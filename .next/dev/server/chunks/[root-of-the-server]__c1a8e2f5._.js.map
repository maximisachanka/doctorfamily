{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///C:/Study/commercial-projects/smartmedical/src/lib/cloudinary.ts"],"sourcesContent":["import { v2 as cloudinary } from 'cloudinary';\r\n\r\n// Конфигурация Cloudinary\r\ncloudinary.config({\r\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\r\n  api_key: process.env.CLOUDINARY_API_KEY,\r\n  api_secret: process.env.CLOUDINARY_API_SECRET,\r\n  secure: true,\r\n});\r\n\r\nexport default cloudinary;\r\n\r\n// Типы для загрузки\r\nexport interface UploadResult {\r\n  public_id: string;\r\n  secure_url: string;\r\n  url: string;\r\n  format: string;\r\n  width: number;\r\n  height: number;\r\n  resource_type: string;\r\n  created_at: string;\r\n  bytes: number;\r\n}\r\n\r\n// Опции для загрузки изображений\r\nexport const imageUploadOptions = {\r\n  folder: 'smartmedical',\r\n  allowed_formats: ['jpg', 'jpeg', 'png', 'webp', 'gif'],\r\n  transformation: [\r\n    { quality: 'auto:good' },\r\n    { fetch_format: 'auto' },\r\n  ],\r\n};\r\n\r\n// Опции для загрузки видео\r\nexport const videoUploadOptions = {\r\n  folder: 'smartmedical/videos',\r\n  allowed_formats: ['mp4', 'webm', 'mov'],\r\n  resource_type: 'video' as const,\r\n  transformation: [\r\n    { quality: 'auto:good' },\r\n  ],\r\n};\r\n\r\n// Папки для разных типов контента\r\nexport const uploadFolders = {\r\n  services: 'smartmedical/services',\r\n  specialists: 'smartmedical/specialists',\r\n  partners: 'smartmedical/partners',\r\n  gallery: 'smartmedical/gallery',\r\n  avatars: 'smartmedical/avatars',\r\n};\r\n\r\n// Функция для получения оптимизированного URL\r\nexport function getOptimizedImageUrl(\r\n  publicId: string,\r\n  options?: {\r\n    width?: number;\r\n    height?: number;\r\n    crop?: string;\r\n    quality?: string;\r\n  }\r\n): string {\r\n  const { width, height, crop = 'fill', quality = 'auto:good' } = options || {};\r\n\r\n  const transformations: string[] = [`q_${quality}`, 'f_auto'];\r\n\r\n  if (width) transformations.push(`w_${width}`);\r\n  if (height) transformations.push(`h_${height}`);\r\n  if (width || height) transformations.push(`c_${crop}`);\r\n\r\n  const transformationString = transformations.join(',');\r\n\r\n  return `https://res.cloudinary.com/${process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME}/image/upload/${transformationString}/${publicId}`;\r\n}\r\n\r\n// Функция для получения URL видео\r\nexport function getVideoUrl(publicId: string): string {\r\n  return `https://res.cloudinary.com/${process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME}/video/upload/q_auto/${publicId}`;\r\n}\r\n\r\n// Функция для удаления файла\r\nexport async function deleteFromCloudinary(publicId: string): Promise<boolean> {\r\n  try {\r\n    const result = await cloudinary.uploader.destroy(publicId);\r\n    return result.result === 'ok';\r\n  } catch (error) {\r\n    console.error('Error deleting from Cloudinary:', error);\r\n    return false;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;;AAEA,0BAA0B;AAC1B,gJAAU,CAAC,MAAM,CAAC;IAChB,YAAY,QAAQ,GAAG,CAAC,qBAAqB;IAC7C,SAAS,QAAQ,GAAG,CAAC,kBAAkB;IACvC,YAAY,QAAQ,GAAG,CAAC,qBAAqB;IAC7C,QAAQ;AACV;uCAEe,gJAAU;AAgBlB,MAAM,qBAAqB;IAChC,QAAQ;IACR,iBAAiB;QAAC;QAAO;QAAQ;QAAO;QAAQ;KAAM;IACtD,gBAAgB;QACd;YAAE,SAAS;QAAY;QACvB;YAAE,cAAc;QAAO;KACxB;AACH;AAGO,MAAM,qBAAqB;IAChC,QAAQ;IACR,iBAAiB;QAAC;QAAO;QAAQ;KAAM;IACvC,eAAe;IACf,gBAAgB;QACd;YAAE,SAAS;QAAY;KACxB;AACH;AAGO,MAAM,gBAAgB;IAC3B,UAAU;IACV,aAAa;IACb,UAAU;IACV,SAAS;IACT,SAAS;AACX;AAGO,SAAS,qBACd,QAAgB,EAChB,OAKC;IAED,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,OAAO,MAAM,EAAE,UAAU,WAAW,EAAE,GAAG,WAAW,CAAC;IAE5E,MAAM,kBAA4B;QAAC,CAAC,EAAE,EAAE,SAAS;QAAE;KAAS;IAE5D,IAAI,OAAO,gBAAgB,IAAI,CAAC,CAAC,EAAE,EAAE,OAAO;IAC5C,IAAI,QAAQ,gBAAgB,IAAI,CAAC,CAAC,EAAE,EAAE,QAAQ;IAC9C,IAAI,SAAS,QAAQ,gBAAgB,IAAI,CAAC,CAAC,EAAE,EAAE,MAAM;IAErD,MAAM,uBAAuB,gBAAgB,IAAI,CAAC;IAElD,OAAO,CAAC,2BAA2B,EAAE,QAAQ,GAAG,CAAC,iCAAiC,CAAC,cAAc,EAAE,qBAAqB,CAAC,EAAE,UAAU;AACvI;AAGO,SAAS,YAAY,QAAgB;IAC1C,OAAO,CAAC,2BAA2B,EAAE,QAAQ,GAAG,CAAC,iCAAiC,CAAC,qBAAqB,EAAE,UAAU;AACtH;AAGO,eAAe,qBAAqB,QAAgB;IACzD,IAAI;QACF,MAAM,SAAS,MAAM,gJAAU,CAAC,QAAQ,CAAC,OAAO,CAAC;QACjD,OAAO,OAAO,MAAM,KAAK;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 187, "column": 0}, "map": {"version":3,"sources":["file:///C:/Study/commercial-projects/smartmedical/src/app/api/upload/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport cloudinary, { uploadFolders, UploadResult } from '@/lib/cloudinary';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const formData = await request.formData();\r\n    const file = formData.get('file') as File;\r\n    const folder = formData.get('folder') as string || 'smartmedical';\r\n    const resourceType = formData.get('resourceType') as 'image' | 'video' || 'image';\r\n\r\n    if (!file) {\r\n      return NextResponse.json(\r\n        { error: 'Файл не предоставлен' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Проверка размера файла (10MB для изображений, 100MB для видео)\r\n    const maxSize = resourceType === 'video' ? 100 * 1024 * 1024 : 10 * 1024 * 1024;\r\n    if (file.size > maxSize) {\r\n      return NextResponse.json(\r\n        { error: `Файл слишком большой. Максимум: ${maxSize / (1024 * 1024)}MB` },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Проверка типа файла\r\n    const allowedImageTypes = ['image/jpeg', 'image/png', 'image/webp', 'image/gif'];\r\n    const allowedVideoTypes = ['video/mp4', 'video/webm', 'video/quicktime'];\r\n    const allowedTypes = resourceType === 'video' ? allowedVideoTypes : allowedImageTypes;\r\n\r\n    if (!allowedTypes.includes(file.type)) {\r\n      return NextResponse.json(\r\n        { error: `Недопустимый тип файла. Разрешены: ${allowedTypes.join(', ')}` },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Конвертируем файл в буфер\r\n    const bytes = await file.arrayBuffer();\r\n    const buffer = Buffer.from(bytes);\r\n\r\n    // Загружаем в Cloudinary\r\n    const result = await new Promise<UploadResult>((resolve, reject) => {\r\n      const uploadStream = cloudinary.uploader.upload_stream(\r\n        {\r\n          folder: folder,\r\n          resource_type: resourceType,\r\n          transformation: resourceType === 'image'\r\n            ? [{ quality: 'auto:good' }, { fetch_format: 'auto' }]\r\n            : [{ quality: 'auto:good' }],\r\n        },\r\n        (error, result) => {\r\n          if (error) reject(error);\r\n          else resolve(result as UploadResult);\r\n        }\r\n      );\r\n\r\n      uploadStream.end(buffer);\r\n    });\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        public_id: result.public_id,\r\n        url: result.secure_url,\r\n        format: result.format,\r\n        width: result.width,\r\n        height: result.height,\r\n        resource_type: result.resource_type,\r\n        bytes: result.bytes,\r\n      }\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Upload error:', error);\r\n    return NextResponse.json(\r\n      { error: 'Ошибка при загрузке файла' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n// GET endpoint для получения подписи для прямой загрузки с клиента\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const folder = searchParams.get('folder') || 'smartmedical';\r\n\r\n    const timestamp = Math.round(new Date().getTime() / 1000);\r\n\r\n    const signature = cloudinary.utils.api_sign_request(\r\n      {\r\n        timestamp,\r\n        folder,\r\n      },\r\n      process.env.CLOUDINARY_API_SECRET!\r\n    );\r\n\r\n    return NextResponse.json({\r\n      signature,\r\n      timestamp,\r\n      cloudName: process.env.CLOUDINARY_CLOUD_NAME,\r\n      apiKey: process.env.CLOUDINARY_API_KEY,\r\n      folder,\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Signature generation error:', error);\r\n    return NextResponse.json(\r\n      { error: 'Ошибка при генерации подписи' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}