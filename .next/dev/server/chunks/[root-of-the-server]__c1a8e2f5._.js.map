{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///C:/Study/commercial-projects/smartmedical/src/lib/cloudinary.ts"],"sourcesContent":["import { v2 as cloudinary } from 'cloudinary';\n\n// Конфигурация Cloudinary\ncloudinary.config({\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n  api_key: process.env.CLOUDINARY_API_KEY,\n  api_secret: process.env.CLOUDINARY_API_SECRET,\n  secure: true,\n});\n\nexport default cloudinary;\n\n// Типы для загрузки\nexport interface UploadResult {\n  public_id: string;\n  secure_url: string;\n  url: string;\n  format: string;\n  width: number;\n  height: number;\n  resource_type: string;\n  created_at: string;\n  bytes: number;\n}\n\n// Опции для загрузки изображений\nexport const imageUploadOptions = {\n  folder: 'smartmedical',\n  allowed_formats: ['jpg', 'jpeg', 'png', 'webp', 'gif'],\n  transformation: [\n    { quality: 'auto:good' },\n    { fetch_format: 'auto' },\n  ],\n};\n\n// Опции для загрузки видео\nexport const videoUploadOptions = {\n  folder: 'smartmedical/videos',\n  allowed_formats: ['mp4', 'webm', 'mov'],\n  resource_type: 'video' as const,\n  transformation: [\n    { quality: 'auto:good' },\n  ],\n};\n\n// Папки для разных типов контента\nexport const uploadFolders = {\n  services: 'smartmedical/services',\n  specialists: 'smartmedical/specialists',\n  partners: 'smartmedical/partners',\n  gallery: 'smartmedical/gallery',\n  avatars: 'smartmedical/avatars',\n};\n\n// Функция для получения оптимизированного URL\nexport function getOptimizedImageUrl(\n  publicId: string,\n  options?: {\n    width?: number;\n    height?: number;\n    crop?: string;\n    quality?: string;\n  }\n): string {\n  const { width, height, crop = 'fill', quality = 'auto:good' } = options || {};\n\n  const transformations: string[] = [`q_${quality}`, 'f_auto'];\n\n  if (width) transformations.push(`w_${width}`);\n  if (height) transformations.push(`h_${height}`);\n  if (width || height) transformations.push(`c_${crop}`);\n\n  const transformationString = transformations.join(',');\n\n  return `https://res.cloudinary.com/${process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME}/image/upload/${transformationString}/${publicId}`;\n}\n\n// Функция для получения URL видео\nexport function getVideoUrl(publicId: string): string {\n  return `https://res.cloudinary.com/${process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME}/video/upload/q_auto/${publicId}`;\n}\n\n// Функция для удаления файла\nexport async function deleteFromCloudinary(publicId: string): Promise<boolean> {\n  try {\n    const result = await cloudinary.uploader.destroy(publicId);\n    return result.result === 'ok';\n  } catch (error) {\n    return false;\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;;AAEA,0BAA0B;AAC1B,gJAAU,CAAC,MAAM,CAAC;IAChB,YAAY,QAAQ,GAAG,CAAC,qBAAqB;IAC7C,SAAS,QAAQ,GAAG,CAAC,kBAAkB;IACvC,YAAY,QAAQ,GAAG,CAAC,qBAAqB;IAC7C,QAAQ;AACV;uCAEe,gJAAU;AAgBlB,MAAM,qBAAqB;IAChC,QAAQ;IACR,iBAAiB;QAAC;QAAO;QAAQ;QAAO;QAAQ;KAAM;IACtD,gBAAgB;QACd;YAAE,SAAS;QAAY;QACvB;YAAE,cAAc;QAAO;KACxB;AACH;AAGO,MAAM,qBAAqB;IAChC,QAAQ;IACR,iBAAiB;QAAC;QAAO;QAAQ;KAAM;IACvC,eAAe;IACf,gBAAgB;QACd;YAAE,SAAS;QAAY;KACxB;AACH;AAGO,MAAM,gBAAgB;IAC3B,UAAU;IACV,aAAa;IACb,UAAU;IACV,SAAS;IACT,SAAS;AACX;AAGO,SAAS,qBACd,QAAgB,EAChB,OAKC;IAED,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,OAAO,MAAM,EAAE,UAAU,WAAW,EAAE,GAAG,WAAW,CAAC;IAE5E,MAAM,kBAA4B;QAAC,CAAC,EAAE,EAAE,SAAS;QAAE;KAAS;IAE5D,IAAI,OAAO,gBAAgB,IAAI,CAAC,CAAC,EAAE,EAAE,OAAO;IAC5C,IAAI,QAAQ,gBAAgB,IAAI,CAAC,CAAC,EAAE,EAAE,QAAQ;IAC9C,IAAI,SAAS,QAAQ,gBAAgB,IAAI,CAAC,CAAC,EAAE,EAAE,MAAM;IAErD,MAAM,uBAAuB,gBAAgB,IAAI,CAAC;IAElD,OAAO,CAAC,2BAA2B,EAAE,QAAQ,GAAG,CAAC,iCAAiC,CAAC,cAAc,EAAE,qBAAqB,CAAC,EAAE,UAAU;AACvI;AAGO,SAAS,YAAY,QAAgB;IAC1C,OAAO,CAAC,2BAA2B,EAAE,QAAQ,GAAG,CAAC,iCAAiC,CAAC,qBAAqB,EAAE,UAAU;AACtH;AAGO,eAAe,qBAAqB,QAAgB;IACzD,IAAI;QACF,MAAM,SAAS,MAAM,gJAAU,CAAC,QAAQ,CAAC,OAAO,CAAC;QACjD,OAAO,OAAO,MAAM,KAAK;IAC3B,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 186, "column": 0}, "map": {"version":3,"sources":["file:///C:/Study/commercial-projects/smartmedical/src/app/api/upload/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport cloudinary, { uploadFolders, UploadResult } from '@/lib/cloudinary';\n\nexport async function POST(request: NextRequest) {\n  try {\n    const formData = await request.formData();\n    const file = formData.get('file') as File;\n    const folder = formData.get('folder') as string || 'smartmedical';\n    const resourceType = formData.get('resourceType') as 'image' | 'video' || 'image';\n\n    if (!file) {\n      return NextResponse.json(\n        { error: 'Файл не предоставлен' },\n        { status: 400 }\n      );\n    }\n\n    // Проверка размера файла (10MB для изображений, 100MB для видео)\n    const maxSize = resourceType === 'video' ? 100 * 1024 * 1024 : 10 * 1024 * 1024;\n    if (file.size > maxSize) {\n      return NextResponse.json(\n        { error: `Файл слишком большой. Максимум: ${maxSize / (1024 * 1024)}MB` },\n        { status: 400 }\n      );\n    }\n\n    // Проверка типа файла\n    const allowedImageTypes = ['image/jpeg', 'image/png', 'image/webp', 'image/gif'];\n    const allowedVideoTypes = ['video/mp4', 'video/webm', 'video/quicktime'];\n    const allowedTypes = resourceType === 'video' ? allowedVideoTypes : allowedImageTypes;\n\n    if (!allowedTypes.includes(file.type)) {\n      return NextResponse.json(\n        { error: `Недопустимый тип файла. Разрешены: ${allowedTypes.join(', ')}` },\n        { status: 400 }\n      );\n    }\n\n    // Конвертируем файл в буфер\n    const bytes = await file.arrayBuffer();\n    const buffer = Buffer.from(bytes);\n\n    // Загружаем в Cloudinary\n    const result = await new Promise<UploadResult>((resolve, reject) => {\n      const uploadStream = cloudinary.uploader.upload_stream(\n        {\n          folder: folder,\n          resource_type: resourceType,\n          transformation: resourceType === 'image'\n            ? [{ quality: 'auto:good' }, { fetch_format: 'auto' }]\n            : [{ quality: 'auto:good' }],\n        },\n        (error, result) => {\n          if (error) reject(error);\n          else resolve(result as UploadResult);\n        }\n      );\n\n      uploadStream.end(buffer);\n    });\n\n    return NextResponse.json({\n      success: true,\n      data: {\n        public_id: result.public_id,\n        url: result.secure_url,\n        format: result.format,\n        width: result.width,\n        height: result.height,\n        resource_type: result.resource_type,\n        bytes: result.bytes,\n      }\n    });\n\n  } catch (error) {\n    return NextResponse.json(\n      { error: 'Ошибка при загрузке файла' },\n      { status: 500 }\n    );\n  }\n}\n\n// GET endpoint для получения подписи для прямой загрузки с клиента\nexport async function GET(request: NextRequest) {\n  try {\n    const searchParams = request.nextUrl.searchParams;\n    const folder = searchParams.get('folder') || 'smartmedical';\n\n    const timestamp = Math.round(new Date().getTime() / 1000);\n\n    const signature = cloudinary.utils.api_sign_request(\n      {\n        timestamp,\n        folder,\n      },\n      process.env.CLOUDINARY_API_SECRET!\n    );\n\n    return NextResponse.json({\n      signature,\n      timestamp,\n      cloudName: process.env.CLOUDINARY_CLOUD_NAME,\n      apiKey: process.env.CLOUDINARY_API_KEY,\n      folder,\n    });\n\n  } catch (error) {\n    return NextResponse.json(\n      { error: 'Ошибка при генерации подписи' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,WAAW,MAAM,QAAQ,QAAQ;QACvC,MAAM,OAAO,SAAS,GAAG,CAAC;QAC1B,MAAM,SAAS,SAAS,GAAG,CAAC,aAAuB;QACnD,MAAM,eAAe,SAAS,GAAG,CAAC,mBAAwC;QAE1E,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAuB,GAChC;gBAAE,QAAQ;YAAI;QAElB;QAEA,iEAAiE;QACjE,MAAM,UAAU,iBAAiB,UAAU,MAAM,OAAO,OAAO,KAAK,OAAO;QAC3E,IAAI,KAAK,IAAI,GAAG,SAAS;YACvB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO,CAAC,gCAAgC,EAAE,UAAU,CAAC,OAAO,IAAI,EAAE,EAAE,CAAC;YAAC,GACxE;gBAAE,QAAQ;YAAI;QAElB;QAEA,sBAAsB;QACtB,MAAM,oBAAoB;YAAC;YAAc;YAAa;YAAc;SAAY;QAChF,MAAM,oBAAoB;YAAC;YAAa;YAAc;SAAkB;QACxE,MAAM,eAAe,iBAAiB,UAAU,oBAAoB;QAEpE,IAAI,CAAC,aAAa,QAAQ,CAAC,KAAK,IAAI,GAAG;YACrC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO,CAAC,mCAAmC,EAAE,aAAa,IAAI,CAAC,OAAO;YAAC,GACzE;gBAAE,QAAQ;YAAI;QAElB;QAEA,4BAA4B;QAC5B,MAAM,QAAQ,MAAM,KAAK,WAAW;QACpC,MAAM,SAAS,OAAO,IAAI,CAAC;QAE3B,yBAAyB;QACzB,MAAM,SAAS,MAAM,IAAI,QAAsB,CAAC,SAAS;YACvD,MAAM,eAAe,qIAAU,CAAC,QAAQ,CAAC,aAAa,CACpD;gBACE,QAAQ;gBACR,eAAe;gBACf,gBAAgB,iBAAiB,UAC7B;oBAAC;wBAAE,SAAS;oBAAY;oBAAG;wBAAE,cAAc;oBAAO;iBAAE,GACpD;oBAAC;wBAAE,SAAS;oBAAY;iBAAE;YAChC,GACA,CAAC,OAAO;gBACN,IAAI,OAAO,OAAO;qBACb,QAAQ;YACf;YAGF,aAAa,GAAG,CAAC;QACnB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM;gBACJ,WAAW,OAAO,SAAS;gBAC3B,KAAK,OAAO,UAAU;gBACtB,QAAQ,OAAO,MAAM;gBACrB,OAAO,OAAO,KAAK;gBACnB,QAAQ,OAAO,MAAM;gBACrB,eAAe,OAAO,aAAa;gBACnC,OAAO,OAAO,KAAK;YACrB;QACF;IAEF,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA4B,GACrC;YAAE,QAAQ;QAAI;IAElB;AACF;AAGO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;QACjD,MAAM,SAAS,aAAa,GAAG,CAAC,aAAa;QAE7C,MAAM,YAAY,KAAK,KAAK,CAAC,IAAI,OAAO,OAAO,KAAK;QAEpD,MAAM,YAAY,qIAAU,CAAC,KAAK,CAAC,gBAAgB,CACjD;YACE;YACA;QACF,GACA,QAAQ,GAAG,CAAC,qBAAqB;QAGnC,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB;YACA;YACA,WAAW,QAAQ,GAAG,CAAC,qBAAqB;YAC5C,QAAQ,QAAQ,GAAG,CAAC,kBAAkB;YACtC;QACF;IAEF,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA+B,GACxC;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}