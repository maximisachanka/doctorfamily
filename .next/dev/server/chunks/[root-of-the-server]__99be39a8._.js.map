{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Study/commercial-projects/smartmedical/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\nconst globalForPrisma = globalThis as unknown as {\r\n  prisma: PrismaClient | undefined;\r\n};\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ??\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEF,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 71, "column": 0}, "map": {"version":3,"sources":["file:///C:/Study/commercial-projects/smartmedical/src/utils/serviceMapping.ts"],"sourcesContent":["/**\r\n * Маппинг между serviceId из меню и названиями услуг в БД\r\n * Это необходимо для точного сопоставления URL из меню с данными в базе\r\n */\r\nexport const serviceIdToTitleMapping: Record<string, Record<string, string>> = {\r\n  // Стоматология\r\n  'dentistry': {\r\n    'caries-treatment': 'Лечение кариеса',\r\n    'teeth-whitening': 'Отбеливание зубов Beyond Polus',\r\n    'professional-cleaning': 'Профессиональная чистка зубов Air Flow',\r\n    'pulpitis-treatment': 'Лечение пульпита',\r\n    'ultrasonic-cleaning': 'Профессиональная чистка зубов Air Flow',\r\n    'oral-hygiene': 'Профессиональная чистка зубов Air Flow',\r\n  },\r\n  // Детская стоматология\r\n  'pediatric-dentistry': {\r\n    'milk-teeth-treatment': 'Лечение молочных зубов',\r\n    'pediatric-surgeon': 'Детский хирург-стоматолог',\r\n    'pediatric-orthodontist': 'Детский ортодонт',\r\n    'milk-teeth-anesthesia': 'Лечение молочных зубов под наркозом',\r\n  },\r\n  // Гинекология\r\n  'gynecology': {\r\n    'gynecologist-appointment': 'Приём гинеколога',\r\n    'diagnostic-studies': 'Диагностические исследования',\r\n    'intrauterine-device': 'Приём гинеколога', // Fallback\r\n    'cervical-conization': 'Приём гинеколога', // Fallback\r\n    'colposcopy': 'Приём гинеколога', // Fallback\r\n    'tube-patency-check': 'Приём гинеколога', // Fallback\r\n    'polyp-removal': 'Приём гинеколога', // Fallback\r\n    'diagnostic-curettage': 'Приём гинеколога', // Fallback\r\n    'culdocentesis': 'Приём гинеколога', // Fallback\r\n  },\r\n  // УЗИ\r\n  'ultrasound': {\r\n    'pelvic-ultrasound': 'УЗИ органов малого таза',\r\n    'breast-ultrasound': 'УЗИ молочных желез',\r\n    'thyroid-ultrasound': 'УЗИ щитовидной железы',\r\n    'abdominal-ultrasound': 'УЗИ органов брюшной полости',\r\n    'fetal-ultrasound': 'УЗИ плода',\r\n    'gender-party': 'УЗИ плода', // Fallback\r\n  },\r\n  // Кардиология\r\n  'cardiology': {\r\n    'echo-kg': 'ЭХО-КГ (УЗИ сердца)',\r\n    'cardiologist-appointment': 'Приём кардиолога',\r\n    'ecg': 'ЭКГ (электрокардиография)',\r\n    'holter-monitoring': 'Холтеровское мониторирование',\r\n  },\r\n  // Детская гинекология\r\n  'pediatric-gynecology': {\r\n    'pediatric-gynecologist': 'Детский гинеколог',\r\n    'pelvic-ultrasound-girls': 'УЗИ органов малого таза для девочек',\r\n    'adolescent-gynecologist': 'Подростковый гинеколог',\r\n  },\r\n  // Эндокринология\r\n  'endocrinology': {\r\n    'endocrinologist-consultation': 'Консультация врача-эндокринолога',\r\n  },\r\n  // Онкология\r\n  'oncology': {\r\n    'oncologist-appointment': 'Приём врача онколога',\r\n  },\r\n  // Дневной стационар\r\n  'day-hospital': {\r\n    'procedure-room': 'Процедурный кабинет',\r\n  },\r\n  // Диагностика\r\n  'diagnostics': {\r\n    'expert-ultrasound': 'Экспертное УЗИ',\r\n    'analyses': 'Лабораторные анализы',\r\n    'tooth-xray': 'Рентген зубов',\r\n    '3d-dental-scan': '3D сканирование зубов',\r\n    'panoramic-dental-scan': 'Панорамный снимок зубов',\r\n  },\r\n};\r\n\r\n/**\r\n * Получить название услуги по serviceId и categorySlug\r\n */\r\nexport function getServiceTitleByServiceId(\r\n  categorySlug: string,\r\n  serviceId: string\r\n): string | null {\r\n  const categoryMapping = serviceIdToTitleMapping[categorySlug];\r\n  if (!categoryMapping) {\r\n    return null;\r\n  }\r\n  return categoryMapping[serviceId] || null;\r\n}\r\n\r\n/**\r\n * Получить serviceId (slug) по названию услуги и categorySlug\r\n * Обратный маппинг для поиска\r\n */\r\nexport function getServiceSlugByTitle(\r\n  categorySlug: string,\r\n  serviceTitle: string\r\n): string | null {\r\n  const categoryMapping = serviceIdToTitleMapping[categorySlug];\r\n  if (!categoryMapping) {\r\n    return null;\r\n  }\r\n\r\n  // Ищем serviceId по названию\r\n  for (const [serviceId, title] of Object.entries(categoryMapping)) {\r\n    if (title.toLowerCase() === serviceTitle.toLowerCase()) {\r\n      return serviceId;\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Получить ключевые слова для поиска услуги по serviceId\r\n */\r\nexport function getServiceKeywords(serviceId: string): string[] {\r\n  const keywordMap: Record<string, string[]> = {\r\n    'breast-ultrasound': ['молочных', 'желез', 'груди', 'молочные', 'грудь'],\r\n    'pelvic-ultrasound': ['малого', 'таза', 'органов', 'малый', 'таз', 'малого таза'],\r\n    'pelvic-ultrasound-girls': ['малого', 'таза', 'органов', 'малый', 'таз', 'малого таза', 'девочек'],\r\n    'thyroid-ultrasound': ['щитовидной', 'железы', 'щитовидная'],\r\n    'caries-treatment': ['кариеса', 'лечение', 'кариес'],\r\n    'teeth-whitening': ['отбеливание', 'зубов', 'белизна'],\r\n    'professional-cleaning': ['чистка', 'зубов', 'профессиональная', 'чистка зубов'],\r\n    'pulpitis-treatment': ['пульпита', 'лечение', 'пульпит'],\r\n    'milk-teeth-treatment': ['молочных', 'зубов', 'лечение', 'молочные зубы'],\r\n    'pediatric-surgeon': ['детский', 'хирург', 'стоматолог', 'удаление'],\r\n    'pediatric-orthodontist': ['детский', 'ортодонт', 'брекеты', 'прикус'],\r\n    'milk-teeth-anesthesia': ['молочных', 'зубов', 'наркоз', 'лечение под наркозом'],\r\n    'gynecologist-appointment': ['гинеколога', 'приём', 'гинеколог'],\r\n    'diagnostic-studies': ['диагностические', 'исследования', 'кольпоскопия', 'биопсия'],\r\n    'abdominal-ultrasound': ['брюшной', 'полости', 'брюшная', 'органов брюшной полости'],\r\n    'fetal-ultrasound': ['плода', 'беременности', 'плод', 'узи плода'],\r\n    'echo-kg': ['эхо', 'кг', 'сердца', 'эхокардиография'],\r\n    'expert-ultrasound': ['экспертное', 'узи', 'экспертный'],\r\n    'analyses': ['лабораторные', 'анализы', 'анализ'],\r\n    'tooth-xray': ['рентген', 'зубов', 'снимок'],\r\n    '3d-dental-scan': ['3d', 'сканирование', 'зубов', 'томография'],\r\n    'panoramic-dental-scan': ['панорамный', 'снимок', 'зубов', 'ортопантомограмма'],\r\n  };\r\n  \r\n  return keywordMap[serviceId] || [];\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 375, "column": 0}, "map": {"version":3,"sources":["file:///C:/Study/commercial-projects/smartmedical/src/app/api/auth/%5B...nextauth%5D/route.ts"],"sourcesContent":["import NextAuth, { NextAuthOptions } from \"next-auth\"\r\nimport GoogleProvider from \"next-auth/providers/google\";\r\nimport CredentialsProvider from \"next-auth/providers/credentials\";\r\nimport bcrypt from \"bcryptjs\";\r\nimport { prisma } from \"@/lib/prisma\";\r\n\r\nexport const authOptions: NextAuthOptions = {\r\n    secret: process.env.NEXTAUTH_SECRET,\r\n    providers: [\r\n        GoogleProvider({\r\n            clientId: process.env.GOOGLE_CLIENT_ID || \"\",\r\n            clientSecret: process.env.GOOGLE_CLIENT_SECRET || \"\",\r\n        }),\r\n        CredentialsProvider({\r\n            name: \"Credentials\",\r\n            credentials: {\r\n                login: { label: \"Логин\", type: \"text\" },\r\n                password: { label: \"Пароль\", type: \"password\" }\r\n            },\r\n            async authorize(credentials) {\r\n                if (!credentials?.login || !credentials?.password) {\r\n                    return null;\r\n                }\r\n\r\n                try {\r\n                    const user = await prisma.patient.findFirst({\r\n                        where: { login: credentials.login },\r\n                    });\r\n\r\n                    if (!user) {\r\n                        return null;\r\n                    }\r\n\r\n                    const isPasswordValid = await bcrypt.compare(\r\n                        credentials.password,\r\n                        user.password\r\n                    );\r\n\r\n                    if (!isPasswordValid) {\r\n                        return null;\r\n                    }\r\n\r\n                    return {\r\n                        id: user.id.toString(),\r\n                        email: user.email,\r\n                        name: user.name,\r\n                        role: user.role,\r\n                        image: user.avatar_url,\r\n                    };\r\n                } catch (error) {\r\n                    console.error(\"Auth error:\", error);\r\n                    return null;\r\n                }\r\n            }\r\n        }),\r\n    ],\r\n    pages: {\r\n        signIn: \"/\",\r\n    },\r\n    session: {\r\n        strategy: \"jwt\",\r\n    },\r\n    callbacks: {\r\n        async jwt({ token, user }) {\r\n            if (user) {\r\n                token.id = user.id;\r\n                token.role = (user as { role?: string }).role;\r\n                token.picture = user.image;\r\n            }\r\n            return token;\r\n        },\r\n        async session({ session, token }) {\r\n            if (session.user && token.id) {\r\n                (session.user as { id: string; role?: string }).id = token.id as string;\r\n                (session.user as { id: string; role?: string }).role = token.role as string;\r\n                session.user.image = token.picture as string | null | undefined;\r\n            }\r\n            return session;\r\n        },\r\n    },\r\n};\r\n\r\nconst handler = NextAuth(authOptions);\r\n\r\nexport { handler as GET, handler as POST };"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEO,MAAM,cAA+B;IACxC,QAAQ,QAAQ,GAAG,CAAC,eAAe;IACnC,WAAW;QACP,IAAA,gKAAc,EAAC;YACX,UAAU,QAAQ,GAAG,CAAC,gBAAgB,IAAI;YAC1C,cAAc,QAAQ,GAAG,CAAC,oBAAoB,IAAI;QACtD;QACA,IAAA,qKAAmB,EAAC;YAChB,MAAM;YACN,aAAa;gBACT,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAO;gBACtC,UAAU;oBAAE,OAAO;oBAAU,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW;gBACvB,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU;oBAC/C,OAAO;gBACX;gBAEA,IAAI;oBACA,MAAM,OAAO,MAAM,gIAAM,CAAC,OAAO,CAAC,SAAS,CAAC;wBACxC,OAAO;4BAAE,OAAO,YAAY,KAAK;wBAAC;oBACtC;oBAEA,IAAI,CAAC,MAAM;wBACP,OAAO;oBACX;oBAEA,MAAM,kBAAkB,MAAM,8IAAM,CAAC,OAAO,CACxC,YAAY,QAAQ,EACpB,KAAK,QAAQ;oBAGjB,IAAI,CAAC,iBAAiB;wBAClB,OAAO;oBACX;oBAEA,OAAO;wBACH,IAAI,KAAK,EAAE,CAAC,QAAQ;wBACpB,OAAO,KAAK,KAAK;wBACjB,MAAM,KAAK,IAAI;wBACf,MAAM,KAAK,IAAI;wBACf,OAAO,KAAK,UAAU;oBAC1B;gBACJ,EAAE,OAAO,OAAO;oBACZ,QAAQ,KAAK,CAAC,eAAe;oBAC7B,OAAO;gBACX;YACJ;QACJ;KACH;IACD,OAAO;QACH,QAAQ;IACZ;IACA,SAAS;QACL,UAAU;IACd;IACA,WAAW;QACP,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACrB,IAAI,MAAM;gBACN,MAAM,EAAE,GAAG,KAAK,EAAE;gBAClB,MAAM,IAAI,GAAG,AAAC,KAA2B,IAAI;gBAC7C,MAAM,OAAO,GAAG,KAAK,KAAK;YAC9B;YACA,OAAO;QACX;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC5B,IAAI,QAAQ,IAAI,IAAI,MAAM,EAAE,EAAE;gBACzB,QAAQ,IAAI,CAAmC,EAAE,GAAG,MAAM,EAAE;gBAC5D,QAAQ,IAAI,CAAmC,IAAI,GAAG,MAAM,IAAI;gBACjE,QAAQ,IAAI,CAAC,KAAK,GAAG,MAAM,OAAO;YACtC;YACA,OAAO;QACX;IACJ;AACJ;AAEA,MAAM,UAAU,IAAA,kJAAQ,EAAC","debugId":null}},
    {"offset": {"line": 474, "column": 0}, "map": {"version":3,"sources":["file:///C:/Study/commercial-projects/smartmedical/src/app/api/search/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport { getServiceSlugByTitle } from \"@/utils/serviceMapping\";\r\nimport { getServerSession } from \"next-auth\";\r\nimport { authOptions } from \"@/app/api/auth/[...nextauth]/route\";\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const query = searchParams.get(\"q\");\r\n\r\n    if (!query || query.trim().length < 3) {\r\n      return NextResponse.json({ results: [] }, { status: 200 });\r\n    }\r\n\r\n    // Проверяем авторизацию пользователя\r\n    const session = await getServerSession(authOptions);\r\n    const isAuthenticated = !!session?.user;\r\n\r\n    const searchTerm = query.trim();\r\n\r\n    // Проверка на кириллицу (русский текст)\r\n    const hasCyrillic = /[а-яёА-ЯЁ]/.test(searchTerm);\r\n    const hasLatin = /[a-zA-Z]/.test(searchTerm);\r\n\r\n    // Если есть латиница, но нет кириллицы - отклоняем поиск\r\n    if (hasLatin && !hasCyrillic) {\r\n      return NextResponse.json({\r\n        results: [],\r\n        error: \"Пожалуйста, используйте русский язык для поиска\"\r\n      }, { status: 200 });\r\n    }\r\n\r\n    // Нормализация поискового запроса\r\n    // Убираем лишние пробелы, приводим к нижнему регистру для внутренних сравнений\r\n    const normalizedTerm = searchTerm.replace(/\\s+/g, ' ').trim();\r\n\r\n    // Search across all entities\r\n    const [services, specialists, vacancies, faqs, materials, partners, contacts] = await Promise.all([\r\n      // Search Services\r\n      prisma.service.findMany({\r\n        where: {\r\n          OR: [\r\n            { title: { contains: normalizedTerm, mode: \"insensitive\" } },\r\n            { subtitle: { contains: normalizedTerm, mode: \"insensitive\" } },\r\n            { description: { contains: normalizedTerm, mode: \"insensitive\" } },\r\n          ],\r\n        },\r\n        include: {\r\n          category: true,\r\n        },\r\n        take: 10,\r\n      }),\r\n\r\n      // Search Specialists\r\n      prisma.specialist.findMany({\r\n        where: {\r\n          OR: [\r\n            { name: { contains: normalizedTerm, mode: \"insensitive\" } },\r\n            { specialization: { contains: normalizedTerm, mode: \"insensitive\" } },\r\n            { qualification: { contains: normalizedTerm, mode: \"insensitive\" } },\r\n          ],\r\n        },\r\n        include: {\r\n          category: true,\r\n        },\r\n        take: 10,\r\n      }),\r\n\r\n      // Search Vacancies\r\n      prisma.vacancy.findMany({\r\n        where: {\r\n          OR: [\r\n            { name: { contains: normalizedTerm, mode: \"insensitive\" } },\r\n            { category: { contains: normalizedTerm, mode: \"insensitive\" } },\r\n            { description: { contains: normalizedTerm, mode: \"insensitive\" } },\r\n            { requirements: { contains: normalizedTerm, mode: \"insensitive\" } },\r\n          ],\r\n        },\r\n        take: 10,\r\n      }),\r\n\r\n      // Search FAQs\r\n      prisma.question.findMany({\r\n        where: {\r\n          OR: [\r\n            { question: { contains: normalizedTerm, mode: \"insensitive\" } },\r\n            { answer: { contains: normalizedTerm, mode: \"insensitive\" } },\r\n          ],\r\n        },\r\n        take: 10,\r\n      }),\r\n\r\n      // Search Materials (только для авторизованных пользователей)\r\n      isAuthenticated\r\n        ? prisma.material.findMany({\r\n            where: {\r\n              AND: [\r\n                { is_active: true },\r\n                {\r\n                  OR: [\r\n                    { title: { contains: normalizedTerm, mode: \"insensitive\" } },\r\n                    { content: { contains: normalizedTerm, mode: \"insensitive\" } },\r\n                  ],\r\n                },\r\n              ],\r\n            },\r\n            take: 10,\r\n          })\r\n        : Promise.resolve([]),\r\n\r\n      // Search Partners\r\n      prisma.partner.findMany({\r\n        where: {\r\n          OR: [\r\n            { name: { contains: normalizedTerm, mode: \"insensitive\" } },\r\n            { description: { contains: normalizedTerm, mode: \"insensitive\" } },\r\n          ],\r\n        },\r\n        include: {\r\n          category: true,\r\n        },\r\n        take: 10,\r\n      }),\r\n\r\n      // Search Contacts\r\n      prisma.contacts.findMany({\r\n        where: {\r\n          OR: [\r\n            { address: { contains: normalizedTerm, mode: \"insensitive\" } },\r\n            { phone_number: { contains: normalizedTerm, mode: \"insensitive\" } },\r\n            { phone_number_sec: { contains: normalizedTerm, mode: \"insensitive\" } },\r\n            { email: { contains: normalizedTerm, mode: \"insensitive\" } },\r\n          ],\r\n        },\r\n        take: 1,\r\n      }),\r\n    ]);\r\n\r\n    // Format results\r\n    type SearchResult = {\r\n      id: string;\r\n      title: string;\r\n      description: string;\r\n      category: string;\r\n      url: string;\r\n      type: \"service\" | \"specialist\" | \"vacancy\" | \"faq\" | \"material\" | \"partner\" | \"contact\" | \"patient-info\";\r\n    };\r\n\r\n    const results: SearchResult[] = [\r\n      ...services.map((service) => {\r\n        // Получаем slug услуги по её названию и категории\r\n        const serviceSlug = getServiceSlugByTitle(service.category.slug, service.title);\r\n\r\n        // Если slug найден, используем полный URL, иначе перенаправляем на страницу услуг\r\n        const url = serviceSlug\r\n          ? `/services/${service.category.slug}/${serviceSlug}`\r\n          : `/services`;\r\n\r\n        return {\r\n          id: `service-${service.id}`,\r\n          title: service.title,\r\n          description: service.description,\r\n          category: service.category.name,\r\n          url,\r\n          type: \"service\" as const,\r\n        };\r\n      }),\r\n\r\n      ...specialists.map((specialist) => ({\r\n        id: `specialist-${specialist.id}`,\r\n        title: specialist.name,\r\n        description: `${specialist.specialization} • Стаж: ${specialist.experience} лет • ${specialist.qualification}`,\r\n        category: specialist.category.name,\r\n        url: `/doctors/${specialist.category.slug}/${specialist.id}`,\r\n        type: \"specialist\" as const,\r\n      })),\r\n\r\n      ...vacancies.map((vacancy) => ({\r\n        id: `vacancy-${vacancy.id}`,\r\n        title: vacancy.name,\r\n        description: vacancy.description,\r\n        category: vacancy.category,\r\n        url: `/clinic/vacancies#vacancy-${vacancy.id}`,\r\n        type: \"vacancy\" as const,\r\n      })),\r\n\r\n      ...faqs.map((faq) => {\r\n        // Формируем правильный URL с категорией FAQ\r\n        const faqCategory = faq.category || 'faq';\r\n        const url = `/clinic/faq/${faqCategory}#faq-${faq.id}`;\r\n\r\n        return {\r\n          id: `faq-${faq.id}`,\r\n          title: faq.question,\r\n          description: faq.answer || \"Ответ скоро будет добавлен\",\r\n          category: faq.category || \"Общие вопросы\",\r\n          url,\r\n          type: \"faq\" as const,\r\n        };\r\n      }),\r\n\r\n      ...materials.map((material) => ({\r\n        id: `material-${material.id}`,\r\n        title: material.title,\r\n        description: material.content,\r\n        category: `Материалы ${material.year}`,\r\n        url: `/account#material-${material.id}`,\r\n        type: \"material\" as const,\r\n      })),\r\n\r\n      ...partners.map((partner) => {\r\n        // Маппинг категории партнера на страницу клиники\r\n        const categoryPageMap: Record<string, string> = {\r\n          'diagnostics': 'medical-labs',\r\n          'gynecology': 'insurance',\r\n          'ultrasound': 'dental-labs'\r\n        };\r\n\r\n        const clinicPage = categoryPageMap[partner.category.slug] || 'partners';\r\n\r\n        return {\r\n          id: `partner-${partner.id}`,\r\n          title: partner.name,\r\n          description: partner.description,\r\n          category: partner.category.name,\r\n          url: `/clinic/${clinicPage}#partner-${partner.id}`,\r\n          type: \"partner\" as const,\r\n        };\r\n      }),\r\n\r\n      ...contacts.map((contact) => ({\r\n        id: `contact-${contact.id}`,\r\n        title: \"Контакты клиники\",\r\n        description: `${contact.address} • Тел: ${contact.phone_number} • Email: ${contact.email}`,\r\n        category: \"Контактная информация\",\r\n        url: \"/contacts\",\r\n        type: \"contact\" as const,\r\n      })),\r\n    ];\r\n\r\n    // Add static search results for Patient Information page\r\n    const patientPageKeywords = [\r\n      {\r\n        keywords: [\"запись\", \"приём\", \"прием\", \"записаться\", \"визит\"],\r\n        title: \"Запись на приём\",\r\n        description: \"Узнайте, как записаться на приём к специалисту, что взять с собой и правила посещения клиники\",\r\n      },\r\n      {\r\n        keywords: [\"подготовка\", \"анализ\", \"кровь\", \"моча\", \"экг\", \"узи\", \"обследование\", \"сдать\"],\r\n        title: \"Подготовка к анализам и обследованиям\",\r\n        description: \"Рекомендации по подготовке к анализам крови, мочи, ЭКГ, УЗИ и другим обследованиям\",\r\n      },\r\n      {\r\n        keywords: [\"документ\", \"договор\", \"согласие\", \"политика\", \"конфиденциальность\", \"защита данных\"],\r\n        title: \"Документы и согласия\",\r\n        description: \"Договор оказания услуг, политика конфиденциальности, защита персональных данных и информированное согласие\",\r\n      },\r\n      {\r\n        keywords: [\"оплата\", \"цена\", \"стоимость\", \"тариф\", \"страховка\", \"страхование\", \"оплатить\"],\r\n        title: \"Способы оплаты\",\r\n        description: \"Информация о способах оплаты услуг: наличные, банковские карты, рассрочка и медицинское страхование\",\r\n      },\r\n    ];\r\n\r\n    const patientPageResults = patientPageKeywords\r\n      .filter((item) =>\r\n        item.keywords.some((keyword) =>\r\n          keyword.includes(normalizedTerm.toLowerCase()) ||\r\n          normalizedTerm.toLowerCase().includes(keyword)\r\n        )\r\n      )\r\n      .map((item, index) => ({\r\n        id: `patient-info-${index}`,\r\n        title: item.title,\r\n        description: item.description,\r\n        category: \"Информация для пациентов\",\r\n        url: \"/patient\",\r\n        type: \"patient-info\" as const,\r\n      }));\r\n\r\n    results.push(...patientPageResults);\r\n\r\n    return NextResponse.json({ results }, { status: 200 });\r\n  } catch (error) {\r\n    console.error(\"Search error:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Ошибка при поиске\", results: [] },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}