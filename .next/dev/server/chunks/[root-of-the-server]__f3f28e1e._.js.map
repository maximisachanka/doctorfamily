{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Study/commercial-projects/smartmedical/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\nconst globalForPrisma = globalThis as unknown as {\r\n  prisma: PrismaClient | undefined;\r\n};\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ??\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEF,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 77, "column": 0}, "map": {"version":3,"sources":["file:///C:/Study/commercial-projects/smartmedical/src/app/api/auth/register/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport bcrypt from \"bcryptjs\";\r\nimport { prisma } from \"@/lib/prisma\";\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json();\r\n    const {\r\n      lastName,\r\n      firstName,\r\n      middleName,\r\n      email,\r\n      phone,\r\n      password,\r\n      confirmPassword,\r\n      login,\r\n    } = body;\r\n\r\n    // Валидация обязательных полей\r\n    if (!login || !email || !password || !firstName || !lastName || !phone) {\r\n      return NextResponse.json(\r\n        { error: \"Все обязательные поля должны быть заполнены\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Проверка совпадения паролей\r\n    if (password !== confirmPassword) {\r\n      return NextResponse.json(\r\n        { error: \"Пароли не совпадают\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Проверка минимальной длины пароля\r\n    if (password.length < 6) {\r\n      return NextResponse.json(\r\n        { error: \"Пароль должен содержать минимум 6 символов\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Проверка минимальной длины логина\r\n    if (login.length < 3) {\r\n      return NextResponse.json(\r\n        { error: \"Логин должен содержать минимум 3 символа\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Валидация формата email\r\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n    if (!emailRegex.test(email)) {\r\n      return NextResponse.json(\r\n        { error: \"Некорректный формат email\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Валидация формата белорусского телефона: +375(XX)XXX-XX-XX\r\n    const phoneRegex = /^\\+375\\((25|29|33|44|17)\\)\\d{3}-\\d{2}-\\d{2}$/;\r\n    if (!phoneRegex.test(phone)) {\r\n      return NextResponse.json(\r\n        { error: \"Некорректный формат телефона. Используйте формат: +375(29)123-45-67\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Проверка уникальности email\r\n    const existingUserByEmail = await prisma.patient.findFirst({\r\n      where: { email },\r\n    });\r\n\r\n    if (existingUserByEmail) {\r\n      return NextResponse.json(\r\n        { error: \"Пользователь с таким email уже существует\" },\r\n        { status: 409 }\r\n      );\r\n    }\r\n\r\n    // Проверка уникальности логина\r\n    const existingUserByLogin = await prisma.patient.findFirst({\r\n      where: { login },\r\n    });\r\n\r\n    if (existingUserByLogin) {\r\n      return NextResponse.json(\r\n        { error: \"Пользователь с таким логином уже существует\" },\r\n        { status: 409 }\r\n      );\r\n    }\r\n\r\n    // Проверка уникальности телефона\r\n    const existingUserByPhone = await prisma.patient.findFirst({\r\n      where: { phone },\r\n    });\r\n\r\n    if (existingUserByPhone) {\r\n      return NextResponse.json(\r\n        { error: \"Пользователь с таким телефоном уже существует\" },\r\n        { status: 409 }\r\n      );\r\n    }\r\n\r\n    // Хеширование пароля\r\n    const hashedPassword = await bcrypt.hash(password, 10);\r\n\r\n    // Формирование полного имени\r\n    const fullName = `${lastName} ${firstName}${middleName ? ` ${middleName}` : \"\"}`.trim();\r\n\r\n    // Создание пользователя\r\n    const user = await prisma.patient.create({\r\n      data: {\r\n        login,\r\n        email,\r\n        password: hashedPassword,\r\n        name: fullName,\r\n        phone,\r\n        registration_date: new Date(),\r\n      },\r\n    });\r\n\r\n    // Возвращаем успешный ответ без пароля\r\n    return NextResponse.json(\r\n      {\r\n        message: \"Регистрация успешна\",\r\n        user: {\r\n          id: user.id,\r\n          login: user.login,\r\n          email: user.email,\r\n          name: user.name,\r\n          phone: user.phone,\r\n        },\r\n      },\r\n      { status: 201 }\r\n    );\r\n  } catch (error) {\r\n    console.error(\"Registration error:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Ошибка при регистрации. Попробуйте позже.\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}}]
}