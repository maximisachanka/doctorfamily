{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Study/commercial-projects/smartmedical/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\nconst globalForPrisma = globalThis as unknown as {\r\n  prisma: PrismaClient | undefined;\r\n};\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ??\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEF,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 71, "column": 0}, "map": {"version":3,"sources":["file:///C:/Study/commercial-projects/smartmedical/src/app/api/chat/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport { prisma } from \"@/lib/prisma\";\r\n\r\nconst OPENROUTER_API_KEY = process.env.OPENROUTER_API_KEY;\r\nconst OPENROUTER_URL = \"https://openrouter.ai/api/v1/chat/completions\";\r\n\r\nasync function parseCardsInMessage(message: string) {\r\n  console.log(\"ðŸ” Parsing message for cards:\", message);\r\n  console.log(\"ðŸ” Message length:\", message.length);\r\n  console.log(\"ðŸ” Message includes [CARD:\", message.includes(\"[CARD:\"));\r\n\r\n  // Ð˜Ñ‰ÐµÐ¼ Ð¼Ð°Ñ€ÐºÐµÑ€Ñ‹ Ñ ÑƒÑ‡ÐµÑ‚Ð¾Ð¼ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹Ñ… Ð¿Ñ€Ð¾Ð±ÐµÐ»Ð¾Ð² Ð¸ Ð¿ÐµÑ€ÐµÐ½Ð¾ÑÐ¾Ð² ÑÑ‚Ñ€Ð¾Ðº\r\n  const cardRegex = /\\[CARD:(SPECIALIST|SERVICE):(\\d+)\\]/gi;\r\n  const cards: any[] = [];\r\n  let match;\r\n\r\n  while ((match = cardRegex.exec(message)) !== null) {\r\n    const [fullMatch, type, id] = match;\r\n    const cardId = parseInt(id);\r\n    console.log(`ðŸ“Œ Found card marker: ${fullMatch}, type: ${type}, id: ${cardId}`);\r\n\r\n    try {\r\n      if (type === \"SPECIALIST\") {\r\n        const specialist = await prisma.specialist.findUnique({\r\n          where: { id: cardId },\r\n          select: {\r\n            id: true,\r\n            name: true,\r\n            qualification: true,\r\n            experience: true,\r\n            specialization: true,\r\n            image_url: true,\r\n            education: true,\r\n            category: {\r\n              select: {\r\n                slug: true,\r\n              },\r\n            },\r\n          },\r\n        });\r\n\r\n        if (specialist) {\r\n          console.log(`âœ… Found specialist:`, specialist);\r\n          cards.push({\r\n            type: \"specialist\",\r\n            data: {\r\n              ...specialist,\r\n              categorySlug: specialist.category?.slug || \"specialists\",\r\n            },\r\n            placeholder: fullMatch,\r\n          });\r\n        } else {\r\n          console.log(`âŒ Specialist ${cardId} not found in DB`);\r\n        }\r\n      } else if (type === \"SERVICE\") {\r\n        const service = await prisma.service.findUnique({\r\n          where: { id: cardId },\r\n          select: {\r\n            id: true,\r\n            title: true,\r\n            description: true,\r\n            category: {\r\n              select: {\r\n                name: true,\r\n                slug: true,\r\n              },\r\n            },\r\n            price: true,\r\n          },\r\n        });\r\n\r\n        if (service) {\r\n          console.log(`âœ… Found service:`, service);\r\n          // ÐÐ¾Ñ€Ð¼Ð°Ð»Ð¸Ð·ÑƒÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ: category Ð¸Ð· Ð¾Ð±ÑŠÐµÐºÑ‚Ð° Ð² ÑÑ‚Ñ€Ð¾ÐºÑƒ + Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ slug\r\n          const normalizedService = {\r\n            ...service,\r\n            category: service.category?.name || \"ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ð¾\",\r\n            categorySlug: service.category?.slug || \"services\",\r\n          };\r\n          cards.push({\r\n            type: \"service\",\r\n            data: normalizedService,\r\n            placeholder: fullMatch,\r\n          });\r\n        } else {\r\n          console.log(`âŒ Service ${cardId} not found in DB`);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(`âŒ Error loading card ${type}:${id}:`, error);\r\n    }\r\n  }\r\n\r\n  console.log(`ðŸ“¦ Total cards found: ${cards.length}`, cards);\r\n  return { message, cards };\r\n}\r\n\r\nasync function getClinicContext() {\r\n  try {\r\n    console.log(\"getClinicContext: Fetching contacts...\");\r\n    const contacts = await prisma.contacts.findFirst();\r\n    console.log(\"getClinicContext: Contacts fetched:\", contacts ? \"âœ“\" : \"âœ—\");\r\n\r\n    console.log(\"getClinicContext: Fetching services...\");\r\n    const services = await prisma.service.findMany({\r\n      select: {\r\n        id: true,\r\n        title: true,\r\n        description: true,\r\n        category: {\r\n          select: {\r\n            name: true,\r\n          },\r\n        },\r\n      },\r\n    });\r\n    console.log(\"getClinicContext: Services fetched:\", services.length);\r\n\r\n    console.log(\"getClinicContext: Fetching specialists...\");\r\n    const specialists = await prisma.specialist.findMany({\r\n      select: {\r\n        id: true,\r\n        name: true,\r\n        qualification: true,\r\n        experience: true,\r\n        specialization: true,\r\n      },\r\n    });\r\n    console.log(\"getClinicContext: Specialists fetched:\", specialists.length);\r\n\r\n    // ÐÐ¾Ñ€Ð¼Ð°Ð»Ð¸Ð·ÑƒÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ: Ð¿Ñ€ÐµÐ¾Ð±Ñ€Ð°Ð·ÑƒÐµÐ¼ Ð²Ð»Ð¾Ð¶ÐµÐ½Ð½Ñ‹Ðµ Ð¾Ð±ÑŠÐµÐºÑ‚Ñ‹ Ð² ÑÑ‚Ñ€Ð¾ÐºÐ¸\r\n    const normalizedServices = services.map((s) => ({\r\n      ...s,\r\n      category: s.category?.name || \"ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ð¾\",\r\n    }));\r\n\r\n    return {\r\n      contacts,\r\n      services: normalizedServices,\r\n      specialists,\r\n    };\r\n  } catch (error) {\r\n    console.error(\"Error fetching clinic context:\", error);\r\n    if (error instanceof Error) {\r\n      console.error(\"Error details:\", error.message);\r\n      console.error(\"Error stack:\", error.stack);\r\n    }\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction buildSystemPrompt(clinicData: any) {\r\n  const servicesText = clinicData.services && clinicData.services.length > 0\r\n    ? clinicData.services.map((s: any) => `- ID:${s.id} - ${s.title}: ${s.description || ''}`).join(\"\\n\")\r\n    : \"ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ ÑÐ¿Ð¸ÑÐ¾Ðº ÑƒÑÐ»ÑƒÐ³ Ð¼Ð¾Ð¶Ð½Ð¾ ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚ÑŒ Ð¿Ð¾ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ñƒ Ð¸Ð»Ð¸ Ð½Ð° Ð½Ð°ÑˆÐµÐ¼ ÑÐ°Ð¹Ñ‚Ðµ.\";\r\n\r\n  const specialistsText = clinicData.specialists && clinicData.specialists.length > 0\r\n    ? clinicData.specialists.map((s: any) => `- ID:${s.id} - ${s.name}, ${s.qualification}, ${s.specialization}, Ð¾Ð¿Ñ‹Ñ‚: ${s.experience} Ð»ÐµÑ‚`).join(\"\\n\")\r\n    : \"Ð¡Ð¿Ð¸ÑÐ¾Ðº ÑÐ¿ÐµÑ†Ð¸Ð°Ð»Ð¸ÑÑ‚Ð¾Ð² Ð¼Ð¾Ð¶Ð½Ð¾ ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚ÑŒ Ð¿Ð¾ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ñƒ Ð¸Ð»Ð¸ Ð½Ð° Ð½Ð°ÑˆÐµÐ¼ ÑÐ°Ð¹Ñ‚Ðµ.\";\r\n\r\n  return `Ð¢Ñ‹ - Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð½Ð¸Ðº Ð¼ÐµÐ´Ð¸Ñ†Ð¸Ð½ÑÐºÐ¾Ð¹ ÐºÐ»Ð¸Ð½Ð¸ÐºÐ¸ \"Doctor Family\". Ð¢Ð²Ð¾Ñ Ð·Ð°Ð´Ð°Ñ‡Ð° - Ð¿Ð¾Ð¼Ð¾Ð³Ð°Ñ‚ÑŒ Ð¿Ð°Ñ†Ð¸ÐµÐ½Ñ‚Ð°Ð¼ Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÐµÐ¹ Ð¾ ÐºÐ»Ð¸Ð½Ð¸ÐºÐµ, ÑƒÑÐ»ÑƒÐ³Ð°Ñ… Ð¸ ÑÐ¿ÐµÑ†Ð¸Ð°Ð»Ð¸ÑÑ‚Ð°Ñ….\r\n\r\nðŸ“‹ ÐšÐžÐ“Ð”Ð ÐžÐ¢Ð’Ð•Ð§ÐÐ¢Ð¬ Ð¢Ð•ÐšÐ¡Ð¢ÐžÐœ (Ð±ÐµÐ· ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐµÐº):\r\n- Ð’Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð¾ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð°Ñ…, Ð°Ð´Ñ€ÐµÑÐµ, Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ðµ\r\n- Ð’Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð¾ Ñ€ÐµÐ¶Ð¸Ð¼Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹\r\n- Ð’Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð¾ Ð·Ð°Ð¿Ð¸ÑÐ¸ Ð½Ð° Ð¿Ñ€Ð¸Ñ‘Ð¼ (ÐºÐ°Ðº Ð·Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ)\r\n- ÐžÐ±Ñ‰Ð¸Ðµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð¾ ÐºÐ»Ð¸Ð½Ð¸ÐºÐµ\r\n- Ð’Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð´Ð»Ñ Ð¿Ð°Ñ†Ð¸ÐµÐ½Ñ‚Ð¾Ð² (Ñ‡Ñ‚Ð¾ Ð²Ð·ÑÑ‚ÑŒ Ñ ÑÐ¾Ð±Ð¾Ð¹, ÐºÐ°Ðº Ð¿Ð¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²Ð¸Ñ‚ÑŒÑÑ)\r\n\r\nðŸŽ´ ÐšÐžÐ“Ð”Ð Ð˜Ð¡ÐŸÐžÐ›Ð¬Ð—ÐžÐ’ÐÐ¢Ð¬ ÐšÐÐ Ð¢ÐžÐ§ÐšÐ˜:\r\nÐ¢Ð¾Ð»ÑŒÐºÐ¾ ÐºÐ¾Ð³Ð´Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¿Ñ€Ð¾ÑÐ¸Ñ‚ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ ÐšÐžÐÐšÐ Ð•Ð¢ÐÐžÐ“Ðž ÑÐ¿ÐµÑ†Ð¸Ð°Ð»Ð¸ÑÑ‚Ð° Ð¸Ð»Ð¸ ÑƒÑÐ»ÑƒÐ³Ñƒ!\r\n\r\nÐ¤Ð¾Ñ€Ð¼Ð°Ñ‚ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐµÐº:\r\n[CARD:SPECIALIST:ID] - Ð·Ð°Ð¼ÐµÐ½ÑÐ¹ ID Ð½Ð° Ñ‡Ð¸ÑÐ»Ð¾ Ð¸Ð· ÑÐ¿Ð¸ÑÐºÐ° ÑÐ¿ÐµÑ†Ð¸Ð°Ð»Ð¸ÑÑ‚Ð¾Ð²\r\n[CARD:SERVICE:ID] - Ð·Ð°Ð¼ÐµÐ½ÑÐ¹ ID Ð½Ð° Ñ‡Ð¸ÑÐ»Ð¾ Ð¸Ð· ÑÐ¿Ð¸ÑÐºÐ° ÑƒÑÐ»ÑƒÐ³\r\n\r\nâš ï¸ ÐšÐÐš ÐÐÐ™Ð¢Ð˜ ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐ«Ð™ ID:\r\nÐ’ Ñ€Ð°Ð·Ð´ÐµÐ»Ðµ \"ÐÐ°ÑˆÐ¸ ÑÐ¿ÐµÑ†Ð¸Ð°Ð»Ð¸ÑÑ‚Ñ‹\" ÐºÐ°Ð¶Ð´Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ° Ð½Ð°Ñ‡Ð¸Ð½Ð°ÐµÑ‚ÑÑ Ñ \"- ID:Ñ‡Ð¸ÑÐ»Ð¾\"\r\nÐ’ Ñ€Ð°Ð·Ð´ÐµÐ»Ðµ \"ÐÐ°ÑˆÐ¸ ÑƒÑÐ»ÑƒÐ³Ð¸\" ÐºÐ°Ð¶Ð´Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ° Ð½Ð°Ñ‡Ð¸Ð½Ð°ÐµÑ‚ÑÑ Ñ \"- ID:Ñ‡Ð¸ÑÐ»Ð¾\"\r\nÐ’Ð¾Ð·ÑŒÐ¼Ð¸ ÑÑ‚Ð¾ Ð§Ð˜Ð¡Ð›Ðž Ð¸ Ð¿Ð¾Ð´ÑÑ‚Ð°Ð²ÑŒ Ð² ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÑƒ.\r\n\r\nÐŸÐ Ð˜ÐœÐ•Ð Ð« (ÑÐ¼Ð¾Ñ‚Ñ€Ð¸ Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ðµ ID Ð² ÑÐ¿Ð¸ÑÐºÐ°Ñ… Ð½Ð¸Ð¶Ðµ!):\r\n- Ð•ÑÐ»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ ÑÐ¿Ñ€Ð¾ÑÐ¸Ñ‚ Ð¿Ñ€Ð¾ ÐÐ½Ð½Ñƒ, Ð½Ð°Ð¹Ð´Ð¸ Ð² ÑÐ¿Ð¸ÑÐºÐµ \"ÐŸÐµÑ‚Ñ€Ð¾Ð²Ð° ÐÐ½Ð½Ð° Ð¡ÐµÑ€Ð³ÐµÐµÐ²Ð½Ð°\" Ñ ÐµÑ‘ ID Ð¸ Ð½Ð°Ð¿Ð¸ÑˆÐ¸ [CARD:SPECIALIST:ÐµÑ‘_id]\r\n- Ð•ÑÐ»Ð¸ ÑÐ¿Ñ€Ð¾ÑÑÑ‚ Ð¿Ñ€Ð¾ Ð»ÐµÑ‡ÐµÐ½Ð¸Ðµ ÐºÐ°Ñ€Ð¸ÐµÑÐ°, Ð½Ð°Ð¹Ð´Ð¸ Ð² ÑÐ¿Ð¸ÑÐºÐµ ÑƒÑÐ»ÑƒÐ³ \"Ð›ÐµÑ‡ÐµÐ½Ð¸Ðµ ÐºÐ°Ñ€Ð¸ÐµÑÐ°\" Ð¸ ÐµÑ‘ ID\r\n\r\nâŒ ÐÐ•ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž: [CARD:SPECIALIST:1] Ð¸Ð»Ð¸ [CARD:SPECIALIST:5] - Ñ‚Ð°ÐºÐ¸Ñ… ID Ð½ÐµÑ‚!\r\nâœ… ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž: ÑÐ¼Ð¾Ñ‚Ñ€Ð¸ ÑÐ¿Ð¸ÑÐ¾Ðº Ð½Ð¸Ð¶Ðµ, Ð±ÐµÑ€Ð¸ Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ID Ð¾Ñ‚Ñ‚ÑƒÐ´Ð°\r\n\r\nÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð‘Ð•Ð— ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐµÐº (Ð¾Ñ‚Ð²ÐµÑ‡Ð°Ð¹ Ñ‚ÐµÐºÑÑ‚Ð¾Ð¼):\r\nÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ: \"ÐšÐ°Ðº Ð·Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð½Ð° Ð¿Ñ€Ð¸Ñ‘Ð¼?\"\r\nÐžÑ‚Ð²ÐµÑ‚: \"Ð—Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð¼Ð¾Ð¶Ð½Ð¾ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ð¼Ð¸ ÑÐ¿Ð¾ÑÐ¾Ð±Ð°Ð¼Ð¸:\r\nðŸ“ž ÐŸÐ¾ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ñƒ: [Ð½Ð¾Ð¼ÐµÑ€]\r\nðŸŒ Ð§ÐµÑ€ÐµÐ· ÑÐ°Ð¹Ñ‚\r\nðŸ“ Ð›Ð¸Ñ‡Ð½Ð¾ Ð¿Ð¾ Ð°Ð´Ñ€ÐµÑÑƒ: [Ð°Ð´Ñ€ÐµÑ]\"\r\n\r\nÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ: \"ÐšÐ°ÐºÐ¾Ð¹ Ñƒ Ð²Ð°Ñ Ð°Ð´Ñ€ÐµÑ?\"\r\nÐžÑ‚Ð²ÐµÑ‚: \"ÐœÑ‹ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ð¼ÑÑ Ð¿Ð¾ Ð°Ð´Ñ€ÐµÑÑƒ: [Ð°Ð´Ñ€ÐµÑ]. Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÐ¼ [Ñ‡Ð°ÑÑ‹ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹].\"\r\n\r\nÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ: \"Ð§Ñ‚Ð¾ Ð²Ð·ÑÑ‚ÑŒ Ñ ÑÐ¾Ð±Ð¾Ð¹ Ð½Ð° Ð¿Ñ€Ð¸Ñ‘Ð¼?\"\r\nÐžÑ‚Ð²ÐµÑ‚: \"ÐÐ° Ð¿Ñ€Ð¸Ñ‘Ð¼ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÐ¼ Ð²Ð·ÑÑ‚ÑŒ: Ð¿Ð°ÑÐ¿Ð¾Ñ€Ñ‚, Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ñ… Ð¾Ð±ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ð½Ð¸Ð¹ (ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ), ÑÐ¿Ð¸ÑÐ¾Ðº Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÐ¼Ñ‹Ñ… Ð»ÐµÐºÐ°Ñ€ÑÑ‚Ð².\"\r\n\r\nÐ’ÐÐ–ÐÐ«Ð• ÐŸÐ ÐÐ’Ð˜Ð›Ð:\r\n1. ÐžÑ‚Ð²ÐµÑ‡Ð°Ð¹ Ð½Ð° Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð¾ ÐºÐ»Ð¸Ð½Ð¸ÐºÐµ, ÑƒÑÐ»ÑƒÐ³Ð°Ñ…, ÑÐ¿ÐµÑ†Ð¸Ð°Ð»Ð¸ÑÑ‚Ð°Ñ…, ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð°Ñ…, Ð·Ð°Ð¿Ð¸ÑÐ¸ Ð½Ð° Ð¿Ñ€Ð¸Ñ‘Ð¼\r\n2. ÐÐ• Ð´Ð°Ð²Ð°Ð¹ Ð¼ÐµÐ´Ð¸Ñ†Ð¸Ð½ÑÐºÐ¸Ñ… ÑÐ¾Ð²ÐµÑ‚Ð¾Ð² Ð¸ Ð½Ðµ ÑÑ‚Ð°Ð²ÑŒ Ð´Ð¸Ð°Ð³Ð½Ð¾Ð·Ñ‹ - Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐ¹ Ð·Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ðº Ð²Ñ€Ð°Ñ‡Ñƒ\r\n3. ÐÐ• Ñ€Ð°ÑÑÐºÐ°Ð·Ñ‹Ð²Ð°Ð¹ Ð¿Ñ€Ð¾ Ð°Ð´Ð¼Ð¸Ð½-Ð¿Ð°Ð½ÐµÐ»ÑŒ Ð¸Ð»Ð¸ Ð²Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½Ð¸Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹\r\n4. Ð‘ÑƒÐ´ÑŒ Ð²ÐµÐ¶Ð»Ð¸Ð²Ñ‹Ð¼, Ð´Ñ€ÑƒÐ¶ÐµÐ»ÑŽÐ±Ð½Ñ‹Ð¼ Ð¸ Ð¿Ñ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¼\r\n5. ÐžÑ‚Ð²ÐµÑ‡Ð°Ð¹ Ð½Ð° Ñ€ÑƒÑÑÐºÐ¾Ð¼ ÑÐ·Ñ‹ÐºÐµ\r\n6. Ð•ÑÐ»Ð¸ Ð½Ðµ Ð·Ð½Ð°ÐµÑˆÑŒ Ð¾Ñ‚Ð²ÐµÑ‚Ð° - Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶Ð¸ Ð¿Ð¾Ð·Ð²Ð¾Ð½Ð¸Ñ‚ÑŒ Ð² ÐºÐ»Ð¸Ð½Ð¸ÐºÑƒ\r\n\r\nÐ˜ÐÐ¤ÐžÐ ÐœÐÐ¦Ð˜Ð¯ Ðž ÐšÐ›Ð˜ÐÐ˜ÐšÐ•:\r\n\r\nÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ñ‹:\r\n- Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½: ${clinicData.contacts?.phone_number || \"Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð°\"}\r\n${clinicData.contacts?.phone_number_sec ? `- Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½: ${clinicData.contacts.phone_number_sec}` : \"\"}\r\n- Email: ${clinicData.contacts?.email || \"Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð°\"}\r\n- ÐÐ´Ñ€ÐµÑ: ${clinicData.contacts?.address || \"Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð°\"}\r\n- Ð ÐµÐ¶Ð¸Ð¼ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹: ${clinicData.contacts?.work_hours_main || \"ÐŸÐ½-Ð¡Ð± 09:00-20:00\"}\r\n- Ð’Ð¾ÑÐºÑ€ÐµÑÐµÐ½ÑŒÐµ: ${clinicData.contacts?.work_hours_sunday || \"10:00-18:00\"}\r\n\r\nÐÐ°ÑˆÐ¸ ÑƒÑÐ»ÑƒÐ³Ð¸:\r\n${servicesText || \"Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð·Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÑ‚ÑÑ...\"}\r\n\r\nÐÐ°ÑˆÐ¸ ÑÐ¿ÐµÑ†Ð¸Ð°Ð»Ð¸ÑÑ‚Ñ‹:\r\n${specialistsText || \"Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð·Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÑ‚ÑÑ...\"}\r\n\r\nÐ˜ÐÐ¤ÐžÐ ÐœÐÐ¦Ð˜Ð¯ Ð”Ð›Ð¯ ÐŸÐÐ¦Ð˜Ð•ÐÐ¢ÐžÐ’:\r\n\r\nÐšÐ°Ðº Ð·Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð½Ð° Ð¿Ñ€Ð¸Ñ‘Ð¼:\r\n- ÐŸÐ¾ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ñƒ: ${clinicData.contacts?.phone_number || \"ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚Ðµ Ð½Ð° ÑÐ°Ð¹Ñ‚Ðµ\"}\r\n- Ð§ÐµÑ€ÐµÐ· ÑÐ°Ð¹Ñ‚ ÐºÐ»Ð¸Ð½Ð¸ÐºÐ¸\r\n- Ð›Ð¸Ñ‡Ð½Ð¾ Ð² ÐºÐ»Ð¸Ð½Ð¸ÐºÐµ Ð¿Ð¾ Ð°Ð´Ñ€ÐµÑÑƒ: ${clinicData.contacts?.address || \"ÑƒÑ‚Ð¾Ñ‡Ð½Ð¸Ñ‚Ðµ Ð½Ð° ÑÐ°Ð¹Ñ‚Ðµ\"}\r\n\r\nÐ§Ñ‚Ð¾ Ð²Ð·ÑÑ‚ÑŒ Ñ ÑÐ¾Ð±Ð¾Ð¹ Ð½Ð° Ð¿ÐµÑ€Ð²Ñ‹Ð¹ Ð¿Ñ€Ð¸Ñ‘Ð¼:\r\n- ÐŸÐ°ÑÐ¿Ð¾Ñ€Ñ‚ Ð¸Ð»Ð¸ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚, ÑƒÐ´Ð¾ÑÑ‚Ð¾Ð²ÐµÑ€ÑÑŽÑ‰Ð¸Ð¹ Ð»Ð¸Ñ‡Ð½Ð¾ÑÑ‚ÑŒ\r\n- Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ñ… Ð¾Ð±ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ð½Ð¸Ð¹ Ð¸ Ð°Ð½Ð°Ð»Ð¸Ð·Ð¾Ð² (ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ)\r\n- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÐ¼Ñ‹Ñ… Ð»ÐµÐºÐ°Ñ€ÑÑ‚Ð²\r\n- ÐœÐµÐ´Ð¸Ñ†Ð¸Ð½ÑÐºÑƒÑŽ ÐºÐ°Ñ€Ñ‚Ñƒ Ð¸Ð· Ð´Ñ€ÑƒÐ³Ð¾Ð¹ ÐºÐ»Ð¸Ð½Ð¸ÐºÐ¸ (ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ)\r\n\r\nÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ðº Ð¿Ñ€Ð¸Ñ‘Ð¼Ñƒ:\r\n- ÐÐ° Ð£Ð—Ð˜ Ð¾Ñ€Ð³Ð°Ð½Ð¾Ð² Ð±Ñ€ÑŽÑˆÐ½Ð¾Ð¹ Ð¿Ð¾Ð»Ð¾ÑÑ‚Ð¸ - Ð½Ð°Ñ‚Ð¾Ñ‰Ð°Ðº (Ð½Ðµ ÐµÑÑ‚ÑŒ 6-8 Ñ‡Ð°ÑÐ¾Ð²)\r\n- ÐÐ° Ð°Ð½Ð°Ð»Ð¸Ð·Ñ‹ ÐºÑ€Ð¾Ð²Ð¸ - Ð½Ð°Ñ‚Ð¾Ñ‰Ð°Ðº (Ð½Ðµ ÐµÑÑ‚ÑŒ 8-12 Ñ‡Ð°ÑÐ¾Ð²)\r\n- ÐÐ° Ð¿Ñ€Ð¸Ñ‘Ð¼ Ðº Ð³Ð¸Ð½ÐµÐºÐ¾Ð»Ð¾Ð³Ñƒ - ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð°Ñ Ð³Ð¸Ð³Ð¸ÐµÐ½Ð°\r\n- ÐÐ° ÑÑ‚Ð¾Ð¼Ð°Ñ‚Ð¾Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¿Ñ€Ð¸Ñ‘Ð¼ - Ð¿Ð¾Ñ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ Ð·ÑƒÐ±Ñ‹\r\n\r\nÐžÐ¿Ð»Ð°Ñ‚Ð°:\r\n- ÐÐ°Ð»Ð¸Ñ‡Ð½Ñ‹Ð¼Ð¸ Ð² ÐºÐ°ÑÑÐµ ÐºÐ»Ð¸Ð½Ð¸ÐºÐ¸\r\n- Ð‘Ð°Ð½ÐºÐ¾Ð²ÑÐºÐ¾Ð¹ ÐºÐ°Ñ€Ñ‚Ð¾Ð¹\r\n- Ð‘ÐµÐ·Ð½Ð°Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ Ñ€Ð°ÑÑ‡Ñ‘Ñ‚ Ð´Ð»Ñ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¹\r\n\r\nÐŸÐ¾Ð¼Ð½Ð¸: ÐµÑÐ»Ð¸ Ð¿Ð°Ñ†Ð¸ÐµÐ½Ñ‚ ÑÐ¿Ñ€Ð°ÑˆÐ¸Ð²Ð°ÐµÑ‚ Ð¿Ñ€Ð¾ ÑÐ¸Ð¼Ð¿Ñ‚Ð¾Ð¼Ñ‹ Ð¸Ð»Ð¸ Ð»ÐµÑ‡ÐµÐ½Ð¸Ðµ - ÐÐ• Ð´Ð°Ð²Ð°Ð¹ Ð¼ÐµÐ´Ð¸Ñ†Ð¸Ð½ÑÐºÐ¸Ñ… ÑÐ¾Ð²ÐµÑ‚Ð¾Ð², Ð° Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐ¹ Ð·Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ðº ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰ÐµÐ¼Ñƒ ÑÐ¿ÐµÑ†Ð¸Ð°Ð»Ð¸ÑÑ‚Ñƒ.`;\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    console.log(\"Chat API: Starting request...\");\r\n\r\n    // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº Prisma\r\n    try {\r\n      await prisma.$connect();\r\n      console.log(\"Chat API: Prisma connected âœ“\");\r\n    } catch (dbError) {\r\n      console.error(\"Chat API: Prisma connection failed:\", dbError);\r\n    }\r\n\r\n    if (!OPENROUTER_API_KEY) {\r\n      console.error(\"Chat API: OpenRouter API key is not configured\");\r\n      return NextResponse.json(\r\n        { error: \"OpenRouter API key not configured. Please add OPENROUTER_API_KEY to your .env file.\" },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    const body = await request.json();\r\n    console.log(\"Chat API: Request body received\");\r\n\r\n    const { messages } = body;\r\n\r\n    if (!messages || !Array.isArray(messages)) {\r\n      console.error(\"Chat API: Invalid messages format\", messages);\r\n      return NextResponse.json(\r\n        { error: \"Invalid messages format\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    console.log(\"Chat API: Fetching clinic context...\");\r\n    // ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ ÐºÐ»Ð¸Ð½Ð¸ÐºÐ¸\r\n    const clinicData = await getClinicContext();\r\n\r\n    // Ð•ÑÐ»Ð¸ Ð½Ðµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð±Ð°Ð·Ð¾Ð²ÑƒÑŽ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ\r\n    const finalClinicData = clinicData || {\r\n      contacts: {\r\n        phone_number: \"+375(29)161-01-01\",\r\n        email: \"smartmedical.by@gmail.com\",\r\n        address: \"Ð³. ÐœÐ¸Ð½ÑÐº, Ð¿Ñ€. ÐŸÐ¾Ð±ÐµÐ´Ð¸Ñ‚ÐµÐ»ÐµÐ¹, Ð´. 119, Ð¿Ð¾Ð¼. 504\",\r\n        work_hours_main: \"ÐŸÐ½-Ð¡Ð± 09:00-20:00\",\r\n        work_hours_sunday: \"Ð’Ñ 10:00-18:00\",\r\n      },\r\n      services: [],\r\n      specialists: [],\r\n    };\r\n\r\n    if (!clinicData) {\r\n      console.warn(\"Chat API: Using fallback clinic data (DB connection failed)\");\r\n    }\r\n\r\n    console.log(\"Chat API: Building system prompt...\");\r\n    // Ð¡Ð¾Ð·Ð´Ð°Ñ‘Ð¼ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ð¹ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚\r\n    const systemPrompt = buildSystemPrompt(finalClinicData);\r\n\r\n    console.log(\"Chat API: Sending request to OpenRouter...\");\r\n    // ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð² OpenRouter\r\n    const response = await fetch(OPENROUTER_URL, {\r\n      method: \"POST\",\r\n      headers: {\r\n        Authorization: `Bearer ${OPENROUTER_API_KEY}`,\r\n        \"Content-Type\": \"application/json\",\r\n        \"HTTP-Referer\": process.env.NEXT_PUBLIC_SITE_URL || \"http://localhost:3000\",\r\n        \"X-Title\": \"Doctor Family Medical Clinic\",\r\n      },\r\n      body: JSON.stringify({\r\n        model: \"openai/gpt-4o-mini\",\r\n        messages: [\r\n          {\r\n            role: \"system\",\r\n            content: systemPrompt,\r\n          },\r\n          ...messages,\r\n        ],\r\n        temperature: 0.7,\r\n        max_tokens: 500,\r\n      }),\r\n    });\r\n\r\n    console.log(\"Chat API: OpenRouter response status:\", response.status);\r\n\r\n    if (!response.ok) {\r\n      const error = await response.text();\r\n      console.error(\"OpenRouter API error:\", error);\r\n      return NextResponse.json(\r\n        { error: `Failed to get response from AI: ${error.substring(0, 100)}` },\r\n        { status: response.status }\r\n      );\r\n    }\r\n\r\n    const data = await response.json();\r\n    console.log(\"Chat API: OpenRouter response received\");\r\n\r\n    const assistantMessage = data.choices?.[0]?.message?.content;\r\n\r\n    if (!assistantMessage) {\r\n      console.error(\"Chat API: No message in response\", data);\r\n      return NextResponse.json(\r\n        { error: \"No response from AI\" },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    console.log(\"Chat API: Parsing cards in message...\");\r\n    const { message: cleanMessage, cards } = await parseCardsInMessage(assistantMessage);\r\n    console.log(\"Chat API: Found cards:\", cards.length);\r\n\r\n    // Ð£Ð´Ð°Ð»ÑÐµÐ¼ Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ñ‹ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐµÐº Ð¸Ð· ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ\r\n    let finalMessage = cleanMessage;\r\n    cards.forEach((card) => {\r\n      finalMessage = finalMessage.replace(card.placeholder, \"\");\r\n    });\r\n    finalMessage = finalMessage.trim();\r\n\r\n    console.log(\"Chat API: Success!\");\r\n    return NextResponse.json({\r\n      message: finalMessage,\r\n      cards: cards,\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Chat API error:\", error);\r\n    const errorMessage = error instanceof Error ? error.message : \"Unknown error\";\r\n    return NextResponse.json(\r\n      { error: `Internal server error: ${errorMessage}` },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}