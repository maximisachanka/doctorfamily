{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Study/commercial-projects/smartmedical/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\n  });\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\n\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEF,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 113, "column": 0}, "map": {"version":3,"sources":["file:///C:/Study/commercial-projects/smartmedical/src/utils/auth.ts"],"sourcesContent":["// Утилиты для работы с ролями и правами доступа\r\n\r\nexport type UserRole = \"USER\" | \"ADMIN\" | \"CHIEF_DOCTOR\" | \"OPERATOR\";\r\n\r\n// Роли с доступом к админ-панели\r\nexport const ADMIN_ROLES: UserRole[] = [\"ADMIN\", \"CHIEF_DOCTOR\", \"OPERATOR\"];\r\n\r\n/**\r\n * Проверяет, имеет ли пользователь доступ к админ-панели\r\n * @param role Роль пользователя\r\n * @returns true если пользователь имеет доступ к админ-панели\r\n */\r\nexport function hasAdminAccess(role?: UserRole | string | null): boolean {\r\n  if (!role) return false;\r\n  return ADMIN_ROLES.includes(role as UserRole);\r\n}\r\n\r\n/**\r\n * Проверяет, имеет ли пользователь полный доступ к админ-панели\r\n * (все разделы кроме управления администраторами)\r\n * @param role Роль пользователя\r\n * @returns true если администратор или главный врач\r\n */\r\nexport function hasFullAdminAccess(role?: UserRole | string | null): boolean {\r\n  if (!role) return false;\r\n  return role === \"ADMIN\" || role === \"CHIEF_DOCTOR\";\r\n}\r\n\r\n/**\r\n * Проверяет, может ли пользователь управлять администраторами\r\n * (назначать/снимать роль администратора)\r\n * @param role Роль пользователя\r\n * @returns true только для главного врача\r\n */\r\nexport function canManageAdmins(role?: UserRole | string | null): boolean {\r\n  return role === \"CHIEF_DOCTOR\";\r\n}\r\n\r\n/**\r\n * Проверяет, имеет ли пользователь доступ только к чату\r\n * @param role Роль пользователя\r\n * @returns true если оператор\r\n */\r\nexport function isChatOnlyAccess(role?: UserRole | string | null): boolean {\r\n  return role === \"OPERATOR\";\r\n}\r\n\r\n/**\r\n * Проверяет, является ли пользователь администратором\r\n * @param role Роль пользователя\r\n * @returns true если пользователь - администратор\r\n */\r\nexport function isAdmin(role?: UserRole | string | null): boolean {\r\n  return role === \"ADMIN\";\r\n}\r\n\r\n/**\r\n * Проверяет, является ли пользователь главным врачом\r\n * @param role Роль пользователя\r\n * @returns true если пользователь - главный врач\r\n */\r\nexport function isChiefDoctor(role?: UserRole | string | null): boolean {\r\n  return role === \"CHIEF_DOCTOR\";\r\n}\r\n\r\n/**\r\n * Проверяет, является ли пользователь оператором\r\n * @param role Роль пользователя\r\n * @returns true если пользователь - оператор\r\n */\r\nexport function isOperator(role?: UserRole | string | null): boolean {\r\n  return role === \"OPERATOR\";\r\n}\r\n\r\n/**\r\n * Получает человекочитаемое название роли\r\n * @param role Роль пользователя\r\n * @returns Название роли на русском языке\r\n */\r\nexport function getRoleName(role?: UserRole | string | null): string {\r\n  switch (role) {\r\n    case \"ADMIN\":\r\n      return \"Администратор\";\r\n    case \"CHIEF_DOCTOR\":\r\n      return \"Главный врач\";\r\n    case \"OPERATOR\":\r\n      return \"Оператор\";\r\n    case \"USER\":\r\n      return \"Пользователь\";\r\n    default:\r\n      return \"Неизвестная роль\";\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,gDAAgD;;;;;;;;;;;;;;;;;;;;;AAKzC,MAAM,cAA0B;IAAC;IAAS;IAAgB;CAAW;AAOrE,SAAS,eAAe,IAA+B;IAC5D,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO,YAAY,QAAQ,CAAC;AAC9B;AAQO,SAAS,mBAAmB,IAA+B;IAChE,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO,SAAS,WAAW,SAAS;AACtC;AAQO,SAAS,gBAAgB,IAA+B;IAC7D,OAAO,SAAS;AAClB;AAOO,SAAS,iBAAiB,IAA+B;IAC9D,OAAO,SAAS;AAClB;AAOO,SAAS,QAAQ,IAA+B;IACrD,OAAO,SAAS;AAClB;AAOO,SAAS,cAAc,IAA+B;IAC3D,OAAO,SAAS;AAClB;AAOO,SAAS,WAAW,IAA+B;IACxD,OAAO,SAAS;AAClB;AAOO,SAAS,YAAY,IAA+B;IACzD,OAAQ;QACN,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT;YACE,OAAO;IACX;AACF","debugId":null}},
    {"offset": {"line": 180, "column": 0}, "map": {"version":3,"sources":["file:///C:/Study/commercial-projects/smartmedical/src/utils/api-auth.ts"],"sourcesContent":["import { NextRequest } from \"next/server\";\r\nimport { getToken } from \"next-auth/jwt\";\r\nimport { hasAdminAccess, hasFullAdminAccess, canManageAdmins, UserRole } from \"./auth\";\r\n\r\n/**\r\n * Результат проверки прав доступа к API\r\n */\r\nexport interface AdminCheckResult {\r\n  isAdmin: boolean;\r\n  error?: string;\r\n  userId?: number;\r\n  role?: UserRole;\r\n  hasFullAccess?: boolean;\r\n  canManageAdmins?: boolean;\r\n}\r\n\r\n/**\r\n * Проверяет права доступа пользователя к админским API роутам\r\n * @param request NextRequest объект\r\n * @returns Результат проверки с информацией о пользователе\r\n */\r\nexport async function checkAdminAccess(\r\n  request: NextRequest\r\n): Promise<AdminCheckResult> {\r\n  try {\r\n    // Получаем токен из сессии\r\n    const token = await getToken({\r\n      req: request,\r\n      secret: process.env.NEXTAUTH_SECRET,\r\n    });\r\n\r\n    // Проверяем наличие токена и ID пользователя\r\n    if (!token || !token.id) {\r\n      return {\r\n        isAdmin: false,\r\n        error: \"Не авторизован\",\r\n      };\r\n    }\r\n\r\n    // Проверяем роль пользователя\r\n    const userRole = token.role as UserRole | undefined;\r\n    if (!hasAdminAccess(userRole)) {\r\n      return {\r\n        isAdmin: false,\r\n        error: \"Нет прав доступа\",\r\n      };\r\n    }\r\n\r\n    return {\r\n      isAdmin: true,\r\n      userId: parseInt(token.id as string),\r\n      role: userRole,\r\n      hasFullAccess: hasFullAdminAccess(userRole),\r\n      canManageAdmins: canManageAdmins(userRole),\r\n    };\r\n  } catch (error) {\r\n    return {\r\n      isAdmin: false,\r\n      error: \"Ошибка при проверке прав доступа\",\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Проверяет полный доступ к админ-панели (не оператор)\r\n * Используется для всех разделов кроме чата\r\n */\r\nexport async function checkFullAdminAccess(\r\n  request: NextRequest\r\n): Promise<AdminCheckResult> {\r\n  const result = await checkAdminAccess(request);\r\n\r\n  if (!result.isAdmin) {\r\n    return result;\r\n  }\r\n\r\n  if (!result.hasFullAccess) {\r\n    return {\r\n      isAdmin: false,\r\n      error: \"Недостаточно прав доступа\",\r\n    };\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * Проверяет права на управление чатами (операторы, администраторы, главный врач)\r\n * Используется для API чата\r\n */\r\nexport async function checkChatAccess(\r\n  request: NextRequest\r\n): Promise<AdminCheckResult> {\r\n  // Для чата достаточно базового админского доступа (включая операторов)\r\n  return checkAdminAccess(request);\r\n}\r\n\r\n/**\r\n * Проверяет права на управление администраторами\r\n * Используется для назначения/снятия роли администратора\r\n * Доступно только главному врачу\r\n */\r\nexport async function checkAdminManagementAccess(\r\n  request: NextRequest\r\n): Promise<AdminCheckResult> {\r\n  const result = await checkAdminAccess(request);\r\n\r\n  if (!result.isAdmin) {\r\n    return result;\r\n  }\r\n\r\n  if (!result.canManageAdmins) {\r\n    return {\r\n      isAdmin: false,\r\n      error: \"Доступ только для главного врача\",\r\n    };\r\n  }\r\n\r\n  return result;\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AACA;AACA;;;AAmBO,eAAe,iBACpB,OAAoB;IAEpB,IAAI;QACF,2BAA2B;QAC3B,MAAM,QAAQ,MAAM,IAAA,0JAAQ,EAAC;YAC3B,KAAK;YACL,QAAQ,QAAQ,GAAG,CAAC,eAAe;QACrC;QAEA,6CAA6C;QAC7C,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,EAAE;YACvB,OAAO;gBACL,SAAS;gBACT,OAAO;YACT;QACF;QAEA,8BAA8B;QAC9B,MAAM,WAAW,MAAM,IAAI;QAC3B,IAAI,CAAC,IAAA,wIAAc,EAAC,WAAW;YAC7B,OAAO;gBACL,SAAS;gBACT,OAAO;YACT;QACF;QAEA,OAAO;YACL,SAAS;YACT,QAAQ,SAAS,MAAM,EAAE;YACzB,MAAM;YACN,eAAe,IAAA,4IAAkB,EAAC;YAClC,iBAAiB,IAAA,yIAAe,EAAC;QACnC;IACF,EAAE,OAAO,OAAO;QACd,OAAO;YACL,SAAS;YACT,OAAO;QACT;IACF;AACF;AAMO,eAAe,qBACpB,OAAoB;IAEpB,MAAM,SAAS,MAAM,iBAAiB;IAEtC,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,OAAO;IACT;IAEA,IAAI,CAAC,OAAO,aAAa,EAAE;QACzB,OAAO;YACL,SAAS;YACT,OAAO;QACT;IACF;IAEA,OAAO;AACT;AAMO,eAAe,gBACpB,OAAoB;IAEpB,uEAAuE;IACvE,OAAO,iBAAiB;AAC1B;AAOO,eAAe,2BACpB,OAAoB;IAEpB,MAAM,SAAS,MAAM,iBAAiB;IAEtC,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,OAAO;IACT;IAEA,IAAI,CAAC,OAAO,eAAe,EAAE;QAC3B,OAAO;YACL,SAAS;YACT,OAAO;QACT;IACF;IAEA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 264, "column": 0}, "map": {"version":3,"sources":["file:///C:/Study/commercial-projects/smartmedical/src/app/api/admin/specialists/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/prisma\";\nimport { checkFullAdminAccess } from \"@/utils/api-auth\";\n\n// GET - Получить всех специалистов\nexport async function GET(request: NextRequest) {\n  try {\n    const adminCheck = await checkFullAdminAccess(request);\n    if (!adminCheck.isAdmin) {\n      return NextResponse.json({ error: adminCheck.error }, { status: 403 });\n    }\n\n    const specialists = await prisma.specialist.findMany({\n      include: {\n        category: {\n          select: {\n            id: true,\n            name: true,\n            slug: true,\n          },\n        },\n        serviceCategory: {\n          select: {\n            id: true,\n            name: true,\n            slug: true,\n          },\n        },\n      },\n      orderBy: { id: \"desc\" },\n    });\n\n    return NextResponse.json(specialists);\n  } catch (error) {\n    return NextResponse.json(\n      { error: \"Ошибка при получении специалистов\" },\n      { status: 500 }\n    );\n  }\n}\n\n// POST - Создать нового специалиста\nexport async function POST(request: NextRequest) {\n  try {\n    const adminCheck = await checkFullAdminAccess(request);\n    if (!adminCheck.isAdmin) {\n      return NextResponse.json({ error: adminCheck.error }, { status: 403 });\n    }\n\n    const data = await request.json();\n\n    console.log('Creating specialist with data:', {\n      ...data,\n      category_id: data.category_id ? parseInt(data.category_id) : null,\n      service_category_id: data.service_category_id ? parseInt(data.service_category_id) : null,\n    });\n\n    const specialist = await prisma.specialist.create({\n      data: {\n        name: data.name,\n        specialization: data.specialization,\n        qualification: data.qualification,\n        experience: parseInt(data.experience),\n        grade: parseInt(data.grade),\n        image_url: data.image_url || \"/images/default-doctor.jpg\",\n        activity_area: data.activity_area || null,\n        education_details: data.education_details || null,\n        conferences: data.conferences || [],\n        specializations: data.specializations || [],\n        education: data.education || [],\n        work_examples: data.work_examples || null,\n        category_id: data.category_id ? parseInt(data.category_id) : null,\n        service_category_id: data.service_category_id ? parseInt(data.service_category_id) : null,\n      },\n      include: {\n        category: true,\n        serviceCategory: true,\n      },\n    });\n\n    return NextResponse.json(specialist, { status: 201 });\n  } catch (error) {\n    console.error('Error creating specialist:', error);\n    return NextResponse.json(\n      { error: \"Ошибка при создании специалиста\", details: error instanceof Error ? error.message : 'Unknown error' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAGO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,aAAa,MAAM,IAAA,qJAAoB,EAAC;QAC9C,IAAI,CAAC,WAAW,OAAO,EAAE;YACvB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,WAAW,KAAK;YAAC,GAAG;gBAAE,QAAQ;YAAI;QACtE;QAEA,MAAM,cAAc,MAAM,gIAAM,CAAC,UAAU,CAAC,QAAQ,CAAC;YACnD,SAAS;gBACP,UAAU;oBACR,QAAQ;wBACN,IAAI;wBACJ,MAAM;wBACN,MAAM;oBACR;gBACF;gBACA,iBAAiB;oBACf,QAAQ;wBACN,IAAI;wBACJ,MAAM;wBACN,MAAM;oBACR;gBACF;YACF;YACA,SAAS;gBAAE,IAAI;YAAO;QACxB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAoC,GAC7C;YAAE,QAAQ;QAAI;IAElB;AACF;AAGO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,aAAa,MAAM,IAAA,qJAAoB,EAAC;QAC9C,IAAI,CAAC,WAAW,OAAO,EAAE;YACvB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,WAAW,KAAK;YAAC,GAAG;gBAAE,QAAQ;YAAI;QACtE;QAEA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,QAAQ,GAAG,CAAC,kCAAkC;YAC5C,GAAG,IAAI;YACP,aAAa,KAAK,WAAW,GAAG,SAAS,KAAK,WAAW,IAAI;YAC7D,qBAAqB,KAAK,mBAAmB,GAAG,SAAS,KAAK,mBAAmB,IAAI;QACvF;QAEA,MAAM,aAAa,MAAM,gIAAM,CAAC,UAAU,CAAC,MAAM,CAAC;YAChD,MAAM;gBACJ,MAAM,KAAK,IAAI;gBACf,gBAAgB,KAAK,cAAc;gBACnC,eAAe,KAAK,aAAa;gBACjC,YAAY,SAAS,KAAK,UAAU;gBACpC,OAAO,SAAS,KAAK,KAAK;gBAC1B,WAAW,KAAK,SAAS,IAAI;gBAC7B,eAAe,KAAK,aAAa,IAAI;gBACrC,mBAAmB,KAAK,iBAAiB,IAAI;gBAC7C,aAAa,KAAK,WAAW,IAAI,EAAE;gBACnC,iBAAiB,KAAK,eAAe,IAAI,EAAE;gBAC3C,WAAW,KAAK,SAAS,IAAI,EAAE;gBAC/B,eAAe,KAAK,aAAa,IAAI;gBACrC,aAAa,KAAK,WAAW,GAAG,SAAS,KAAK,WAAW,IAAI;gBAC7D,qBAAqB,KAAK,mBAAmB,GAAG,SAAS,KAAK,mBAAmB,IAAI;YACvF;YACA,SAAS;gBACP,UAAU;gBACV,iBAAiB;YACnB;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,YAAY;YAAE,QAAQ;QAAI;IACrD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAAmC,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAAgB,GAC9G;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}