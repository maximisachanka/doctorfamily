{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/utils/auth.ts"],"sourcesContent":["// Утилиты для работы с ролями и правами доступа\r\n\r\nexport type UserRole = \"USER\" | \"ADMIN\" | \"CHIEF_DOCTOR\" | \"OPERATOR\";\r\n\r\n// Роли с доступом к админ-панели\r\nexport const ADMIN_ROLES: UserRole[] = [\"ADMIN\", \"CHIEF_DOCTOR\", \"OPERATOR\"];\r\n\r\n/**\r\n * Проверяет, имеет ли пользователь доступ к админ-панели\r\n * @param role Роль пользователя\r\n * @returns true если пользователь имеет доступ к админ-панели\r\n */\r\nexport function hasAdminAccess(role?: UserRole | string | null): boolean {\r\n  if (!role) return false;\r\n  return ADMIN_ROLES.includes(role as UserRole);\r\n}\r\n\r\n/**\r\n * Проверяет, имеет ли пользователь полный доступ к админ-панели\r\n * (все разделы кроме управления администраторами)\r\n * @param role Роль пользователя\r\n * @returns true если администратор или главный врач\r\n */\r\nexport function hasFullAdminAccess(role?: UserRole | string | null): boolean {\r\n  if (!role) return false;\r\n  return role === \"ADMIN\" || role === \"CHIEF_DOCTOR\";\r\n}\r\n\r\n/**\r\n * Проверяет, может ли пользователь управлять администраторами\r\n * (назначать/снимать роль администратора)\r\n * @param role Роль пользователя\r\n * @returns true только для главного врача\r\n */\r\nexport function canManageAdmins(role?: UserRole | string | null): boolean {\r\n  return role === \"CHIEF_DOCTOR\";\r\n}\r\n\r\n/**\r\n * Проверяет, имеет ли пользователь доступ только к чату\r\n * @param role Роль пользователя\r\n * @returns true если оператор\r\n */\r\nexport function isChatOnlyAccess(role?: UserRole | string | null): boolean {\r\n  return role === \"OPERATOR\";\r\n}\r\n\r\n/**\r\n * Проверяет, является ли пользователь администратором\r\n * @param role Роль пользователя\r\n * @returns true если пользователь - администратор\r\n */\r\nexport function isAdmin(role?: UserRole | string | null): boolean {\r\n  return role === \"ADMIN\";\r\n}\r\n\r\n/**\r\n * Проверяет, является ли пользователь главным врачом\r\n * @param role Роль пользователя\r\n * @returns true если пользователь - главный врач\r\n */\r\nexport function isChiefDoctor(role?: UserRole | string | null): boolean {\r\n  return role === \"CHIEF_DOCTOR\";\r\n}\r\n\r\n/**\r\n * Проверяет, является ли пользователь оператором\r\n * @param role Роль пользователя\r\n * @returns true если пользователь - оператор\r\n */\r\nexport function isOperator(role?: UserRole | string | null): boolean {\r\n  return role === \"OPERATOR\";\r\n}\r\n\r\n/**\r\n * Получает человекочитаемое название роли\r\n * @param role Роль пользователя\r\n * @returns Название роли на русском языке\r\n */\r\nexport function getRoleName(role?: UserRole | string | null): string {\r\n  switch (role) {\r\n    case \"ADMIN\":\r\n      return \"Администратор\";\r\n    case \"CHIEF_DOCTOR\":\r\n      return \"Главный врач\";\r\n    case \"OPERATOR\":\r\n      return \"Оператор\";\r\n    case \"USER\":\r\n      return \"Пользователь\";\r\n    default:\r\n      return \"Неизвестная роль\";\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,gDAAgD;;;;;;;;;;;;;;;;;;;;;AAKzC,MAAM,cAA0B;IAAC;IAAS;IAAgB;CAAW;AAOrE,SAAS,eAAe,IAA+B;IAC5D,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO,YAAY,QAAQ,CAAC;AAC9B;AAQO,SAAS,mBAAmB,IAA+B;IAChE,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO,SAAS,WAAW,SAAS;AACtC;AAQO,SAAS,gBAAgB,IAA+B;IAC7D,OAAO,SAAS;AAClB;AAOO,SAAS,iBAAiB,IAA+B;IAC9D,OAAO,SAAS;AAClB;AAOO,SAAS,QAAQ,IAA+B;IACrD,OAAO,SAAS;AAClB;AAOO,SAAS,cAAc,IAA+B;IAC3D,OAAO,SAAS;AAClB;AAOO,SAAS,WAAW,IAA+B;IACxD,OAAO,SAAS;AAClB;AAOO,SAAS,YAAY,IAA+B;IACzD,OAAQ;QACN,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT;YACE,OAAO;IACX;AACF"}},
    {"offset": {"line": 83, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport type { NextRequest } from \"next/server\";\r\nimport { getToken } from \"next-auth/jwt\";\r\nimport { hasAdminAccess, hasFullAdminAccess, isChatOnlyAccess } from \"@/utils/auth\";\r\n\r\nexport async function middleware(request: NextRequest) {\r\n  const { pathname } = request.nextUrl;\r\n\r\n  // Защищаем роуты /admin\r\n  if (pathname.startsWith(\"/admin\")) {\r\n    const token = await getToken({\r\n      req: request,\r\n      secret: process.env.NEXTAUTH_SECRET,\r\n    });\r\n\r\n    // Если пользователь не авторизован или не имеет нужной роли - редирект на главную\r\n    if (!token || !hasAdminAccess(token.role)) {\r\n      const url = request.nextUrl.clone();\r\n      url.pathname = \"/\";\r\n      return NextResponse.redirect(url);\r\n    }\r\n\r\n    // Если пользователь - оператор (только доступ к чату)\r\n    if (isChatOnlyAccess(token.role)) {\r\n      // Разрешаем доступ только к /admin и /admin/chat\r\n      if (pathname === \"/admin\" || pathname.startsWith(\"/admin/chat\")) {\r\n        return NextResponse.next();\r\n      }\r\n\r\n      // Для всех остальных роутов - редирект на чат\r\n      const url = request.nextUrl.clone();\r\n      url.pathname = \"/admin/chat\";\r\n      return NextResponse.redirect(url);\r\n    }\r\n\r\n    // Для администраторов и главного врача - полный доступ\r\n    if (hasFullAdminAccess(token.role)) {\r\n      return NextResponse.next();\r\n    }\r\n  }\r\n\r\n  return NextResponse.next();\r\n}\r\n\r\n// Настройка matcher для применения middleware только к нужным путям\r\nexport const config = {\r\n  matcher: [\r\n    // Применяем middleware к роутам админ-панели\r\n    \"/admin/:path*\",\r\n  ],\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;AACA;;;;AAEO,eAAe,WAAW,OAAoB;IACnD,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,wBAAwB;IACxB,IAAI,SAAS,UAAU,CAAC,WAAW;QACjC,MAAM,QAAQ,MAAM,IAAA,gKAAQ,EAAC;YAC3B,KAAK;YACL,QAAQ,QAAQ,GAAG,CAAC,eAAe;QACrC;QAEA,kFAAkF;QAClF,IAAI,CAAC,SAAS,CAAC,IAAA,8IAAc,EAAC,MAAM,IAAI,GAAG;YACzC,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;YACjC,IAAI,QAAQ,GAAG;YACf,OAAO,gMAAY,CAAC,QAAQ,CAAC;QAC/B;QAEA,sDAAsD;QACtD,IAAI,IAAA,gJAAgB,EAAC,MAAM,IAAI,GAAG;YAChC,iDAAiD;YACjD,IAAI,aAAa,YAAY,SAAS,UAAU,CAAC,gBAAgB;gBAC/D,OAAO,gMAAY,CAAC,IAAI;YAC1B;YAEA,8CAA8C;YAC9C,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;YACjC,IAAI,QAAQ,GAAG;YACf,OAAO,gMAAY,CAAC,QAAQ,CAAC;QAC/B;QAEA,uDAAuD;QACvD,IAAI,IAAA,kJAAkB,EAAC,MAAM,IAAI,GAAG;YAClC,OAAO,gMAAY,CAAC,IAAI;QAC1B;IACF;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAGO,MAAM,SAAS;IACpB,SAAS;QACP,6CAA6C;QAC7C;KACD;AACH"}}]
}