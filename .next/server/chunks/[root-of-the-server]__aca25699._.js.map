{"version":3,"sources":["turbopack:///[project]/src/lib/prisma.ts","turbopack:///[project]/src/lib/getServicesMenu.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\n  });\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\n\n","import { prisma } from './prisma';\r\n\r\ninterface ServiceCategory {\r\n  id: number;\r\n  name: string;\r\n  slug: string;\r\n  icon: string | null;\r\n  parent_id: number | null;\r\n  order: number;\r\n  children?: ServiceCategory[];\r\n}\r\n\r\ninterface MenuItem {\r\n  id: string;\r\n  title: string;\r\n  icon?: string;\r\n  description?: string;\r\n  children?: MenuItem[];\r\n}\r\n\r\n// Функция для рекурсивного построения дерева меню\r\nfunction buildMenuTree(categories: ServiceCategory[]): MenuItem[] {\r\n  return categories.map((category) => {\r\n    const menuItem: MenuItem = {\r\n      id: category.slug,\r\n      title: category.name,\r\n    };\r\n\r\n    // Добавляем иконку только для корневых элементов\r\n    if (!category.parent_id && category.icon) {\r\n      menuItem.icon = category.icon;\r\n    }\r\n\r\n    // Добавляем только подкатегории в меню\r\n    if (category.children && category.children.length > 0) {\r\n      menuItem.children = buildMenuTree(category.children);\r\n    }\r\n\r\n    return menuItem;\r\n  });\r\n}\r\n\r\n// Получение меню услуг из БД (для использования на сервере)\r\nexport async function getServicesMenuFromDB(): Promise<MenuItem[]> {\r\n  try {\r\n    // @ts-ignore - ServiceCategory будет доступна после npx prisma generate\r\n    const categories = await prisma.serviceCategory.findMany({\r\n      where: {\r\n        is_active: true,\r\n        parent_id: null, // Только корневые категории\r\n      },\r\n      orderBy: [\r\n        { order: 'asc' },\r\n        { name: 'asc' },\r\n      ],\r\n      include: {\r\n        children: {\r\n          where: { is_active: true },\r\n          orderBy: [\r\n            { order: 'asc' },\r\n            { name: 'asc' },\r\n          ],\r\n          include: {\r\n            children: {\r\n              where: { is_active: true },\r\n              orderBy: [\r\n                { order: 'asc' },\r\n                { name: 'asc' },\r\n              ],\r\n            },\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    return buildMenuTree(categories as ServiceCategory[]);\r\n  } catch (error) {\r\n    console.error('Error fetching services menu from DB:', error);\r\n    return [];\r\n  }\r\n}\r\n"],"names":[],"mappings":"6nCAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAMO,IAAM,EAJW,AAKtB,WAAgB,MAAM,EACtB,IAAI,EAAA,YAAY,CAAC,CACf,IAA2E,CAAC,AAAvE,QAA+E,AACtF,8BADgD,0UCTlD,IAAA,EAAA,EAAA,CAAA,CAAA,OA2CO,eAAe,IACpB,GAAI,CAEF,IAAM,EAAa,MAAM,EAAA,MAAM,CAAC,eAAe,CAAC,QAAQ,CAAC,CACvD,MAAO,CACL,WAAW,EACX,UAAW,IACb,EACA,QAAS,CACP,CAAE,MAAO,KAAM,EACf,CAAE,KAAM,KAAM,EACf,CACD,QAAS,CACP,SAAU,CACR,MAAO,CAAE,WAAW,CAAK,EACzB,QAAS,CACP,CAAE,MAAO,KAAM,EACf,CAAE,KAAM,KAAM,EACf,CACD,QAAS,CACP,SAAU,CACR,MAAO,CAAE,WAAW,CAAK,EACzB,QAAS,CACP,CAAE,MAAO,KAAM,EACf,CAAE,KAAM,KAAM,EAElB,AADG,CAEL,CACF,CACF,CACF,GAEA,OAtDJ,AAsDW,SAtDF,EAAc,CAA6B,EAClD,OAAO,EAAW,GAAG,CAAE,AAAD,IACpB,IAAM,EAAqB,CACzB,GAAI,EAAS,IAAI,CACjB,MAAO,EAAS,IAAI,AACtB,EAYA,MATI,CAAC,EAAS,SAAS,EAAI,EAAS,IAAI,EAAE,CACxC,EAAS,IAAI,CAAG,EAAS,IAAA,AAAI,EAI3B,EAAS,QAAQ,EAAI,EAAS,QAAQ,CAAC,MAAM,CAAG,GAAG,CACrD,EAAS,QAAQ,CAAG,EAAc,EAAS,SAAQ,EAG9C,CACT,EACF,EAmCyB,EACvB,CAAE,MAAO,EAAO,CAEd,OADA,QAAQ,KAAK,CAAC,wCAAyC,GAChD,EAAE,AACX,CACF"}