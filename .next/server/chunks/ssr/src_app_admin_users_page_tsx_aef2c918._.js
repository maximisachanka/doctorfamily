module.exports=[78130,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(75003),e=a.i(62036),f=a.i(46271),g=a.i(28379),h=a.i(96221),i=a.i(41675),j=a.i(3314),k=a.i(33508),l=a.i(77156),m=a.i(41379),n=a.i(43108),o=a.i(16201),p=a.i(92e3),q=a.i(61056),r=a.i(67974),s=a.i(72663),t=a.i(4297),u=a.i(52913),v=a.i(55220),w=a.i(79212),x=a.i(96215),y=a.i(37210),z=a.i(72549);a.i(27190);var A=a.i(25170);function B(){let{status:a}=(0,d.useSession)(),{sessionVerified:B,isLoading:C,verifySession:D}=(0,w.useAdminSession)(),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)(null),I=(0,z.useConfirmDialog)(),{success:J,error:K}=(0,A.useAlert)(),[L,M]=(0,c.useState)([]),[N,O]=(0,c.useState)(!1),[P,Q]=(0,c.useState)(""),[R,S]=(0,c.useState)(1),[T,U]=(0,c.useState)("all"),[V,W]=(0,c.useState)(!1),[X,Y]=(0,c.useState)(null),[Z,$]=(0,c.useState)(""),[_,aa]=(0,c.useState)(!1),[ab,ac]=(0,c.useState)(!1),[ad,ae]=(0,c.useState)(null);(0,c.useEffect)(()=>{"authenticated"===a?af():"unauthenticated"===a&&F(!1)},[a]),(0,c.useEffect)(()=>{B&&(E||G)&&ag()},[B,E,G]);let af=async()=>{try{let a=await fetch("/api/admin/auth"),b=await a.json();F(!0===b.isChiefDoctor),H(!0===b.isAdmin)}catch(a){F(!1),H(!1)}},ag=async()=>{O(!0);try{let a=await fetch("/api/admin/users");if(a.ok){let b=await a.json();M(b)}}catch(a){console.error("Error loading data:",a)}finally{O(!1)}},ah=(0,c.useMemo)(()=>{let a=L;if("admin"===T?a=a.filter(a=>"ADMIN"===a.role):"operator"===T&&(a=a.filter(a=>"OPERATOR"===a.role)),P){let b=P.toLowerCase();a=a.filter(a=>a.name.toLowerCase().includes(b)||a.email&&a.email.toLowerCase().includes(b)||a.phone&&a.phone.toLowerCase().includes(b)||a.login.toLowerCase().includes(b))}return a},[L,P,T]),ai=(0,c.useMemo)(()=>L.filter(a=>"ADMIN"===a.role).length,[L]),aj=(0,c.useMemo)(()=>L.filter(a=>"OPERATOR"===a.role).length,[L]);(0,c.useEffect)(()=>{S(1)},[P,T]);let ak=Math.ceil(ah.length/12),al=(0,c.useMemo)(()=>{let a=(R-1)*12;return ah.slice(a,a+12)},[ah,R]),am=async(a,b)=>{if("ADMIN"===b)return E?(Y(a),$(""),ae(null),void W(!0)):void K("Только главный врач может назначать администраторов");if("OPERATOR"===b){if(!await I.confirm({title:"Назначить оператором",message:`Вы уверены, что хотите назначить пользователя "${ap(a)}" оператором?`,confirmText:"Назначить",cancelText:"Отмена"}))return;await an(a.id,b);return}if("ADMIN"===a.role)return E?void(await I.confirm({title:"Снять права администратора",message:`Вы уверены, что хотите снять права администратора с пользователя "${ap(a)}"?`,confirmText:"Подтвердить",cancelText:"Отмена",variant:"danger"})&&await an(a.id,b)):void K("Только главный врач может снимать права администратора");if("OPERATOR"===a.role){if(!await I.confirm({title:"Снять права оператора",message:`Вы уверены, что хотите снять права оператора с пользователя "${ap(a)}"?`,confirmText:"Подтвердить",cancelText:"Отмена",variant:"warning"}))return;await an(a.id,b);return}},an=async(a,b,c)=>{try{let d=await fetch("/api/admin/users",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a,newRole:b,adminPassword:c})});if(d.ok)return await ag(),J({ADMIN:"Администратор назначен",OPERATOR:"Оператор назначен",USER:"Роль изменена на пользователя"}[b]||"Роль изменена"),!0;{let a=await d.json();throw Error(a.error||"Ошибка изменения роли")}}catch(a){return K(a.message||"Ошибка изменения роли"),!1}},ao=async()=>{if(X&&Z){ac(!0),ae(null);try{let a=await fetch("/api/admin/users",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:X.id,newRole:"ADMIN",adminPassword:Z})});if(a.ok)await ag(),J("Администратор назначен"),W(!1),Y(null),$("");else{let b=await a.json();ae(b.error||"Ошибка назначения администратора")}}catch(a){ae("Ошибка назначения администратора")}finally{ac(!1)}}},ap=a=>a.name||a.login,aq=a=>{let b=a.name.trim().split(/\s+/);return b.length>=2?(b[0][0]+b[1][0]).toUpperCase():a.name.slice(0,2).toUpperCase()};return"loading"===a||null===E||null===G||C?(0,b.jsx)(x.AdminAccessSkeleton,{}):"unauthenticated"!==a&&(E||G)?B?(0,b.jsxs)("div",{className:"flex min-h-screen bg-gray-50",children:[(0,b.jsx)(s.AdminMenu,{}),(0,b.jsx)("div",{className:"flex-1 p-4 lg:p-8 overflow-auto",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,b.jsxs)(t.AdminSection,{title:"Пользователи",icon:g.UserCog,count:L.length,loading:N,searchValue:P,onSearchChange:Q,children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-6 flex-wrap",children:[(0,b.jsxs)("button",{onClick:()=>U("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${"all"===T?"bg-gray-700 text-white shadow-md":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-200"}`,children:[(0,b.jsx)(g.UserCog,{className:"w-4 h-4"}),"Все пользователи"]}),(0,b.jsxs)("button",{onClick:()=>U("admin"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${"admin"===T?"bg-emerald-500 text-white shadow-md":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-200"}`,children:[(0,b.jsx)(j.Shield,{className:"w-4 h-4"}),"Администраторы",ai>0&&(0,b.jsx)("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold ${"admin"===T?"bg-white/20 text-white":"bg-emerald-500/10 text-emerald-600"}`,children:ai})]}),(0,b.jsxs)("button",{onClick:()=>U("operator"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${"operator"===T?"bg-blue-500 text-white shadow-md":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-200"}`,children:[(0,b.jsx)(q.Headphones,{className:"w-4 h-4"}),"Операторы",aj>0&&(0,b.jsx)("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold ${"operator"===T?"bg-white/20 text-white":"bg-blue-500/10 text-blue-600"}`,children:aj})]})]}),0===ah.length?(0,b.jsx)(t.EmptyState,{icon:g.UserCog,title:"Пользователи не найдены",description:P?"Попробуйте изменить поисковый запрос":"Пока нет пользователей"}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(0,b.jsx)(e.AnimatePresence,{children:al.map(a=>(0,b.jsxs)(t.ItemCard,{children:[(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsx)("div",{className:`w-12 h-12 rounded-full overflow-hidden flex-shrink-0 flex items-center justify-center ${"ADMIN"===a.role?"bg-emerald-500":"OPERATOR"===a.role?"bg-blue-500":"bg-gray-500"}`,children:a.avatar_url?(0,b.jsx)("img",{src:a.avatar_url,alt:ap(a),className:"w-full h-full object-cover"}):(0,b.jsx)("span",{className:"text-sm font-semibold text-white",children:aq(a)})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-800 truncate",children:ap(a)}),(0,b.jsxs)("p",{className:"text-sm text-gray-500 truncate",children:["@",a.login]}),a.email&&(0,b.jsx)("p",{className:"text-xs text-gray-400 truncate",children:a.email})]})]}),a.phone&&(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:a.phone}),(0,b.jsxs)("div",{className:"flex items-center justify-between mt-3",children:[(0,b.jsxs)("p",{className:"text-xs text-gray-400 flex items-center gap-1",children:[(0,b.jsx)(i.Calendar,{className:"w-3 h-3"}),new Date(a.registration_date).toLocaleDateString("ru-RU")]}),"ADMIN"===a.role?(0,b.jsx)(t.Badge,{variant:"success",children:"Администратор"}):"OPERATOR"===a.role?(0,b.jsx)(t.Badge,{variant:"primary",children:"Оператор"}):(0,b.jsx)(t.Badge,{variant:"secondary",children:"Пользователь"})]}),(0,b.jsx)("div",{className:"flex items-center gap-2 mt-4 pt-4 border-t border-gray-100",children:"USER"===a.role?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("button",{onClick:()=>am(a,"OPERATOR"),className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-2 bg-blue-500 text-white text-xs sm:text-sm font-medium rounded-lg hover:bg-blue-600 transition-colors",children:[(0,b.jsx)(q.Headphones,{className:"w-4 h-4 flex-shrink-0"}),(0,b.jsx)("span",{className:"truncate",children:"Оператор"})]}),E&&(0,b.jsxs)("button",{onClick:()=>am(a,"ADMIN"),className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-2 bg-emerald-500 text-white text-xs sm:text-sm font-medium rounded-lg hover:bg-emerald-600 transition-colors",children:[(0,b.jsx)(j.Shield,{className:"w-4 h-4 flex-shrink-0"}),(0,b.jsx)("span",{className:"truncate",children:"Админ"})]})]}):"OPERATOR"===a.role?(0,b.jsxs)("button",{onClick:()=>am(a,"USER"),className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-2 bg-gray-500 text-white text-xs sm:text-sm font-medium rounded-lg hover:bg-gray-600 transition-colors",children:[(0,b.jsx)(k.X,{className:"w-4 h-4 flex-shrink-0"}),(0,b.jsx)("span",{className:"truncate",children:"Снять оператора"})]}):"ADMIN"===a.role&&E?(0,b.jsxs)("button",{onClick:()=>am(a,"USER"),className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-2 bg-red-500 text-white text-xs sm:text-sm font-medium rounded-lg hover:bg-red-600 transition-colors",children:[(0,b.jsx)(k.X,{className:"w-4 h-4 flex-shrink-0"}),(0,b.jsx)("span",{className:"truncate",children:"Снять админа"})]}):null})]},a.id))})}),ak>1&&(0,b.jsx)(r.Pagination,{currentPage:R,totalPages:ak,onPageChange:S,className:"mt-6"})]})]}),(0,b.jsx)(e.AnimatePresence,{children:V&&X&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,b.jsx)(f.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>!ab&&W(!1),className:"absolute inset-0 bg-black/50 backdrop-blur-sm"}),(0,b.jsxs)(f.motion.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative w-full max-w-md bg-white rounded-2xl shadow-2xl overflow-hidden",children:[(0,b.jsx)("div",{className:"bg-[#18A36C] px-6 py-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("h2",{className:"text-xl font-semibold text-white flex items-center gap-2",children:[(0,b.jsx)(n.Lock,{className:"w-5 h-5"}),"Подтверждение"]}),(0,b.jsx)("button",{onClick:()=>!ab&&W(!1),className:"p-1.5 hover:bg-white/20 rounded-lg transition-colors",children:(0,b.jsx)(k.X,{className:"w-5 h-5 text-white"})})]})}),(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4 mb-4 p-4 bg-gray-50 rounded-xl",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-full overflow-hidden flex-shrink-0 bg-blue-500 flex items-center justify-center",children:X.avatar_url?(0,b.jsx)("img",{src:X.avatar_url,alt:ap(X),className:"w-full h-full object-cover"}):(0,b.jsx)("span",{className:"text-sm font-semibold text-white",children:aq(X)})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-800",children:ap(X)}),(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:["@",X.login]})]})]}),(0,b.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Для назначения администратора введите ваш пароль:"}),ad&&(0,b.jsxs)("div",{className:"p-3 mb-4 bg-red-50 border border-red-200 rounded-xl text-sm text-red-600 flex items-center gap-2",children:[(0,b.jsx)(p.AlertCircle,{className:"w-4 h-4 flex-shrink-0"}),ad]}),(0,b.jsx)("form",{autoComplete:"off",onSubmit:a=>{a.preventDefault(),ao()},children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("input",{type:_?"text":"password",name:"admin-confirmation-password",value:Z,onChange:a=>$(a.target.value),placeholder:"Введите ваш пароль",autoComplete:"off",className:"w-full px-4 py-3 pr-12 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-[#18A36C]/20 focus:border-[#18A36C] transition-all",disabled:ab,onKeyDown:a=>"Enter"===a.key&&ao()}),(0,b.jsx)("button",{type:"button",onClick:()=>aa(!_),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 text-gray-400 hover:text-gray-600",children:_?(0,b.jsx)(m.EyeOff,{className:"w-5 h-5"}):(0,b.jsx)(l.Eye,{className:"w-5 h-5"})})]})})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 p-6 pt-0",children:[(0,b.jsx)("button",{onClick:()=>W(!1),disabled:ab,className:"flex-1 px-4 py-2.5 border border-gray-200 text-gray-700 font-medium rounded-xl hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Отмена"}),(0,b.jsxs)("button",{onClick:ao,disabled:ab||!Z,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-[#18A36C] text-white font-medium rounded-xl hover:bg-[#15905f] transition-colors disabled:opacity-50",children:[ab?(0,b.jsx)(h.Loader2,{className:"w-4 h-4 animate-spin"}):(0,b.jsx)(o.CheckCircle,{className:"w-4 h-4"}),"Подтвердить"]})]})]})]})}),(0,b.jsx)(y.ConfirmDialog,{isOpen:I.isOpen,onClose:I.handleCancel,onConfirm:I.handleConfirm,title:I.options.title,message:I.options.message,confirmText:I.options.confirmText,cancelText:I.options.cancelText,variant:I.options.variant,loading:I.loading})]})})]}):(0,b.jsx)(v.AdminAuthForm,{onSuccess:()=>{D()}}):(0,b.jsx)(u.default,{})}a.s(["default",()=>B])}];

//# sourceMappingURL=src_app_admin_users_page_tsx_aef2c918._.js.map