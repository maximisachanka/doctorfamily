module.exports=[78130,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(75003),e=a.i(62036),f=a.i(46271),g=a.i(28379),h=a.i(96221),i=a.i(41675),j=a.i(3314),k=a.i(33508),l=a.i(77156),m=a.i(41379),n=a.i(43108),o=a.i(16201),p=a.i(92e3),q=a.i(61056),r=a.i(67974),s=a.i(72663),t=a.i(3038),u=a.i(4297),v=a.i(52913),w=a.i(55220),x=a.i(79212),y=a.i(96215),z=a.i(37210),A=a.i(72549);a.i(27190);var B=a.i(25170);function C(){let{status:a}=(0,d.useSession)(),{sessionVerified:C,isLoading:D,verifySession:E}=(0,x.useAdminSession)(),[F,G]=(0,c.useState)(null),[H,I]=(0,c.useState)(null),J=(0,A.useConfirmDialog)(),{success:K,error:L}=(0,B.useAlert)(),{currentPage:M,setPage:N,buildApiUrl:O}=(0,t.useServerPagination)(12),[P,Q]=(0,c.useState)([]),[R,S]=(0,c.useState)(1),[T,U]=(0,c.useState)(0),[V,W]=(0,c.useState)(!1),[X,Y]=(0,c.useState)(""),[Z,$]=(0,c.useState)("all"),[_,aa]=(0,c.useState)(!1),[ab,ac]=(0,c.useState)(null),[ad,ae]=(0,c.useState)(""),[af,ag]=(0,c.useState)(!1),[ah,ai]=(0,c.useState)(!1),[aj,ak]=(0,c.useState)(null);(0,c.useEffect)(()=>{"authenticated"===a?al():"unauthenticated"===a&&G(!1)},[a]),(0,c.useEffect)(()=>{C&&(F||H)&&am()},[C,F,H,M,X,Z]);let al=async()=>{try{let a=await fetch("/api/admin/auth"),b=await a.json();G(!0===b.isChiefDoctor),I(!0===b.isAdmin)}catch(a){G(!1),I(!1)}},am=async()=>{W(!0);try{let a=O("/api/admin/users",X)+("all"!==Z?`&role=${Z}`:""),b=await fetch(a);if(b.ok){let a=await b.json();Q(a.data||[]),S(a.totalPages||1),U(a.totalCount||0)}}catch(a){console.error("Error loading data:",a),L("Ошибка загрузки данных")}finally{W(!1)}};(0,c.useEffect)(()=>{N(1)},[X,Z]);let an=async(a,b)=>{if("ADMIN"===b)return F?(ac(a),ae(""),ak(null),void aa(!0)):void L("Только главный врач может назначать администраторов");if("OPERATOR"===b){if(!await J.confirm({title:"Назначить оператором",message:`Вы уверены, что хотите назначить пользователя "${aq(a)}" оператором?`,confirmText:"Назначить",cancelText:"Отмена"}))return;await ao(a.id,b);return}if("ADMIN"===a.role)return F?void(await J.confirm({title:"Снять права администратора",message:`Вы уверены, что хотите снять права администратора с пользователя "${aq(a)}"?`,confirmText:"Подтвердить",cancelText:"Отмена",variant:"danger"})&&await ao(a.id,b)):void L("Только главный врач может снимать права администратора");if("OPERATOR"===a.role){if(!await J.confirm({title:"Снять права оператора",message:`Вы уверены, что хотите снять права оператора с пользователя "${aq(a)}"?`,confirmText:"Подтвердить",cancelText:"Отмена",variant:"warning"}))return;await ao(a.id,b);return}},ao=async(a,b,c)=>{try{let d=await fetch("/api/admin/users",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a,newRole:b,adminPassword:c})});if(d.ok)return await am(),K({ADMIN:"Администратор назначен",OPERATOR:"Оператор назначен",USER:"Роль изменена на пользователя"}[b]||"Роль изменена"),!0;{let a=await d.json();throw Error(a.error||"Ошибка изменения роли")}}catch(a){return L(a.message||"Ошибка изменения роли"),!1}},ap=async()=>{if(ab&&ad){ai(!0),ak(null);try{let a=await fetch("/api/admin/users",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:ab.id,newRole:"ADMIN",adminPassword:ad})});if(a.ok)await am(),K("Администратор назначен"),aa(!1),ac(null),ae("");else{let b=await a.json();ak(b.error||"Ошибка назначения администратора")}}catch(a){ak("Ошибка назначения администратора")}finally{ai(!1)}}},aq=a=>a.name||a.login,ar=a=>{let b=a.name.trim().split(/\s+/);return b.length>=2?(b[0][0]+b[1][0]).toUpperCase():a.name.slice(0,2).toUpperCase()};return"loading"===a||null===F||null===H||D?(0,b.jsx)(y.AdminAccessSkeleton,{}):"unauthenticated"!==a&&(F||H)?C?(0,b.jsxs)("div",{className:"flex min-h-screen bg-gray-50",children:[(0,b.jsx)(s.AdminMenu,{}),(0,b.jsx)("div",{className:"flex-1 p-4 lg:p-8 overflow-auto",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,b.jsxs)(u.AdminSection,{title:"Пользователи",icon:g.UserCog,count:T,loading:V,searchValue:X,onSearchChange:Y,children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-6 flex-wrap",children:[(0,b.jsxs)("button",{onClick:()=>$("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${"all"===Z?"bg-gray-700 text-white shadow-md":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-200"}`,children:[(0,b.jsx)(g.UserCog,{className:"w-4 h-4"}),"Все пользователи"]}),(0,b.jsxs)("button",{onClick:()=>$("admin"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${"admin"===Z?"bg-emerald-500 text-white shadow-md":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-200"}`,children:[(0,b.jsx)(j.Shield,{className:"w-4 h-4"}),"Администраторы",adminsCount>0&&(0,b.jsx)("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold ${"admin"===Z?"bg-white/20 text-white":"bg-emerald-500/10 text-emerald-600"}`,children:adminsCount})]}),(0,b.jsxs)("button",{onClick:()=>$("operator"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${"operator"===Z?"bg-blue-500 text-white shadow-md":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-200"}`,children:[(0,b.jsx)(q.Headphones,{className:"w-4 h-4"}),"Операторы",operatorsCount>0&&(0,b.jsx)("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold ${"operator"===Z?"bg-white/20 text-white":"bg-blue-500/10 text-blue-600"}`,children:operatorsCount})]})]}),0===P.length?(0,b.jsx)(u.EmptyState,{icon:g.UserCog,title:"Пользователи не найдены",description:X?"Попробуйте изменить поисковый запрос":"Пока нет пользователей"}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(0,b.jsx)(e.AnimatePresence,{children:P.map(a=>(0,b.jsxs)(u.ItemCard,{children:[(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsx)("div",{className:`w-12 h-12 rounded-full overflow-hidden flex-shrink-0 flex items-center justify-center ${"ADMIN"===a.role?"bg-emerald-500":"OPERATOR"===a.role?"bg-blue-500":"bg-gray-500"}`,children:a.avatar_url?(0,b.jsx)("img",{src:a.avatar_url,alt:aq(a),className:"w-full h-full object-cover"}):(0,b.jsx)("span",{className:"text-sm font-semibold text-white",children:ar(a)})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-800 truncate",children:aq(a)}),(0,b.jsxs)("p",{className:"text-sm text-gray-500 truncate",children:["@",a.login]}),a.email&&(0,b.jsx)("p",{className:"text-xs text-gray-400 truncate",children:a.email})]})]}),a.phone&&(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:a.phone}),(0,b.jsxs)("div",{className:"flex items-center justify-between mt-3",children:[(0,b.jsxs)("p",{className:"text-xs text-gray-400 flex items-center gap-1",children:[(0,b.jsx)(i.Calendar,{className:"w-3 h-3"}),new Date(a.registration_date).toLocaleDateString("ru-RU")]}),"ADMIN"===a.role?(0,b.jsx)(u.Badge,{variant:"success",children:"Администратор"}):"OPERATOR"===a.role?(0,b.jsx)(u.Badge,{variant:"primary",children:"Оператор"}):(0,b.jsx)(u.Badge,{variant:"secondary",children:"Пользователь"})]}),(0,b.jsx)("div",{className:"flex items-center gap-2 mt-4 pt-4 border-t border-gray-100",children:"USER"===a.role?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("button",{onClick:()=>an(a,"OPERATOR"),className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-2 bg-blue-500 text-white text-xs sm:text-sm font-medium rounded-lg hover:bg-blue-600 transition-colors",children:[(0,b.jsx)(q.Headphones,{className:"w-4 h-4 flex-shrink-0"}),(0,b.jsx)("span",{className:"truncate",children:"Оператор"})]}),F&&(0,b.jsxs)("button",{onClick:()=>an(a,"ADMIN"),className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-2 bg-emerald-500 text-white text-xs sm:text-sm font-medium rounded-lg hover:bg-emerald-600 transition-colors",children:[(0,b.jsx)(j.Shield,{className:"w-4 h-4 flex-shrink-0"}),(0,b.jsx)("span",{className:"truncate",children:"Админ"})]})]}):"OPERATOR"===a.role?(0,b.jsxs)("button",{onClick:()=>an(a,"USER"),className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-2 bg-gray-500 text-white text-xs sm:text-sm font-medium rounded-lg hover:bg-gray-600 transition-colors",children:[(0,b.jsx)(k.X,{className:"w-4 h-4 flex-shrink-0"}),(0,b.jsx)("span",{className:"truncate",children:"Снять оператора"})]}):"ADMIN"===a.role&&F?(0,b.jsxs)("button",{onClick:()=>an(a,"USER"),className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-2 bg-red-500 text-white text-xs sm:text-sm font-medium rounded-lg hover:bg-red-600 transition-colors",children:[(0,b.jsx)(k.X,{className:"w-4 h-4 flex-shrink-0"}),(0,b.jsx)("span",{className:"truncate",children:"Снять админа"})]}):null})]},a.id))})}),R>1&&(0,b.jsx)(r.Pagination,{currentPage:M,totalPages:R,onPageChange:N,className:"mt-6"})]})]}),(0,b.jsx)(e.AnimatePresence,{children:_&&ab&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,b.jsx)(f.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>!ah&&aa(!1),className:"absolute inset-0 bg-black/50 backdrop-blur-sm"}),(0,b.jsxs)(f.motion.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative w-full max-w-md bg-white rounded-2xl shadow-2xl overflow-hidden",children:[(0,b.jsx)("div",{className:"bg-[#18A36C] px-6 py-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("h2",{className:"text-xl font-semibold text-white flex items-center gap-2",children:[(0,b.jsx)(n.Lock,{className:"w-5 h-5"}),"Подтверждение"]}),(0,b.jsx)("button",{onClick:()=>!ah&&aa(!1),className:"p-1.5 hover:bg-white/20 rounded-lg transition-colors",children:(0,b.jsx)(k.X,{className:"w-5 h-5 text-white"})})]})}),(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4 mb-4 p-4 bg-gray-50 rounded-xl",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-full overflow-hidden flex-shrink-0 bg-blue-500 flex items-center justify-center",children:ab.avatar_url?(0,b.jsx)("img",{src:ab.avatar_url,alt:aq(ab),className:"w-full h-full object-cover"}):(0,b.jsx)("span",{className:"text-sm font-semibold text-white",children:ar(ab)})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-800",children:aq(ab)}),(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:["@",ab.login]})]})]}),(0,b.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Для назначения администратора введите ваш пароль:"}),aj&&(0,b.jsxs)("div",{className:"p-3 mb-4 bg-red-50 border border-red-200 rounded-xl text-sm text-red-600 flex items-center gap-2",children:[(0,b.jsx)(p.AlertCircle,{className:"w-4 h-4 flex-shrink-0"}),aj]}),(0,b.jsx)("form",{autoComplete:"off",onSubmit:a=>{a.preventDefault(),ap()},children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("input",{type:af?"text":"password",name:"admin-confirmation-password",value:ad,onChange:a=>ae(a.target.value),placeholder:"Введите ваш пароль",autoComplete:"off",className:"w-full px-4 py-3 pr-12 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-[#18A36C]/20 focus:border-[#18A36C] transition-all",disabled:ah,onKeyDown:a=>"Enter"===a.key&&ap()}),(0,b.jsx)("button",{type:"button",onClick:()=>ag(!af),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 text-gray-400 hover:text-gray-600",children:af?(0,b.jsx)(m.EyeOff,{className:"w-5 h-5"}):(0,b.jsx)(l.Eye,{className:"w-5 h-5"})})]})})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 p-6 pt-0",children:[(0,b.jsx)("button",{onClick:()=>aa(!1),disabled:ah,className:"flex-1 px-4 py-2.5 border border-gray-200 text-gray-700 font-medium rounded-xl hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Отмена"}),(0,b.jsxs)("button",{onClick:ap,disabled:ah||!ad,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-[#18A36C] text-white font-medium rounded-xl hover:bg-[#15905f] transition-colors disabled:opacity-50",children:[ah?(0,b.jsx)(h.Loader2,{className:"w-4 h-4 animate-spin"}):(0,b.jsx)(o.CheckCircle,{className:"w-4 h-4"}),"Подтвердить"]})]})]})]})}),(0,b.jsx)(z.ConfirmDialog,{isOpen:J.isOpen,onClose:J.handleCancel,onConfirm:J.handleConfirm,title:J.options.title,message:J.options.message,confirmText:J.options.confirmText,cancelText:J.options.cancelText,variant:J.options.variant,loading:J.loading})]})})]}):(0,b.jsx)(w.AdminAuthForm,{onSuccess:()=>{E()}}):(0,b.jsx)(v.default,{})}a.s(["default",()=>C])}];

//# sourceMappingURL=src_app_admin_users_page_tsx_aef2c918._.js.map