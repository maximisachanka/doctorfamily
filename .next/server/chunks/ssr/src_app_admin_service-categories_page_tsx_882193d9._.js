module.exports=[71748,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(75003),e=a.i(54624),f=a.i(50522),g=a.i(5784),h=a.i(62036),i=a.i(72663),j=a.i(4297),k=a.i(52913),l=a.i(55220),m=a.i(79212),n=a.i(25170),o=a.i(96215),p=a.i(72549),q=a.i(37210),r=a.i(33699),s=a.i(91678);let t=["Baby","Smile","Heart","Activity","Eye","Brain","Users","Stethoscope","ShieldPlus","Syringe","Pill","Microscope","Hospital","Dna"];function u(){let a,{status:u}=(0,d.useSession)(),{sessionVerified:v,isLoading:w,verifySession:x}=(0,m.useAdminSession)(),[y,z]=(0,c.useState)(null),[A,B]=(0,c.useState)(!0),{success:C,error:D}=(0,n.useAlert)(),E=(0,p.useConfirmDialog)(),[F,G]=(0,c.useState)([]),[H,I]=(0,c.useState)(!1),[J,K]=(0,c.useState)(new Set),[L,M]=(0,c.useState)(""),[N,O]=(0,c.useState)(!1),[P,Q]=(0,c.useState)(null),[R,S]=(0,c.useState)(!1),[T,U]=(0,c.useState)(""),[V,W]=(0,c.useState)({name:"",slug:"",icon:"",description:"",parent_id:"",order:"0",is_active:!0});(0,c.useEffect)(()=>{"authenticated"===u?X():"unauthenticated"===u&&z(!1)},[u]),(0,c.useEffect)(()=>{v&&y&&Y()},[v,y]);let X=async()=>{B(!0);try{let a=await fetch("/api/admin/auth"),b=await a.json(),c="ADMIN"===b.role||"CHIEF_DOCTOR"===b.role;z(c)}catch(a){z(!1)}finally{B(!1)}},Y=async()=>{I(!0);try{let a=await fetch("/api/admin/service-categories");if(a.ok){let b=await a.json();G(b)}}catch(a){D("Ошибка загрузки данных")}finally{I(!1)}},Z=(0,c.useMemo)(()=>{let a=(b,c=0)=>{let d=[];for(let e of b)d.push({...e,level:c}),e.children&&e.children.length>0&&d.push(...a(e.children,c+1));return d};return a(F)},[F]),$=async()=>{S(!0);try{let a=P?`/api/admin/service-categories/${P.id}`:"/api/admin/service-categories",b=P?"PUT":"POST",c=await fetch(a,{method:b,headers:{"Content-Type":"application/json"},body:JSON.stringify({...V,parent_id:V.parent_id?parseInt(V.parent_id):null,order:parseInt(V.order)})});if(c.ok)await Y(),aa(),C(P?"Категория обновлена":"Категория создана");else{let a=await c.json();D(a.error||"Ошибка сохранения")}}catch(a){D("Ошибка сохранения")}finally{S(!1)}},_=async(a,b)=>{if(await E.confirm({title:"Удаление категории",message:`Вы уверены, что хотите удалить категорию "${b}"? Это также удалит все вложенные подкатегории. Это действие нельзя отменить.`,confirmText:"Удалить",cancelText:"Отмена",variant:"danger"}))try{let b=await fetch(`/api/admin/service-categories/${a}`,{method:"DELETE"});if(b.ok)await Y(),C("Категория удалена");else{let a=await b.json();D(a.error||"Ошибка удаления")}}catch(a){D("Ошибка удаления")}},aa=()=>{W({name:"",slug:"",icon:"",description:"",parent_id:"",order:"0",is_active:!0}),Q(null),U(""),O(!1)},ab=()=>{aa(),O(!0)},ac=(a,c=0,d=!1)=>{let e=a.icon?r.iconMap[a.icon]:null,h=a.children&&a.children.length>0,i=J.has(a.id);return(0,b.jsxs)("div",{className:"relative",children:[c>0&&(0,b.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-[2px] bg-gray-200",style:{left:`${(c-1)*32+16}px`}}),c>0&&(0,b.jsx)("div",{className:"absolute left-0 top-6 w-4 h-[2px] bg-gray-200",style:{left:`${(c-1)*32+16}px`}}),(0,b.jsx)("div",{className:"mb-3",style:{marginLeft:c>0?`${32*c}px`:"0"},children:(0,b.jsxs)("div",{className:`relative ${0===c?"bg-white":1===c?"bg-blue-50/30":"bg-purple-50/30"} border-l-4 ${0===c?"border-l-[#18A36C]":1===c?"border-l-blue-400":"border-l-purple-400"} rounded-lg overflow-hidden transition-all hover:shadow-md`,children:[h&&(0,b.jsx)("button",{onClick:()=>{var b;let c;return b=a.id,void((c=new Set(J)).has(b)?c.delete(b):c.add(b),K(c))},className:"absolute left-3 top-6 -translate-y-1/2 z-10 p-1.5 bg-white hover:bg-gray-100 rounded-lg border border-gray-200 shadow-sm transition-all hover:scale-110",children:i?(0,b.jsx)(g.ChevronDown,{className:"w-4 h-4 text-[#18A36C]"}):(0,b.jsx)(f.ChevronRight,{className:"w-4 h-4 text-gray-600"})}),(0,b.jsxs)("div",{className:`p-4 ${h?"pl-12":"pl-4"}`,children:[(0,b.jsxs)("div",{className:"flex items-start gap-3 mb-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:`w-1 h-12 rounded-full ${0===c?"bg-[#18A36C]":1===c?"bg-blue-400":"bg-purple-400"}`}),e&&(0,b.jsx)("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0 ${0===c?"bg-[#18A36C]/10":1===c?"bg-blue-100":"bg-purple-100"}`,children:(0,b.jsx)(e,{className:`w-6 h-6 ${0===c?"text-[#18A36C]":1===c?"text-blue-600":"text-purple-600"}`})})]}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-800 text-base",children:a.name}),0===c&&(0,b.jsx)(j.Badge,{variant:"primary",children:"Корневая"}),1===c&&(0,b.jsx)(j.Badge,{variant:"secondary",children:"Подкатегория"}),2===c&&(0,b.jsx)(j.Badge,{variant:"secondary",children:"Вложенная"})]}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 font-mono",children:["/",a.slug]})]})]}),a.description&&(0,b.jsx)("p",{className:"text-sm text-gray-600 mb-3 pl-14 line-clamp-2",children:a.description}),(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-wrap mb-3 pl-14",children:[(0,b.jsxs)(j.Badge,{variant:"secondary",children:["Порядок: ",a.order]}),(0,b.jsx)(j.Badge,{variant:a.is_active?"success":"danger",children:a.is_active?"Активна":"Неактивна"}),h&&(0,b.jsxs)(j.Badge,{variant:"primary",children:["Подкатегорий: ",a.children.length]})]}),(0,b.jsx)("div",{className:"flex items-center justify-end pt-3 border-t border-gray-200 pl-14",children:(0,b.jsx)(j.CardActions,{onEdit:()=>{Q(a),W({name:a.name,slug:a.slug,icon:a.icon||"",description:a.description||"",parent_id:a.parent_id?.toString()||"",order:a.order.toString(),is_active:a.is_active}),U(""),O(!0)},onDelete:()=>_(a.id,a.name)})})]})]})}),h&&i&&(0,b.jsx)("div",{className:"mt-2 relative",children:a.children.map((b,d)=>ac(b,c+1,d===a.children.length-1))})]},a.id)};return"loading"===u||null===y||w||A?(0,b.jsx)(o.AdminAccessSkeleton,{}):"unauthenticated"===u||!1===y?(0,b.jsx)(k.default,{}):v?(0,b.jsxs)("div",{className:"flex min-h-screen bg-gray-50",children:[(0,b.jsx)(i.AdminMenu,{}),(0,b.jsx)("div",{className:"flex-1 p-4 lg:p-8 overflow-auto",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,b.jsx)(j.AdminSection,{title:"Категории услуг",icon:e.FolderTree,count:Z.length,loading:H,onAdd:ab,addButtonText:"Добавить категорию",searchValue:L,onSearchChange:M,children:0===F.length?(0,b.jsx)(j.EmptyState,{icon:e.FolderTree,title:"Категории не найдены",description:"Добавьте первую категорию услуг",actionText:"Добавить категорию",onAction:ab}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,b.jsx)("button",{onClick:()=>{let a=new Set,b=c=>{c.forEach(c=>{c.children&&c.children.length>0&&(a.add(c.id),b(c.children))})};b(F),K(a)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Развернуть все"}),(0,b.jsx)("button",{onClick:()=>{K(new Set)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Свернуть все"})]}),(0,b.jsx)("div",{className:"space-y-2",children:(0,b.jsx)(h.AnimatePresence,{children:F.map(a=>ac(a))})})]})}),(0,b.jsx)(j.FormModal,{isOpen:N,onClose:aa,title:P?"Редактирование категории":"Новая категория",onSubmit:$,loading:R,disabled:!V.name||!V.slug,children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsx)(j.FormField,{label:"Название",required:!0,children:(0,b.jsx)(j.FormInput,{type:"text",value:V.name,onChange:a=>{let b=a.target.value;W({...V,name:b,slug:(0,s.generateSlug)(b)})},placeholder:"Детская стоматология"})}),(0,b.jsxs)(j.FormField,{label:"Slug (URL)",required:!0,children:[(0,b.jsx)(j.FormInput,{type:"text",value:V.slug,onChange:a=>W({...V,slug:a.target.value}),placeholder:"detskaya-stomatologiya"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Генерируется автоматически из названия"}),(0,b.jsx)("button",{type:"button",onClick:()=>W({...V,slug:(0,s.generateSlug)(V.name)}),className:"text-xs font-medium text-[#18A36C] hover:text-[#18A36C]/80 underline",disabled:!V.name,children:"Регенерировать"})]})]})]}),(0,b.jsxs)(j.FormField,{label:"Иконка",children:[(0,b.jsxs)(j.FormSelect,{value:V.icon,onChange:a=>W({...V,icon:a.target.value}),children:[(0,b.jsx)("option",{value:"",children:"Без иконки"}),t.map(a=>(0,b.jsx)("option",{value:a,children:a},a))]}),V.icon&&r.iconMap[V.icon]&&(0,b.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-8 h-8 bg-[#18A36C]/10 rounded flex items-center justify-center",children:(a=r.iconMap[V.icon],(0,b.jsx)(a,{className:"w-4 h-4 text-[#18A36C]"}))}),(0,b.jsx)("span",{className:"text-xs text-gray-500",children:"Предпросмотр"})]}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Иконка будет отображаться в меню рядом с названием категории"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)(j.FormField,{label:"Порядок сортировки",children:[(0,b.jsx)(j.FormInput,{type:"number",value:V.order,onChange:a=>{let b=a.target.value;W({...V,order:b}),(a=>{let b=parseInt(a);if(isNaN(b))return U("");let c=Z.find(a=>(!P||a.id!==P.id)&&a.order===b);c?U(`⚠️ Порядок ${b} уже занят категорией "${c.name}"`):U("")})(b)},placeholder:"0"}),T&&(0,b.jsx)("p",{className:"text-xs text-amber-600 mt-1 flex items-center gap-1",children:T}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Определяет порядок отображения категорий в меню"})]}),(0,b.jsx)(j.FormField,{label:"Статус",children:(0,b.jsxs)(j.FormSelect,{value:V.is_active?"true":"false",onChange:a=>W({...V,is_active:"true"===a.target.value}),children:[(0,b.jsx)("option",{value:"true",children:"Активна"}),(0,b.jsx)("option",{value:"false",children:"Неактивна"})]})})]}),(0,b.jsx)(j.FormField,{label:"Описание",children:(0,b.jsx)(j.FormTextarea,{value:V.description,onChange:a=>W({...V,description:a.target.value}),rows:3,placeholder:"Краткое описание категории..."})})]})}),(0,b.jsx)(q.ConfirmDialog,{isOpen:E.isOpen,onClose:E.handleCancel,onConfirm:E.handleConfirm,title:E.options.title,message:E.options.message,confirmText:E.options.confirmText,cancelText:E.options.cancelText,variant:E.options.variant,loading:E.loading})]})})]}):(0,b.jsx)(l.AdminAuthForm,{onSuccess:()=>{x()}})}a.s(["default",()=>u])}];

//# sourceMappingURL=src_app_admin_service-categories_page_tsx_882193d9._.js.map