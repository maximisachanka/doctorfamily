module.exports=[63982,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(75003),e=a.i(62036),f=a.i(46271),g=a.i(63588),h=a.i(96221),i=a.i(21374),j=a.i(41675),k=a.i(16201),l=a.i(41710),m=a.i(34157),m=m,n=a.i(77156),o=a.i(33508),p=a.i(67974);a.i(24933);var q=a.i(41567),r=a.i(72663),s=a.i(4297),t=a.i(52913),u=a.i(55220),v=a.i(79212),w=a.i(96215),x=a.i(37210),y=a.i(72549);a.i(27190);var z=a.i(25170),A=a.i(3038),B=a.i(60514);function C(){let{status:a}=(0,d.useSession)(),{sessionVerified:C,isLoading:D,verifySession:E}=(0,v.useAdminSession)(),[F,G]=(0,c.useState)(null),[H,I]=(0,c.useState)(!0),J=(0,y.useConfirmDialog)(),{success:K,error:L}=(0,z.useAlert)(),{refetch:M}=(0,B.useUnreadCountsContext)(),{currentPage:N,setPage:O,buildApiUrl:P,itemsPerPage:Q}=(0,A.useServerPagination)(12),[R,S]=(0,c.useState)([]),[T,U]=(0,c.useState)(1),[V,W]=(0,c.useState)(0),[X,Y]=(0,c.useState)(0),[Z,$]=(0,c.useState)(0),[_,aa]=(0,c.useState)([]),[ab,ac]=(0,c.useState)(!1),[ad,ae]=(0,c.useState)(""),[af,ag]=(0,c.useState)("pending"),[ah,ai]=(0,c.useState)(null),[aj,ak]=(0,c.useState)(null),[al,am]=(0,c.useState)({service_id:"",verified:!0}),[an,ao]=(0,c.useState)(!1),[ap,aq]=(0,c.useState)(!1),[ar,as]=(0,c.useState)(null),[at,au]=(0,c.useState)(!1),[av,aw]=(0,c.useState)({name:"",text:"",date:"",grade:"5",image_url:"",verified:!1,service_id:""});(0,c.useEffect)(()=>{"authenticated"===a?ax():"unauthenticated"===a&&G(!1)},[a]),(0,c.useEffect)(()=>{C&&F&&az()},[C,F]);let ax=async()=>{I(!0);try{let a=await fetch("/api/admin/auth"),b=await a.json();G(b.isAdmin)}catch(a){G(!1)}finally{I(!1)}},ay=async()=>{try{let[a,b]=await Promise.all([fetch("/api/admin/feedbacks?page=1&limit=1&status=pending"),fetch("/api/admin/feedbacks?page=1&limit=1&status=approved")]);if(a.ok){let b=await a.json();Y(b.totalCount||0)}if(b.ok){let a=await b.json();$(a.totalCount||0)}}catch(a){}},az=async()=>{ac(!0);try{let a=P("/api/admin/feedbacks",ad)+`&status=${af}`,[b,c]=await Promise.all([fetch(a),fetch("/api/services"),ay()]);if(b.ok){let a=await b.json();S(a.data||[]),U(a.totalPages||1),W(a.totalCount||0)}if(c.ok){let a=await c.json();aa(a)}}catch(a){}finally{ac(!1)}};(0,c.useEffect)(()=>{C&&F&&az()},[C,F,N,ad,af]),(0,c.useEffect)(()=>{O(1)},[ad,af]);let aA=()=>{aw({name:"",text:"",date:"",grade:"5",image_url:"",verified:!1,service_id:""}),as(null),aq(!1)},aB=()=>{aA(),aw(a=>({...a,date:new Date().toISOString().split("T")[0],verified:!0})),aq(!0)},aC=async()=>{au(!0);try{let a=ar?`/api/admin/feedbacks/${ar.id}`:"/api/admin/feedbacks",b=ar?"PUT":"POST",c=await fetch(a,{method:b,headers:{"Content-Type":"application/json"},body:JSON.stringify(av)});if(c.ok)await az(),aA(),K(ar?"Отзыв обновлен":"Отзыв создан");else{let a=await c.json();L(a.error||"Ошибка сохранения")}}catch(a){L("Ошибка сохранения")}finally{au(!1)}},aD=a=>{ak(a),am({service_id:"",verified:!0})},aE=async()=>{if(aj){ao(!0);try{let a=await fetch(`/api/admin/feedbacks/${aj.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({verified:al.verified,service_id:al.service_id||null})});if(a.ok)await az(),ak(null),K("Отзыв одобрен"),await M();else{let b=await a.json();L(b.error||"Ошибка одобрения")}}catch(a){L("Ошибка одобрения")}finally{ao(!1)}}},aF=async(a,b)=>{if(await J.confirm({title:"Удаление отзыва",message:`Вы уверены, что хотите удалить отзыв от "${b}"? Это действие нельзя отменить.`,confirmText:"Удалить",cancelText:"Отмена",variant:"danger"}))try{let b=await fetch(`/api/admin/feedbacks/${a}`,{method:"DELETE"});if(b.ok)await az(),K("Отзыв удален"),await M();else{let a=await b.json();L(a.error||"Ошибка удаления")}}catch(a){L("Ошибка удаления")}},aG=a=>(0,b.jsx)("div",{className:"flex items-center gap-0.5",children:[1,2,3,4,5].map(c=>(0,b.jsx)(i.Star,{className:`w-4 h-4 ${c<=a?"text-yellow-400 fill-yellow-400":"text-gray-300"}`},c))});return"loading"===a||null===F||D||H?(0,b.jsx)(w.AdminAccessSkeleton,{}):"unauthenticated"===a||!1===F?(0,b.jsx)(t.default,{}):C?(0,b.jsxs)("div",{className:"flex min-h-screen bg-gray-50",children:[(0,b.jsx)(r.AdminMenu,{}),(0,b.jsx)("div",{className:"flex-1 p-4 lg:p-8 overflow-auto",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,b.jsxs)(s.AdminSection,{title:"Отзывы",icon:g.MessageSquare,count:V,loading:ab,searchValue:ad,onSearchChange:ae,onAdd:aB,addButtonText:"Добавить отзыв",loadingSkeleton:(0,b.jsx)(w.AdminFeedbacksGridSkeleton,{count:Q}),children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-6",children:[(0,b.jsxs)("button",{onClick:()=>ag("pending"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 cursor-pointer ${"pending"===af?"bg-amber-500 text-white shadow-md":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-200"}`,children:[(0,b.jsx)(l.Clock,{className:"w-4 h-4"}),"На модерации",X>0&&(0,b.jsx)("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold ${"pending"===af?"bg-white/20 text-white":"bg-amber-100 text-amber-700"}`,children:X})]}),(0,b.jsxs)("button",{onClick:()=>ag("approved"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 cursor-pointer ${"approved"===af?"bg-[#18A36C] text-white shadow-md":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-200"}`,children:[(0,b.jsx)(k.CheckCircle,{className:"w-4 h-4"}),"Одобренные"]})]}),0===R.length?(0,b.jsx)(s.EmptyState,{icon:g.MessageSquare,title:"Отзывы не найдены",description:ad?"Попробуйте изменить поисковый запрос":"Добавьте первый отзыв",actionText:ad?void 0:"Добавить отзыв",onAction:ad?void 0:aB}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,b.jsx)(e.AnimatePresence,{children:R.map(a=>{var c;let d;return(0,b.jsxs)(s.ItemCard,{children:[(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsx)("div",{className:"w-14 h-14 rounded-full overflow-hidden flex-shrink-0 bg-gray-100 flex items-center justify-center",children:a.image_url?(0,b.jsx)("img",{src:a.image_url,alt:a.name,className:"w-full h-full object-cover"}):(0,b.jsx)("span",{className:"text-lg font-semibold text-gray-500",children:(d=(c=a.name).trim().split(/\s+/)).length>=2?(d[0][0]+d[1][0]).toUpperCase():c.slice(0,2).toUpperCase()})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-800",children:a.name}),a.verified&&(0,b.jsx)(k.CheckCircle,{className:"w-4 h-4 text-[#18A36C]"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[aG(a.grade),(0,b.jsxs)("span",{className:"text-xs text-gray-400 flex items-center gap-1",children:[(0,b.jsx)(j.Calendar,{className:"w-3 h-3"}),new Date(a.date).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"})]})]}),(0,b.jsx)("p",{className:"text-sm text-gray-500 line-clamp-2",children:a.text})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-3",children:[a.service&&(0,b.jsx)(s.Badge,{variant:"secondary",children:a.service.title}),!a.service&&(0,b.jsx)(s.Badge,{variant:"primary",children:"Без услуги"}),a.verified?(0,b.jsx)(s.Badge,{variant:"success",children:"Опубликован"}):(0,b.jsx)(s.Badge,{variant:"warning",children:"На модерации"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-gray-100",children:[a.verified?(0,b.jsx)("div",{}):(0,b.jsxs)("button",{onClick:()=>aD(a),className:"flex items-center gap-1.5 px-3 py-1.5 bg-[#18A36C] text-white text-sm font-medium rounded-lg hover:bg-[#15905f] transition-colors cursor-pointer",children:[(0,b.jsx)(m.default,{className:"w-4 h-4"}),"Одобрить"]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[a.verified?(0,b.jsx)(s.CardActions,{onEdit:()=>{as(a),aw({name:a.name,text:a.text,date:new Date(a.date).toISOString().split("T")[0],grade:a.grade.toString(),image_url:a.image_url,verified:a.verified,service_id:a.service_id?.toString()||""}),aq(!0)},onDelete:()=>aF(a.id,a.name)}):(0,b.jsx)("button",{onClick:()=>ai(a),className:"p-2 text-gray-400 hover:text-[#18A36C] hover:bg-[#18A36C]/10 rounded-lg transition-colors cursor-pointer",title:"Просмотреть",children:(0,b.jsx)(n.Eye,{className:"w-4 h-4"})}),!a.verified&&(0,b.jsx)("button",{onClick:()=>aF(a.id,a.name),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors cursor-pointer",title:"Удалить",children:(0,b.jsx)(o.X,{className:"w-4 h-4"})})]})]})]},a.id)})})}),T>1&&(0,b.jsx)(p.Pagination,{currentPage:N,totalPages:T,onPageChange:O,className:"mt-6"})]})]}),(0,b.jsx)(s.FormModal,{isOpen:ap,onClose:aA,title:ar?"Редактирование отзыва":"Новый отзыв",onSubmit:aC,loading:at,disabled:!av.name||!av.text,children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsx)(s.FormField,{label:"Имя автора",required:!0,children:(0,b.jsx)(s.FormInput,{type:"text",value:av.name,onChange:a=>aw({...av,name:a.target.value}),placeholder:"Иван Иванов"})}),(0,b.jsx)(s.FormField,{label:"Дата",required:!0,children:(0,b.jsx)(s.FormDateInput,{value:av.date,onChange:a=>aw({...av,date:a})})})]}),(0,b.jsx)(s.FormField,{label:"Текст отзыва",required:!0,children:(0,b.jsx)(s.FormTextarea,{value:av.text,onChange:a=>aw({...av,text:a.target.value}),rows:4,placeholder:"Текст отзыва"})}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsx)(s.FormField,{label:"Оценка (1-5)",required:!0,children:(0,b.jsxs)(s.FormSelect,{value:av.grade,onChange:a=>aw({...av,grade:a.target.value}),children:[(0,b.jsx)("option",{value:"5",children:"5 - Отлично"}),(0,b.jsx)("option",{value:"4",children:"4 - Хорошо"}),(0,b.jsx)("option",{value:"3",children:"3 - Нормально"}),(0,b.jsx)("option",{value:"2",children:"2 - Плохо"}),(0,b.jsx)("option",{value:"1",children:"1 - Ужасно"})]})}),(0,b.jsx)(s.FormField,{label:"Привязка к услуге",children:(0,b.jsxs)(s.FormSelect,{value:av.service_id,onChange:a=>aw({...av,service_id:a.target.value}),children:[(0,b.jsx)("option",{value:"",children:"Без привязки к услуге"}),_.map(a=>(0,b.jsx)("option",{value:a.id,children:a.title},a.id))]})})]}),(0,b.jsx)(s.FormField,{label:"Фото автора",children:(0,b.jsx)(q.ImageUploader,{value:av.image_url,onChange:a=>aw({...av,image_url:a}),folder:"smartmedical/feedbacks",placeholder:"Загрузите фото автора отзыва",maxSizeMB:5})}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("button",{type:"button",onClick:()=>aw({...av,verified:!av.verified}),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors cursor-pointer ${av.verified?"bg-[#18A36C]":"bg-gray-300"}`,children:(0,b.jsx)("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${av.verified?"translate-x-6":"translate-x-1"}`})}),(0,b.jsx)("span",{className:"text-sm text-gray-700",children:av.verified?"Показывать в общих отзывах клиники":"Не показывать в общих отзывах клиники"})]})]})}),(0,b.jsx)(e.AnimatePresence,{children:ah&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,b.jsx)(f.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>ai(null),className:"absolute inset-0 bg-black/50 backdrop-blur-sm"}),(0,b.jsxs)(f.motion.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative w-full max-w-lg mx-4 bg-white rounded-2xl shadow-2xl overflow-hidden",children:[(0,b.jsx)("div",{className:"bg-[#18A36C] px-6 py-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold text-white",children:"Просмотр отзыва"}),(0,b.jsx)("button",{onClick:()=>ai(null),className:"p-1.5 hover:bg-white/20 rounded-lg transition-colors cursor-pointer",children:(0,b.jsx)(o.X,{className:"w-5 h-5 text-white"})})]})}),(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsxs)("div",{className:"flex items-start gap-4 mb-4",children:[(0,b.jsx)("div",{className:"w-14 h-14 rounded-full overflow-hidden flex-shrink-0 bg-gray-100 flex items-center justify-center",children:ah.image_url?(0,b.jsx)("img",{src:ah.image_url,alt:ah.name,className:"w-full h-full object-cover"}):(0,b.jsx)("span",{className:"text-lg font-semibold text-gray-500",children:ah.name.trim().split(/\s+/).length>=2?(ah.name.trim().split(/\s+/)[0][0]+ah.name.trim().split(/\s+/)[1][0]).toUpperCase():ah.name.slice(0,2).toUpperCase()})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-800 text-lg",children:ah.name}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[aG(ah.grade),(0,b.jsx)("span",{className:"text-sm text-gray-500",children:new Date(ah.date).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"})})]})]})]}),(0,b.jsx)("div",{className:"bg-gray-50 rounded-xl p-4 mb-4",children:(0,b.jsx)("p",{className:"text-gray-700 whitespace-pre-wrap",children:ah.text})}),ah.service&&(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("span",{className:"text-sm text-gray-500",children:"Услуга: "}),(0,b.jsx)("span",{className:"text-sm font-medium text-gray-700",children:ah.service.title})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 pt-4 border-t border-gray-100",children:[(0,b.jsxs)("button",{onClick:()=>{aD(ah),ai(null)},className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-[#18A36C] text-white font-medium rounded-xl hover:bg-[#15905f] transition-colors cursor-pointer",children:[(0,b.jsx)(m.default,{className:"w-4 h-4"}),"Одобрить"]}),(0,b.jsxs)("button",{onClick:()=>{aF(ah.id,ah.name),ai(null)},className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-red-500 text-white font-medium rounded-xl hover:bg-red-600 transition-colors cursor-pointer",children:[(0,b.jsx)(o.X,{className:"w-4 h-4"}),"Отклонить"]})]})]})]})]})}),(0,b.jsx)(e.AnimatePresence,{children:aj&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,b.jsx)(f.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>!an&&ak(null),className:"absolute inset-0 bg-black/50 backdrop-blur-sm"}),(0,b.jsxs)(f.motion.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative w-full max-w-md bg-white rounded-2xl shadow-2xl overflow-hidden",children:[(0,b.jsx)("div",{className:"bg-[#18A36C] px-6 py-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold text-white",children:"Одобрение отзыва"}),(0,b.jsx)("button",{onClick:()=>!an&&ak(null),className:"p-1.5 hover:bg-white/20 rounded-lg transition-colors cursor-pointer",children:(0,b.jsx)(o.X,{className:"w-5 h-5 text-white"})})]})}),(0,b.jsxs)("div",{className:"p-6 space-y-5",children:[(0,b.jsxs)("div",{className:"p-4 bg-gray-50 rounded-xl",children:[(0,b.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Отзыв от"}),(0,b.jsx)("p",{className:"font-medium text-gray-800",children:aj.name}),(0,b.jsx)("p",{className:"text-sm text-gray-600 mt-2 line-clamp-2",children:aj.text})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Привязка к услуге"}),(0,b.jsxs)("select",{value:al.service_id,onChange:a=>am({...al,service_id:a.target.value}),className:"w-full px-4 py-2.5 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-[#18A36C]/20 focus:border-[#18A36C] transition-all",children:[(0,b.jsx)("option",{value:"",children:"Без привязки к услуге"}),_.map(a=>(0,b.jsx)("option",{value:a.id,children:a.title},a.id))]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("button",{type:"button",onClick:()=>am({...al,verified:!al.verified}),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors cursor-pointer ${al.verified?"bg-[#18A36C]":"bg-gray-300"}`,children:(0,b.jsx)("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${al.verified?"translate-x-6":"translate-x-1"}`})}),(0,b.jsx)("span",{className:"text-sm text-gray-700",children:"Показывать в общих отзывах клиники"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 pt-2",children:[(0,b.jsx)("button",{onClick:()=>ak(null),disabled:an,className:"flex-1 px-4 py-2.5 border border-gray-200 text-gray-700 font-medium rounded-xl hover:bg-gray-50 transition-colors disabled:opacity-50 cursor-pointer",children:"Отмена"}),(0,b.jsxs)("button",{onClick:aE,disabled:an,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-[#18A36C] text-white font-medium rounded-xl hover:bg-[#15905f] transition-colors disabled:opacity-50 cursor-pointer",children:[an?(0,b.jsx)(h.Loader2,{className:"w-4 h-4 animate-spin"}):(0,b.jsx)(m.default,{className:"w-4 h-4"}),"Одобрить"]})]})]})]})]})}),(0,b.jsx)(x.ConfirmDialog,{isOpen:J.isOpen,onClose:J.handleCancel,onConfirm:J.handleConfirm,title:J.options.title,message:J.options.message,confirmText:J.options.confirmText,cancelText:J.options.cancelText,variant:J.options.variant,loading:J.loading})]})})]}):(0,b.jsx)(u.AdminAuthForm,{onSuccess:()=>{E()}})}a.s(["default",()=>C],63982)}];

//# sourceMappingURL=src_app_admin_feedbacks_page_tsx_4ef62292._.js.map