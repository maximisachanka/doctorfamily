module.exports=[63982,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(75003),e=a.i(62036),f=a.i(46271),g=a.i(63588),h=a.i(96221),i=a.i(21374),j=a.i(41675),k=a.i(16201),l=a.i(41710),m=a.i(34157),m=m,n=a.i(77156),o=a.i(33508),p=a.i(67974);a.i(24933);var q=a.i(41567),r=a.i(72663),s=a.i(4297),t=a.i(52913),u=a.i(55220),v=a.i(79212),w=a.i(96215),x=a.i(37210),y=a.i(72549);a.i(27190);var z=a.i(25170),A=a.i(60514);function B(){let{status:a}=(0,d.useSession)(),{sessionVerified:B,isLoading:C,verifySession:D}=(0,v.useAdminSession)(),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)(!0),I=(0,y.useConfirmDialog)(),{success:J,error:K}=(0,z.useAlert)(),{refetch:L}=(0,A.useUnreadCountsContext)(),[M,N]=(0,c.useState)([]),[O,P]=(0,c.useState)([]),[Q,R]=(0,c.useState)(!1),[S,T]=(0,c.useState)(""),[U,V]=(0,c.useState)(1),[W,X]=(0,c.useState)("pending"),[Y,Z]=(0,c.useState)(null),[$,_]=(0,c.useState)(null),[aa,ab]=(0,c.useState)({service_id:"",verified:!0}),[ac,ad]=(0,c.useState)(!1),[ae,af]=(0,c.useState)(!1),[ag,ah]=(0,c.useState)(null),[ai,aj]=(0,c.useState)(!1),[ak,al]=(0,c.useState)({name:"",text:"",date:"",grade:"5",image_url:"",verified:!1,service_id:""});(0,c.useEffect)(()=>{"authenticated"===a?am():"unauthenticated"===a&&F(!1)},[a]),(0,c.useEffect)(()=>{B&&E&&an()},[B,E]);let am=async()=>{H(!0);try{let a=await fetch("/api/admin/auth"),b=await a.json();F(b.isAdmin)}catch(a){F(!1)}finally{H(!1)}},an=async()=>{R(!0);try{let[a,b]=await Promise.all([fetch("/api/admin/feedbacks"),fetch("/api/services")]);if(a.ok){let b=await a.json();N(b)}if(b.ok){let a=await b.json();P(a)}}catch(a){console.error("Error loading data:",a)}finally{R(!1)}},ao=(0,c.useMemo)(()=>{let a=M;if(a="pending"===W?a.filter(a=>!a.verified):a.filter(a=>a.verified),S){let b=S.toLowerCase();a=a.filter(a=>a.name.toLowerCase().includes(b)||a.text.toLowerCase().includes(b)||a.service?.title.toLowerCase().includes(b))}return a},[M,S,W]),ap=(0,c.useMemo)(()=>M.filter(a=>!a.verified).length,[M]);(0,c.useEffect)(()=>{V(1)},[S,W]);let aq=Math.ceil(ao.length/12),ar=(0,c.useMemo)(()=>{let a=(U-1)*12;return ao.slice(a,a+12)},[ao,U]),as=()=>{al({name:"",text:"",date:"",grade:"5",image_url:"",verified:!1,service_id:""}),ah(null),af(!1)},at=()=>{as(),al(a=>({...a,date:new Date().toISOString().split("T")[0],verified:!0})),af(!0)},au=async()=>{aj(!0);try{let a=ag?`/api/admin/feedbacks/${ag.id}`:"/api/admin/feedbacks",b=ag?"PUT":"POST",c=await fetch(a,{method:b,headers:{"Content-Type":"application/json"},body:JSON.stringify(ak)});if(c.ok)await an(),as(),J(ag?"Отзыв обновлен":"Отзыв создан");else{let a=await c.json();K(a.error||"Ошибка сохранения")}}catch(a){K("Ошибка сохранения")}finally{aj(!1)}},av=a=>{_(a),ab({service_id:"",verified:!0})},aw=async()=>{if($){ad(!0);try{let a=await fetch(`/api/admin/feedbacks/${$.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({verified:aa.verified,service_id:aa.service_id||null})});if(a.ok)await an(),_(null),J("Отзыв одобрен"),await L();else{let b=await a.json();K(b.error||"Ошибка одобрения")}}catch(a){K("Ошибка одобрения")}finally{ad(!1)}}},ax=async(a,b)=>{if(await I.confirm({title:"Удаление отзыва",message:`Вы уверены, что хотите удалить отзыв от "${b}"? Это действие нельзя отменить.`,confirmText:"Удалить",cancelText:"Отмена",variant:"danger"}))try{let b=await fetch(`/api/admin/feedbacks/${a}`,{method:"DELETE"});if(b.ok)await an(),J("Отзыв удален"),await L();else{let a=await b.json();K(a.error||"Ошибка удаления")}}catch(a){K("Ошибка удаления")}},ay=a=>(0,b.jsx)("div",{className:"flex items-center gap-0.5",children:[1,2,3,4,5].map(c=>(0,b.jsx)(i.Star,{className:`w-4 h-4 ${c<=a?"text-yellow-400 fill-yellow-400":"text-gray-300"}`},c))});return"loading"===a||null===E||C||G?(0,b.jsx)(w.AdminAccessSkeleton,{}):"unauthenticated"===a||!1===E?(0,b.jsx)(t.default,{}):B?(0,b.jsxs)("div",{className:"flex min-h-screen bg-gray-50",children:[(0,b.jsx)(r.AdminMenu,{}),(0,b.jsx)("div",{className:"flex-1 p-4 lg:p-8 overflow-auto",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,b.jsxs)(s.AdminSection,{title:"Отзывы",icon:g.MessageSquare,count:M.length,loading:Q,searchValue:S,onSearchChange:T,onAdd:at,addButtonText:"Добавить отзыв",loadingSkeleton:(0,b.jsx)(w.AdminFeedbacksGridSkeleton,{count:12}),children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-6",children:[(0,b.jsxs)("button",{onClick:()=>X("pending"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${"pending"===W?"bg-amber-500 text-white shadow-md":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-200"}`,children:[(0,b.jsx)(l.Clock,{className:"w-4 h-4"}),"На модерации",ap>0&&(0,b.jsx)("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold ${"pending"===W?"bg-white/20 text-white":"bg-amber-100 text-amber-700"}`,children:ap})]}),(0,b.jsxs)("button",{onClick:()=>X("approved"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${"approved"===W?"bg-[#18A36C] text-white shadow-md":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-200"}`,children:[(0,b.jsx)(k.CheckCircle,{className:"w-4 h-4"}),"Одобренные"]})]}),0===ao.length?(0,b.jsx)(s.EmptyState,{icon:g.MessageSquare,title:"Отзывы не найдены",description:S?"Попробуйте изменить поисковый запрос":"Добавьте первый отзыв",actionText:S?void 0:"Добавить отзыв",onAction:S?void 0:at}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,b.jsx)(e.AnimatePresence,{children:ar.map(a=>{var c;let d;return(0,b.jsxs)(s.ItemCard,{children:[(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsx)("div",{className:"w-14 h-14 rounded-full overflow-hidden flex-shrink-0 bg-gray-100 flex items-center justify-center",children:a.image_url?(0,b.jsx)("img",{src:a.image_url,alt:a.name,className:"w-full h-full object-cover"}):(0,b.jsx)("span",{className:"text-lg font-semibold text-gray-500",children:(d=(c=a.name).trim().split(/\s+/)).length>=2?(d[0][0]+d[1][0]).toUpperCase():c.slice(0,2).toUpperCase()})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-800",children:a.name}),a.verified&&(0,b.jsx)(k.CheckCircle,{className:"w-4 h-4 text-[#18A36C]"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[ay(a.grade),(0,b.jsxs)("span",{className:"text-xs text-gray-400 flex items-center gap-1",children:[(0,b.jsx)(j.Calendar,{className:"w-3 h-3"}),new Date(a.date).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"})]})]}),(0,b.jsx)("p",{className:"text-sm text-gray-500 line-clamp-2",children:a.text})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-3",children:[a.service&&(0,b.jsx)(s.Badge,{variant:"secondary",children:a.service.title}),!a.service&&(0,b.jsx)(s.Badge,{variant:"primary",children:"Без услуги"}),a.verified?(0,b.jsx)(s.Badge,{variant:"success",children:"Опубликован"}):(0,b.jsx)(s.Badge,{variant:"warning",children:"На модерации"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-gray-100",children:[a.verified?(0,b.jsx)("div",{}):(0,b.jsxs)("button",{onClick:()=>av(a),className:"flex items-center gap-1.5 px-3 py-1.5 bg-[#18A36C] text-white text-sm font-medium rounded-lg hover:bg-[#15905f] transition-colors",children:[(0,b.jsx)(m.default,{className:"w-4 h-4"}),"Одобрить"]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[a.verified?(0,b.jsx)(s.CardActions,{onEdit:()=>{ah(a),al({name:a.name,text:a.text,date:new Date(a.date).toISOString().split("T")[0],grade:a.grade.toString(),image_url:a.image_url,verified:a.verified,service_id:a.service_id?.toString()||""}),af(!0)},onDelete:()=>ax(a.id,a.name)}):(0,b.jsx)("button",{onClick:()=>Z(a),className:"p-2 text-gray-400 hover:text-[#18A36C] hover:bg-[#18A36C]/10 rounded-lg transition-colors",title:"Просмотреть",children:(0,b.jsx)(n.Eye,{className:"w-4 h-4"})}),!a.verified&&(0,b.jsx)("button",{onClick:()=>ax(a.id,a.name),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",title:"Удалить",children:(0,b.jsx)(o.X,{className:"w-4 h-4"})})]})]})]},a.id)})})}),aq>1&&(0,b.jsx)(p.Pagination,{currentPage:U,totalPages:aq,onPageChange:V,className:"mt-6"})]})]}),(0,b.jsx)(s.FormModal,{isOpen:ae,onClose:as,title:ag?"Редактирование отзыва":"Новый отзыв",onSubmit:au,loading:ai,disabled:!ak.name||!ak.text,children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsx)(s.FormField,{label:"Имя автора",required:!0,children:(0,b.jsx)(s.FormInput,{type:"text",value:ak.name,onChange:a=>al({...ak,name:a.target.value}),placeholder:"Иван Иванов"})}),(0,b.jsx)(s.FormField,{label:"Дата",required:!0,children:(0,b.jsx)(s.FormDateInput,{value:ak.date,onChange:a=>al({...ak,date:a})})})]}),(0,b.jsx)(s.FormField,{label:"Текст отзыва",required:!0,children:(0,b.jsx)(s.FormTextarea,{value:ak.text,onChange:a=>al({...ak,text:a.target.value}),rows:4,placeholder:"Текст отзыва"})}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsx)(s.FormField,{label:"Оценка (1-5)",required:!0,children:(0,b.jsxs)(s.FormSelect,{value:ak.grade,onChange:a=>al({...ak,grade:a.target.value}),children:[(0,b.jsx)("option",{value:"5",children:"5 - Отлично"}),(0,b.jsx)("option",{value:"4",children:"4 - Хорошо"}),(0,b.jsx)("option",{value:"3",children:"3 - Нормально"}),(0,b.jsx)("option",{value:"2",children:"2 - Плохо"}),(0,b.jsx)("option",{value:"1",children:"1 - Ужасно"})]})}),(0,b.jsx)(s.FormField,{label:"Привязка к услуге",children:(0,b.jsxs)(s.FormSelect,{value:ak.service_id,onChange:a=>al({...ak,service_id:a.target.value}),children:[(0,b.jsx)("option",{value:"",children:"Без привязки к услуге"}),O.map(a=>(0,b.jsx)("option",{value:a.id,children:a.title},a.id))]})})]}),(0,b.jsx)(s.FormField,{label:"Фото автора",children:(0,b.jsx)(q.ImageUploader,{value:ak.image_url,onChange:a=>al({...ak,image_url:a}),folder:"smartmedical/feedbacks",placeholder:"Загрузите фото автора отзыва",maxSizeMB:5})}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("button",{type:"button",onClick:()=>al({...ak,verified:!ak.verified}),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${ak.verified?"bg-[#18A36C]":"bg-gray-300"}`,children:(0,b.jsx)("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${ak.verified?"translate-x-6":"translate-x-1"}`})}),(0,b.jsx)("span",{className:"text-sm text-gray-700",children:ak.verified?"Показывать в общих отзывах клиники":"Не показывать в общих отзывах клиники"})]})]})}),(0,b.jsx)(e.AnimatePresence,{children:Y&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,b.jsx)(f.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>Z(null),className:"absolute inset-0 bg-black/50 backdrop-blur-sm"}),(0,b.jsxs)(f.motion.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative w-full max-w-lg mx-4 bg-white rounded-2xl shadow-2xl overflow-hidden",children:[(0,b.jsx)("div",{className:"bg-[#18A36C] px-6 py-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold text-white",children:"Просмотр отзыва"}),(0,b.jsx)("button",{onClick:()=>Z(null),className:"p-1.5 hover:bg-white/20 rounded-lg transition-colors",children:(0,b.jsx)(o.X,{className:"w-5 h-5 text-white"})})]})}),(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsxs)("div",{className:"flex items-start gap-4 mb-4",children:[(0,b.jsx)("div",{className:"w-14 h-14 rounded-full overflow-hidden flex-shrink-0 bg-gray-100 flex items-center justify-center",children:Y.image_url?(0,b.jsx)("img",{src:Y.image_url,alt:Y.name,className:"w-full h-full object-cover"}):(0,b.jsx)("span",{className:"text-lg font-semibold text-gray-500",children:Y.name.trim().split(/\s+/).length>=2?(Y.name.trim().split(/\s+/)[0][0]+Y.name.trim().split(/\s+/)[1][0]).toUpperCase():Y.name.slice(0,2).toUpperCase()})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-800 text-lg",children:Y.name}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[ay(Y.grade),(0,b.jsx)("span",{className:"text-sm text-gray-500",children:new Date(Y.date).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"})})]})]})]}),(0,b.jsx)("div",{className:"bg-gray-50 rounded-xl p-4 mb-4",children:(0,b.jsx)("p",{className:"text-gray-700 whitespace-pre-wrap",children:Y.text})}),Y.service&&(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("span",{className:"text-sm text-gray-500",children:"Услуга: "}),(0,b.jsx)("span",{className:"text-sm font-medium text-gray-700",children:Y.service.title})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 pt-4 border-t border-gray-100",children:[(0,b.jsxs)("button",{onClick:()=>{av(Y),Z(null)},className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-[#18A36C] text-white font-medium rounded-xl hover:bg-[#15905f] transition-colors",children:[(0,b.jsx)(m.default,{className:"w-4 h-4"}),"Одобрить"]}),(0,b.jsxs)("button",{onClick:()=>{ax(Y.id,Y.name),Z(null)},className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-red-500 text-white font-medium rounded-xl hover:bg-red-600 transition-colors",children:[(0,b.jsx)(o.X,{className:"w-4 h-4"}),"Отклонить"]})]})]})]})]})}),(0,b.jsx)(e.AnimatePresence,{children:$&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,b.jsx)(f.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>!ac&&_(null),className:"absolute inset-0 bg-black/50 backdrop-blur-sm"}),(0,b.jsxs)(f.motion.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative w-full max-w-md bg-white rounded-2xl shadow-2xl overflow-hidden",children:[(0,b.jsx)("div",{className:"bg-[#18A36C] px-6 py-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold text-white",children:"Одобрение отзыва"}),(0,b.jsx)("button",{onClick:()=>!ac&&_(null),className:"p-1.5 hover:bg-white/20 rounded-lg transition-colors",children:(0,b.jsx)(o.X,{className:"w-5 h-5 text-white"})})]})}),(0,b.jsxs)("div",{className:"p-6 space-y-5",children:[(0,b.jsxs)("div",{className:"p-4 bg-gray-50 rounded-xl",children:[(0,b.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Отзыв от"}),(0,b.jsx)("p",{className:"font-medium text-gray-800",children:$.name}),(0,b.jsx)("p",{className:"text-sm text-gray-600 mt-2 line-clamp-2",children:$.text})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Привязка к услуге"}),(0,b.jsxs)("select",{value:aa.service_id,onChange:a=>ab({...aa,service_id:a.target.value}),className:"w-full px-4 py-2.5 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-[#18A36C]/20 focus:border-[#18A36C] transition-all",children:[(0,b.jsx)("option",{value:"",children:"Без привязки к услуге"}),O.map(a=>(0,b.jsx)("option",{value:a.id,children:a.title},a.id))]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("button",{type:"button",onClick:()=>ab({...aa,verified:!aa.verified}),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${aa.verified?"bg-[#18A36C]":"bg-gray-300"}`,children:(0,b.jsx)("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${aa.verified?"translate-x-6":"translate-x-1"}`})}),(0,b.jsx)("span",{className:"text-sm text-gray-700",children:"Показывать в общих отзывах клиники"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 pt-2",children:[(0,b.jsx)("button",{onClick:()=>_(null),disabled:ac,className:"flex-1 px-4 py-2.5 border border-gray-200 text-gray-700 font-medium rounded-xl hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Отмена"}),(0,b.jsxs)("button",{onClick:aw,disabled:ac,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-[#18A36C] text-white font-medium rounded-xl hover:bg-[#15905f] transition-colors disabled:opacity-50",children:[ac?(0,b.jsx)(h.Loader2,{className:"w-4 h-4 animate-spin"}):(0,b.jsx)(m.default,{className:"w-4 h-4"}),"Одобрить"]})]})]})]})]})}),(0,b.jsx)(x.ConfirmDialog,{isOpen:I.isOpen,onClose:I.handleCancel,onConfirm:I.handleConfirm,title:I.options.title,message:I.options.message,confirmText:I.options.confirmText,cancelText:I.options.cancelText,variant:I.options.variant,loading:I.loading})]})})]}):(0,b.jsx)(u.AdminAuthForm,{onSuccess:()=>{D()}})}a.s(["default",()=>B],63982)}];

//# sourceMappingURL=src_app_admin_feedbacks_page_tsx_4ef62292._.js.map