module.exports=[90504,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(75003),e=a.i(62036),f=a.i(40784),g=a.i(67974),h=a.i(41567),i=a.i(5784);function j({images:a,onChange:d,folder:e,maxSizeMB:f=10}){let g=[{key:"image_url",label:"Главное изображение",value:a.image_url},{key:"image_url_1",label:"Изображение 1",value:a.image_url_1},{key:"image_url_2",label:"Изображение 2",value:a.image_url_2},{key:"image_url_3",label:"Изображение 3",value:a.image_url_3},{key:"image_url_4",label:"Изображение 4 (опционально)",value:a.image_url_4}],[j,k]=(0,c.useState)(g[0].key),l=g.find(a=>a.key===j)||g[0];return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Выберите слот изображения"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("select",{value:j,onChange:a=>k(a.target.value),className:"w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#18A36C] focus:border-transparent appearance-none cursor-pointer transition-all",children:g.map(a=>(0,b.jsxs)("option",{value:a.key,children:[a.label,a.value?" ✓":""]},a.key))}),(0,b.jsx)(i.ChevronDown,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"})]})]}),(0,b.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-200",children:[(0,b.jsx)("p",{className:"text-xs font-medium text-gray-600 mb-3",children:"Загруженные изображения:"}),(0,b.jsx)("div",{className:"grid grid-cols-5 gap-2",children:g.map(a=>(0,b.jsxs)("button",{type:"button",onClick:()=>k(a.key),className:`relative aspect-square rounded-lg overflow-hidden border-2 transition-all ${j===a.key?"border-[#18A36C] ring-2 ring-[#18A36C]/20":"border-gray-200 hover:border-gray-300"}`,title:a.label,children:[a.value?(0,b.jsx)("img",{src:a.value,alt:a.label,className:"w-full h-full object-cover"}):(0,b.jsx)("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-xs text-gray-400 font-medium",children:"image_url"===a.key?"Главное":a.key.replace("image_url_","")})}),j===a.key&&(0,b.jsx)("div",{className:"absolute inset-0 bg-[#18A36C]/10 flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-6 h-6 bg-[#18A36C] rounded-full flex items-center justify-center",children:(0,b.jsx)("svg",{className:"w-4 h-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})})]},a.key))})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl p-4 border-2 border-dashed border-gray-300",children:[(0,b.jsxs)("p",{className:"text-sm font-medium text-gray-700 mb-3",children:["Загрузка для: ",(0,b.jsx)("span",{className:"text-[#18A36C]",children:l.label})]}),(0,b.jsx)(h.ImageUploader,{value:l.value,onChange:a=>d(j,a),folder:e,placeholder:`Загрузите ${l.label.toLowerCase()}`,maxSizeMB:f})]})]})}var k=a.i(72663),l=a.i(3038),m=a.i(4297),n=a.i(52913),o=a.i(55220),p=a.i(79212),q=a.i(25170),r=a.i(96215),s=a.i(31860),t=a.i(37210),u=a.i(72549),v=a.i(50522);let w=(0,a.i(70106).default)("circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);var x=a.i(67453);function y({categories:a,value:c,onChange:d,placeholder:e="Выберите категорию",maxHeight:f="320px",showHeader:g=!0,showFooter:h=!0}){let i=c?parseInt(c.toString()):null;return(0,b.jsxs)("div",{className:"w-full border border-gray-200 rounded-xl bg-white overflow-hidden",children:[g&&(0,b.jsx)("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-200",children:(0,b.jsx)("p",{className:"text-sm text-gray-600",children:i&&a.find(a=>a.id===i)?.name||e})}),(0,b.jsx)("div",{className:"overflow-y-auto",style:{maxHeight:f},children:a.map(a=>{let c=a.id===i,e=a.disabled;return(0,b.jsx)("div",{onClick:()=>!e&&d(a.id.toString()),className:`
                px-4 py-3 border-b border-gray-100 transition-all cursor-pointer
                ${e?"bg-gray-50 cursor-not-allowed opacity-60":"hover:bg-[#18A36C]/5 hover:border-l-4 hover:border-l-[#18A36C]"}
                ${c&&!e?"bg-[#18A36C]/10 border-l-4 border-l-[#18A36C]":"border-l-4 border-l-transparent"}
              `,style:{paddingLeft:`${16+20*a.level}px`},children:(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[a.level>0&&(0,b.jsx)(v.ChevronRight,{className:"w-3 h-3 text-gray-400 flex-shrink-0"}),c?(0,b.jsx)(x.CheckCircle2,{className:"w-4 h-4 text-[#18A36C] flex-shrink-0"}):(0,b.jsx)(w,{className:"w-4 h-4 text-gray-300 flex-shrink-0"}),(0,b.jsx)("span",{className:`
                    text-sm flex-1 truncate
                    ${e?"text-gray-400":"text-gray-800"}
                    ${c?"font-semibold text-[#18A36C]":""}
                  `,children:a.name})]}),e&&a.disabledReason&&(0,b.jsx)("span",{className:"text-xs text-gray-400 italic flex-shrink-0",children:a.disabledReason})]})},a.id)})}),h&&(0,b.jsx)("div",{className:"px-4 py-2 bg-gray-50 border-t border-gray-200",children:(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Доступны только категории без подкатегорий"})})]})}function z(){let{status:a}=(0,d.useSession)(),{sessionVerified:h,isLoading:i,verifySession:v}=(0,p.useAdminSession)(),[w,x]=(0,c.useState)(null),[z,A]=(0,c.useState)(!0),{success:B,error:C}=(0,q.useAlert)(),D=(0,u.useConfirmDialog)(),{currentPage:E,setPage:F,buildApiUrl:G}=(0,l.useServerPagination)(12),[H,I]=(0,c.useState)([]),[J,K]=(0,c.useState)(1),[L,M]=(0,c.useState)(0),[N,O]=(0,c.useState)([]),[P,Q]=(0,c.useState)([]),[R,S]=(0,c.useState)(!1),[T,U]=(0,c.useState)(""),[V,W]=(0,c.useState)(!1),[X,Y]=(0,c.useState)(null),[Z,$]=(0,c.useState)(!1),[_,aa]=(0,c.useState)({title:"",subtitle:"",price:"",video_url:"",description:"",image_url:"",image_url_1:"",image_url_2:"",image_url_3:"",image_url_4:"",specialist_ids:[],service_category_id:""});(0,c.useEffect)(()=>{"authenticated"===a?ab():"unauthenticated"===a&&x(!1)},[a]),(0,c.useEffect)(()=>{h&&w&&ac()},[h,w,E,T]);let ab=async()=>{A(!0);try{let a=await fetch("/api/admin/auth"),b=await a.json();x(b.isAdmin)}catch(a){x(!1)}finally{A(!1)}},ac=async()=>{S(!0);try{let a=G("/api/admin/services",T),[b,c,d]=await Promise.all([fetch(a),fetch("/api/service-categories"),fetch("/api/specialists")]);if(b.ok){let a=await b.json();I(a.data||[]),K(a.totalPages||1),M(a.totalCount||0)}if(c.ok){let a=await c.json();O(a)}if(d.ok){let a=await d.json();Q(a)}}catch(a){console.error("Error loading data:",a),C("Ошибка загрузки данных")}finally{S(!1)}};(0,c.useEffect)(()=>{F(1)},[T]);let ad=(0,c.useMemo)(()=>{let a=new Set(H.filter(a=>a.service_category_id&&(!X||a.id!==X.id)).map(a=>a.service_category_id)),b=(c,d=0)=>{let e=[];for(let f of c){let c=f.children&&f.children.length>0,g=a.has(f.id),h=!1,i="";c?(h=!0,i="имеет подкатегории"):g&&(h=!0,i="уже занята"),e.push({...f,level:d,disabled:h,disabledReason:i}),f.children&&f.children.length>0&&e.push(...b(f.children,d+1))}return e};return b(N)},[N,H,X]),ae=()=>{aa({title:"",subtitle:"",price:"",video_url:"",description:"",image_url:"",image_url_1:"",image_url_2:"",image_url_3:"",image_url_4:"",specialist_ids:[],service_category_id:""}),Y(null),W(!1)},af=()=>{ae(),W(!0)},ag=async()=>{$(!0);try{let a=X?`/api/admin/services/${X.id}`:"/api/admin/services",b=X?"PUT":"POST",c=await fetch(a,{method:b,headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});if(c.ok)await ac(),ae(),B(X?"Услуга обновлена":"Услуга создана");else{let a=await c.json();C(a.error||"Ошибка сохранения")}}catch(a){C("Ошибка сохранения")}finally{$(!1)}},ah=async(a,b)=>{if(await D.confirm({title:"Удаление услуги",message:`Вы уверены, что хотите удалить услугу "${b}"? Это действие нельзя отменить.`,confirmText:"Удалить",cancelText:"Отмена",variant:"danger"}))try{let b=await fetch(`/api/admin/services/${a}`,{method:"DELETE"});if(b.ok)await ac(),B("Услуга удалена");else{let a=await b.json();C(a.error||"Ошибка удаления")}}catch(a){C("Ошибка удаления")}};return"loading"===a||null===w||i||z?(0,b.jsx)(r.AdminAccessSkeleton,{}):"unauthenticated"===a||!1===w?(0,b.jsx)(n.default,{}):h?(0,b.jsxs)("div",{className:"flex min-h-screen bg-gray-50",children:[(0,b.jsx)(k.AdminMenu,{}),(0,b.jsx)("div",{className:"flex-1 p-4 lg:p-8 overflow-auto",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,b.jsx)(m.AdminSection,{title:"Услуги",icon:f.ShoppingBag,count:L,loading:R,searchValue:T,onSearchChange:U,onAdd:af,addButtonText:"Добавить услугу",children:0===H.length?(0,b.jsx)(m.EmptyState,{icon:f.ShoppingBag,title:"Услуги не найдены",description:T?"Попробуйте изменить поисковый запрос":"Добавьте первую услугу",actionText:T?void 0:"Добавить услугу",onAction:T?void 0:af}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:(0,b.jsx)(e.AnimatePresence,{children:H.map(a=>(0,b.jsxs)(m.ItemCard,{children:[(0,b.jsx)("div",{className:"w-full h-32 rounded-xl overflow-hidden bg-gray-100 mb-3",children:(0,b.jsx)(s.ImageWithFallback,{src:a.image_url,alt:a.title,className:"w-full h-full object-cover"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-800 line-clamp-1",children:a.title}),(0,b.jsx)("p",{className:"text-sm text-gray-500 line-clamp-2 mt-1",children:a.subtitle})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-3 flex-wrap",children:[a.serviceCategory&&(0,b.jsx)(m.Badge,{variant:"primary",children:a.serviceCategory.name}),(0,b.jsxs)(m.Badge,{variant:"success",children:[a.price," BYN"]})]}),a.specialists.length>0&&(0,b.jsx)("div",{className:"mt-2",children:(0,b.jsxs)(m.Badge,{variant:"secondary",children:["Специалисты (",a.specialists.length,")"]})}),(0,b.jsx)("div",{className:"flex items-center justify-end mt-4 pt-4 border-t border-gray-100",children:(0,b.jsx)(m.CardActions,{onEdit:()=>{Y(a),aa({title:a.title,subtitle:a.subtitle,price:a.price.toString(),video_url:a.video_url,description:a.description,image_url:a.image_url,image_url_1:a.image_url_1,image_url_2:a.image_url_2,image_url_3:a.image_url_3,image_url_4:a.image_url_4||"",specialist_ids:a.specialists.map(a=>a.id.toString()),service_category_id:a.service_category_id?.toString()||""}),W(!0)},onDelete:()=>ah(a.id,a.title)})})]},a.id))})}),J>1&&(0,b.jsx)(g.Pagination,{currentPage:E,totalPages:J,onPageChange:F,className:"mt-6"})]})}),(0,b.jsx)(m.FormModal,{isOpen:V,onClose:ae,title:X?"Редактирование услуги":"Новая услуга",onSubmit:ag,loading:Z,disabled:!_.title||!_.subtitle||!_.price||!_.service_category_id||0===_.specialist_ids.length,children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsx)(m.FormField,{label:"Название",required:!0,children:(0,b.jsx)(m.FormInput,{type:"text",value:_.title,onChange:a=>aa({..._,title:a.target.value}),placeholder:"Лечение кариеса"})}),(0,b.jsx)(m.FormField,{label:"Цена (BYN)",required:!0,children:(0,b.jsx)(m.FormInput,{type:"number",value:_.price,onChange:a=>aa({..._,price:a.target.value}),placeholder:"100"})})]}),(0,b.jsx)(m.FormField,{label:"Подзаголовок",required:!0,children:(0,b.jsx)(m.FormInput,{type:"text",value:_.subtitle,onChange:a=>aa({..._,subtitle:a.target.value}),placeholder:"Краткое описание услуги"})}),(0,b.jsx)(m.FormField,{label:"Категория услуги",required:!0,children:(0,b.jsx)(y,{categories:ad,value:_.service_category_id,onChange:a=>aa({..._,service_category_id:a}),placeholder:"Выберите категорию"})}),(0,b.jsx)("div",{className:"grid grid-cols-1 gap-4",children:(0,b.jsxs)(m.FormField,{label:"Специалисты",required:!0,children:[(0,b.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto border border-gray-200 rounded-xl p-3 bg-gray-50",children:P.map(a=>(0,b.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-100 p-2 rounded-lg transition-colors",children:[(0,b.jsx)("input",{type:"checkbox",checked:_.specialist_ids.includes(a.id.toString()),onChange:b=>{b.target.checked?aa({..._,specialist_ids:[..._.specialist_ids,a.id.toString()]}):aa({..._,specialist_ids:_.specialist_ids.filter(b=>b!==a.id.toString())})},className:"w-4 h-4 text-[#18A36C] border-gray-300 rounded focus:ring-[#18A36C]"}),(0,b.jsx)("span",{className:"text-sm text-gray-700",children:a.name})]},a.id))}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Выбрано: ",_.specialist_ids.length]})]})}),(0,b.jsx)(m.FormField,{label:"Описание",children:(0,b.jsx)(m.FormTextarea,{value:_.description,onChange:a=>aa({..._,description:a.target.value}),rows:4,placeholder:"Полное описание услуги..."})}),(0,b.jsx)(m.FormField,{label:"Ссылка на видео (YouTube)",children:(0,b.jsx)(m.FormInput,{type:"text",value:_.video_url,onChange:a=>aa({..._,video_url:a.target.value}),placeholder:"https://youtube.com/watch?v=..."})}),(0,b.jsxs)("div",{className:"border-t border-gray-100 pt-6",children:[(0,b.jsx)("h4",{className:"font-medium text-gray-700 mb-4",children:"Изображения услуги"}),(0,b.jsx)(j,{images:{image_url:_.image_url,image_url_1:_.image_url_1,image_url_2:_.image_url_2,image_url_3:_.image_url_3,image_url_4:_.image_url_4},onChange:(a,b)=>aa({..._,[a]:b}),folder:"smartmedical/services",maxSizeMB:10})]})]})}),(0,b.jsx)(t.ConfirmDialog,{isOpen:D.isOpen,onClose:D.handleCancel,onConfirm:D.handleConfirm,title:D.options.title,message:D.options.message,confirmText:D.options.confirmText,cancelText:D.options.cancelText,variant:D.options.variant,loading:D.loading})]})})]}):(0,b.jsx)(o.AdminAuthForm,{onSuccess:()=>{v()}})}a.s(["default",()=>z],90504)}];

//# sourceMappingURL=src_app_admin_services_page_tsx_76b5bb0d._.js.map