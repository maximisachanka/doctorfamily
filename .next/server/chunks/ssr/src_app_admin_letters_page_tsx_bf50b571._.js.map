{"version":3,"sources":["turbopack:///[project]/src/app/admin/letters/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useMemo } from 'react';\nimport { useSession } from 'next-auth/react';\nimport { AnimatePresence, motion } from 'framer-motion';\nimport { Mail, Loader2, Calendar, CheckCircle, Clock, Send, Eye, X, User, Ban, UserCheck } from 'lucide-react';\nimport { Pagination } from '@/components/common/SMPagination/SMPagination';\nimport { AdminMenu } from '@/components/SMAdmin/SMAdminMenu';\nimport {\n  AdminSection,\n  EmptyState,\n  ItemCard,\n  CardActions,\n  Badge,\n} from '@/components/SMAdmin/SMAdminSection';\nimport NotFound from '../../not-found';\nimport { AdminAuthForm } from '@/components/SMAdmin/SMAdminAuthForm';\nimport { useAdminSession } from '@/hooks/useAdminSession';\nimport { AdminAccessSkeleton } from '@/components/SMAdmin/SMAdminSkeleton';\nimport { ConfirmDialog } from '@/components/SMAdmin/SMConfirmDialog';\nimport { useConfirmDialog } from '@/hooks/useConfirmDialog';\nimport { useAlert } from '@/components/common/SMAlert';\nimport { useServerPagination } from '@/hooks/useServerPagination';\nimport { useUnreadCountsContext } from '@/contexts/UnreadCountsContext';\n\ninterface LetterMessage {\n  id: number;\n  sender_type: 'patient' | 'chief_doctor';\n  content: string;\n  created_at: string;\n  is_read: boolean;\n}\n\ninterface Letter {\n  id: number;\n  subject: string;\n  content: string;\n  created_at: string;\n  reply: string | null;\n  replied_at: string | null;\n  is_read: boolean;\n  is_reply_read: boolean;\n  has_new_patient_message: boolean;\n  messages: LetterMessage[];\n  patient: {\n    id: number;\n    name: string;\n    email: string;\n    phone: string;\n    avatar_url: string | null;\n    is_messages_blocked: boolean;\n  };\n}\n\nexport default function AdminLettersPage() {\n  const { status } = useSession();\n  const { sessionVerified, isLoading: sessionLoading, verifySession } = useAdminSession();\n  const [hasAdminRole, setHasAdminRole] = useState<boolean | null>(null);\n  const [isChiefDoctor, setIsChiefDoctor] = useState(false);\n  const confirmDialog = useConfirmDialog();\n  const { success, error: showError } = useAlert();\n  const { refetch: refetchUnreadCounts } = useUnreadCountsContext();\n\n  // Pagination hook\n  const { currentPage, setPage, buildApiUrl } = useServerPagination(12);\n\n  // Data states\n  const [letters, setLetters] = useState<Letter[]>([]);\n  const [totalPages, setTotalPages] = useState(1);\n  const [totalCount, setTotalCount] = useState(0);\n  const [unreadCount, setUnreadCount] = useState(0);\n  const [repliedCount, setRepliedCount] = useState(0);\n  const [loading, setLoading] = useState(false);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [filterStatus, setFilterStatus] = useState<'unread' | 'replied' | 'all'>('unread');\n  const [viewingLetter, setViewingLetter] = useState<Letter | null>(null);\n  const [replyText, setReplyText] = useState('');\n  const [replyLoading, setReplyLoading] = useState(false);\n  const [blockLoading, setBlockLoading] = useState(false);\n\n  // Check admin role\n  useEffect(() => {\n    if (status === 'authenticated') {\n      checkAdminRole();\n    } else if (status === 'unauthenticated') {\n      setHasAdminRole(false);\n    }\n  }, [status]);\n\n  const checkAdminRole = async () => {\n    try {\n      const res = await fetch('/api/admin/auth');\n      const data = await res.json();\n      setHasAdminRole(data.isAdmin);\n      setIsChiefDoctor(data.isChiefDoctor);\n    } catch (error) {\n      setHasAdminRole(false);\n    }\n  };\n\n  const handleAuthSuccess = () => {\n    verifySession();\n  };\n\n  const loadCounts = async () => {\n    try {\n      // Fetch counts for both statuses\n      const [unreadRes, repliedRes] = await Promise.all([\n        fetch('/api/admin/letters?page=1&limit=1&status=unread'),\n        fetch('/api/admin/letters?page=1&limit=1&status=replied'),\n      ]);\n\n      if (unreadRes.ok) {\n        const data = await unreadRes.json();\n        setUnreadCount(data.totalCount || 0);\n      }\n\n      if (repliedRes.ok) {\n        const data = await repliedRes.json();\n        setRepliedCount(data.totalCount || 0);\n      }\n    } catch (error) {\n      console.error('Error loading counts:', error);\n    }\n  };\n\n  const loadData = async () => {\n    setLoading(true);\n    try {\n      const apiUrl = buildApiUrl('/api/admin/letters', searchQuery) +\n        `&status=${filterStatus}`;\n\n      const [res] = await Promise.all([\n        fetch(apiUrl),\n        loadCounts(), // Load counts in parallel\n      ]);\n\n      if (res.ok) {\n        const response = await res.json();\n        setLetters(response.data || []);\n        setTotalPages(response.totalPages || 1);\n        setTotalCount(response.totalCount || 0);\n\n        // Помечаем все письма как прочитанные после загрузки\n        await fetch('/api/admin/letters/mark-all-read', {\n          method: 'POST',\n        });\n\n        // Обновляем счетчики непрочитанных\n        await refetchUnreadCounts();\n      }\n    } catch (error) {\n      console.error('Error loading data:', error);\n      showError('Ошибка загрузки данных');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Load data when session is verified or page/search/filter changes\n  useEffect(() => {\n    if (sessionVerified && hasAdminRole && isChiefDoctor) {\n      loadData();\n    }\n  }, [sessionVerified, hasAdminRole, isChiefDoctor, currentPage, searchQuery, filterStatus]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  // Reset page when search or filter changes\n  useEffect(() => {\n    setPage(1);\n  }, [searchQuery, filterStatus]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  const handleViewLetter = async (letter: Letter) => {\n    setViewingLetter(letter);\n    setReplyText(letter.reply || '');\n\n    // Mark as read if not already\n    if (!letter.is_read) {\n      try {\n        await fetch(`/api/admin/letters/${letter.id}`);\n        // Update local state\n        setLetters(prev => prev.map(l =>\n          l.id === letter.id ? { ...l, is_read: true } : l\n        ));\n      } catch (error) {\n        console.error('Error marking letter as read:', error);\n      }\n    }\n  };\n\n  const handleSendReply = async () => {\n    if (!viewingLetter || !replyText.trim()) return;\n\n    setReplyLoading(true);\n    try {\n      const res = await fetch(`/api/admin/letters/${viewingLetter.id}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ reply: replyText }),\n      });\n\n      if (res.ok) {\n        await loadData();\n        setViewingLetter(null);\n        setReplyText('');\n        success('Ответ отправлен');\n      } else {\n        const error = await res.json();\n        showError(error.error || 'Ошибка отправки');\n      }\n    } catch (error) {\n      showError('Ошибка отправки');\n    } finally {\n      setReplyLoading(false);\n    }\n  };\n\n  const handleDelete = async (id: number, subject: string) => {\n    const confirmed = await confirmDialog.confirm({\n      title: 'Удаление письма',\n      message: `Вы уверены, что хотите удалить письмо \"${subject}\"? Это действие нельзя отменить.`,\n      confirmText: 'Удалить',\n      cancelText: 'Отмена',\n      variant: 'danger',\n    });\n\n    if (!confirmed) return;\n\n    try {\n      const res = await fetch(`/api/admin/letters/${id}`, {\n        method: 'DELETE',\n      });\n\n      if (res.ok) {\n        await loadData();\n        success('Письмо удалено');\n      } else {\n        const error = await res.json();\n        showError(error.error || 'Ошибка удаления');\n      }\n    } catch (error) {\n      showError('Ошибка удаления');\n    }\n  };\n\n  const handleToggleBlock = async (patientId: number, currentlyBlocked: boolean) => {\n    const action = currentlyBlocked ? 'разблокировать' : 'заблокировать';\n    const confirmed = await confirmDialog.confirm({\n      title: currentlyBlocked ? 'Разблокировка пользователя' : 'Блокировка пользователя',\n      message: `Вы уверены, что хотите ${action} этого пользователя? ${!currentlyBlocked ? 'Он не сможет отправлять письма.' : ''}`,\n      confirmText: currentlyBlocked ? 'Разблокировать' : 'Заблокировать',\n      cancelText: 'Отмена',\n      variant: currentlyBlocked ? 'warning' : 'danger',\n    });\n\n    if (!confirmed) return;\n\n    setBlockLoading(true);\n    try {\n      const res = await fetch(`/api/admin/users/${patientId}/block`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ blocked: !currentlyBlocked }),\n      });\n\n      if (res.ok) {\n        // Update local state\n        setLetters(prev => prev.map(l =>\n          l.patient.id === patientId\n            ? { ...l, patient: { ...l.patient, is_messages_blocked: !currentlyBlocked } }\n            : l\n        ));\n        if (viewingLetter && viewingLetter.patient.id === patientId) {\n          setViewingLetter(prev => prev ? {\n            ...prev,\n            patient: { ...prev.patient, is_messages_blocked: !currentlyBlocked }\n          } : null);\n        }\n        success(currentlyBlocked ? 'Пользователь разблокирован' : 'Пользователь заблокирован');\n      } else {\n        const error = await res.json();\n        showError(error.error || 'Ошибка');\n      }\n    } catch (error) {\n      showError('Ошибка при изменении статуса');\n    } finally {\n      setBlockLoading(false);\n    }\n  };\n\n  // Get initials from name\n  const getInitials = (name: string) => {\n    const parts = name.trim().split(/\\s+/);\n    if (parts.length >= 2) {\n      return (parts[0][0] + parts[1][0]).toUpperCase();\n    }\n    return name.slice(0, 2).toUpperCase();\n  };\n\n  // Loading state\n  if (status === 'loading' || hasAdminRole === null || sessionLoading) {\n    return <AdminAccessSkeleton />;\n  }\n\n  // Not chief doctor - show 404 (Letters only for CHIEF_DOCTOR)\n  if (status === 'unauthenticated' || !hasAdminRole || !isChiefDoctor) {\n    return <NotFound />;\n  }\n\n  // Admin login form (only if session not verified)\n  if (!sessionVerified) {\n    return <AdminAuthForm onSuccess={handleAuthSuccess} />;\n  }\n\n  return (\n    <div className=\"flex min-h-screen bg-gray-50\">\n      <AdminMenu />\n\n      <div className=\"flex-1 p-4 lg:p-8 overflow-auto\">\n        <div className=\"max-w-7xl mx-auto\">\n          <AdminSection\n            title=\"Письма главному врачу\"\n            icon={Mail}\n            count={totalCount}\n            loading={loading}\n            searchValue={searchQuery}\n            onSearchChange={setSearchQuery}\n          >\n            {/* Filter Tabs */}\n            <div className=\"flex items-center gap-2 mb-6\">\n              <button\n                onClick={() => setFilterStatus('unread')}\n                className={`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 cursor-pointer ${filterStatus === 'unread'\n                    ? 'bg-amber-500 text-white shadow-md'\n                    : 'bg-white text-gray-600 hover:bg-gray-100 border border-gray-200'\n                  }`}\n              >\n                <Clock className=\"w-4 h-4\" />\n                Без ответа\n                {unreadCount > 0 && (\n                  <span className={`px-2 py-0.5 rounded-full text-xs font-bold ${filterStatus === 'unread'\n                      ? 'bg-white/20 text-white'\n                      : 'bg-amber-100 text-amber-700'\n                    }`}>\n                    {unreadCount}\n                  </span>\n                )}\n              </button>\n              <button\n                onClick={() => setFilterStatus('replied')}\n                className={`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 cursor-pointer ${filterStatus === 'replied'\n                    ? 'bg-[#18A36C] text-white shadow-md'\n                    : 'bg-white text-gray-600 hover:bg-gray-100 border border-gray-200'\n                  }`}\n              >\n                <CheckCircle className=\"w-4 h-4\" />\n                С ответом\n              </button>\n              <button\n                onClick={() => setFilterStatus('all')}\n                className={`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 cursor-pointer ${filterStatus === 'all'\n                    ? 'bg-gray-700 text-white shadow-md'\n                    : 'bg-white text-gray-600 hover:bg-gray-100 border border-gray-200'\n                  }`}\n              >\n                <Mail className=\"w-4 h-4\" />\n                Все письма\n              </button>\n            </div>\n\n            {letters.length === 0 ? (\n              <EmptyState\n                icon={Mail}\n                title=\"Письма не найдены\"\n                description={searchQuery ? 'Попробуйте изменить поисковый запрос' : 'Пока нет писем от пациентов'}\n              />\n            ) : (\n              <>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <AnimatePresence>\n                    {letters.map((letter) => (\n                      <ItemCard key={letter.id}>\n                        <div className=\"flex gap-4\">\n                          {/* Avatar */}\n                          <div className=\"w-12 h-12 rounded-full overflow-hidden flex-shrink-0 bg-[#18A36C] flex items-center justify-center\">\n                            {letter.patient.avatar_url ? (\n                              <img\n                                src={letter.patient.avatar_url}\n                                alt={letter.patient.name}\n                                className=\"w-full h-full object-cover\"\n                              />\n                            ) : (\n                              <span className=\"text-sm font-semibold text-white\">\n                                {getInitials(letter.patient.name)}\n                              </span>\n                            )}\n                          </div>\n\n                          {/* Content */}\n                          <div className=\"flex-1 min-w-0\">\n                            <div className=\"flex items-center gap-2 mb-1\">\n                              <h3 className=\"font-semibold text-gray-800 truncate\">{letter.subject}</h3>\n                              {!letter.is_read && !letter.reply && (\n                                <span className=\"w-2 h-2 bg-amber-500 rounded-full flex-shrink-0\" />\n                              )}\n                            </div>\n                            <p className=\"text-sm text-gray-500 mb-1\">{letter.patient.name}</p>\n                            <p className=\"text-xs text-gray-400 flex items-center gap-1\">\n                              <Calendar className=\"w-3 h-3\" />\n                              {new Date(letter.created_at).toLocaleDateString('ru-RU', {\n                                day: 'numeric',\n                                month: 'long',\n                                year: 'numeric',\n                                hour: '2-digit',\n                                minute: '2-digit',\n                              })}\n                            </p>\n                          </div>\n                        </div>\n\n                        {/* Preview */}\n                        <p className=\"text-sm text-gray-500 line-clamp-2 mt-3\">{letter.content}</p>\n\n                        {/* Tags */}\n                        <div className=\"flex items-center gap-2 mt-3 flex-wrap\">\n                          {letter.patient.is_messages_blocked && (\n                            <Badge variant=\"danger\">\n                              <Ban className=\"w-3 h-3 mr-1\" />\n                              Заблокирован\n                            </Badge>\n                          )}\n                          {letter.has_new_patient_message ? (\n                            <Badge variant=\"warning\">Новое сообщение</Badge>\n                          ) : letter.reply ? (\n                            <Badge variant=\"success\">Отвечено</Badge>\n                          ) : (\n                            <Badge variant=\"warning\">Ожидает ответа</Badge>\n                          )}\n                          {letter.messages && letter.messages.length > 0 && (\n                            <Badge variant=\"secondary\">{letter.messages.length + 1} сообщ.</Badge>\n                          )}\n                        </div>\n\n                        {/* Actions */}\n                        <div className=\"flex items-center justify-between mt-4 pt-4 border-t border-gray-100\">\n                          <button\n                            onClick={() => handleViewLetter(letter)}\n                            className=\"flex items-center gap-1.5 px-3 py-1.5 bg-[#18A36C] text-white text-sm font-medium rounded-lg hover:bg-[#15905f] transition-colors cursor-pointer\"\n                          >\n                            <Eye className=\"w-4 h-4\" />\n                            {letter.reply ? 'Просмотреть' : 'Ответить'}\n                          </button>\n                          <button\n                            onClick={() => handleDelete(letter.id, letter.subject)}\n                            className=\"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors cursor-pointer\"\n                            title=\"Удалить\"\n                          >\n                            <X className=\"w-4 h-4\" />\n                          </button>\n                        </div>\n                      </ItemCard>\n                    ))}\n                  </AnimatePresence>\n                </div>\n\n                {/* Pagination */}\n                {totalPages > 1 && (\n                  <Pagination\n                    currentPage={currentPage}\n                    totalPages={totalPages}\n                    onPageChange={setPage}\n                    className=\"mt-6\"\n                  />\n                )}\n              </>\n            )}\n          </AdminSection>\n\n          {/* View/Reply Modal */}\n          <AnimatePresence>\n            {viewingLetter && (\n              <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\n                <motion.div\n                  initial={{ opacity: 0 }}\n                  animate={{ opacity: 1 }}\n                  exit={{ opacity: 0 }}\n                  onClick={() => !replyLoading && setViewingLetter(null)}\n                  className=\"absolute inset-0 bg-black/50 backdrop-blur-sm\"\n                />\n                <motion.div\n                  initial={{ opacity: 0, scale: 0.95, y: 20 }}\n                  animate={{ opacity: 1, scale: 1, y: 0 }}\n                  exit={{ opacity: 0, scale: 0.95, y: 20 }}\n                  className=\"relative w-full max-w-2xl bg-white rounded-2xl shadow-2xl overflow-hidden max-h-[90vh] flex flex-col\"\n                >\n                  {/* Header */}\n                  <div className=\"bg-[#18A36C] px-6 py-4 flex-shrink-0\">\n                    <div className=\"flex items-center justify-between\">\n                      <h2 className=\"text-xl font-semibold text-white\">Письмо</h2>\n                      <button\n                        onClick={() => !replyLoading && setViewingLetter(null)}\n                        className=\"p-1.5 hover:bg-white/20 rounded-lg transition-colors cursor-pointer\"\n                      >\n                        <X className=\"w-5 h-5 text-white\" />\n                      </button>\n                    </div>\n                  </div>\n\n                  {/* Content */}\n                  <div className=\"p-6 overflow-y-auto flex-1\">\n                    {/* Sender info */}\n                    <div className=\"flex items-start gap-4 mb-4 pb-4 border-b border-gray-100\">\n                      <div className=\"w-14 h-14 rounded-full overflow-hidden flex-shrink-0 bg-[#18A36C] flex items-center justify-center\">\n                        {viewingLetter.patient.avatar_url ? (\n                          <img\n                            src={viewingLetter.patient.avatar_url}\n                            alt={viewingLetter.patient.name}\n                            className=\"w-full h-full object-cover\"\n                          />\n                        ) : (\n                          <span className=\"text-lg font-semibold text-white\">\n                            {getInitials(viewingLetter.patient.name)}\n                          </span>\n                        )}\n                      </div>\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center gap-2\">\n                          <h3 className=\"font-semibold text-gray-800 text-lg\">{viewingLetter.patient.name}</h3>\n                          {viewingLetter.patient.is_messages_blocked && (\n                            <span className=\"px-2 py-0.5 bg-red-100 text-red-600 text-xs font-medium rounded-full flex items-center gap-1\">\n                              <Ban className=\"w-3 h-3\" />\n                              Заблокирован\n                            </span>\n                          )}\n                        </div>\n                        <p className=\"text-sm text-gray-500\">{viewingLetter.patient.email}</p>\n                        <p className=\"text-sm text-gray-500\">{viewingLetter.patient.phone}</p>\n                      </div>\n                      <button\n                        onClick={() => handleToggleBlock(viewingLetter.patient.id, viewingLetter.patient.is_messages_blocked)}\n                        disabled={blockLoading}\n                        className={`flex items-center gap-1.5 px-3 py-2 rounded-lg text-sm font-medium transition-colors disabled:opacity-50 cursor-pointer ${\n                          viewingLetter.patient.is_messages_blocked\n                            ? 'bg-green-100 text-green-700 hover:bg-green-200'\n                            : 'bg-red-100 text-red-700 hover:bg-red-200'\n                        }`}\n                        title={viewingLetter.patient.is_messages_blocked ? 'Разблокировать пользователя' : 'Заблокировать пользователя'}\n                      >\n                        {blockLoading ? (\n                          <Loader2 className=\"w-4 h-4 animate-spin\" />\n                        ) : viewingLetter.patient.is_messages_blocked ? (\n                          <UserCheck className=\"w-4 h-4\" />\n                        ) : (\n                          <Ban className=\"w-4 h-4\" />\n                        )}\n                        {viewingLetter.patient.is_messages_blocked ? 'Разблокировать' : 'Заблокировать'}\n                      </button>\n                    </div>\n\n                    {/* Subject */}\n                    <h4 className=\"font-semibold text-gray-800 text-lg mb-2\">{viewingLetter.subject}</h4>\n                    <p className=\"text-xs text-gray-400 mb-4\">\n                      {new Date(viewingLetter.created_at).toLocaleDateString('ru-RU', {\n                        day: 'numeric',\n                        month: 'long',\n                        year: 'numeric',\n                        hour: '2-digit',\n                        minute: '2-digit',\n                      })}\n                    </p>\n\n                    {/* Conversation Thread */}\n                    <div className=\"space-y-4 mb-6\">\n                      {/* Initial message from patient */}\n                      <div className=\"flex gap-3\">\n                        <div className=\"w-8 h-8 rounded-full overflow-hidden flex-shrink-0 bg-[#18A36C] flex items-center justify-center\">\n                          {viewingLetter.patient.avatar_url ? (\n                            <img\n                              src={viewingLetter.patient.avatar_url}\n                              alt={viewingLetter.patient.name}\n                              className=\"w-full h-full object-cover\"\n                            />\n                          ) : (\n                            <span className=\"text-xs font-semibold text-white\">\n                              {getInitials(viewingLetter.patient.name)}\n                            </span>\n                          )}\n                        </div>\n                        <div className=\"flex-1\">\n                          <div className=\"bg-gray-100 rounded-xl p-4\">\n                            <p className=\"text-gray-700 whitespace-pre-wrap\">{viewingLetter.content}</p>\n                          </div>\n                          <p className=\"text-xs text-gray-400 mt-1\">\n                            {new Date(viewingLetter.created_at).toLocaleDateString('ru-RU', {\n                              day: 'numeric',\n                              month: 'short',\n                              hour: '2-digit',\n                              minute: '2-digit',\n                            })}\n                          </p>\n                        </div>\n                      </div>\n\n                      {/* First reply - always show if exists */}\n                      {viewingLetter.reply && (\n                        <div className=\"flex gap-3 justify-end\">\n                          <div className=\"flex-1 max-w-[85%]\">\n                            <div className=\"bg-[#18A36C]/10 rounded-xl p-4\">\n                              <p className=\"text-gray-700 whitespace-pre-wrap\">{viewingLetter.reply}</p>\n                            </div>\n                            <p className=\"text-xs text-gray-400 mt-1 text-right\">\n                              <CheckCircle className=\"w-3 h-3 inline mr-1 text-[#18A36C]\" />\n                              Вы, {viewingLetter.replied_at && new Date(viewingLetter.replied_at).toLocaleDateString('ru-RU', {\n                                day: 'numeric',\n                                month: 'short',\n                                hour: '2-digit',\n                                minute: '2-digit',\n                              })}\n                            </p>\n                          </div>\n                        </div>\n                      )}\n\n                      {/* Thread messages */}\n                      {viewingLetter.messages && viewingLetter.messages.map((msg) => (\n                        <div key={msg.id} className={`flex gap-3 ${msg.sender_type === 'chief_doctor' ? 'justify-end' : ''}`}>\n                          {msg.sender_type === 'patient' && (\n                            <div className=\"w-8 h-8 rounded-full overflow-hidden flex-shrink-0 bg-[#18A36C] flex items-center justify-center\">\n                              {viewingLetter.patient.avatar_url ? (\n                                <img\n                                  src={viewingLetter.patient.avatar_url}\n                                  alt={viewingLetter.patient.name}\n                                  className=\"w-full h-full object-cover\"\n                                />\n                              ) : (\n                                <span className=\"text-xs font-semibold text-white\">\n                                  {getInitials(viewingLetter.patient.name)}\n                                </span>\n                              )}\n                            </div>\n                          )}\n                          <div className={`flex-1 ${msg.sender_type === 'chief_doctor' ? 'max-w-[85%]' : ''}`}>\n                            <div className={`rounded-xl p-4 ${msg.sender_type === 'chief_doctor' ? 'bg-[#18A36C]/10' : 'bg-gray-100'}`}>\n                              <p className=\"text-gray-700 whitespace-pre-wrap\">{msg.content}</p>\n                            </div>\n                            <p className={`text-xs text-gray-400 mt-1 ${msg.sender_type === 'chief_doctor' ? 'text-right' : ''}`}>\n                              {msg.sender_type === 'chief_doctor' && <CheckCircle className=\"w-3 h-3 inline mr-1 text-[#18A36C]\" />}\n                              {msg.sender_type === 'chief_doctor' ? 'Вы' : viewingLetter.patient.name.split(' ')[0]}, {new Date(msg.created_at).toLocaleDateString('ru-RU', {\n                                day: 'numeric',\n                                month: 'short',\n                                hour: '2-digit',\n                                minute: '2-digit',\n                              })}\n                            </p>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n\n                    {/* Reply form - always shown for chief doctor */}\n                    {isChiefDoctor && (\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          {viewingLetter.reply ? 'Продолжить переписку' : 'Ваш ответ'}\n                        </label>\n                        <textarea\n                          value={replyText}\n                          onChange={(e) => setReplyText(e.target.value)}\n                          rows={4}\n                          className=\"w-full px-4 py-3 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-[#18A36C]/20 focus:border-[#18A36C] transition-all resize-none\"\n                          placeholder=\"Введите ваш ответ пациенту...\"\n                        />\n                      </div>\n                    )}\n\n                    {/* Not chief doctor warning */}\n                    {!isChiefDoctor && (\n                      <div className=\"bg-amber-50 border border-amber-200 rounded-xl p-4\">\n                        <p className=\"text-amber-700 text-sm\">\n                          Только главный врач может отвечать на письма пациентов.\n                        </p>\n                      </div>\n                    )}\n                  </div>\n\n                  {/* Actions */}\n                  {isChiefDoctor && (\n                    <div className=\"flex items-center gap-3 p-6 pt-0 flex-shrink-0\">\n                      <button\n                        onClick={() => setViewingLetter(null)}\n                        disabled={replyLoading}\n                        className=\"flex-1 px-4 py-2.5 border border-gray-200 text-gray-700 font-medium rounded-xl hover:bg-gray-50 transition-colors disabled:opacity-50 cursor-pointer\"\n                      >\n                        Закрыть\n                      </button>\n                      <button\n                        onClick={handleSendReply}\n                        disabled={replyLoading || !replyText.trim()}\n                        className=\"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-[#18A36C] text-white font-medium rounded-xl hover:bg-[#15905f] transition-colors disabled:opacity-50 cursor-pointer\"\n                      >\n                        {replyLoading ? (\n                          <Loader2 className=\"w-4 h-4 animate-spin\" />\n                        ) : (\n                          <Send className=\"w-4 h-4\" />\n                        )}\n                        Отправить\n                      </button>\n                    </div>\n                  )}\n                </motion.div>\n              </div>\n            )}\n          </AnimatePresence>\n\n          {/* Confirm Dialog */}\n          <ConfirmDialog\n            isOpen={confirmDialog.isOpen}\n            onClose={confirmDialog.handleCancel}\n            onConfirm={confirmDialog.handleConfirm}\n            title={confirmDialog.options.title}\n            message={confirmDialog.options.message}\n            confirmText={confirmDialog.options.confirmText}\n            cancelText={confirmDialog.options.cancelText}\n            variant={confirmDialog.options.variant}\n            loading={confirmDialog.loading}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}