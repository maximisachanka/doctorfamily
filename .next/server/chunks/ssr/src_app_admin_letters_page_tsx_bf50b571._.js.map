{"version":3,"sources":["turbopack:///[project]/src/app/admin/letters/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect, useMemo } from 'react';\r\nimport { useSession } from 'next-auth/react';\r\nimport { AnimatePresence, motion } from 'framer-motion';\r\nimport { Mail, Loader2, Calendar, CheckCircle, Clock, Send, Eye, X, User, Ban, UserCheck } from 'lucide-react';\r\nimport { Pagination } from '@/components/common/SMPagination/SMPagination';\r\nimport { AdminMenu } from '@/components/SMAdmin/SMAdminMenu';\r\nimport {\r\n  AdminSection,\r\n  EmptyState,\r\n  ItemCard,\r\n  CardActions,\r\n  Badge,\r\n} from '@/components/SMAdmin/SMAdminSection';\r\nimport NotFound from '../../not-found';\r\nimport { AdminAuthForm } from '@/components/SMAdmin/SMAdminAuthForm';\r\nimport { useAdminSession } from '@/hooks/useAdminSession';\r\nimport { AdminAccessSkeleton } from '@/components/SMAdmin/SMAdminSkeleton';\r\nimport { ConfirmDialog } from '@/components/SMAdmin/SMConfirmDialog';\r\nimport { useConfirmDialog } from '@/hooks/useConfirmDialog';\r\nimport { useAlert } from '@/components/common/SMAlert';\r\nimport { useUnreadCountsContext } from '@/contexts/UnreadCountsContext';\r\n\r\ninterface LetterMessage {\r\n  id: number;\r\n  sender_type: 'patient' | 'chief_doctor';\r\n  content: string;\r\n  created_at: string;\r\n  is_read: boolean;\r\n}\r\n\r\ninterface Letter {\r\n  id: number;\r\n  subject: string;\r\n  content: string;\r\n  created_at: string;\r\n  reply: string | null;\r\n  replied_at: string | null;\r\n  is_read: boolean;\r\n  is_reply_read: boolean;\r\n  has_new_patient_message: boolean;\r\n  messages: LetterMessage[];\r\n  patient: {\r\n    id: number;\r\n    name: string;\r\n    email: string;\r\n    phone: string;\r\n    avatar_url: string | null;\r\n    is_messages_blocked: boolean;\r\n  };\r\n}\r\n\r\nexport default function AdminLettersPage() {\r\n  const { status } = useSession();\r\n  const { sessionVerified, isLoading: sessionLoading, verifySession } = useAdminSession();\r\n  const [hasAdminRole, setHasAdminRole] = useState<boolean | null>(null);\r\n  const [isChiefDoctor, setIsChiefDoctor] = useState(false);\r\n  const confirmDialog = useConfirmDialog();\r\n  const { success, error: showError } = useAlert();\r\n  const { refetch: refetchUnreadCounts } = useUnreadCountsContext();\r\n\r\n  // Data states\r\n  const [letters, setLetters] = useState<Letter[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [filterStatus, setFilterStatus] = useState<'unread' | 'replied' | 'all'>('unread');\r\n  const [viewingLetter, setViewingLetter] = useState<Letter | null>(null);\r\n  const [replyText, setReplyText] = useState('');\r\n  const [replyLoading, setReplyLoading] = useState(false);\r\n  const [blockLoading, setBlockLoading] = useState(false);\r\n  const ITEMS_PER_PAGE = 12;\r\n\r\n  // Check admin role\r\n  useEffect(() => {\r\n    if (status === 'authenticated') {\r\n      checkAdminRole();\r\n    } else if (status === 'unauthenticated') {\r\n      setHasAdminRole(false);\r\n    }\r\n  }, [status]);\r\n\r\n  // Load data when session is verified (only for chief doctor)\r\n  useEffect(() => {\r\n    if (sessionVerified && hasAdminRole && isChiefDoctor) {\r\n      loadData();\r\n    }\r\n  }, [sessionVerified, hasAdminRole, isChiefDoctor]);\r\n\r\n  const checkAdminRole = async () => {\r\n    try {\r\n      const res = await fetch('/api/admin/auth');\r\n      const data = await res.json();\r\n      setHasAdminRole(data.isAdmin);\r\n      setIsChiefDoctor(data.isChiefDoctor);\r\n    } catch (error) {\r\n      setHasAdminRole(false);\r\n    }\r\n  };\r\n\r\n  const handleAuthSuccess = () => {\r\n    verifySession();\r\n  };\r\n\r\n  const loadData = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch('/api/admin/letters');\r\n      if (res.ok) {\r\n        const data = await res.json();\r\n        setLetters(data);\r\n\r\n        // Помечаем все письма как прочитанные после загрузки\r\n        await fetch('/api/admin/letters/mark-all-read', {\r\n          method: 'POST',\r\n        });\r\n\r\n        // Обновляем счетчики непрочитанных\r\n        await refetchUnreadCounts();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading data:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Filtered letters\r\n  const filteredLetters = useMemo(() => {\r\n    let result = letters;\r\n\r\n    // Filter by status\r\n    if (filterStatus === 'unread') {\r\n      result = result.filter(l => !l.reply || l.has_new_patient_message);\r\n    } else if (filterStatus === 'replied') {\r\n      result = result.filter(l => l.reply && !l.has_new_patient_message);\r\n    }\r\n\r\n    // Filter by search query\r\n    if (searchQuery) {\r\n      const query = searchQuery.toLowerCase();\r\n      result = result.filter(\r\n        (l) =>\r\n          l.subject.toLowerCase().includes(query) ||\r\n          l.content.toLowerCase().includes(query) ||\r\n          l.patient.name.toLowerCase().includes(query) ||\r\n          l.patient.email.toLowerCase().includes(query)\r\n      );\r\n    }\r\n\r\n    return result;\r\n  }, [letters, searchQuery, filterStatus]);\r\n\r\n  // Count unread letters (without reply OR with new patient message)\r\n  const unreadCount = useMemo(() => {\r\n    return letters.filter(l => !l.reply || l.has_new_patient_message).length;\r\n  }, [letters]);\r\n\r\n  // Reset page when search or filter changes\r\n  useEffect(() => {\r\n    setCurrentPage(1);\r\n  }, [searchQuery, filterStatus]);\r\n\r\n  // Pagination\r\n  const totalPages = Math.ceil(filteredLetters.length / ITEMS_PER_PAGE);\r\n  const paginatedLetters = useMemo(() => {\r\n    const start = (currentPage - 1) * ITEMS_PER_PAGE;\r\n    return filteredLetters.slice(start, start + ITEMS_PER_PAGE);\r\n  }, [filteredLetters, currentPage]);\r\n\r\n  const handleViewLetter = async (letter: Letter) => {\r\n    setViewingLetter(letter);\r\n    setReplyText(letter.reply || '');\r\n\r\n    // Mark as read if not already\r\n    if (!letter.is_read) {\r\n      try {\r\n        await fetch(`/api/admin/letters/${letter.id}`);\r\n        // Update local state\r\n        setLetters(prev => prev.map(l =>\r\n          l.id === letter.id ? { ...l, is_read: true } : l\r\n        ));\r\n      } catch (error) {\r\n        console.error('Error marking letter as read:', error);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleSendReply = async () => {\r\n    if (!viewingLetter || !replyText.trim()) return;\r\n\r\n    setReplyLoading(true);\r\n    try {\r\n      const res = await fetch(`/api/admin/letters/${viewingLetter.id}`, {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ reply: replyText }),\r\n      });\r\n\r\n      if (res.ok) {\r\n        await loadData();\r\n        setViewingLetter(null);\r\n        setReplyText('');\r\n        success('Ответ отправлен');\r\n      } else {\r\n        const error = await res.json();\r\n        showError(error.error || 'Ошибка отправки');\r\n      }\r\n    } catch (error) {\r\n      showError('Ошибка отправки');\r\n    } finally {\r\n      setReplyLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (id: number, subject: string) => {\r\n    const confirmed = await confirmDialog.confirm({\r\n      title: 'Удаление письма',\r\n      message: `Вы уверены, что хотите удалить письмо \"${subject}\"? Это действие нельзя отменить.`,\r\n      confirmText: 'Удалить',\r\n      cancelText: 'Отмена',\r\n      variant: 'danger',\r\n    });\r\n\r\n    if (!confirmed) return;\r\n\r\n    try {\r\n      const res = await fetch(`/api/admin/letters/${id}`, {\r\n        method: 'DELETE',\r\n      });\r\n\r\n      if (res.ok) {\r\n        await loadData();\r\n        success('Письмо удалено');\r\n      } else {\r\n        const error = await res.json();\r\n        showError(error.error || 'Ошибка удаления');\r\n      }\r\n    } catch (error) {\r\n      showError('Ошибка удаления');\r\n    }\r\n  };\r\n\r\n  const handleToggleBlock = async (patientId: number, currentlyBlocked: boolean) => {\r\n    const action = currentlyBlocked ? 'разблокировать' : 'заблокировать';\r\n    const confirmed = await confirmDialog.confirm({\r\n      title: currentlyBlocked ? 'Разблокировка пользователя' : 'Блокировка пользователя',\r\n      message: `Вы уверены, что хотите ${action} этого пользователя? ${!currentlyBlocked ? 'Он не сможет отправлять письма.' : ''}`,\r\n      confirmText: currentlyBlocked ? 'Разблокировать' : 'Заблокировать',\r\n      cancelText: 'Отмена',\r\n      variant: currentlyBlocked ? 'warning' : 'danger',\r\n    });\r\n\r\n    if (!confirmed) return;\r\n\r\n    setBlockLoading(true);\r\n    try {\r\n      const res = await fetch(`/api/admin/users/${patientId}/block`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ blocked: !currentlyBlocked }),\r\n      });\r\n\r\n      if (res.ok) {\r\n        // Update local state\r\n        setLetters(prev => prev.map(l =>\r\n          l.patient.id === patientId\r\n            ? { ...l, patient: { ...l.patient, is_messages_blocked: !currentlyBlocked } }\r\n            : l\r\n        ));\r\n        if (viewingLetter && viewingLetter.patient.id === patientId) {\r\n          setViewingLetter(prev => prev ? {\r\n            ...prev,\r\n            patient: { ...prev.patient, is_messages_blocked: !currentlyBlocked }\r\n          } : null);\r\n        }\r\n        success(currentlyBlocked ? 'Пользователь разблокирован' : 'Пользователь заблокирован');\r\n      } else {\r\n        const error = await res.json();\r\n        showError(error.error || 'Ошибка');\r\n      }\r\n    } catch (error) {\r\n      showError('Ошибка при изменении статуса');\r\n    } finally {\r\n      setBlockLoading(false);\r\n    }\r\n  };\r\n\r\n  // Get initials from name\r\n  const getInitials = (name: string) => {\r\n    const parts = name.trim().split(/\\s+/);\r\n    if (parts.length >= 2) {\r\n      return (parts[0][0] + parts[1][0]).toUpperCase();\r\n    }\r\n    return name.slice(0, 2).toUpperCase();\r\n  };\r\n\r\n  // Loading state\r\n  if (status === 'loading' || hasAdminRole === null || sessionLoading) {\r\n    return <AdminAccessSkeleton />;\r\n  }\r\n\r\n  // Not chief doctor - show 404 (Letters only for CHIEF_DOCTOR)\r\n  if (status === 'unauthenticated' || !hasAdminRole || !isChiefDoctor) {\r\n    return <NotFound />;\r\n  }\r\n\r\n  // Admin login form (only if session not verified)\r\n  if (!sessionVerified) {\r\n    return <AdminAuthForm onSuccess={handleAuthSuccess} />;\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex min-h-screen bg-gray-50\">\r\n      <AdminMenu />\r\n\r\n      <div className=\"flex-1 p-4 lg:p-8 overflow-auto\">\r\n        <div className=\"max-w-7xl mx-auto\">\r\n          <AdminSection\r\n            title=\"Письма главному врачу\"\r\n            icon={Mail}\r\n            count={letters.length}\r\n            loading={loading}\r\n            searchValue={searchQuery}\r\n            onSearchChange={setSearchQuery}\r\n          >\r\n            {/* Filter Tabs */}\r\n            <div className=\"flex items-center gap-2 mb-6\">\r\n              <button\r\n                onClick={() => setFilterStatus('unread')}\r\n                className={`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${filterStatus === 'unread'\r\n                    ? 'bg-amber-500 text-white shadow-md'\r\n                    : 'bg-white text-gray-600 hover:bg-gray-100 border border-gray-200'\r\n                  }`}\r\n              >\r\n                <Clock className=\"w-4 h-4\" />\r\n                Без ответа\r\n                {unreadCount > 0 && (\r\n                  <span className={`px-2 py-0.5 rounded-full text-xs font-bold ${filterStatus === 'unread'\r\n                      ? 'bg-white/20 text-white'\r\n                      : 'bg-amber-100 text-amber-700'\r\n                    }`}>\r\n                    {unreadCount}\r\n                  </span>\r\n                )}\r\n              </button>\r\n              <button\r\n                onClick={() => setFilterStatus('replied')}\r\n                className={`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${filterStatus === 'replied'\r\n                    ? 'bg-[#18A36C] text-white shadow-md'\r\n                    : 'bg-white text-gray-600 hover:bg-gray-100 border border-gray-200'\r\n                  }`}\r\n              >\r\n                <CheckCircle className=\"w-4 h-4\" />\r\n                С ответом\r\n              </button>\r\n              <button\r\n                onClick={() => setFilterStatus('all')}\r\n                className={`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${filterStatus === 'all'\r\n                    ? 'bg-gray-700 text-white shadow-md'\r\n                    : 'bg-white text-gray-600 hover:bg-gray-100 border border-gray-200'\r\n                  }`}\r\n              >\r\n                <Mail className=\"w-4 h-4\" />\r\n                Все письма\r\n              </button>\r\n            </div>\r\n\r\n            {filteredLetters.length === 0 ? (\r\n              <EmptyState\r\n                icon={Mail}\r\n                title=\"Письма не найдены\"\r\n                description={searchQuery ? 'Попробуйте изменить поисковый запрос' : 'Пока нет писем от пациентов'}\r\n              />\r\n            ) : (\r\n              <>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <AnimatePresence>\r\n                    {paginatedLetters.map((letter) => (\r\n                      <ItemCard key={letter.id}>\r\n                        <div className=\"flex gap-4\">\r\n                          {/* Avatar */}\r\n                          <div className=\"w-12 h-12 rounded-full overflow-hidden flex-shrink-0 bg-[#18A36C] flex items-center justify-center\">\r\n                            {letter.patient.avatar_url ? (\r\n                              <img\r\n                                src={letter.patient.avatar_url}\r\n                                alt={letter.patient.name}\r\n                                className=\"w-full h-full object-cover\"\r\n                              />\r\n                            ) : (\r\n                              <span className=\"text-sm font-semibold text-white\">\r\n                                {getInitials(letter.patient.name)}\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n\r\n                          {/* Content */}\r\n                          <div className=\"flex-1 min-w-0\">\r\n                            <div className=\"flex items-center gap-2 mb-1\">\r\n                              <h3 className=\"font-semibold text-gray-800 truncate\">{letter.subject}</h3>\r\n                              {!letter.is_read && !letter.reply && (\r\n                                <span className=\"w-2 h-2 bg-amber-500 rounded-full flex-shrink-0\" />\r\n                              )}\r\n                            </div>\r\n                            <p className=\"text-sm text-gray-500 mb-1\">{letter.patient.name}</p>\r\n                            <p className=\"text-xs text-gray-400 flex items-center gap-1\">\r\n                              <Calendar className=\"w-3 h-3\" />\r\n                              {new Date(letter.created_at).toLocaleDateString('ru-RU', {\r\n                                day: 'numeric',\r\n                                month: 'long',\r\n                                year: 'numeric',\r\n                                hour: '2-digit',\r\n                                minute: '2-digit',\r\n                              })}\r\n                            </p>\r\n                          </div>\r\n                        </div>\r\n\r\n                        {/* Preview */}\r\n                        <p className=\"text-sm text-gray-500 line-clamp-2 mt-3\">{letter.content}</p>\r\n\r\n                        {/* Tags */}\r\n                        <div className=\"flex items-center gap-2 mt-3 flex-wrap\">\r\n                          {letter.patient.is_messages_blocked && (\r\n                            <Badge variant=\"danger\">\r\n                              <Ban className=\"w-3 h-3 mr-1\" />\r\n                              Заблокирован\r\n                            </Badge>\r\n                          )}\r\n                          {letter.has_new_patient_message ? (\r\n                            <Badge variant=\"warning\">Новое сообщение</Badge>\r\n                          ) : letter.reply ? (\r\n                            <Badge variant=\"success\">Отвечено</Badge>\r\n                          ) : (\r\n                            <Badge variant=\"warning\">Ожидает ответа</Badge>\r\n                          )}\r\n                          {letter.messages && letter.messages.length > 0 && (\r\n                            <Badge variant=\"secondary\">{letter.messages.length + 1} сообщ.</Badge>\r\n                          )}\r\n                        </div>\r\n\r\n                        {/* Actions */}\r\n                        <div className=\"flex items-center justify-between mt-4 pt-4 border-t border-gray-100\">\r\n                          <button\r\n                            onClick={() => handleViewLetter(letter)}\r\n                            className=\"flex items-center gap-1.5 px-3 py-1.5 bg-[#18A36C] text-white text-sm font-medium rounded-lg hover:bg-[#15905f] transition-colors\"\r\n                          >\r\n                            <Eye className=\"w-4 h-4\" />\r\n                            {letter.reply ? 'Просмотреть' : 'Ответить'}\r\n                          </button>\r\n                          <button\r\n                            onClick={() => handleDelete(letter.id, letter.subject)}\r\n                            className=\"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors\"\r\n                            title=\"Удалить\"\r\n                          >\r\n                            <X className=\"w-4 h-4\" />\r\n                          </button>\r\n                        </div>\r\n                      </ItemCard>\r\n                    ))}\r\n                  </AnimatePresence>\r\n                </div>\r\n\r\n                {/* Pagination */}\r\n                {totalPages > 1 && (\r\n                  <Pagination\r\n                    currentPage={currentPage}\r\n                    totalPages={totalPages}\r\n                    onPageChange={setCurrentPage}\r\n                    className=\"mt-6\"\r\n                  />\r\n                )}\r\n              </>\r\n            )}\r\n          </AdminSection>\r\n\r\n          {/* View/Reply Modal */}\r\n          <AnimatePresence>\r\n            {viewingLetter && (\r\n              <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\r\n                <motion.div\r\n                  initial={{ opacity: 0 }}\r\n                  animate={{ opacity: 1 }}\r\n                  exit={{ opacity: 0 }}\r\n                  onClick={() => !replyLoading && setViewingLetter(null)}\r\n                  className=\"absolute inset-0 bg-black/50 backdrop-blur-sm\"\r\n                />\r\n                <motion.div\r\n                  initial={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                  animate={{ opacity: 1, scale: 1, y: 0 }}\r\n                  exit={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                  className=\"relative w-full max-w-2xl bg-white rounded-2xl shadow-2xl overflow-hidden max-h-[90vh] flex flex-col\"\r\n                >\r\n                  {/* Header */}\r\n                  <div className=\"bg-[#18A36C] px-6 py-4 flex-shrink-0\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <h2 className=\"text-xl font-semibold text-white\">Письмо</h2>\r\n                      <button\r\n                        onClick={() => !replyLoading && setViewingLetter(null)}\r\n                        className=\"p-1.5 hover:bg-white/20 rounded-lg transition-colors\"\r\n                      >\r\n                        <X className=\"w-5 h-5 text-white\" />\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Content */}\r\n                  <div className=\"p-6 overflow-y-auto flex-1\">\r\n                    {/* Sender info */}\r\n                    <div className=\"flex items-start gap-4 mb-4 pb-4 border-b border-gray-100\">\r\n                      <div className=\"w-14 h-14 rounded-full overflow-hidden flex-shrink-0 bg-[#18A36C] flex items-center justify-center\">\r\n                        {viewingLetter.patient.avatar_url ? (\r\n                          <img\r\n                            src={viewingLetter.patient.avatar_url}\r\n                            alt={viewingLetter.patient.name}\r\n                            className=\"w-full h-full object-cover\"\r\n                          />\r\n                        ) : (\r\n                          <span className=\"text-lg font-semibold text-white\">\r\n                            {getInitials(viewingLetter.patient.name)}\r\n                          </span>\r\n                        )}\r\n                      </div>\r\n                      <div className=\"flex-1\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <h3 className=\"font-semibold text-gray-800 text-lg\">{viewingLetter.patient.name}</h3>\r\n                          {viewingLetter.patient.is_messages_blocked && (\r\n                            <span className=\"px-2 py-0.5 bg-red-100 text-red-600 text-xs font-medium rounded-full flex items-center gap-1\">\r\n                              <Ban className=\"w-3 h-3\" />\r\n                              Заблокирован\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n                        <p className=\"text-sm text-gray-500\">{viewingLetter.patient.email}</p>\r\n                        <p className=\"text-sm text-gray-500\">{viewingLetter.patient.phone}</p>\r\n                      </div>\r\n                      <button\r\n                        onClick={() => handleToggleBlock(viewingLetter.patient.id, viewingLetter.patient.is_messages_blocked)}\r\n                        disabled={blockLoading}\r\n                        className={`flex items-center gap-1.5 px-3 py-2 rounded-lg text-sm font-medium transition-colors disabled:opacity-50 ${\r\n                          viewingLetter.patient.is_messages_blocked\r\n                            ? 'bg-green-100 text-green-700 hover:bg-green-200'\r\n                            : 'bg-red-100 text-red-700 hover:bg-red-200'\r\n                        }`}\r\n                        title={viewingLetter.patient.is_messages_blocked ? 'Разблокировать пользователя' : 'Заблокировать пользователя'}\r\n                      >\r\n                        {blockLoading ? (\r\n                          <Loader2 className=\"w-4 h-4 animate-spin\" />\r\n                        ) : viewingLetter.patient.is_messages_blocked ? (\r\n                          <UserCheck className=\"w-4 h-4\" />\r\n                        ) : (\r\n                          <Ban className=\"w-4 h-4\" />\r\n                        )}\r\n                        {viewingLetter.patient.is_messages_blocked ? 'Разблокировать' : 'Заблокировать'}\r\n                      </button>\r\n                    </div>\r\n\r\n                    {/* Subject */}\r\n                    <h4 className=\"font-semibold text-gray-800 text-lg mb-2\">{viewingLetter.subject}</h4>\r\n                    <p className=\"text-xs text-gray-400 mb-4\">\r\n                      {new Date(viewingLetter.created_at).toLocaleDateString('ru-RU', {\r\n                        day: 'numeric',\r\n                        month: 'long',\r\n                        year: 'numeric',\r\n                        hour: '2-digit',\r\n                        minute: '2-digit',\r\n                      })}\r\n                    </p>\r\n\r\n                    {/* Conversation Thread */}\r\n                    <div className=\"space-y-4 mb-6\">\r\n                      {/* Initial message from patient */}\r\n                      <div className=\"flex gap-3\">\r\n                        <div className=\"w-8 h-8 rounded-full overflow-hidden flex-shrink-0 bg-[#18A36C] flex items-center justify-center\">\r\n                          {viewingLetter.patient.avatar_url ? (\r\n                            <img\r\n                              src={viewingLetter.patient.avatar_url}\r\n                              alt={viewingLetter.patient.name}\r\n                              className=\"w-full h-full object-cover\"\r\n                            />\r\n                          ) : (\r\n                            <span className=\"text-xs font-semibold text-white\">\r\n                              {getInitials(viewingLetter.patient.name)}\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n                        <div className=\"flex-1\">\r\n                          <div className=\"bg-gray-100 rounded-xl p-4\">\r\n                            <p className=\"text-gray-700 whitespace-pre-wrap\">{viewingLetter.content}</p>\r\n                          </div>\r\n                          <p className=\"text-xs text-gray-400 mt-1\">\r\n                            {new Date(viewingLetter.created_at).toLocaleDateString('ru-RU', {\r\n                              day: 'numeric',\r\n                              month: 'short',\r\n                              hour: '2-digit',\r\n                              minute: '2-digit',\r\n                            })}\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* First reply - always show if exists */}\r\n                      {viewingLetter.reply && (\r\n                        <div className=\"flex gap-3 justify-end\">\r\n                          <div className=\"flex-1 max-w-[85%]\">\r\n                            <div className=\"bg-[#18A36C]/10 rounded-xl p-4\">\r\n                              <p className=\"text-gray-700 whitespace-pre-wrap\">{viewingLetter.reply}</p>\r\n                            </div>\r\n                            <p className=\"text-xs text-gray-400 mt-1 text-right\">\r\n                              <CheckCircle className=\"w-3 h-3 inline mr-1 text-[#18A36C]\" />\r\n                              Вы, {viewingLetter.replied_at && new Date(viewingLetter.replied_at).toLocaleDateString('ru-RU', {\r\n                                day: 'numeric',\r\n                                month: 'short',\r\n                                hour: '2-digit',\r\n                                minute: '2-digit',\r\n                              })}\r\n                            </p>\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n\r\n                      {/* Thread messages */}\r\n                      {viewingLetter.messages && viewingLetter.messages.map((msg) => (\r\n                        <div key={msg.id} className={`flex gap-3 ${msg.sender_type === 'chief_doctor' ? 'justify-end' : ''}`}>\r\n                          {msg.sender_type === 'patient' && (\r\n                            <div className=\"w-8 h-8 rounded-full overflow-hidden flex-shrink-0 bg-[#18A36C] flex items-center justify-center\">\r\n                              {viewingLetter.patient.avatar_url ? (\r\n                                <img\r\n                                  src={viewingLetter.patient.avatar_url}\r\n                                  alt={viewingLetter.patient.name}\r\n                                  className=\"w-full h-full object-cover\"\r\n                                />\r\n                              ) : (\r\n                                <span className=\"text-xs font-semibold text-white\">\r\n                                  {getInitials(viewingLetter.patient.name)}\r\n                                </span>\r\n                              )}\r\n                            </div>\r\n                          )}\r\n                          <div className={`flex-1 ${msg.sender_type === 'chief_doctor' ? 'max-w-[85%]' : ''}`}>\r\n                            <div className={`rounded-xl p-4 ${msg.sender_type === 'chief_doctor' ? 'bg-[#18A36C]/10' : 'bg-gray-100'}`}>\r\n                              <p className=\"text-gray-700 whitespace-pre-wrap\">{msg.content}</p>\r\n                            </div>\r\n                            <p className={`text-xs text-gray-400 mt-1 ${msg.sender_type === 'chief_doctor' ? 'text-right' : ''}`}>\r\n                              {msg.sender_type === 'chief_doctor' && <CheckCircle className=\"w-3 h-3 inline mr-1 text-[#18A36C]\" />}\r\n                              {msg.sender_type === 'chief_doctor' ? 'Вы' : viewingLetter.patient.name.split(' ')[0]}, {new Date(msg.created_at).toLocaleDateString('ru-RU', {\r\n                                day: 'numeric',\r\n                                month: 'short',\r\n                                hour: '2-digit',\r\n                                minute: '2-digit',\r\n                              })}\r\n                            </p>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n\r\n                    {/* Reply form - always shown for chief doctor */}\r\n                    {isChiefDoctor && (\r\n                      <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                          {viewingLetter.reply ? 'Продолжить переписку' : 'Ваш ответ'}\r\n                        </label>\r\n                        <textarea\r\n                          value={replyText}\r\n                          onChange={(e) => setReplyText(e.target.value)}\r\n                          rows={4}\r\n                          className=\"w-full px-4 py-3 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-[#18A36C]/20 focus:border-[#18A36C] transition-all resize-none\"\r\n                          placeholder=\"Введите ваш ответ пациенту...\"\r\n                        />\r\n                      </div>\r\n                    )}\r\n\r\n                    {/* Not chief doctor warning */}\r\n                    {!isChiefDoctor && (\r\n                      <div className=\"bg-amber-50 border border-amber-200 rounded-xl p-4\">\r\n                        <p className=\"text-amber-700 text-sm\">\r\n                          Только главный врач может отвечать на письма пациентов.\r\n                        </p>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Actions */}\r\n                  {isChiefDoctor && (\r\n                    <div className=\"flex items-center gap-3 p-6 pt-0 flex-shrink-0\">\r\n                      <button\r\n                        onClick={() => setViewingLetter(null)}\r\n                        disabled={replyLoading}\r\n                        className=\"flex-1 px-4 py-2.5 border border-gray-200 text-gray-700 font-medium rounded-xl hover:bg-gray-50 transition-colors disabled:opacity-50\"\r\n                      >\r\n                        Закрыть\r\n                      </button>\r\n                      <button\r\n                        onClick={handleSendReply}\r\n                        disabled={replyLoading || !replyText.trim()}\r\n                        className=\"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-[#18A36C] text-white font-medium rounded-xl hover:bg-[#15905f] transition-colors disabled:opacity-50\"\r\n                      >\r\n                        {replyLoading ? (\r\n                          <Loader2 className=\"w-4 h-4 animate-spin\" />\r\n                        ) : (\r\n                          <Send className=\"w-4 h-4\" />\r\n                        )}\r\n                        Отправить\r\n                      </button>\r\n                    </div>\r\n                  )}\r\n                </motion.div>\r\n              </div>\r\n            )}\r\n          </AnimatePresence>\r\n\r\n          {/* Confirm Dialog */}\r\n          <ConfirmDialog\r\n            isOpen={confirmDialog.isOpen}\r\n            onClose={confirmDialog.handleCancel}\r\n            onConfirm={confirmDialog.handleConfirm}\r\n            title={confirmDialog.options.title}\r\n            message={confirmDialog.options.message}\r\n            confirmText={confirmDialog.options.confirmText}\r\n            cancelText={confirmDialog.options.cancelText}\r\n            variant={confirmDialog.options.variant}\r\n            loading={confirmDialog.loading}\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}