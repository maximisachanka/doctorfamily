module.exports=[60514,a=>{"use strict";var b=a.i(87924),c=a.i(72131);let d=(0,c.createContext)(void 0);function e({children:a}){let{counts:e,loading:f,refetch:g}=function(a=3e4){let[b,d]=(0,c.useState)({feedbacks:0,letters:0,chats:0}),[e,f]=(0,c.useState)(!0),g=async()=>{try{let a=await fetch("/api/admin/unread-counts");if(a.ok){let b=await a.json();d(b)}}catch(a){console.error("Error fetching unread counts:",a)}finally{f(!1)}};return(0,c.useEffect)(()=>{g();let b=setInterval(g,a);return()=>clearInterval(b)},[a]),{counts:b,loading:e,refetch:g}}(3e4);return(0,b.jsx)(d.Provider,{value:{counts:e,loading:f,refetch:g},children:a})}function f(){let a=(0,c.useContext)(d);return a||{counts:{feedbacks:0,letters:0,chats:0},loading:!1,refetch:async()=>{}}}a.s(["UnreadCountsProvider",()=>e,"useUnreadCountsContext",()=>f],60514)},83492,a=>{"use strict";var b=a.i(87924),c=a.i(75003),d=a.i(25170),e=a.i(60514),f=a.i(72131),g=a.i(50944);let h="chat-notifications-notified";function i({children:a}){return!function(){let{data:a,status:b}=(0,c.useSession)(),e=(0,g.usePathname)(),i=(0,d.useAlert)(),j=(0,f.useRef)(null),k=(0,f.useRef)(null),l=(0,f.useRef)(!1);(0,f.useEffect)(()=>{l.current=e?.startsWith("/admin")||!1},[e]),(0,f.useEffect)(()=>{},[]);let m=(0,f.useCallback)(()=>{k.current&&(k.current.currentTime=0,k.current.play().catch(()=>{}))},[]),n=(0,f.useCallback)(async()=>{if("authenticated"===b&&a&&l.current)try{let a=await fetch("/api/operator-chat?unread_only=true");if(!a.ok)return;let b=(await a.json()).chats||[];if(0===b.length)return;let c=JSON.parse(localStorage.getItem(h)||"[]"),d=b.filter(a=>!c.includes(a.id));if(d.length>0){if(m(),1===d.length){let a=d[0],b=a.messages[0]?.content||"",c=b.length>50?b.substring(0,50)+"...":b;i.info(`Новое сообщение от ${a.patient.name}: "${c}"`,"Новое сообщение в чате")}else i.info(`У вас ${d.length} новых сообщений в чате. Проверьте раздел "Чат".`,"Новые сообщения");let a=[...c,...d.map(a=>a.id)];localStorage.setItem(h,JSON.stringify(a))}}catch(a){console.error("Error checking for chat notifications:",a)}},[a,b,i,m]);(0,f.useEffect)(()=>{if("authenticated"!==b||!l.current)return;let a=setTimeout(()=>{n()},2e3);return()=>clearTimeout(a)},[b,e,n]),(0,f.useEffect)(()=>{if("authenticated"!==b||!l.current){j.current&&(clearInterval(j.current),j.current=null);return}return j.current=setInterval(n,15e3),()=>{j.current&&(clearInterval(j.current),j.current=null)}},[b,e,n])}(),(0,b.jsx)(b.Fragment,{children:a})}function j({children:a}){return(0,b.jsx)(c.SessionProvider,{children:(0,b.jsx)(d.AlertProvider,{children:(0,b.jsx)(e.UnreadCountsProvider,{children:(0,b.jsx)(i,{children:(0,b.jsx)("div",{className:"min-h-screen bg-gray-50",children:a})})})})})}a.s(["AdminProviders",()=>j],83492)}];

//# sourceMappingURL=src_38f4de29._.js.map