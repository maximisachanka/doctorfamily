(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,71689,e=>{"use strict";let s=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>s],71689)},18050,e=>{"use strict";var s=e.i(43476),a=e.i(73375),r=e.i(63059),t=e.i(26299);function i({currentPage:e,totalPages:i,onPageChange:l,className:n=""}){if(i<=1)return null;let c=(()=>{let s=[];if(i<=5)for(let e=1;e<=i;e++)s.push(e);else{s.push(1),e>3&&s.push("...");let a=Math.max(2,e-1),r=Math.min(i-1,e+1);for(let e=a;e<=r;e++)s.push(e);e<i-2&&s.push("..."),s.push(i)}return s})();return(0,s.jsxs)("div",{className:`flex items-center justify-center gap-2 ${n}`,children:[(0,s.jsx)(t.Button,{onClick:()=>l(e-1),disabled:1===e,variant:"outline",className:"h-10 w-10 p-0 border-gray-300 hover:bg-gray-50 disabled:opacity-50 cursor-pointer disabled:cursor-not-allowed hidden sm:flex items-center justify-center",children:(0,s.jsx)(a.ChevronLeft,{className:"w-5 h-5"})}),(0,s.jsxs)("div",{className:"flex sm:hidden items-center gap-2",children:[(0,s.jsx)(t.Button,{onClick:()=>l(e-1),disabled:1===e,variant:"outline",className:"h-10 px-3 border-gray-300 hover:bg-gray-50 disabled:opacity-50 cursor-pointer disabled:cursor-not-allowed",children:(0,s.jsx)(a.ChevronLeft,{className:"w-4 h-4"})}),(0,s.jsxs)("span",{className:"text-sm text-gray-700 min-w-[80px] text-center",children:[e," / ",i]}),(0,s.jsx)(t.Button,{onClick:()=>l(e+1),disabled:e===i,variant:"outline",className:"h-10 px-3 border-gray-300 hover:bg-gray-50 disabled:opacity-50 cursor-pointer disabled:cursor-not-allowed",children:(0,s.jsx)(r.ChevronRight,{className:"w-4 h-4"})})]}),(0,s.jsx)("div",{className:"hidden sm:flex items-center gap-2",children:c.map((a,r)=>{if("..."===a)return(0,s.jsx)("span",{className:"px-2 text-gray-500",children:"..."},`ellipsis-${r}`);let i=a===e;return(0,s.jsx)(t.Button,{onClick:()=>l(a),variant:i?"default":"outline",className:`h-10 w-10 p-0 cursor-pointer ${i?"bg-[#18A36C] hover:bg-[#18A36C]/90 text-white border-[#18A36C]":"border-gray-300 hover:bg-gray-50 text-gray-700"}`,children:a},a)})}),(0,s.jsx)(t.Button,{onClick:()=>l(e+1),disabled:e===i,variant:"outline",className:"h-10 w-10 p-0 border-gray-300 hover:bg-gray-50 disabled:opacity-50 cursor-pointer disabled:cursor-not-allowed hidden sm:flex items-center justify-center",children:(0,s.jsx)(r.ChevronRight,{className:"w-5 h-5"})})]})}e.s(["Pagination",()=>i])},73250,e=>{"use strict";var s=e.i(43476);function a({className:e=""}){return(0,s.jsx)("div",{className:`animate-pulse bg-gray-200 rounded ${e}`})}function r(){return(0,s.jsxs)("div",{className:"bg-white rounded-xl p-5 border border-gray-100 shadow-sm",children:[(0,s.jsxs)("div",{className:"flex gap-4 mb-4",children:[(0,s.jsx)(a,{className:"w-16 h-16 rounded-xl flex-shrink-0"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0 space-y-2",children:[(0,s.jsx)(a,{className:"h-5 w-3/4"}),(0,s.jsx)(a,{className:"h-4 w-full"}),(0,s.jsx)(a,{className:"h-4 w-2/3"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,s.jsx)(a,{className:"h-6 w-20 rounded-full"}),(0,s.jsx)(a,{className:"h-6 w-16 rounded-full"})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100",children:[(0,s.jsx)(a,{className:"h-4 w-24"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(a,{className:"h-8 w-8 rounded-lg"}),(0,s.jsx)(a,{className:"h-8 w-8 rounded-lg"})]})]})]})}function t({count:e=12}){return(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:Array.from({length:e}).map((e,a)=>(0,s.jsx)(r,{},a))})}function i(){return(0,s.jsxs)("div",{className:"bg-white rounded-xl p-5 border border-gray-100 shadow-sm",children:[(0,s.jsxs)("div",{className:"flex gap-4 mb-3",children:[(0,s.jsx)(a,{className:"w-14 h-14 rounded-full flex-shrink-0"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0 space-y-2",children:[(0,s.jsx)(a,{className:"h-5 w-2/5"}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(a,{className:"h-4 w-24"}),(0,s.jsx)(a,{className:"h-3 w-20"})]}),(0,s.jsx)(a,{className:"h-4 w-full"}),(0,s.jsx)(a,{className:"h-4 w-4/5"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,s.jsx)(a,{className:"h-6 w-32 rounded-full"}),(0,s.jsx)(a,{className:"h-6 w-28 rounded-full"})]}),(0,s.jsx)("div",{className:"flex items-center justify-end pt-4 border-t border-gray-100",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(a,{className:"h-8 w-8 rounded-lg"}),(0,s.jsx)(a,{className:"h-8 w-8 rounded-lg"})]})})]})}function l({count:e=12}){return(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Array.from({length:e}).map((e,a)=>(0,s.jsx)(i,{},a))})}function n(){return(0,s.jsx)("div",{className:"bg-white rounded-xl p-5 border border-gray-100 shadow-sm",children:(0,s.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(a,{className:"h-5 w-3/4 mb-2"}),(0,s.jsx)(a,{className:"h-4 w-full mb-2"}),(0,s.jsx)(a,{className:"h-4 w-5/6 mb-3"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(a,{className:"h-6 w-24 rounded-full"}),(0,s.jsx)(a,{className:"h-6 w-32 rounded-full"})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(a,{className:"h-8 w-8 rounded-lg"}),(0,s.jsx)(a,{className:"h-8 w-8 rounded-lg"})]})]})})}function c({count:e=12}){return(0,s.jsx)("div",{className:"space-y-4",children:Array.from({length:e}).map((e,a)=>(0,s.jsx)(n,{},a))})}function o(){return(0,s.jsxs)("div",{className:"bg-white rounded-2xl p-6 lg:p-8 border border-gray-100",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-8",children:[(0,s.jsx)(a,{className:"w-12 h-12 rounded-xl"}),(0,s.jsxs)("div",{children:[(0,s.jsx)(a,{className:"h-7 w-40 mb-2"}),(0,s.jsx)(a,{className:"h-4 w-64"})]})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[Array.from({length:7}).map((e,r)=>(0,s.jsxs)("div",{children:[(0,s.jsx)(a,{className:"h-4 w-32 mb-2"}),(0,s.jsx)(a,{className:"h-11 w-full rounded-lg"})]},r)),(0,s.jsx)("div",{className:"pt-4",children:(0,s.jsx)(a,{className:"h-11 w-48 rounded-lg"})})]})]})}function d(){return(0,s.jsxs)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 backdrop-blur-md",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-white/50 backdrop-blur-sm"}),(0,s.jsxs)("div",{className:"relative z-10 text-center",children:[(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)("div",{className:"w-16 h-16 mx-auto border-4 border-gray-200 border-t-[#18A36C] rounded-full animate-spin"})}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:"Проверка доступа..."}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Пожалуйста, подождите"})]}),(0,s.jsxs)("div",{className:"flex justify-center gap-2 mt-6",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-[#18A36C] rounded-full animate-pulse",style:{animationDelay:"0ms"}}),(0,s.jsx)("div",{className:"w-2 h-2 bg-[#18A36C] rounded-full animate-pulse",style:{animationDelay:"150ms"}}),(0,s.jsx)("div",{className:"w-2 h-2 bg-[#18A36C] rounded-full animate-pulse",style:{animationDelay:"300ms"}})]})]})]})}e.s(["AdminAccessSkeleton",()=>d,"AdminContactsSkeleton",()=>o,"AdminFeedbacksGridSkeleton",()=>l,"AdminGridSkeleton",()=>t,"AdminQuestionsGridSkeleton",()=>c])},81997,e=>{"use strict";let s=(0,e.i(75254).default)("messages-square",[["path",{d:"M16 10a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 14.286V4a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z",key:"1n2ejm"}],["path",{d:"M20 9a2 2 0 0 1 2 2v10.286a.71.71 0 0 1-1.212.502l-2.202-2.202A2 2 0 0 0 17.172 19H10a2 2 0 0 1-2-2v-1",key:"1qfcsi"}]]);e.s(["MessagesSquare",()=>s],81997)},31961,e=>{"use strict";var s=e.i(43476),a=e.i(91918),r=e.i(25913),t=e.i(80809);let i=(0,r.cva)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function l({className:e,variant:r,asChild:l=!1,...n}){let c=l?a.Slot:"span";return(0,s.jsx)(c,{"data-slot":"badge",className:(0,t.cn)(i({variant:r}),e),...n})}e.s(["Badge",()=>l])},47865,e=>{"use strict";var s=e.i(18566),a=e.i(71645);function r(t=12){let i=function(){try{let{useSearchParams:s}=e.r(18566);return s()}catch{return null}}(),l=(0,s.useRouter)(),n=(0,s.usePathname)(),c=(0,a.useMemo)(()=>{if(!i)return 1;let e=i.get("p"),s=e?parseInt(e,10):1;return s>0?s:1},[i]),o=(0,a.useCallback)(e=>{let s=new URLSearchParams(i?.toString()||"");1===e?s.delete("p"):s.set("p",e.toString());let a=s.toString(),r=a?`${n}?${a}`:n;l.replace(r,{scroll:!1})},[i,n,l]),d=(0,a.useCallback)(e=>{let s=Math.ceil(e.length/t),a=(c-1)*t,r=a+t;return{paginatedData:e.slice(a,r),totalPages:s,startIndex:a,endIndex:r}},[c,t]);return{currentPage:c,setPage:o,paginateData:d,itemsPerPage:t}}e.s(["useUrlPagination",()=>r])},84348,e=>{"use strict";var s=e.i(43476),a=e.i(71645),r=e.i(17255),t=e.i(18566),i=e.i(73250),l=e.i(81997),n=e.i(3116),c=e.i(84614),o=e.i(94771),d=e.i(94983),m=e.i(23622);let x=(0,e.i(75254).default)("user-x",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);var h=e.i(31278),u=e.i(71689),g=e.i(31961),p=e.i(26299),f=e.i(46932),b=e.i(88653),j=e.i(37727),y=e.i(14764),N=e.i(31245),w=e.i(27612),v=e.i(86633);let C="chat-notifications-notified";function k({chatId:e,onClose:r}){let[t,i]=(0,a.useState)(null),[l,d]=(0,a.useState)(!0),[u,k]=(0,a.useState)(""),[A,S]=(0,a.useState)(!1),[_,E]=(0,a.useState)(!1),[L,B]=(0,a.useState)(!1),[T,I]=(0,a.useState)(!1),[D,O]=(0,a.useState)(!1),P=(0,a.useRef)(null),$=(0,v.useAlert)(),M=(0,a.useCallback)(async()=>{try{let s=await fetch(`/api/operator-chat/${e}`);if(s.ok){let a,r=await s.json();i(r.chat),a=JSON.parse(localStorage.getItem(C)||"[]").filter(s=>s!==e),localStorage.setItem(C,JSON.stringify(a))}else $.error("Не удалось загрузить чат","Ошибка")}catch(e){console.error("Error loading chat:",e),$.error("Ошибка при загрузке чата","Ошибка")}finally{d(!1)}},[e,$]);(0,a.useEffect)(()=>{M()},[M]),(0,a.useEffect)(()=>{t&&P.current?.scrollIntoView({behavior:"smooth"})},[t?.messages]);let G=async()=>{try{(await fetch(`/api/operator-chat/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"take"})})).ok?($.success("Вы взяли чат","Успех"),M()):$.error("Не удалось взять чат","Ошибка")}catch(e){console.error("Error taking chat:",e),$.error("Ошибка при взятии чата","Ошибка")}},V=async()=>{try{(await fetch(`/api/operator-chat/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"CLOSED"})})).ok?($.success("Чат закрыт","Успех"),r()):$.error("Не удалось закрыть чат","Ошибка")}catch(e){console.error("Error closing chat:",e),$.error("Ошибка при закрытии чата","Ошибка")}},U=async()=>{if(!t||L)return;let s=t.patient.is_messages_blocked?"unblock":"block";B(!0);try{let a=await fetch(`/api/operator-chat/${e}/block`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:s})}),t=await a.json();a.ok?($.success("block"===s?"Пользователь заблокирован и все его чаты удалены":"Пользователь разблокирован","Успех"),"block"===s?r():(await M(),E(!1))):$.error(t.error||"Не удалось "+("block"===s?"заблокировать":"разблокировать")+" пользователя","Ошибка")}catch(e){console.error("Error blocking/unblocking user:",e),$.error("Ошибка при блокировке/разблокировке","Ошибка")}finally{B(!1)}},z=async()=>{if(t&&!D){O(!0);try{let s=await fetch(`/api/operator-chat/${e}`,{method:"DELETE"}),a=await s.json();s.ok?($.success("Чат удален","Успех"),r()):$.error(a.error||"Не удалось удалить чат","Ошибка")}catch(e){console.error("Error deleting chat:",e),$.error("Ошибка при удалении чата","Ошибка")}finally{O(!1)}}},R=async()=>{if(u.trim()&&!A){S(!0);try{let s=await fetch(`/api/operator-chat/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:u.trim()})});if(s.ok)k(""),M();else{let e=await s.json();$.error(e.error||"Не удалось отправить сообщение","Ошибка")}}catch(e){console.error("Error sending message:",e),$.error("Ошибка при отправке сообщения","Ошибка")}finally{S(!1)}}};return(0,s.jsx)(b.AnimatePresence,{children:(0,s.jsxs)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[(0,s.jsx)(f.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:r,className:"absolute inset-0 bg-black/50 backdrop-blur-sm"}),(0,s.jsx)(f.motion.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative z-10 w-full max-w-3xl bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[80vh]",children:l?(0,s.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,s.jsx)(h.Loader2,{className:"w-8 h-8 text-[#18A36C] animate-spin"})}):t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"bg-white border-b border-gray-200 p-4 sm:p-6 flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 sm:gap-4 min-w-0",children:[t.patient.avatar_url?(0,s.jsx)("img",{src:t.patient.avatar_url,alt:t.patient.name,className:"w-12 h-12 sm:w-14 sm:h-14 rounded-full object-cover border-2 border-gray-200 flex-shrink-0"}):(0,s.jsx)("div",{className:"w-12 h-12 sm:w-14 sm:h-14 bg-gradient-to-br from-[#18A36C] to-[#15905f] rounded-full flex items-center justify-center shadow-md flex-shrink-0",children:(0,s.jsx)(c.User,{className:"w-6 h-6 sm:w-7 sm:h-7 text-white"})}),(0,s.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,s.jsx)("h2",{className:"text-lg sm:text-xl font-bold text-gray-900 truncate",children:t.patient.name}),(0,s.jsx)("p",{className:"text-gray-600 text-xs sm:text-sm truncate",children:t.patient.email}),(0,s.jsxs)("div",{className:"mt-1.5 flex items-center gap-2 flex-wrap",children:[(e=>{switch(e){case"WAITING":return(0,s.jsx)(g.Badge,{variant:"outline",className:"border-amber-400 text-amber-700 bg-amber-50",children:"Ожидает"});case"ACTIVE":return(0,s.jsx)(g.Badge,{variant:"default",className:"bg-[#18A36C] text-white border-transparent shadow-sm",children:"Активный"});case"CLOSED":return(0,s.jsx)(g.Badge,{variant:"secondary",className:"bg-gray-200 text-gray-700",children:"Закрыт"});default:return null}})(t.status),t.patient.is_messages_blocked&&(0,s.jsxs)(g.Badge,{variant:"secondary",className:"bg-gray-700 text-white text-xs",children:[(0,s.jsx)(m.Ban,{className:"w-3 h-3 mr-1"}),"Заблокирован"]})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:["CLOSED"!==t.status&&(0,s.jsxs)(s.Fragment,{children:["WAITING"===t.status&&(0,s.jsx)(p.Button,{onClick:G,className:"bg-[#18A36C] text-white hover:bg-[#15905f] shadow-sm cursor-pointer",children:"Взять чат"}),"ACTIVE"===t.status&&(0,s.jsx)(p.Button,{onClick:V,variant:"outline",className:"text-gray-700 border-gray-300 cursor-pointer",children:"Закрыть чат"})]}),(0,s.jsx)("button",{onClick:()=>{I(!0)},title:"Удалить чат",className:"w-10 h-10 rounded-lg flex items-center justify-center transition-all bg-red-50 text-red-600 hover:bg-red-100 cursor-pointer",children:(0,s.jsx)(w.Trash2,{className:"w-5 h-5"})}),(0,s.jsx)("button",{onClick:()=>{t&&E(!0)},title:t.patient.is_messages_blocked?"Разблокировать":"Заблокировать",className:`w-10 h-10 rounded-lg flex items-center justify-center transition-all cursor-pointer ${t.patient.is_messages_blocked?"bg-[#18A36C]/10 text-[#18A36C] hover:bg-[#18A36C]/20":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:t.patient.is_messages_blocked?(0,s.jsx)(x,{className:"w-5 h-5"}):(0,s.jsx)(m.Ban,{className:"w-5 h-5"})}),(0,s.jsx)("button",{onClick:r,className:"w-10 h-10 rounded-lg bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600 transition-colors cursor-pointer",children:(0,s.jsx)(j.X,{className:"w-5 h-5"})})]})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-4 bg-gradient-to-b from-gray-50 to-white",children:[t.messages.map(e=>(0,s.jsxs)(f.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex gap-3 ${"operator"===e.sender_type?"flex-row-reverse":""}`,children:[e.sender.avatar_url?(0,s.jsx)("img",{src:e.sender.avatar_url,alt:e.sender.name,className:"w-10 h-10 rounded-full object-cover flex-shrink-0 shadow-sm"}):(0,s.jsx)("div",{className:`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 shadow-sm ${"operator"===e.sender_type?"bg-gradient-to-br from-[#18A36C] to-[#15905f]":"bg-gradient-to-br from-gray-400 to-gray-500"}`,children:"operator"===e.sender_type?(0,s.jsx)(N.Bot,{className:"w-5 h-5 text-white"}):(0,s.jsx)(c.User,{className:"w-5 h-5 text-white"})}),(0,s.jsxs)("div",{className:`max-w-[70%] ${"operator"===e.sender_type?"items-end":"items-start"} flex flex-col`,children:[(0,s.jsx)("div",{className:`rounded-2xl p-4 shadow-sm ${"operator"===e.sender_type?"bg-gradient-to-br from-[#18A36C] to-[#15905f] text-white":"bg-white text-gray-800 border border-gray-200"}`,children:(0,s.jsx)("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:e.content})}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-1.5 px-2",children:[(0,s.jsx)(n.Clock,{className:"w-3 h-3 text-gray-400"}),(0,s.jsx)("span",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}),"operator"===e.sender_type&&e.is_read&&(0,s.jsx)(o.CheckCheck,{className:"w-4 h-4 text-[#18A36C]"})]})]})]},e.id)),(0,s.jsx)("div",{ref:P})]}),"CLOSED"!==t.status&&(0,s.jsx)("div",{className:"p-4 bg-white border-t border-gray-200",children:(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("input",{type:"text",value:u,onChange:e=>k(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),R())},placeholder:"Напишите сообщение...",disabled:A,className:"flex-1 px-4 py-3 bg-gray-50 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-[#18A36C] focus:border-transparent transition-all disabled:opacity-50"}),(0,s.jsx)("button",{onClick:R,disabled:A||!u.trim(),className:"w-12 h-12 bg-gradient-to-br from-[#18A36C] to-[#15905f] rounded-xl flex items-center justify-center text-white hover:shadow-md hover:scale-105 transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 cursor-pointer",children:A?(0,s.jsx)(h.Loader2,{className:"w-5 h-5 animate-spin"}):(0,s.jsx)(y.Send,{className:"w-5 h-5"})})]})})]}):(0,s.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,s.jsx)("p",{className:"text-gray-600",children:"Чат не найден"})})}),_&&t&&(0,s.jsx)(f.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-20 flex items-center justify-center bg-black/40 backdrop-blur-sm",onClick:()=>E(!1),children:(0,s.jsxs)(f.motion.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},onClick:e=>e.stopPropagation(),className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden",children:[(0,s.jsx)("div",{className:`p-6 ${(t.patient.is_messages_blocked,"bg-gradient-to-r from-[#18A36C] to-[#15905f]")}`,children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center",children:t.patient.is_messages_blocked?(0,s.jsx)(x,{className:"w-6 h-6 text-white"}):(0,s.jsx)(m.Ban,{className:"w-6 h-6 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-white",children:t.patient.is_messages_blocked?"Разблокировать пользователя?":"Заблокировать пользователя?"}),(0,s.jsx)("p",{className:"text-sm text-white/80",children:t.patient.name})]})]})}),(0,s.jsx)("div",{className:"p-6",children:(0,s.jsx)("p",{className:"text-gray-700 leading-relaxed",children:t.patient.is_messages_blocked?"Пользователь сможет снова создавать новые чаты и отправлять сообщения.":"Пользователь не сможет создавать новые чаты и отправлять сообщения. Все его чаты будут удалены."})}),(0,s.jsxs)("div",{className:"px-6 pb-6 flex gap-3 justify-end",children:[(0,s.jsx)(p.Button,{variant:"outline",onClick:()=>E(!1),disabled:L,className:"border-gray-300 text-gray-700 hover:bg-gray-50 cursor-pointer",children:"Отмена"}),(0,s.jsxs)(p.Button,{onClick:U,disabled:L,className:t.patient.is_messages_blocked?"bg-[#18A36C] hover:bg-[#15905f] text-white shadow-md flex items-center gap-2 cursor-pointer":"bg-gray-700 hover:bg-gray-800 text-white shadow-md flex items-center gap-2 cursor-pointer",children:[L&&(0,s.jsx)(h.Loader2,{className:"w-4 h-4 animate-spin"}),t.patient.is_messages_blocked?"Разблокировать":"Заблокировать"]})]})]})}),T&&t&&(0,s.jsx)(f.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-20 flex items-center justify-center bg-black/40 backdrop-blur-sm",onClick:()=>I(!1),children:(0,s.jsxs)(f.motion.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},onClick:e=>e.stopPropagation(),className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden",children:[(0,s.jsx)("div",{className:"p-6 bg-gradient-to-r from-red-500 to-red-600",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center",children:(0,s.jsx)(w.Trash2,{className:"w-6 h-6 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-white",children:"Удалить чат?"}),(0,s.jsx)("p",{className:"text-sm text-white/80",children:t.patient.name})]})]})}),(0,s.jsx)("div",{className:"p-6",children:(0,s.jsx)("p",{className:"text-gray-700 leading-relaxed",children:"Все сообщения в этом чате будут удалены безвозвратно. Это действие нельзя отменить."})}),(0,s.jsxs)("div",{className:"px-6 pb-6 flex gap-3 justify-end",children:[(0,s.jsx)(p.Button,{variant:"outline",onClick:()=>I(!1),disabled:D,className:"border-gray-300 text-gray-700 hover:bg-gray-50 cursor-pointer",children:"Отмена"}),(0,s.jsxs)(p.Button,{onClick:z,disabled:D,className:"bg-red-500 hover:bg-red-600 text-white shadow-md flex items-center gap-2 cursor-pointer",children:[D&&(0,s.jsx)(h.Loader2,{className:"w-4 h-4 animate-spin"}),"Удалить"]})]})]})})]})})}var A=e.i(18050),S=e.i(47865);function _(){let{data:e,status:f}=(0,r.useSession)(),b=(0,t.useRouter)(),j=(0,v.useAlert)(),[y,N]=(0,a.useState)(null),[w,C]=(0,a.useState)(!0),[_,E]=(0,a.useState)([]),[L,B]=(0,a.useState)([]),[T,I]=(0,a.useState)(!0),[D,O]=(0,a.useState)(null),[P,$]=(0,a.useState)("ALL"),[M,G]=(0,a.useState)(null),{currentPage:V,setPage:U,paginateData:z}=(0,S.useUrlPagination)(9),R=(0,a.useCallback)(async()=>{C(!0);try{let e=await fetch("/api/admin/auth"),s=await e.json();N(s.isAdmin||!1)}catch(e){console.error("Error checking admin role:",e),N(!1)}finally{C(!1)}},[]);(0,a.useEffect)(()=>{"authenticated"===f?R():"unauthenticated"===f&&(C(!1),N(!1))},[f,R]);let W=(0,a.useCallback)(async()=>{try{I(!0);let e=await fetch("/api/operator-chat");if(e.ok){let s=await e.json();E(s.chats||[])}else j.error("Не удалось загрузить чаты","Ошибка")}catch(e){console.error("Error loading chats:",e),j.error("Ошибка при загрузке чатов","Ошибка")}finally{I(!1)}},[j]),H=(0,a.useCallback)(async()=>{try{let e=await fetch("/api/admin/blocked-users");if(e.ok){let s=await e.json();B(s.users||[])}else j.error("Не удалось загрузить заблокированных пользователей","Ошибка")}catch(e){console.error("Error loading blocked users:",e),j.error("Ошибка при загрузке заблокированных пользователей","Ошибка")}},[j]),K=async e=>{G(e);try{let s=await fetch("/api/admin/blocked-users",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:e})});if(s.ok)j.success("Пользователь разблокирован","Успех"),H();else{let e=await s.json();j.error(e.error||"Не удалось разблокировать пользователя","Ошибка")}}catch(e){console.error("Error unblocking user:",e),j.error("Ошибка при разблокировке пользователя","Ошибка")}finally{G(null)}};if((0,a.useEffect)(()=>{y&&(W(),H())},[y,W,H]),(0,a.useEffect)(()=>{"unauthenticated"===f&&b.push("/account?section=login")},[f,b]),(0,a.useEffect)(()=>{U(1)},[P]),"loading"===f||null===y||w)return(0,s.jsx)(i.AdminAccessSkeleton,{});if(!y)return b.push("/"),(0,s.jsx)(i.AdminAccessSkeleton,{});let J="ALL"===P?_:_.filter(e=>e.status===P),q=_.filter(e=>"WAITING"===e.status).length,F=_.filter(e=>"ACTIVE"===e.status).length,Q=L.length,X=Math.ceil(J.length/9),Y=J.slice((V-1)*9,9*V),Z=Math.ceil(L.length/9),ee=L.slice((V-1)*9,9*V);return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-6 lg:py-8",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-[#18A36C] to-[#15905f] rounded-xl flex items-center justify-center shadow-md",children:(0,s.jsx)(l.MessagesSquare,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"Чат с пациентами"}),(0,s.jsx)("p",{className:"text-xs sm:text-sm text-gray-600",children:"Управление обращениями"})]})]}),(0,s.jsxs)(p.Button,{variant:"outline",onClick:()=>b.push("/admin"),className:"flex items-center gap-2 hover:bg-gray-50 self-start sm:self-auto cursor-pointer",children:[(0,s.jsx)(u.ArrowLeft,{className:"w-4 h-4"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Назад в админ-панель"}),(0,s.jsx)("span",{className:"sm:hidden",children:"Назад"})]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,s.jsxs)(p.Button,{variant:"ALL"===P?"default":"outline",onClick:()=>$("ALL"),className:"ALL"===P?"bg-[#18A36C] hover:bg-[#15905f] shadow-sm text-white cursor-pointer":"hover:bg-gray-50 cursor-pointer",children:["Все (",_.length,")"]}),(0,s.jsxs)(p.Button,{variant:"WAITING"===P?"default":"outline",onClick:()=>$("WAITING"),className:"WAITING"===P?"bg-[#18A36C] hover:bg-[#15905f] shadow-sm text-white cursor-pointer":"hover:bg-gray-50 cursor-pointer",children:["Ожидают (",q,")"]}),(0,s.jsxs)(p.Button,{variant:"ACTIVE"===P?"default":"outline",onClick:()=>$("ACTIVE"),className:"ACTIVE"===P?"bg-[#18A36C] hover:bg-[#15905f] shadow-sm text-white cursor-pointer":"hover:bg-gray-50 cursor-pointer",children:["Активные (",F,")"]}),(0,s.jsx)(p.Button,{variant:"CLOSED"===P?"default":"outline",onClick:()=>$("CLOSED"),className:"CLOSED"===P?"bg-[#18A36C] hover:bg-[#15905f] shadow-sm text-white cursor-pointer":"hover:bg-gray-50 cursor-pointer",children:"Закрытые"}),(0,s.jsxs)(p.Button,{variant:"BLOCKED"===P?"default":"outline",onClick:()=>$("BLOCKED"),className:"BLOCKED"===P?"bg-red-500 hover:bg-red-600 shadow-sm text-white cursor-pointer":"hover:bg-gray-50 text-red-600 border-red-300 cursor-pointer",children:["Заблокированные (",Q,")"]})]})]}),T?(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(e=>(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 border border-gray-200 animate-pulse",children:[(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-4"}),(0,s.jsx)("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]},e))}):"BLOCKED"===P?0===L.length?(0,s.jsxs)("div",{className:"bg-white rounded-lg p-12 text-center border border-gray-200",children:[(0,s.jsx)(d.MessageCircle,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Нет заблокированных пользователей"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Заблокированные пользователи появятся здесь"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:ee.map(e=>(0,s.jsxs)("div",{className:"bg-white rounded-xl p-5 border-2 border-red-300 bg-red-50/20 shadow-sm",children:[(0,s.jsx)("div",{className:"flex items-start justify-between mb-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[e.avatar_url?(0,s.jsx)("img",{src:e.avatar_url,alt:e.name,className:"w-12 h-12 rounded-full object-cover shadow-sm"}):(0,s.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-gray-400 to-gray-500 rounded-full flex items-center justify-center shadow-sm",children:(0,s.jsx)(c.User,{className:"w-6 h-6 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:e.name}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:e.email})]})]})}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)(g.Badge,{variant:"secondary",className:"bg-red-100 text-red-700 border-red-300 mb-2",children:[(0,s.jsx)(m.Ban,{className:"w-3 h-3 mr-1"}),"Заблокирован"]}),e.phone&&(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:e.phone})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1.5 text-xs text-gray-500",children:[(0,s.jsx)(n.Clock,{className:"w-3.5 h-3.5"}),(0,s.jsx)("span",{children:new Date(e.registration_date).toLocaleDateString("ru-RU")})]}),(0,s.jsxs)(p.Button,{onClick:()=>K(e.id),disabled:M===e.id,className:"bg-[#18A36C] hover:bg-[#15905f] text-white text-xs px-3 py-1.5 flex items-center gap-1.5 cursor-pointer",children:[M===e.id?(0,s.jsx)(h.Loader2,{className:"w-3.5 h-3.5 animate-spin"}):(0,s.jsx)(x,{className:"w-3.5 h-3.5"}),"Разблокировать"]})]})]},e.id))}),Z>1&&(0,s.jsx)(A.Pagination,{currentPage:V,totalPages:Z,onPageChange:U,className:"mt-6"})]}):0===J.length?(0,s.jsxs)("div",{className:"bg-white rounded-lg p-12 text-center border border-gray-200",children:[(0,s.jsx)(d.MessageCircle,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,s.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:["ALL"===P&&"Нет чатов","WAITING"===P&&"Нет ожидающих чатов","ACTIVE"===P&&"Нет активных чатов","CLOSED"===P&&"Нет закрытых чатов"]}),(0,s.jsxs)("p",{className:"text-gray-600",children:["WAITING"===P&&"Когда пациенты напишут, их чаты появятся здесь","ACTIVE"===P&&"Нет активных чатов в данный момент","CLOSED"===P&&"Нет закрытых чатов","ALL"===P&&"Чаты появятся когда пациенты начнут писать"]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Y.map(e=>(0,s.jsxs)("div",{className:`bg-white rounded-xl p-5 border-2 transition-all cursor-pointer ${e.has_unread_operator?"border-[#18A36C] bg-[#18A36C]/5 shadow-sm hover:shadow-md":"border-gray-200 hover:border-[#18A36C]/50 hover:shadow-md"}`,onClick:()=>O(e.id),children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[e.patient.avatar_url?(0,s.jsx)("img",{src:e.patient.avatar_url,alt:e.patient.name,className:"w-12 h-12 rounded-full object-cover shadow-sm"}):(0,s.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-[#18A36C] to-[#15905f] rounded-full flex items-center justify-center shadow-sm",children:(0,s.jsx)(c.User,{className:"w-6 h-6 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:e.patient.name}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:e.patient.email})]})]}),e.has_unread_operator&&(0,s.jsx)("div",{className:"w-2.5 h-2.5 bg-red-500 rounded-full animate-pulse"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3 flex-wrap",children:[(e=>{switch(e){case"WAITING":return(0,s.jsx)(g.Badge,{variant:"outline",className:"border-amber-400 text-amber-700 bg-amber-50",children:"Ожидает"});case"ACTIVE":return(0,s.jsx)(g.Badge,{variant:"default",className:"bg-[#18A36C] text-white border-transparent shadow-sm",children:"Активный"});case"CLOSED":return(0,s.jsx)(g.Badge,{variant:"secondary",className:"bg-gray-200 text-gray-700",children:"Закрыт"});default:return null}})(e.status),e.operator&&(0,s.jsxs)("span",{className:"text-xs text-gray-500",children:["Оператор: ",e.operator.name]})]}),e.messages.length>0&&(0,s.jsx)("div",{className:"mb-3",children:(0,s.jsx)("p",{className:"text-sm text-gray-700 line-clamp-2",children:e.messages[0].content})}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 pt-3 border-t border-gray-100",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,s.jsx)(n.Clock,{className:"w-3.5 h-3.5"}),(0,s.jsx)("span",{children:e.last_message_at?(e=>{let s=new Date,a=new Date(e),r=Math.floor((s.getTime()-a.getTime())/6e4);if(r<1)return"только что";if(r<60)return`${r} мин назад`;let t=Math.floor(r/60);if(t<24)return`${t} ч назад`;let i=Math.floor(t/24);return`${i} д назад`})(e.last_message_at):"Нет сообщений"})]}),e.has_unread_operator?(0,s.jsx)("span",{className:"text-[#18A36C] font-semibold",children:"Новое"}):(0,s.jsx)(o.CheckCheck,{className:"w-4 h-4 text-gray-400"})]})]},e.id))}),X>1&&(0,s.jsx)(A.Pagination,{currentPage:V,totalPages:X,onPageChange:U,className:"mt-6"})]})]}),D&&(0,s.jsx)(k,{chatId:D,onClose:()=>{O(null),W(),H()}})]})}e.s(["default",()=>_,"dynamic",0,"force-dynamic"],84348)}]);