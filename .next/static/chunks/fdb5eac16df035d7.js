(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"warnOnce",{enumerable:!0,get:function(){return i}});let i=e=>{}},69524,91900,e=>{"use strict";var t=e.i(43476),a=e.i(46932),i=e.i(88653),s=e.i(78894),l=e.i(37727),r=e.i(26299);function n({isOpen:e,onClose:n,onConfirm:o,title:d,message:c,confirmText:m="Удалить",cancelText:u="Отмена",variant:x="danger",loading:g=!1}){return e?(0,t.jsx)(i.AnimatePresence,{children:e&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:n,className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[9998]"}),(0,t.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",children:(0,t.jsxs)(a.motion.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",duration:.3},className:"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,t.jsx)("div",{className:`px-6 py-5 border-b border-gray-100 ${"danger"===x?"bg-red-50":"bg-yellow-50"}`,children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${"danger"===x?"bg-red-100":"bg-yellow-100"}`,children:(0,t.jsx)(s.AlertTriangle,{className:`w-6 h-6 ${"danger"===x?"text-red-600":"text-yellow-600"}`})}),(0,t.jsx)("div",{children:(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:d})})]}),(0,t.jsx)("button",{onClick:n,disabled:g,className:"text-gray-400 hover:text-gray-600 transition-colors disabled:opacity-50",children:(0,t.jsx)(l.X,{className:"w-5 h-5"})})]})}),(0,t.jsx)("div",{className:"px-6 py-5",children:(0,t.jsx)("p",{className:"text-gray-600 leading-relaxed",children:c})}),(0,t.jsxs)("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-100 flex items-center justify-end gap-3",children:[(0,t.jsx)(r.Button,{onClick:n,disabled:g,variant:"ghost",className:"px-5 py-2.5",children:u}),(0,t.jsx)("button",{onClick:()=>{o()},disabled:g,className:`px-5 py-2.5 rounded-xl font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed ${"danger"===x?"bg-red-600 hover:bg-red-700 text-white shadow-lg shadow-red-600/30":"bg-yellow-600 hover:bg-yellow-700 text-white shadow-lg shadow-yellow-600/30"}`,children:g?(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),(0,t.jsx)("span",{children:"Удаление..."})]}):m})]})]})})]})}):null}e.s(["ConfirmDialog",()=>n],69524);var o=e.i(71645);function d(){let[e,t]=(0,o.useState)(!1),[a,i]=(0,o.useState)(!1),[s,l]=(0,o.useState)({title:"",message:""}),[r,n]=(0,o.useState)(null),d=(0,o.useCallback)(e=>(l(e),t(!0),i(!1),new Promise(e=>{n({resolve:e})})),[]);return{confirm:d,isOpen:e,loading:a,options:s,handleConfirm:(0,o.useCallback)(async()=>{r&&(i(!0),await new Promise(e=>setTimeout(e,300)),r.resolve(!0),t(!1),i(!1),n(null))},[r]),handleCancel:(0,o.useCallback)(()=>{r&&(r.resolve(!1),t(!1),i(!1),n(null))},[r])}}e.s(["useConfirmDialog",()=>d],91900)},87690,e=>{"use strict";e.i(51651),e.i(5901),e.i(86633),e.s([])},20230,e=>{"use strict";var t=e.i(43476),a=e.i(71645);function i(e){let[i,s]=(0,a.useState)(!1),{src:l,alt:r,style:n,className:o,...d}=e;return i||!l?(0,t.jsx)("div",{className:`inline-block bg-gray-100 text-center align-middle ${o??""}`,style:n,children:(0,t.jsx)("div",{className:"flex items-center justify-center w-full h-full",children:(0,t.jsx)("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODgiIGhlaWdodD0iODgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBvcGFjaXR5PSIuMyIgZmlsbD0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIzLjciPjxyZWN0IHg9IjE2IiB5PSIxNiIgd2lkdGg9IjU2IiBoZWlnaHQ9IjU2IiByeD0iNiIvPjxwYXRoIGQ9Im0xNiA1OCAxNi0xOCAzMiAzMiIvPjxjaXJjbGUgY3g9IjUzIiBjeT0iMzUiIHI9IjciLz48L3N2Zz4KCg==",alt:r||"Нет фото",...d,"data-original-url":l})})}):(0,t.jsx)("img",{src:l,alt:r,className:o,style:n,...d,onError:()=>{s(!0)}})}e.s(["ImageWithFallback",()=>i])},18050,e=>{"use strict";var t=e.i(43476),a=e.i(73375),i=e.i(63059),s=e.i(26299);function l({currentPage:e,totalPages:l,onPageChange:r,className:n=""}){if(l<=1)return null;let o=(()=>{let t=[];if(l<=5)for(let e=1;e<=l;e++)t.push(e);else{t.push(1),e>3&&t.push("...");let a=Math.max(2,e-1),i=Math.min(l-1,e+1);for(let e=a;e<=i;e++)t.push(e);e<l-2&&t.push("..."),t.push(l)}return t})();return(0,t.jsxs)("div",{className:`flex items-center justify-center gap-2 ${n}`,children:[(0,t.jsx)(s.Button,{onClick:()=>r(e-1),disabled:1===e,variant:"outline",className:"h-10 w-10 p-0 border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed hidden sm:flex items-center justify-center",children:(0,t.jsx)(a.ChevronLeft,{className:"w-5 h-5"})}),(0,t.jsxs)("div",{className:"flex sm:hidden items-center gap-2",children:[(0,t.jsx)(s.Button,{onClick:()=>r(e-1),disabled:1===e,variant:"outline",className:"h-10 px-3 border-gray-300 hover:bg-gray-50 disabled:opacity-50",children:(0,t.jsx)(a.ChevronLeft,{className:"w-4 h-4"})}),(0,t.jsxs)("span",{className:"text-sm text-gray-700 min-w-[80px] text-center",children:[e," / ",l]}),(0,t.jsx)(s.Button,{onClick:()=>r(e+1),disabled:e===l,variant:"outline",className:"h-10 px-3 border-gray-300 hover:bg-gray-50 disabled:opacity-50",children:(0,t.jsx)(i.ChevronRight,{className:"w-4 h-4"})})]}),(0,t.jsx)("div",{className:"hidden sm:flex items-center gap-2",children:o.map((a,i)=>{if("..."===a)return(0,t.jsx)("span",{className:"px-2 text-gray-500",children:"..."},`ellipsis-${i}`);let l=a===e;return(0,t.jsx)(s.Button,{onClick:()=>r(a),variant:l?"default":"outline",className:`h-10 w-10 p-0 ${l?"bg-[#18A36C] hover:bg-[#18A36C]/90 text-white border-[#18A36C]":"border-gray-300 hover:bg-gray-50 text-gray-700"}`,children:a},a)})}),(0,t.jsx)(s.Button,{onClick:()=>r(e+1),disabled:e===l,variant:"outline",className:"h-10 w-10 p-0 border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed hidden sm:flex items-center justify-center",children:(0,t.jsx)(i.ChevronRight,{className:"w-5 h-5"})})]})}e.s(["Pagination",()=>l])},69074,e=>{"use strict";let t=(0,e.i(75254).default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);e.s(["Upload",()=>t],69074)},1558,e=>{"use strict";var t=e.i(43476),a=e.i(71645),i=e.i(69074),s=e.i(37727),l=e.i(31278),r=e.i(69638),n=e.i(86633);function o({value:e,onChange:o,folder:d="smartmedical",placeholder:c="Загрузить фото",className:m="",maxSizeMB:u=10}){let[x,g]=(0,a.useState)("idle"),[h,p]=(0,a.useState)(e||""),j=(0,a.useRef)(null),{success:b,error:f}=(0,n.useAlert)();(0,a.useEffect)(()=>{void 0!==e&&p(e)},[e]);let y=(0,a.useCallback)(async t=>{if(!["image/jpeg","image/png","image/webp","image/gif"].includes(t.type)){f("Только JPG, PNG, WebP, GIF"),g("error");return}if(t.size>1024*u*1024){f(`Максимальный размер: ${u}MB`),g("error");return}g("uploading");let a=URL.createObjectURL(t);p(a);try{let e=new FormData;e.append("file",t),e.append("folder",d);let a=await fetch("/api/upload",{method:"POST",body:e}),i=await a.json();if(!a.ok)throw Error(i.error||"Ошибка загрузки");p(i.data.url),o(i.data.url),g("success"),b("Изображение успешно загружено"),setTimeout(()=>g("idle"),2e3)}catch(t){f(t instanceof Error?t.message:"Ошибка загрузки"),g("error"),p(e||"")}finally{URL.revokeObjectURL(a)}},[d,u,o,e,b,f]);return(0,t.jsxs)("div",{className:`flex items-start gap-4 ${m}`,children:[(0,t.jsx)("input",{ref:j,type:"file",accept:"image/jpeg,image/png,image/webp,image/gif",onChange:e=>{let t=e.target.files?.[0];t&&y(t)},className:"hidden"}),(0,t.jsxs)("div",{className:"relative",children:[h?(0,t.jsxs)("div",{className:"relative w-48 h-48 rounded-2xl overflow-hidden bg-gray-100 shadow-sm border border-gray-200",children:[(0,t.jsx)("img",{src:h,alt:"Preview",className:"w-full h-full object-cover"}),"uploading"===x&&(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center",children:(0,t.jsx)(l.Loader2,{className:"w-10 h-10 text-white animate-spin"})}),"success"===x&&(0,t.jsx)("div",{className:"absolute bottom-2 right-2 w-8 h-8 rounded-full bg-green-500 flex items-center justify-center shadow-lg",children:(0,t.jsx)(r.CheckCircle,{className:"w-5 h-5 text-white"})})]}):(0,t.jsxs)("div",{onClick:()=>"uploading"!==x&&j.current?.click(),className:"w-48 h-48 rounded-2xl bg-gray-100 border-2 border-dashed border-gray-300 flex flex-col items-center justify-center cursor-pointer hover:border-[#18A36C] hover:bg-gray-50 transition-colors",children:[(0,t.jsx)(i.Upload,{className:"w-10 h-10 text-gray-400 mb-2"}),(0,t.jsx)("span",{className:"text-sm text-gray-500 text-center px-4",children:"Нажмите для загрузки"})]}),h&&"uploading"!==x&&(0,t.jsx)("button",{type:"button",onClick:()=>{p(""),o(""),g("idle"),j.current&&(j.current.value="")},className:"absolute -top-3 -right-3 w-8 h-8 rounded-full bg-red-500 hover:bg-red-600 flex items-center justify-center shadow-lg transition-colors z-10",children:(0,t.jsx)(s.X,{className:"w-4 h-4 text-white"})})]}),(0,t.jsxs)("div",{className:"flex-1 pt-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>"uploading"!==x&&j.current?.click(),disabled:"uploading"===x,className:"px-5 py-2.5 bg-[#18A36C] hover:bg-[#149259] disabled:bg-gray-300 rounded-xl text-sm font-medium text-white transition-colors flex items-center gap-2 shadow-sm",children:"uploading"===x?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Loader2,{className:"w-4 h-4 animate-spin"}),"Загрузка..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.Upload,{className:"w-4 h-4"}),h?"Заменить фото":c]})}),(0,t.jsxs)("p",{className:"text-xs text-gray-400 mt-3",children:["JPG, PNG, WebP, GIF до ",u,"MB"]})]})]})}e.s(["ImageUploader",()=>o])},94662,e=>{"use strict";e.i(1558),e.s([])},1083,e=>{"use strict";var t=e.i(43476),a=e.i(71645),i=e.i(17255),s=e.i(88653),l=e.i(78583),r=e.i(87316),n=e.i(18050);e.i(94662);var o=e.i(1558),d=e.i(75961),c=e.i(4125),m=e.i(29306),u=e.i(18026),x=e.i(45347),g=e.i(73250),h=e.i(20230),p=e.i(69524),j=e.i(91900);e.i(87690);var b=e.i(86633);function f(){let{status:e}=(0,i.useSession)(),{sessionVerified:f,isLoading:y,verifySession:v}=(0,x.useAdminSession)(),[w,N]=(0,a.useState)(null),C=(0,j.useConfirmDialog)(),{success:S,error:I}=(0,b.useAlert)(),[k,F]=(0,a.useState)([]),[P,A]=(0,a.useState)(!1),[T,_]=(0,a.useState)(""),[D,L]=(0,a.useState)(1),[B,O]=(0,a.useState)(!1),[M,U]=(0,a.useState)(null),[R,z]=(0,a.useState)(!1),[$,E]=(0,a.useState)({title:"",content:"",detailed_content:"",image_url:"",date:"",year:new Date().getFullYear().toString(),is_active:!0});(0,a.useEffect)(()=>{"authenticated"===e?G():"unauthenticated"===e&&N(!1)},[e]),(0,a.useEffect)(()=>{f&&w&&W()},[f,w]);let G=async()=>{try{let e=await fetch("/api/admin/auth"),t=await e.json();N(t.isAdmin)}catch(e){N(!1)}},W=async()=>{A(!0);try{let e=await fetch("/api/admin/materials");if(e.ok){let t=await e.json();F(t)}}catch(e){console.error("Error loading materials:",e)}finally{A(!1)}},Z=(0,a.useMemo)(()=>{if(!T)return k;let e=T.toLowerCase();return k.filter(t=>t.title.toLowerCase().includes(e)||t.content.toLowerCase().includes(e))},[k,T]);(0,a.useEffect)(()=>{L(1)},[T]);let H=Math.ceil(Z.length/12),J=(0,a.useMemo)(()=>{let e=(D-1)*12;return Z.slice(e,e+12)},[Z,D]),q=()=>{E({title:"",content:"",detailed_content:"",image_url:"",date:"",year:new Date().getFullYear().toString(),is_active:!0}),U(null),O(!1)},X=()=>{q(),E(e=>({...e,date:new Date().toISOString().split("T")[0]})),O(!0)},Y=async()=>{z(!0);try{let e=M?`/api/admin/materials/${M.id}`:"/api/admin/materials",t=M?"PUT":"POST",a=await fetch(e,{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify($)});if(a.ok)await W(),q(),S(M?"Материал обновлен":"Материал создан");else{let e=await a.json();I(e.error||"Ошибка сохранения")}}catch(e){I("Ошибка сохранения")}finally{z(!1)}},K=async(e,t)=>{if(await C.confirm({title:"Удаление материала",message:`Вы уверены, что хотите удалить материал "${t}"? Это действие нельзя отменить.`,confirmText:"Удалить",cancelText:"Отмена",variant:"danger"}))try{let t=await fetch(`/api/admin/materials/${e}`,{method:"DELETE"});if(t.ok)await W(),S("Материал удален");else{let e=await t.json();I(e.error||"Ошибка удаления")}}catch(e){I("Ошибка удаления")}};return"loading"===e||null===w||y?(0,t.jsx)(g.AdminAccessSkeleton,{}):"unauthenticated"!==e&&w?f?(0,t.jsxs)("div",{className:"flex min-h-screen bg-gray-50",children:[(0,t.jsx)(d.AdminMenu,{}),(0,t.jsx)("div",{className:"flex-1 p-4 lg:p-8 overflow-auto",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,t.jsx)(c.AdminSection,{title:"Материалы",icon:l.FileText,count:k.length,loading:P,searchValue:T,onSearchChange:_,onAdd:X,addButtonText:"Добавить материал",children:0===Z.length?(0,t.jsx)(c.EmptyState,{icon:l.FileText,title:"Материалы не найдены",description:T?"Попробуйте изменить поисковый запрос":"Добавьте первый материал",actionText:T?void 0:"Добавить материал",onAction:T?void 0:X}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:(0,t.jsx)(s.AnimatePresence,{children:J.map(e=>(0,t.jsxs)(c.ItemCard,{children:[(0,t.jsx)("div",{className:"w-full h-40 rounded-xl overflow-hidden bg-gray-100 mb-4",children:(0,t.jsx)(h.ImageWithFallback,{src:e.image_url,alt:e.title,className:"w-full h-full object-cover"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,t.jsx)(c.Badge,{variant:"secondary",children:e.year})}),(0,t.jsx)("h3",{className:"font-semibold text-gray-800 line-clamp-2 mb-2",children:e.title}),(0,t.jsx)("p",{className:"text-sm text-gray-500 line-clamp-2",children:e.content})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-gray-100",children:[(0,t.jsxs)("span",{className:"text-xs text-gray-400 flex items-center gap-1",children:[(0,t.jsx)(r.Calendar,{className:"w-3 h-3"}),new Date(e.date).toLocaleDateString("ru-RU")]}),(0,t.jsx)(c.CardActions,{onEdit:()=>{U(e),E({title:e.title,content:e.content,detailed_content:e.detailed_content||"",image_url:e.image_url,date:new Date(e.date).toISOString().split("T")[0],year:e.year.toString(),is_active:e.is_active}),O(!0)},onDelete:()=>K(e.id,e.title)})]})]},e.id))})}),H>1&&(0,t.jsx)(n.Pagination,{currentPage:D,totalPages:H,onPageChange:L,className:"mt-6"})]})}),(0,t.jsx)(c.FormModal,{isOpen:B,onClose:q,title:M?"Редактирование материала":"Новый материал",onSubmit:Y,loading:R,disabled:!$.title||!$.content||!$.image_url,children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(c.FormField,{label:"Заголовок",required:!0,children:(0,t.jsx)(c.FormInput,{type:"text",value:$.title,onChange:e=>E({...$,title:e.target.value}),placeholder:"Название материала"})}),(0,t.jsx)(c.FormField,{label:"Краткое описание",required:!0,children:(0,t.jsx)(c.FormTextarea,{value:$.content,onChange:e=>E({...$,content:e.target.value}),rows:3,placeholder:"Краткое описание для карточки"})}),(0,t.jsx)(c.FormField,{label:"Подробное описание",children:(0,t.jsx)(c.FormTextarea,{value:$.detailed_content,onChange:e=>E({...$,detailed_content:e.target.value}),rows:5,placeholder:"Полное описание для модального окна"})}),(0,t.jsx)(c.FormField,{label:"Изображение",required:!0,children:(0,t.jsx)(o.ImageUploader,{value:$.image_url,onChange:e=>E({...$,image_url:e}),folder:"smartmedical/materials",placeholder:"Загрузите изображение материала",maxSizeMB:10})}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsx)(c.FormField,{label:"Дата",required:!0,children:(0,t.jsx)(c.FormDateInput,{value:$.date,onChange:e=>E({...$,date:e})})}),(0,t.jsx)(c.FormField,{label:"Год",required:!0,children:(0,t.jsx)(c.FormInput,{type:"number",value:$.year,onChange:e=>E({...$,year:e.target.value}),placeholder:"2024"})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("button",{type:"button",onClick:()=>E({...$,is_active:!$.is_active}),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${$.is_active?"bg-[#18A36C]":"bg-gray-300"}`,children:(0,t.jsx)("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${$.is_active?"translate-x-6":"translate-x-1"}`})}),(0,t.jsx)("span",{className:"text-sm text-gray-700",children:$.is_active?"Материал активен":"Материал скрыт"})]})]})}),(0,t.jsx)(p.ConfirmDialog,{isOpen:C.isOpen,onClose:C.handleCancel,onConfirm:C.handleConfirm,title:C.options.title,message:C.options.message,confirmText:C.options.confirmText,cancelText:C.options.cancelText,variant:C.options.variant,loading:C.loading})]})})]}):(0,t.jsx)(u.AdminAuthForm,{onSuccess:()=>{v()}}):(0,t.jsx)(m.default,{})}e.s(["default",()=>f])}]);