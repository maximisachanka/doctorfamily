(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18050,e=>{"use strict";var s=e.i(43476),a=e.i(73375),t=e.i(63059),r=e.i(26299);function l({currentPage:e,totalPages:l,onPageChange:i,className:n=""}){if(l<=1)return null;let c=(()=>{let s=[];if(l<=5)for(let e=1;e<=l;e++)s.push(e);else{s.push(1),e>3&&s.push("...");let a=Math.max(2,e-1),t=Math.min(l-1,e+1);for(let e=a;e<=t;e++)s.push(e);e<l-2&&s.push("..."),s.push(l)}return s})();return(0,s.jsxs)("div",{className:`flex items-center justify-center gap-2 ${n}`,children:[(0,s.jsx)(r.Button,{onClick:()=>i(e-1),disabled:1===e,variant:"outline",className:"h-10 w-10 p-0 border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed hidden sm:flex items-center justify-center",children:(0,s.jsx)(a.ChevronLeft,{className:"w-5 h-5"})}),(0,s.jsxs)("div",{className:"flex sm:hidden items-center gap-2",children:[(0,s.jsx)(r.Button,{onClick:()=>i(e-1),disabled:1===e,variant:"outline",className:"h-10 px-3 border-gray-300 hover:bg-gray-50 disabled:opacity-50",children:(0,s.jsx)(a.ChevronLeft,{className:"w-4 h-4"})}),(0,s.jsxs)("span",{className:"text-sm text-gray-700 min-w-[80px] text-center",children:[e," / ",l]}),(0,s.jsx)(r.Button,{onClick:()=>i(e+1),disabled:e===l,variant:"outline",className:"h-10 px-3 border-gray-300 hover:bg-gray-50 disabled:opacity-50",children:(0,s.jsx)(t.ChevronRight,{className:"w-4 h-4"})})]}),(0,s.jsx)("div",{className:"hidden sm:flex items-center gap-2",children:c.map((a,t)=>{if("..."===a)return(0,s.jsx)("span",{className:"px-2 text-gray-500",children:"..."},`ellipsis-${t}`);let l=a===e;return(0,s.jsx)(r.Button,{onClick:()=>i(a),variant:l?"default":"outline",className:`h-10 w-10 p-0 ${l?"bg-[#18A36C] hover:bg-[#18A36C]/90 text-white border-[#18A36C]":"border-gray-300 hover:bg-gray-50 text-gray-700"}`,children:a},a)})}),(0,s.jsx)(r.Button,{onClick:()=>i(e+1),disabled:e===l,variant:"outline",className:"h-10 w-10 p-0 border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed hidden sm:flex items-center justify-center",children:(0,s.jsx)(t.ChevronRight,{className:"w-5 h-5"})})]})}e.s(["Pagination",()=>l])},71689,e=>{"use strict";let s=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>s],71689)},73250,e=>{"use strict";var s=e.i(43476);function a({className:e=""}){return(0,s.jsx)("div",{className:`animate-pulse bg-gray-200 rounded ${e}`})}function t(){return(0,s.jsxs)("div",{className:"bg-white rounded-xl p-5 border border-gray-100 shadow-sm",children:[(0,s.jsxs)("div",{className:"flex gap-4 mb-4",children:[(0,s.jsx)(a,{className:"w-16 h-16 rounded-xl flex-shrink-0"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0 space-y-2",children:[(0,s.jsx)(a,{className:"h-5 w-3/4"}),(0,s.jsx)(a,{className:"h-4 w-full"}),(0,s.jsx)(a,{className:"h-4 w-2/3"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,s.jsx)(a,{className:"h-6 w-20 rounded-full"}),(0,s.jsx)(a,{className:"h-6 w-16 rounded-full"})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100",children:[(0,s.jsx)(a,{className:"h-4 w-24"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(a,{className:"h-8 w-8 rounded-lg"}),(0,s.jsx)(a,{className:"h-8 w-8 rounded-lg"})]})]})]})}function r({count:e=12}){return(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:Array.from({length:e}).map((e,a)=>(0,s.jsx)(t,{},a))})}function l(){return(0,s.jsxs)("div",{className:"bg-white rounded-xl p-5 border border-gray-100 shadow-sm",children:[(0,s.jsxs)("div",{className:"flex gap-4 mb-3",children:[(0,s.jsx)(a,{className:"w-14 h-14 rounded-full flex-shrink-0"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0 space-y-2",children:[(0,s.jsx)(a,{className:"h-5 w-2/5"}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(a,{className:"h-4 w-24"}),(0,s.jsx)(a,{className:"h-3 w-20"})]}),(0,s.jsx)(a,{className:"h-4 w-full"}),(0,s.jsx)(a,{className:"h-4 w-4/5"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,s.jsx)(a,{className:"h-6 w-32 rounded-full"}),(0,s.jsx)(a,{className:"h-6 w-28 rounded-full"})]}),(0,s.jsx)("div",{className:"flex items-center justify-end pt-4 border-t border-gray-100",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(a,{className:"h-8 w-8 rounded-lg"}),(0,s.jsx)(a,{className:"h-8 w-8 rounded-lg"})]})})]})}function i({count:e=12}){return(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Array.from({length:e}).map((e,a)=>(0,s.jsx)(l,{},a))})}function n(){return(0,s.jsx)("div",{className:"bg-white rounded-xl p-5 border border-gray-100 shadow-sm",children:(0,s.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(a,{className:"h-5 w-3/4 mb-2"}),(0,s.jsx)(a,{className:"h-4 w-full mb-2"}),(0,s.jsx)(a,{className:"h-4 w-5/6 mb-3"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(a,{className:"h-6 w-24 rounded-full"}),(0,s.jsx)(a,{className:"h-6 w-32 rounded-full"})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(a,{className:"h-8 w-8 rounded-lg"}),(0,s.jsx)(a,{className:"h-8 w-8 rounded-lg"})]})]})})}function c({count:e=12}){return(0,s.jsx)("div",{className:"space-y-4",children:Array.from({length:e}).map((e,a)=>(0,s.jsx)(n,{},a))})}function d(){return(0,s.jsxs)("div",{className:"bg-white rounded-2xl p-6 lg:p-8 border border-gray-100",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-8",children:[(0,s.jsx)(a,{className:"w-12 h-12 rounded-xl"}),(0,s.jsxs)("div",{children:[(0,s.jsx)(a,{className:"h-7 w-40 mb-2"}),(0,s.jsx)(a,{className:"h-4 w-64"})]})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[Array.from({length:7}).map((e,t)=>(0,s.jsxs)("div",{children:[(0,s.jsx)(a,{className:"h-4 w-32 mb-2"}),(0,s.jsx)(a,{className:"h-11 w-full rounded-lg"})]},t)),(0,s.jsx)("div",{className:"pt-4",children:(0,s.jsx)(a,{className:"h-11 w-48 rounded-lg"})})]})]})}function o(){return(0,s.jsxs)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 backdrop-blur-md",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-white/50 backdrop-blur-sm"}),(0,s.jsxs)("div",{className:"relative z-10 text-center",children:[(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)("div",{className:"w-16 h-16 mx-auto border-4 border-gray-200 border-t-[#18A36C] rounded-full animate-spin"})}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:"Проверка доступа..."}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Пожалуйста, подождите"})]}),(0,s.jsxs)("div",{className:"flex justify-center gap-2 mt-6",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-[#18A36C] rounded-full animate-pulse",style:{animationDelay:"0ms"}}),(0,s.jsx)("div",{className:"w-2 h-2 bg-[#18A36C] rounded-full animate-pulse",style:{animationDelay:"150ms"}}),(0,s.jsx)("div",{className:"w-2 h-2 bg-[#18A36C] rounded-full animate-pulse",style:{animationDelay:"300ms"}})]})]})]})}e.s(["AdminAccessSkeleton",()=>o,"AdminContactsSkeleton",()=>d,"AdminFeedbacksGridSkeleton",()=>i,"AdminGridSkeleton",()=>r,"AdminQuestionsGridSkeleton",()=>c])},81997,e=>{"use strict";let s=(0,e.i(75254).default)("messages-square",[["path",{d:"M16 10a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 14.286V4a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z",key:"1n2ejm"}],["path",{d:"M20 9a2 2 0 0 1 2 2v10.286a.71.71 0 0 1-1.212.502l-2.202-2.202A2 2 0 0 0 17.172 19H10a2 2 0 0 1-2-2v-1",key:"1qfcsi"}]]);e.s(["MessagesSquare",()=>s],81997)},31961,e=>{"use strict";var s=e.i(43476),a=e.i(91918),t=e.i(25913),r=e.i(80809);let l=(0,t.cva)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function i({className:e,variant:t,asChild:i=!1,...n}){let c=i?a.Slot:"span";return(0,s.jsx)(c,{"data-slot":"badge",className:(0,r.cn)(l({variant:t}),e),...n})}e.s(["Badge",()=>i])},84348,e=>{"use strict";var s=e.i(43476),a=e.i(71645),t=e.i(17255),r=e.i(18566),l=e.i(73250),i=e.i(81997),n=e.i(3116),c=e.i(84614),d=e.i(94771),o=e.i(94983),m=e.i(23622);let x=(0,e.i(75254).default)("user-x",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);var h=e.i(31278),g=e.i(71689),u=e.i(31961),b=e.i(26299),j=e.i(46932),f=e.i(88653),p=e.i(37727),y=e.i(14764),N=e.i(31245),w=e.i(27612),v=e.i(86633);let k="chat-notifications-notified";function C({chatId:e,onClose:t}){let[r,l]=(0,a.useState)(null),[i,o]=(0,a.useState)(!0),[g,C]=(0,a.useState)(""),[A,S]=(0,a.useState)(!1),[_,E]=(0,a.useState)(!1),[L,B]=(0,a.useState)(!1),[T,I]=(0,a.useState)(!1),[D,O]=(0,a.useState)(!1),P=(0,a.useRef)(null),$=(0,v.useAlert)(),M=(0,a.useCallback)(async()=>{try{let s=await fetch(`/api/operator-chat/${e}`);if(s.ok){let a,t=await s.json();l(t.chat),a=JSON.parse(localStorage.getItem(k)||"[]").filter(s=>s!==e),localStorage.setItem(k,JSON.stringify(a))}else $.error("Не удалось загрузить чат","Ошибка")}catch(e){console.error("Error loading chat:",e),$.error("Ошибка при загрузке чата","Ошибка")}finally{o(!1)}},[e,$]);(0,a.useEffect)(()=>{M()},[M]),(0,a.useEffect)(()=>{r&&P.current?.scrollIntoView({behavior:"smooth"})},[r?.messages]);let G=async()=>{try{(await fetch(`/api/operator-chat/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"take"})})).ok?($.success("Вы взяли чат","Успех"),M()):$.error("Не удалось взять чат","Ошибка")}catch(e){console.error("Error taking chat:",e),$.error("Ошибка при взятии чата","Ошибка")}},V=async()=>{try{(await fetch(`/api/operator-chat/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"CLOSED"})})).ok?($.success("Чат закрыт","Успех"),t()):$.error("Не удалось закрыть чат","Ошибка")}catch(e){console.error("Error closing chat:",e),$.error("Ошибка при закрытии чата","Ошибка")}},z=async()=>{if(!r||L)return;let s=r.patient.is_messages_blocked?"unblock":"block";B(!0);try{let a=await fetch(`/api/operator-chat/${e}/block`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:s})}),r=await a.json();a.ok?($.success("block"===s?"Пользователь заблокирован и все его чаты удалены":"Пользователь разблокирован","Успех"),"block"===s?t():(await M(),E(!1))):$.error(r.error||"Не удалось "+("block"===s?"заблокировать":"разблокировать")+" пользователя","Ошибка")}catch(e){console.error("Error blocking/unblocking user:",e),$.error("Ошибка при блокировке/разблокировке","Ошибка")}finally{B(!1)}},W=async()=>{if(r&&!D){O(!0);try{let s=await fetch(`/api/operator-chat/${e}`,{method:"DELETE"}),a=await s.json();s.ok?($.success("Чат удален","Успех"),t()):$.error(a.error||"Не удалось удалить чат","Ошибка")}catch(e){console.error("Error deleting chat:",e),$.error("Ошибка при удалении чата","Ошибка")}finally{O(!1)}}},H=async()=>{if(g.trim()&&!A){S(!0);try{let s=await fetch(`/api/operator-chat/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:g.trim()})});if(s.ok)C(""),M();else{let e=await s.json();$.error(e.error||"Не удалось отправить сообщение","Ошибка")}}catch(e){console.error("Error sending message:",e),$.error("Ошибка при отправке сообщения","Ошибка")}finally{S(!1)}}};return(0,s.jsx)(f.AnimatePresence,{children:(0,s.jsxs)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[(0,s.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:t,className:"absolute inset-0 bg-black/50 backdrop-blur-sm"}),(0,s.jsx)(j.motion.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative z-10 w-full max-w-3xl bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[80vh]",children:i?(0,s.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,s.jsx)(h.Loader2,{className:"w-8 h-8 text-[#18A36C] animate-spin"})}):r?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"bg-white border-b border-gray-200 p-4 sm:p-6 flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 sm:gap-4 min-w-0",children:[r.patient.avatar_url?(0,s.jsx)("img",{src:r.patient.avatar_url,alt:r.patient.name,className:"w-12 h-12 sm:w-14 sm:h-14 rounded-full object-cover border-2 border-gray-200 flex-shrink-0"}):(0,s.jsx)("div",{className:"w-12 h-12 sm:w-14 sm:h-14 bg-gradient-to-br from-[#18A36C] to-[#15905f] rounded-full flex items-center justify-center shadow-md flex-shrink-0",children:(0,s.jsx)(c.User,{className:"w-6 h-6 sm:w-7 sm:h-7 text-white"})}),(0,s.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,s.jsx)("h2",{className:"text-lg sm:text-xl font-bold text-gray-900 truncate",children:r.patient.name}),(0,s.jsx)("p",{className:"text-gray-600 text-xs sm:text-sm truncate",children:r.patient.email}),(0,s.jsxs)("div",{className:"mt-1.5 flex items-center gap-2 flex-wrap",children:[(e=>{switch(e){case"WAITING":return(0,s.jsx)(u.Badge,{variant:"outline",className:"border-amber-400 text-amber-700 bg-amber-50",children:"Ожидает"});case"ACTIVE":return(0,s.jsx)(u.Badge,{variant:"default",className:"bg-emerald-500 text-white border-transparent shadow-sm",children:"Активный"});case"CLOSED":return(0,s.jsx)(u.Badge,{variant:"secondary",className:"bg-gray-200 text-gray-700",children:"Закрыт"});default:return null}})(r.status),r.patient.is_messages_blocked&&(0,s.jsxs)(u.Badge,{variant:"secondary",className:"bg-gray-700 text-white text-xs",children:[(0,s.jsx)(m.Ban,{className:"w-3 h-3 mr-1"}),"Заблокирован"]})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:["CLOSED"!==r.status&&(0,s.jsxs)(s.Fragment,{children:["WAITING"===r.status&&(0,s.jsx)(b.Button,{onClick:G,className:"bg-[#18A36C] text-white hover:bg-[#15905f] shadow-sm",children:"Взять чат"}),"ACTIVE"===r.status&&(0,s.jsx)(b.Button,{onClick:V,variant:"outline",className:"text-gray-700 border-gray-300 hover:bg-gray-50",children:"Закрыть чат"})]}),(0,s.jsx)("button",{onClick:()=>{I(!0)},title:"Удалить чат",className:"w-10 h-10 rounded-lg flex items-center justify-center transition-all bg-red-50 text-red-600 hover:bg-red-100",children:(0,s.jsx)(w.Trash2,{className:"w-5 h-5"})}),(0,s.jsx)("button",{onClick:()=>{r&&E(!0)},title:r.patient.is_messages_blocked?"Разблокировать":"Заблокировать",className:`w-10 h-10 rounded-lg flex items-center justify-center transition-all ${r.patient.is_messages_blocked?"bg-blue-50 text-blue-600 hover:bg-blue-100":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:r.patient.is_messages_blocked?(0,s.jsx)(x,{className:"w-5 h-5"}):(0,s.jsx)(m.Ban,{className:"w-5 h-5"})}),(0,s.jsx)("button",{onClick:t,className:"w-10 h-10 rounded-lg bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600 transition-colors",children:(0,s.jsx)(p.X,{className:"w-5 h-5"})})]})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-4 bg-gradient-to-b from-gray-50 to-white",children:[r.messages.map(e=>(0,s.jsxs)(j.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex gap-3 ${"operator"===e.sender_type?"flex-row-reverse":""}`,children:[e.sender.avatar_url?(0,s.jsx)("img",{src:e.sender.avatar_url,alt:e.sender.name,className:"w-10 h-10 rounded-full object-cover flex-shrink-0 shadow-sm"}):(0,s.jsx)("div",{className:`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 shadow-sm ${"operator"===e.sender_type?"bg-gradient-to-br from-emerald-500 to-emerald-600":"bg-gradient-to-br from-gray-400 to-gray-500"}`,children:"operator"===e.sender_type?(0,s.jsx)(N.Bot,{className:"w-5 h-5 text-white"}):(0,s.jsx)(c.User,{className:"w-5 h-5 text-white"})}),(0,s.jsxs)("div",{className:`max-w-[70%] ${"operator"===e.sender_type?"items-end":"items-start"} flex flex-col`,children:[(0,s.jsx)("div",{className:`rounded-2xl p-4 shadow-sm ${"operator"===e.sender_type?"bg-gradient-to-br from-emerald-500 to-emerald-600 text-white":"bg-white text-gray-800 border border-gray-200"}`,children:(0,s.jsx)("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:e.content})}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-1.5 px-2",children:[(0,s.jsx)(n.Clock,{className:"w-3 h-3 text-gray-400"}),(0,s.jsx)("span",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}),"operator"===e.sender_type&&e.is_read&&(0,s.jsx)(d.CheckCheck,{className:"w-4 h-4 text-emerald-500"})]})]})]},e.id)),(0,s.jsx)("div",{ref:P})]}),"CLOSED"!==r.status&&(0,s.jsx)("div",{className:"p-4 bg-white border-t border-gray-200",children:(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("input",{type:"text",value:g,onChange:e=>C(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),H())},placeholder:"Напишите сообщение...",disabled:A,className:"flex-1 px-4 py-3 bg-gray-50 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all disabled:opacity-50"}),(0,s.jsx)("button",{onClick:H,disabled:A||!g.trim(),className:"w-12 h-12 bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-xl flex items-center justify-center text-white hover:shadow-md hover:scale-105 transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",children:A?(0,s.jsx)(h.Loader2,{className:"w-5 h-5 animate-spin"}):(0,s.jsx)(y.Send,{className:"w-5 h-5"})})]})})]}):(0,s.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,s.jsx)("p",{className:"text-gray-600",children:"Чат не найден"})})}),_&&r&&(0,s.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-20 flex items-center justify-center bg-black/40 backdrop-blur-sm",onClick:()=>E(!1),children:(0,s.jsxs)(j.motion.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},onClick:e=>e.stopPropagation(),className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden",children:[(0,s.jsx)("div",{className:`p-6 ${(r.patient.is_messages_blocked,"bg-gradient-to-r from-[#18A36C] to-[#15905f]")}`,children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center",children:r.patient.is_messages_blocked?(0,s.jsx)(x,{className:"w-6 h-6 text-white"}):(0,s.jsx)(m.Ban,{className:"w-6 h-6 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-white",children:r.patient.is_messages_blocked?"Разблокировать пользователя?":"Заблокировать пользователя?"}),(0,s.jsx)("p",{className:"text-sm text-white/80",children:r.patient.name})]})]})}),(0,s.jsx)("div",{className:"p-6",children:(0,s.jsx)("p",{className:"text-gray-700 leading-relaxed",children:r.patient.is_messages_blocked?"Пользователь сможет снова создавать новые чаты и отправлять сообщения.":"Пользователь не сможет создавать новые чаты и отправлять сообщения. Все его чаты будут удалены."})}),(0,s.jsxs)("div",{className:"px-6 pb-6 flex gap-3 justify-end",children:[(0,s.jsx)(b.Button,{variant:"outline",onClick:()=>E(!1),disabled:L,className:"border-gray-300 text-gray-700 hover:bg-gray-50",children:"Отмена"}),(0,s.jsxs)(b.Button,{onClick:z,disabled:L,className:r.patient.is_messages_blocked?"bg-blue-500 hover:bg-blue-600 text-white shadow-md flex items-center gap-2":"bg-gray-700 hover:bg-gray-800 text-white shadow-md flex items-center gap-2",children:[L&&(0,s.jsx)(h.Loader2,{className:"w-4 h-4 animate-spin"}),r.patient.is_messages_blocked?"Разблокировать":"Заблокировать"]})]})]})}),T&&r&&(0,s.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-20 flex items-center justify-center bg-black/40 backdrop-blur-sm",onClick:()=>I(!1),children:(0,s.jsxs)(j.motion.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},onClick:e=>e.stopPropagation(),className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden",children:[(0,s.jsx)("div",{className:"p-6 bg-gradient-to-r from-red-500 to-red-600",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center",children:(0,s.jsx)(w.Trash2,{className:"w-6 h-6 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-white",children:"Удалить чат?"}),(0,s.jsx)("p",{className:"text-sm text-white/80",children:r.patient.name})]})]})}),(0,s.jsx)("div",{className:"p-6",children:(0,s.jsx)("p",{className:"text-gray-700 leading-relaxed",children:"Все сообщения в этом чате будут удалены безвозвратно. Это действие нельзя отменить."})}),(0,s.jsxs)("div",{className:"px-6 pb-6 flex gap-3 justify-end",children:[(0,s.jsx)(b.Button,{variant:"outline",onClick:()=>I(!1),disabled:D,className:"border-gray-300 text-gray-700 hover:bg-gray-50",children:"Отмена"}),(0,s.jsxs)(b.Button,{onClick:W,disabled:D,className:"bg-red-500 hover:bg-red-600 text-white shadow-md flex items-center gap-2",children:[D&&(0,s.jsx)(h.Loader2,{className:"w-4 h-4 animate-spin"}),"Удалить"]})]})]})})]})})}var A=e.i(18050);function S(){let{data:e,status:j}=(0,t.useSession)(),f=(0,r.useRouter)(),p=(0,v.useAlert)(),[y,N]=(0,a.useState)(null),[w,k]=(0,a.useState)(!0),[S,_]=(0,a.useState)([]),[E,L]=(0,a.useState)([]),[B,T]=(0,a.useState)(!0),[I,D]=(0,a.useState)(null),[O,P]=(0,a.useState)("ALL"),[$,M]=(0,a.useState)(null),[G,V]=(0,a.useState)(1),z=(0,a.useCallback)(async()=>{k(!0);try{let e=await fetch("/api/admin/auth"),s=await e.json();N(s.isAdmin||!1)}catch(e){console.error("Error checking admin role:",e),N(!1)}finally{k(!1)}},[]);(0,a.useEffect)(()=>{"authenticated"===j?z():"unauthenticated"===j&&(k(!1),N(!1))},[j,z]);let W=(0,a.useCallback)(async()=>{try{T(!0);let e=await fetch("/api/operator-chat");if(e.ok){let s=await e.json();_(s.chats||[])}else p.error("Не удалось загрузить чаты","Ошибка")}catch(e){console.error("Error loading chats:",e),p.error("Ошибка при загрузке чатов","Ошибка")}finally{T(!1)}},[p]),H=(0,a.useCallback)(async()=>{try{let e=await fetch("/api/admin/blocked-users");if(e.ok){let s=await e.json();L(s.users||[])}else p.error("Не удалось загрузить заблокированных пользователей","Ошибка")}catch(e){console.error("Error loading blocked users:",e),p.error("Ошибка при загрузке заблокированных пользователей","Ошибка")}},[p]),K=async e=>{M(e);try{let s=await fetch("/api/admin/blocked-users",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:e})});if(s.ok)p.success("Пользователь разблокирован","Успех"),H();else{let e=await s.json();p.error(e.error||"Не удалось разблокировать пользователя","Ошибка")}}catch(e){console.error("Error unblocking user:",e),p.error("Ошибка при разблокировке пользователя","Ошибка")}finally{M(null)}};if((0,a.useEffect)(()=>{y&&(W(),H())},[y,W,H]),(0,a.useEffect)(()=>{"unauthenticated"===j&&f.push("/account?section=login")},[j,f]),(0,a.useEffect)(()=>{V(1)},[O]),"loading"===j||null===y||w)return(0,s.jsx)(l.AdminAccessSkeleton,{});if(!y)return f.push("/"),(0,s.jsx)(l.AdminAccessSkeleton,{});let R="ALL"===O?S:S.filter(e=>e.status===O),U=S.filter(e=>"WAITING"===e.status).length,J=S.filter(e=>"ACTIVE"===e.status).length,q=E.length,F=Math.ceil(R.length/9),Q=R.slice((G-1)*9,9*G),X=Math.ceil(E.length/9),Y=E.slice((G-1)*9,9*G);return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-6 lg:py-8",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-xl flex items-center justify-center shadow-md",children:(0,s.jsx)(i.MessagesSquare,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"Чат с пациентами"}),(0,s.jsx)("p",{className:"text-xs sm:text-sm text-gray-600",children:"Управление обращениями"})]})]}),(0,s.jsxs)(b.Button,{variant:"outline",onClick:()=>f.push("/admin"),className:"flex items-center gap-2 hover:bg-gray-50 self-start sm:self-auto",children:[(0,s.jsx)(g.ArrowLeft,{className:"w-4 h-4"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Назад в админ-панель"}),(0,s.jsx)("span",{className:"sm:hidden",children:"Назад"})]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,s.jsxs)(b.Button,{variant:"ALL"===O?"default":"outline",onClick:()=>P("ALL"),className:"ALL"===O?"bg-emerald-500 hover:bg-emerald-600 shadow-sm text-white":"hover:bg-gray-50",children:["Все (",S.length,")"]}),(0,s.jsxs)(b.Button,{variant:"WAITING"===O?"default":"outline",onClick:()=>P("WAITING"),className:"WAITING"===O?"bg-emerald-500 hover:bg-emerald-600 shadow-sm text-white":"hover:bg-gray-50",children:["Ожидают (",U,")"]}),(0,s.jsxs)(b.Button,{variant:"ACTIVE"===O?"default":"outline",onClick:()=>P("ACTIVE"),className:"ACTIVE"===O?"bg-emerald-500 hover:bg-emerald-600 shadow-sm text-white":"hover:bg-gray-50",children:["Активные (",J,")"]}),(0,s.jsx)(b.Button,{variant:"CLOSED"===O?"default":"outline",onClick:()=>P("CLOSED"),className:"CLOSED"===O?"bg-emerald-500 hover:bg-emerald-600 shadow-sm text-white":"hover:bg-gray-50",children:"Закрытые"}),(0,s.jsxs)(b.Button,{variant:"BLOCKED"===O?"default":"outline",onClick:()=>P("BLOCKED"),className:"BLOCKED"===O?"bg-red-500 hover:bg-red-600 shadow-sm text-white":"hover:bg-gray-50 text-red-600 border-red-300",children:["Заблокированные (",q,")"]})]})]}),B?(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(e=>(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 border border-gray-200 animate-pulse",children:[(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-4"}),(0,s.jsx)("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]},e))}):"BLOCKED"===O?0===E.length?(0,s.jsxs)("div",{className:"bg-white rounded-lg p-12 text-center border border-gray-200",children:[(0,s.jsx)(o.MessageCircle,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Нет заблокированных пользователей"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Заблокированные пользователи появятся здесь"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Y.map(e=>(0,s.jsxs)("div",{className:"bg-white rounded-xl p-5 border-2 border-red-300 bg-red-50/20 shadow-sm",children:[(0,s.jsx)("div",{className:"flex items-start justify-between mb-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[e.avatar_url?(0,s.jsx)("img",{src:e.avatar_url,alt:e.name,className:"w-12 h-12 rounded-full object-cover shadow-sm"}):(0,s.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-gray-400 to-gray-500 rounded-full flex items-center justify-center shadow-sm",children:(0,s.jsx)(c.User,{className:"w-6 h-6 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:e.name}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:e.email})]})]})}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)(u.Badge,{variant:"secondary",className:"bg-red-100 text-red-700 border-red-300 mb-2",children:[(0,s.jsx)(m.Ban,{className:"w-3 h-3 mr-1"}),"Заблокирован"]}),e.phone&&(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:e.phone})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1.5 text-xs text-gray-500",children:[(0,s.jsx)(n.Clock,{className:"w-3.5 h-3.5"}),(0,s.jsx)("span",{children:new Date(e.registration_date).toLocaleDateString("ru-RU")})]}),(0,s.jsxs)(b.Button,{onClick:()=>K(e.id),disabled:$===e.id,className:"bg-blue-500 hover:bg-blue-600 text-white text-xs px-3 py-1.5 flex items-center gap-1.5",children:[$===e.id?(0,s.jsx)(h.Loader2,{className:"w-3.5 h-3.5 animate-spin"}):(0,s.jsx)(x,{className:"w-3.5 h-3.5"}),"Разблокировать"]})]})]},e.id))}),X>1&&(0,s.jsx)(A.Pagination,{currentPage:G,totalPages:X,onPageChange:V,className:"mt-6"})]}):0===R.length?(0,s.jsxs)("div",{className:"bg-white rounded-lg p-12 text-center border border-gray-200",children:[(0,s.jsx)(o.MessageCircle,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,s.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:["ALL"===O&&"Нет чатов","WAITING"===O&&"Нет ожидающих чатов","ACTIVE"===O&&"Нет активных чатов","CLOSED"===O&&"Нет закрытых чатов"]}),(0,s.jsxs)("p",{className:"text-gray-600",children:["WAITING"===O&&"Когда пациенты напишут, их чаты появятся здесь","ACTIVE"===O&&"Нет активных чатов в данный момент","CLOSED"===O&&"Нет закрытых чатов","ALL"===O&&"Чаты появятся когда пациенты начнут писать"]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Q.map(e=>(0,s.jsxs)("div",{className:`bg-white rounded-xl p-5 border-2 transition-all cursor-pointer ${e.has_unread_operator?"border-emerald-400 bg-emerald-50/30 shadow-sm hover:shadow-md":"border-gray-200 hover:border-emerald-300 hover:shadow-md"}`,onClick:()=>D(e.id),children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[e.patient.avatar_url?(0,s.jsx)("img",{src:e.patient.avatar_url,alt:e.patient.name,className:"w-12 h-12 rounded-full object-cover shadow-sm"}):(0,s.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-full flex items-center justify-center shadow-sm",children:(0,s.jsx)(c.User,{className:"w-6 h-6 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:e.patient.name}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:e.patient.email})]})]}),e.has_unread_operator&&(0,s.jsx)("div",{className:"w-2.5 h-2.5 bg-red-500 rounded-full animate-pulse"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3 flex-wrap",children:[(e=>{switch(e){case"WAITING":return(0,s.jsx)(u.Badge,{variant:"outline",className:"border-amber-400 text-amber-700 bg-amber-50",children:"Ожидает"});case"ACTIVE":return(0,s.jsx)(u.Badge,{variant:"default",className:"bg-emerald-500 text-white border-transparent shadow-sm",children:"Активный"});case"CLOSED":return(0,s.jsx)(u.Badge,{variant:"secondary",className:"bg-gray-200 text-gray-700",children:"Закрыт"});default:return null}})(e.status),e.operator&&(0,s.jsxs)("span",{className:"text-xs text-gray-500",children:["Оператор: ",e.operator.name]})]}),e.messages.length>0&&(0,s.jsx)("div",{className:"mb-3",children:(0,s.jsx)("p",{className:"text-sm text-gray-700 line-clamp-2",children:e.messages[0].content})}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 pt-3 border-t border-gray-100",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,s.jsx)(n.Clock,{className:"w-3.5 h-3.5"}),(0,s.jsx)("span",{children:e.last_message_at?(e=>{let s=new Date,a=new Date(e),t=Math.floor((s.getTime()-a.getTime())/6e4);if(t<1)return"только что";if(t<60)return`${t} мин назад`;let r=Math.floor(t/60);if(r<24)return`${r} ч назад`;let l=Math.floor(r/24);return`${l} д назад`})(e.last_message_at):"Нет сообщений"})]}),e.has_unread_operator?(0,s.jsx)("span",{className:"text-emerald-600 font-semibold",children:"Новое"}):(0,s.jsx)(d.CheckCheck,{className:"w-4 h-4 text-gray-400"})]})]},e.id))}),F>1&&(0,s.jsx)(A.Pagination,{currentPage:G,totalPages:F,onPageChange:V,className:"mt-6"})]})]}),I&&(0,s.jsx)(C,{chatId:I,onClose:()=>{D(null),W(),H()}})]})}e.s(["default",()=>S],84348)}]);