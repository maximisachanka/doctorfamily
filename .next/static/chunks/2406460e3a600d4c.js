(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"warnOnce",{enumerable:!0,get:function(){return s}});let s=e=>{}},18050,e=>{"use strict";var t=e.i(43476),a=e.i(73375),s=e.i(63059),i=e.i(26299);function r({currentPage:e,totalPages:r,onPageChange:l,className:n=""}){if(r<=1)return null;let c=(()=>{let t=[];if(r<=5)for(let e=1;e<=r;e++)t.push(e);else{t.push(1),e>3&&t.push("...");let a=Math.max(2,e-1),s=Math.min(r-1,e+1);for(let e=a;e<=s;e++)t.push(e);e<r-2&&t.push("..."),t.push(r)}return t})();return(0,t.jsxs)("div",{className:`flex items-center justify-center gap-2 ${n}`,children:[(0,t.jsx)(i.Button,{onClick:()=>l(e-1),disabled:1===e,variant:"outline",className:"h-10 w-10 p-0 border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed hidden sm:flex items-center justify-center",children:(0,t.jsx)(a.ChevronLeft,{className:"w-5 h-5"})}),(0,t.jsxs)("div",{className:"flex sm:hidden items-center gap-2",children:[(0,t.jsx)(i.Button,{onClick:()=>l(e-1),disabled:1===e,variant:"outline",className:"h-10 px-3 border-gray-300 hover:bg-gray-50 disabled:opacity-50",children:(0,t.jsx)(a.ChevronLeft,{className:"w-4 h-4"})}),(0,t.jsxs)("span",{className:"text-sm text-gray-700 min-w-[80px] text-center",children:[e," / ",r]}),(0,t.jsx)(i.Button,{onClick:()=>l(e+1),disabled:e===r,variant:"outline",className:"h-10 px-3 border-gray-300 hover:bg-gray-50 disabled:opacity-50",children:(0,t.jsx)(s.ChevronRight,{className:"w-4 h-4"})})]}),(0,t.jsx)("div",{className:"hidden sm:flex items-center gap-2",children:c.map((a,s)=>{if("..."===a)return(0,t.jsx)("span",{className:"px-2 text-gray-500",children:"..."},`ellipsis-${s}`);let r=a===e;return(0,t.jsx)(i.Button,{onClick:()=>l(a),variant:r?"default":"outline",className:`h-10 w-10 p-0 ${r?"bg-[#18A36C] hover:bg-[#18A36C]/90 text-white border-[#18A36C]":"border-gray-300 hover:bg-gray-50 text-gray-700"}`,children:a},a)})}),(0,t.jsx)(i.Button,{onClick:()=>l(e+1),disabled:e===r,variant:"outline",className:"h-10 w-10 p-0 border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed hidden sm:flex items-center justify-center",children:(0,t.jsx)(s.ChevronRight,{className:"w-5 h-5"})})]})}e.s(["Pagination",()=>r])},69524,91900,e=>{"use strict";var t=e.i(43476),a=e.i(46932),s=e.i(88653),i=e.i(78894),r=e.i(37727),l=e.i(26299);function n({isOpen:e,onClose:n,onConfirm:c,title:d,message:o,confirmText:m="Удалить",cancelText:x="Отмена",variant:h="danger",loading:g=!1}){return e?(0,t.jsx)(s.AnimatePresence,{children:e&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:n,className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[9998]"}),(0,t.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",children:(0,t.jsxs)(a.motion.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",duration:.3},className:"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,t.jsx)("div",{className:`px-6 py-5 border-b border-gray-100 ${"danger"===h?"bg-red-50":"bg-yellow-50"}`,children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${"danger"===h?"bg-red-100":"bg-yellow-100"}`,children:(0,t.jsx)(i.AlertTriangle,{className:`w-6 h-6 ${"danger"===h?"text-red-600":"text-yellow-600"}`})}),(0,t.jsx)("div",{children:(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:d})})]}),(0,t.jsx)("button",{onClick:n,disabled:g,className:"text-gray-400 hover:text-gray-600 transition-colors disabled:opacity-50",children:(0,t.jsx)(r.X,{className:"w-5 h-5"})})]})}),(0,t.jsx)("div",{className:"px-6 py-5",children:(0,t.jsx)("p",{className:"text-gray-600 leading-relaxed",children:o})}),(0,t.jsxs)("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-100 flex items-center justify-end gap-3",children:[(0,t.jsx)(l.Button,{onClick:n,disabled:g,variant:"ghost",className:"px-5 py-2.5",children:x}),(0,t.jsx)("button",{onClick:()=>{c()},disabled:g,className:`px-5 py-2.5 rounded-xl font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed ${"danger"===h?"bg-red-600 hover:bg-red-700 text-white shadow-lg shadow-red-600/30":"bg-yellow-600 hover:bg-yellow-700 text-white shadow-lg shadow-yellow-600/30"}`,children:g?(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),(0,t.jsx)("span",{children:"Удаление..."})]}):m})]})]})})]})}):null}e.s(["ConfirmDialog",()=>n],69524);var c=e.i(71645);function d(){let[e,t]=(0,c.useState)(!1),[a,s]=(0,c.useState)(!1),[i,r]=(0,c.useState)({title:"",message:""}),[l,n]=(0,c.useState)(null),d=(0,c.useCallback)(e=>(r(e),t(!0),s(!1),new Promise(e=>{n({resolve:e})})),[]);return{confirm:d,isOpen:e,loading:a,options:i,handleConfirm:(0,c.useCallback)(async()=>{l&&(s(!0),await new Promise(e=>setTimeout(e,300)),l.resolve(!0),t(!1),s(!1),n(null))},[l]),handleCancel:(0,c.useCallback)(()=>{l&&(l.resolve(!1),t(!1),s(!1),n(null))},[l])}}e.s(["useConfirmDialog",()=>d],91900)},87690,e=>{"use strict";e.i(51651),e.i(5901),e.i(86633),e.s([])},68181,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(17255),i=e.i(88653),r=e.i(46932),l=e.i(63488),n=e.i(31278),c=e.i(87316),d=e.i(69638),o=e.i(3116),m=e.i(14764),x=e.i(86536),h=e.i(37727),g=e.i(23622),p=e.i(82293),u=e.i(18050),f=e.i(75961),b=e.i(4125),j=e.i(29306),y=e.i(18026),w=e.i(45347),N=e.i(73250),v=e.i(69524),C=e.i(91900);e.i(87690);var _=e.i(86633),k=e.i(42002);function S(){let{status:e}=(0,s.useSession)(),{sessionVerified:S,isLoading:A,verifySession:$}=(0,w.useAdminSession)(),[T,P]=(0,a.useState)(null),[B,D]=(0,a.useState)(!1),L=(0,C.useConfirmDialog)(),{success:U,error:M}=(0,_.useAlert)(),{refetch:O}=(0,k.useUnreadCountsContext)(),[E,R]=(0,a.useState)([]),[z,F]=(0,a.useState)(!1),[X,J]=(0,a.useState)(""),[K,I]=(0,a.useState)(1),[V,q]=(0,a.useState)("unread"),[G,H]=(0,a.useState)(null),[Q,W]=(0,a.useState)(""),[Y,Z]=(0,a.useState)(!1),[ee,et]=(0,a.useState)(!1);(0,a.useEffect)(()=>{"authenticated"===e?ea():"unauthenticated"===e&&P(!1)},[e]),(0,a.useEffect)(()=>{S&&T&&B&&es()},[S,T,B]);let ea=async()=>{try{let e=await fetch("/api/admin/auth"),t=await e.json();P(t.isAdmin),D(t.isChiefDoctor)}catch(e){P(!1)}},es=async()=>{F(!0);try{let e=await fetch("/api/admin/letters");if(e.ok){let t=await e.json();R(t),await fetch("/api/admin/letters/mark-all-read",{method:"POST"}),await O()}}catch(e){console.error("Error loading data:",e)}finally{F(!1)}},ei=(0,a.useMemo)(()=>{let e=E;if("unread"===V?e=e.filter(e=>!e.reply||e.has_new_patient_message):"replied"===V&&(e=e.filter(e=>e.reply&&!e.has_new_patient_message)),X){let t=X.toLowerCase();e=e.filter(e=>e.subject.toLowerCase().includes(t)||e.content.toLowerCase().includes(t)||e.patient.name.toLowerCase().includes(t)||e.patient.email.toLowerCase().includes(t))}return e},[E,X,V]),er=(0,a.useMemo)(()=>E.filter(e=>!e.reply||e.has_new_patient_message).length,[E]);(0,a.useEffect)(()=>{I(1)},[X,V]);let el=Math.ceil(ei.length/12),en=(0,a.useMemo)(()=>{let e=(K-1)*12;return ei.slice(e,e+12)},[ei,K]),ec=async e=>{if(H(e),W(e.reply||""),!e.is_read)try{await fetch(`/api/admin/letters/${e.id}`),R(t=>t.map(t=>t.id===e.id?{...t,is_read:!0}:t))}catch(e){console.error("Error marking letter as read:",e)}},ed=async()=>{if(G&&Q.trim()){Z(!0);try{let e=await fetch(`/api/admin/letters/${G.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({reply:Q})});if(e.ok)await es(),H(null),W(""),U("Ответ отправлен");else{let t=await e.json();M(t.error||"Ошибка отправки")}}catch(e){M("Ошибка отправки")}finally{Z(!1)}}},eo=async(e,t)=>{if(await L.confirm({title:"Удаление письма",message:`Вы уверены, что хотите удалить письмо "${t}"? Это действие нельзя отменить.`,confirmText:"Удалить",cancelText:"Отмена",variant:"danger"}))try{let t=await fetch(`/api/admin/letters/${e}`,{method:"DELETE"});if(t.ok)await es(),U("Письмо удалено");else{let e=await t.json();M(e.error||"Ошибка удаления")}}catch(e){M("Ошибка удаления")}},em=async(e,t)=>{if(await L.confirm({title:t?"Разблокировка пользователя":"Блокировка пользователя",message:`Вы уверены, что хотите ${t?"разблокировать":"заблокировать"} этого пользователя? ${!t?"Он не сможет отправлять письма.":""}`,confirmText:t?"Разблокировать":"Заблокировать",cancelText:"Отмена",variant:t?"warning":"danger"})){et(!0);try{let a=await fetch(`/api/admin/users/${e}/block`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({blocked:!t})});if(a.ok)R(a=>a.map(a=>a.patient.id===e?{...a,patient:{...a.patient,is_messages_blocked:!t}}:a)),G&&G.patient.id===e&&H(e=>e?{...e,patient:{...e.patient,is_messages_blocked:!t}}:null),U(t?"Пользователь разблокирован":"Пользователь заблокирован");else{let e=await a.json();M(e.error||"Ошибка")}}catch(e){M("Ошибка при изменении статуса")}finally{et(!1)}}},ex=e=>{let t=e.trim().split(/\s+/);return t.length>=2?(t[0][0]+t[1][0]).toUpperCase():e.slice(0,2).toUpperCase()};return"loading"===e||null===T||A?(0,t.jsx)(N.AdminAccessSkeleton,{}):"unauthenticated"!==e&&T&&B?S?(0,t.jsxs)("div",{className:"flex min-h-screen bg-gray-50",children:[(0,t.jsx)(f.AdminMenu,{}),(0,t.jsx)("div",{className:"flex-1 p-4 lg:p-8 overflow-auto",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,t.jsxs)(b.AdminSection,{title:"Письма главному врачу",icon:l.Mail,count:E.length,loading:z,searchValue:X,onSearchChange:J,children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-6",children:[(0,t.jsxs)("button",{onClick:()=>q("unread"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${"unread"===V?"bg-amber-500 text-white shadow-md":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-200"}`,children:[(0,t.jsx)(o.Clock,{className:"w-4 h-4"}),"Без ответа",er>0&&(0,t.jsx)("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold ${"unread"===V?"bg-white/20 text-white":"bg-amber-100 text-amber-700"}`,children:er})]}),(0,t.jsxs)("button",{onClick:()=>q("replied"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${"replied"===V?"bg-[#18A36C] text-white shadow-md":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-200"}`,children:[(0,t.jsx)(d.CheckCircle,{className:"w-4 h-4"}),"С ответом"]}),(0,t.jsxs)("button",{onClick:()=>q("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${"all"===V?"bg-gray-700 text-white shadow-md":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-200"}`,children:[(0,t.jsx)(l.Mail,{className:"w-4 h-4"}),"Все письма"]})]}),0===ei.length?(0,t.jsx)(b.EmptyState,{icon:l.Mail,title:"Письма не найдены",description:X?"Попробуйте изменить поисковый запрос":"Пока нет писем от пациентов"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,t.jsx)(i.AnimatePresence,{children:en.map(e=>(0,t.jsxs)(b.ItemCard,{children:[(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)("div",{className:"w-12 h-12 rounded-full overflow-hidden flex-shrink-0 bg-[#18A36C] flex items-center justify-center",children:e.patient.avatar_url?(0,t.jsx)("img",{src:e.patient.avatar_url,alt:e.patient.name,className:"w-full h-full object-cover"}):(0,t.jsx)("span",{className:"text-sm font-semibold text-white",children:ex(e.patient.name)})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-800 truncate",children:e.subject}),!e.is_read&&!e.reply&&(0,t.jsx)("span",{className:"w-2 h-2 bg-amber-500 rounded-full flex-shrink-0"})]}),(0,t.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:e.patient.name}),(0,t.jsxs)("p",{className:"text-xs text-gray-400 flex items-center gap-1",children:[(0,t.jsx)(c.Calendar,{className:"w-3 h-3"}),new Date(e.created_at).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]}),(0,t.jsx)("p",{className:"text-sm text-gray-500 line-clamp-2 mt-3",children:e.content}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-3 flex-wrap",children:[e.patient.is_messages_blocked&&(0,t.jsxs)(b.Badge,{variant:"danger",children:[(0,t.jsx)(g.Ban,{className:"w-3 h-3 mr-1"}),"Заблокирован"]}),e.has_new_patient_message?(0,t.jsx)(b.Badge,{variant:"warning",children:"Новое сообщение"}):e.reply?(0,t.jsx)(b.Badge,{variant:"success",children:"Отвечено"}):(0,t.jsx)(b.Badge,{variant:"warning",children:"Ожидает ответа"}),e.messages&&e.messages.length>0&&(0,t.jsxs)(b.Badge,{variant:"secondary",children:[e.messages.length+1," сообщ."]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-gray-100",children:[(0,t.jsxs)("button",{onClick:()=>ec(e),className:"flex items-center gap-1.5 px-3 py-1.5 bg-[#18A36C] text-white text-sm font-medium rounded-lg hover:bg-[#15905f] transition-colors",children:[(0,t.jsx)(x.Eye,{className:"w-4 h-4"}),e.reply?"Просмотреть":"Ответить"]}),(0,t.jsx)("button",{onClick:()=>eo(e.id,e.subject),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",title:"Удалить",children:(0,t.jsx)(h.X,{className:"w-4 h-4"})})]})]},e.id))})}),el>1&&(0,t.jsx)(u.Pagination,{currentPage:K,totalPages:el,onPageChange:I,className:"mt-6"})]})]}),(0,t.jsx)(i.AnimatePresence,{children:G&&(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,t.jsx)(r.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>!Y&&H(null),className:"absolute inset-0 bg-black/50 backdrop-blur-sm"}),(0,t.jsxs)(r.motion.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative w-full max-w-2xl bg-white rounded-2xl shadow-2xl overflow-hidden max-h-[90vh] flex flex-col",children:[(0,t.jsx)("div",{className:"bg-[#18A36C] px-6 py-4 flex-shrink-0",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-white",children:"Письмо"}),(0,t.jsx)("button",{onClick:()=>!Y&&H(null),className:"p-1.5 hover:bg-white/20 rounded-lg transition-colors",children:(0,t.jsx)(h.X,{className:"w-5 h-5 text-white"})})]})}),(0,t.jsxs)("div",{className:"p-6 overflow-y-auto flex-1",children:[(0,t.jsxs)("div",{className:"flex items-start gap-4 mb-4 pb-4 border-b border-gray-100",children:[(0,t.jsx)("div",{className:"w-14 h-14 rounded-full overflow-hidden flex-shrink-0 bg-[#18A36C] flex items-center justify-center",children:G.patient.avatar_url?(0,t.jsx)("img",{src:G.patient.avatar_url,alt:G.patient.name,className:"w-full h-full object-cover"}):(0,t.jsx)("span",{className:"text-lg font-semibold text-white",children:ex(G.patient.name)})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-800 text-lg",children:G.patient.name}),G.patient.is_messages_blocked&&(0,t.jsxs)("span",{className:"px-2 py-0.5 bg-red-100 text-red-600 text-xs font-medium rounded-full flex items-center gap-1",children:[(0,t.jsx)(g.Ban,{className:"w-3 h-3"}),"Заблокирован"]})]}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:G.patient.email}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:G.patient.phone})]}),(0,t.jsxs)("button",{onClick:()=>em(G.patient.id,G.patient.is_messages_blocked),disabled:ee,className:`flex items-center gap-1.5 px-3 py-2 rounded-lg text-sm font-medium transition-colors disabled:opacity-50 ${G.patient.is_messages_blocked?"bg-green-100 text-green-700 hover:bg-green-200":"bg-red-100 text-red-700 hover:bg-red-200"}`,title:G.patient.is_messages_blocked?"Разблокировать пользователя":"Заблокировать пользователя",children:[ee?(0,t.jsx)(n.Loader2,{className:"w-4 h-4 animate-spin"}):G.patient.is_messages_blocked?(0,t.jsx)(p.UserCheck,{className:"w-4 h-4"}):(0,t.jsx)(g.Ban,{className:"w-4 h-4"}),G.patient.is_messages_blocked?"Разблокировать":"Заблокировать"]})]}),(0,t.jsx)("h4",{className:"font-semibold text-gray-800 text-lg mb-2",children:G.subject}),(0,t.jsx)("p",{className:"text-xs text-gray-400 mb-4",children:new Date(G.created_at).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})}),(0,t.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full overflow-hidden flex-shrink-0 bg-[#18A36C] flex items-center justify-center",children:G.patient.avatar_url?(0,t.jsx)("img",{src:G.patient.avatar_url,alt:G.patient.name,className:"w-full h-full object-cover"}):(0,t.jsx)("span",{className:"text-xs font-semibold text-white",children:ex(G.patient.name)})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"bg-gray-100 rounded-xl p-4",children:(0,t.jsx)("p",{className:"text-gray-700 whitespace-pre-wrap",children:G.content})}),(0,t.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:new Date(G.created_at).toLocaleDateString("ru-RU",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})})]})]}),G.reply&&(0,t.jsx)("div",{className:"flex gap-3 justify-end",children:(0,t.jsxs)("div",{className:"flex-1 max-w-[85%]",children:[(0,t.jsx)("div",{className:"bg-[#18A36C]/10 rounded-xl p-4",children:(0,t.jsx)("p",{className:"text-gray-700 whitespace-pre-wrap",children:G.reply})}),(0,t.jsxs)("p",{className:"text-xs text-gray-400 mt-1 text-right",children:[(0,t.jsx)(d.CheckCircle,{className:"w-3 h-3 inline mr-1 text-[#18A36C]"}),"Вы, ",G.replied_at&&new Date(G.replied_at).toLocaleDateString("ru-RU",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})]})]})}),G.messages&&G.messages.map(e=>(0,t.jsxs)("div",{className:`flex gap-3 ${"chief_doctor"===e.sender_type?"justify-end":""}`,children:["patient"===e.sender_type&&(0,t.jsx)("div",{className:"w-8 h-8 rounded-full overflow-hidden flex-shrink-0 bg-[#18A36C] flex items-center justify-center",children:G.patient.avatar_url?(0,t.jsx)("img",{src:G.patient.avatar_url,alt:G.patient.name,className:"w-full h-full object-cover"}):(0,t.jsx)("span",{className:"text-xs font-semibold text-white",children:ex(G.patient.name)})}),(0,t.jsxs)("div",{className:`flex-1 ${"chief_doctor"===e.sender_type?"max-w-[85%]":""}`,children:[(0,t.jsx)("div",{className:`rounded-xl p-4 ${"chief_doctor"===e.sender_type?"bg-[#18A36C]/10":"bg-gray-100"}`,children:(0,t.jsx)("p",{className:"text-gray-700 whitespace-pre-wrap",children:e.content})}),(0,t.jsxs)("p",{className:`text-xs text-gray-400 mt-1 ${"chief_doctor"===e.sender_type?"text-right":""}`,children:["chief_doctor"===e.sender_type&&(0,t.jsx)(d.CheckCircle,{className:"w-3 h-3 inline mr-1 text-[#18A36C]"}),"chief_doctor"===e.sender_type?"Вы":G.patient.name.split(" ")[0],", ",new Date(e.created_at).toLocaleDateString("ru-RU",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})]})]})]},e.id))]}),B&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:G.reply?"Продолжить переписку":"Ваш ответ"}),(0,t.jsx)("textarea",{value:Q,onChange:e=>W(e.target.value),rows:4,className:"w-full px-4 py-3 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-[#18A36C]/20 focus:border-[#18A36C] transition-all resize-none",placeholder:"Введите ваш ответ пациенту..."})]}),!B&&(0,t.jsx)("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4",children:(0,t.jsx)("p",{className:"text-amber-700 text-sm",children:"Только главный врач может отвечать на письма пациентов."})})]}),B&&(0,t.jsxs)("div",{className:"flex items-center gap-3 p-6 pt-0 flex-shrink-0",children:[(0,t.jsx)("button",{onClick:()=>H(null),disabled:Y,className:"flex-1 px-4 py-2.5 border border-gray-200 text-gray-700 font-medium rounded-xl hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Закрыть"}),(0,t.jsxs)("button",{onClick:ed,disabled:Y||!Q.trim(),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-[#18A36C] text-white font-medium rounded-xl hover:bg-[#15905f] transition-colors disabled:opacity-50",children:[Y?(0,t.jsx)(n.Loader2,{className:"w-4 h-4 animate-spin"}):(0,t.jsx)(m.Send,{className:"w-4 h-4"}),"Отправить"]})]})]})]})}),(0,t.jsx)(v.ConfirmDialog,{isOpen:L.isOpen,onClose:L.handleCancel,onConfirm:L.handleConfirm,title:L.options.title,message:L.options.message,confirmText:L.options.confirmText,cancelText:L.options.cancelText,variant:L.options.variant,loading:L.loading})]})})]}):(0,t.jsx)(y.AdminAuthForm,{onSuccess:()=>{$()}}):(0,t.jsx)(j.default,{})}e.s(["default",()=>S])}]);