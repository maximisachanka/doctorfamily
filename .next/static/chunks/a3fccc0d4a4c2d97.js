(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,42002,e=>{"use strict";var t=e.i(43476),r=e.i(71645);let n=(0,r.createContext)(void 0);function c({children:e}){let{counts:c,loading:i,refetch:a}=function(e=3e4){let[t,n]=(0,r.useState)({feedbacks:0,letters:0,chats:0}),[c,i]=(0,r.useState)(!0),a=async()=>{try{let e=await fetch("/api/admin/unread-counts");if(e.ok){let t=await e.json();n(t)}}catch(e){console.error("Error fetching unread counts:",e)}finally{i(!1)}};return(0,r.useEffect)(()=>{a();let t=setInterval(a,e);return()=>clearInterval(t)},[e]),{counts:t,loading:c,refetch:a}}(3e4);return(0,t.jsx)(n.Provider,{value:{counts:c,loading:i,refetch:a},children:e})}function i(){let e=(0,r.useContext)(n);return e||{counts:{feedbacks:0,letters:0,chats:0},loading:!1,refetch:async()=>{}}}e.s(["UnreadCountsProvider",()=>c,"useUnreadCountsContext",()=>i],42002)},36160,e=>{"use strict";var t=e.i(43476),r=e.i(17255),n=e.i(86633),c=e.i(42002),i=e.i(71645),a=e.i(18566);let u="chat-notifications-notified";function s({children:e}){return!function(){let{data:e,status:t}=(0,r.useSession)(),c=(0,a.usePathname)(),s=(0,n.useAlert)(),l=(0,i.useRef)(null),o=(0,i.useRef)(null),f=(0,i.useRef)(!1);(0,i.useEffect)(()=>{f.current=c?.startsWith("/admin")||!1},[c]),(0,i.useEffect)(()=>{o.current=new Audio("/sounds/notification.mp3"),o.current.volume=.5},[]);let d=(0,i.useCallback)(()=>{o.current&&(o.current.currentTime=0,o.current.play().catch(()=>{}))},[]),h=(0,i.useCallback)(async()=>{if("authenticated"===t&&e&&f.current)try{let e=await fetch("/api/operator-chat?unread_only=true");if(!e.ok)return;let t=(await e.json()).chats||[];if(0===t.length)return;let r=JSON.parse(localStorage.getItem(u)||"[]"),n=t.filter(e=>!r.includes(e.id));if(n.length>0){if(d(),1===n.length){let e=n[0],t=e.messages[0]?.content||"",r=t.length>50?t.substring(0,50)+"...":t;s.info(`Новое сообщение от ${e.patient.name}: "${r}"`,"Новое сообщение в чате")}else s.info(`У вас ${n.length} новых сообщений в чате. Проверьте раздел "Чат".`,"Новые сообщения");let e=[...r,...n.map(e=>e.id)];localStorage.setItem(u,JSON.stringify(e))}}catch(e){console.error("Error checking for chat notifications:",e)}},[e,t,s,d]);(0,i.useEffect)(()=>{if("authenticated"!==t||!f.current)return;let e=setTimeout(()=>{h()},2e3);return()=>clearTimeout(e)},[t,c,h]),(0,i.useEffect)(()=>{if("authenticated"!==t||!f.current){l.current&&(clearInterval(l.current),l.current=null);return}return l.current=setInterval(h,15e3),()=>{l.current&&(clearInterval(l.current),l.current=null)}},[t,c,h])}(),(0,t.jsx)(t.Fragment,{children:e})}function l({children:e}){return(0,t.jsx)(r.SessionProvider,{children:(0,t.jsx)(n.AlertProvider,{children:(0,t.jsx)(c.UnreadCountsProvider,{children:(0,t.jsx)(s,{children:(0,t.jsx)("div",{className:"min-h-screen bg-gray-50",children:e})})})})})}e.s(["AdminProviders",()=>l],36160)}]);