(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,a,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"warnOnce",{enumerable:!0,get:function(){return t}});let t=e=>{}},91900,e=>{"use strict";var a=e.i(71645);function i(){let[e,i]=(0,a.useState)(!1),[t,s]=(0,a.useState)(!1),[l,r]=(0,a.useState)({title:"",message:""}),[n,d]=(0,a.useState)(null),o=(0,a.useCallback)(e=>(r(e),i(!0),s(!1),new Promise(e=>{d({resolve:e})})),[]);return{confirm:o,isOpen:e,loading:t,options:l,handleConfirm:(0,a.useCallback)(async()=>{n&&(s(!0),await new Promise(e=>setTimeout(e,300)),n.resolve(!0),i(!1),s(!1),d(null))},[n]),handleCancel:(0,a.useCallback)(()=>{n&&(n.resolve(!1),i(!1),s(!1),d(null))},[n])}}e.s(["useConfirmDialog",()=>i])},69524,e=>{"use strict";var a=e.i(43476),i=e.i(46932),t=e.i(88653),s=e.i(78894),l=e.i(37727),r=e.i(26299);function n({isOpen:e,onClose:n,onConfirm:d,title:o,message:c,confirmText:h="Удалить",cancelText:m="Отмена",variant:u="danger",loading:x=!1}){return e?(0,a.jsx)(t.AnimatePresence,{children:e&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:n,className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[9998]"}),(0,a.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",children:(0,a.jsxs)(i.motion.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",duration:.3},className:"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("div",{className:`px-6 py-5 border-b border-gray-100 ${"danger"===u?"bg-red-50":"bg-yellow-50"}`,children:(0,a.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${"danger"===u?"bg-red-100":"bg-yellow-100"}`,children:(0,a.jsx)(s.AlertTriangle,{className:`w-6 h-6 ${"danger"===u?"text-red-600":"text-yellow-600"}`})}),(0,a.jsx)("div",{children:(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:o})})]}),(0,a.jsx)("button",{onClick:n,disabled:x,className:"text-gray-400 hover:text-gray-600 transition-colors disabled:opacity-50 cursor-pointer",children:(0,a.jsx)(l.X,{className:"w-5 h-5"})})]})}),(0,a.jsx)("div",{className:"px-6 py-5",children:(0,a.jsx)("p",{className:"text-gray-600 leading-relaxed",children:c})}),(0,a.jsxs)("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-100 flex items-center justify-end gap-3",children:[(0,a.jsx)(r.Button,{onClick:n,disabled:x,variant:"ghost",className:"px-5 py-2.5 cursor-pointer",children:m}),(0,a.jsx)("button",{onClick:()=>{d()},disabled:x,className:`px-5 py-2.5 rounded-xl font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer ${"danger"===u?"bg-red-600 hover:bg-red-700 text-white shadow-lg shadow-red-600/30":"bg-yellow-600 hover:bg-yellow-700 text-white shadow-lg shadow-yellow-600/30"}`,children:x?(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),(0,a.jsx)("span",{children:"Удаление..."})]}):h})]})]})})]})}):null}e.s(["ConfirmDialog",()=>n])},31171,e=>{"use strict";let a=(0,e.i(75254).default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);e.s(["default",()=>a])},64659,e=>{"use strict";var a=e.i(31171);e.s(["ChevronDown",()=>a.default])},7475,e=>{"use strict";var a=e.i(43476),i=e.i(71645),t=e.i(17255);let s=(0,e.i(75254).default)("folder-tree",[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]]);var l=e.i(63059),r=e.i(64659),n=e.i(88653),d=e.i(75961),o=e.i(4125),c=e.i(29306),h=e.i(18026),m=e.i(45347),u=e.i(86633),x=e.i(73250),g=e.i(91900),p=e.i(69524),j=e.i(27280);let v=["Baby","Smile","Heart","Activity","Eye","Brain","Users","Stethoscope","ShieldPlus","Syringe","Pill","Microscope","Hospital","Dna"];function y(){let e,{status:y}=(0,t.useSession)(),{sessionVerified:f,isLoading:b,verifySession:w}=(0,m.useAdminSession)(),[N,C]=(0,i.useState)(null),[S,F]=(0,i.useState)(!0),{success:k,error:A}=(0,u.useAlert)(),T=(0,g.useConfirmDialog)(),[_,P]=(0,i.useState)([]),[M,O]=(0,i.useState)(!1),[B,D]=(0,i.useState)(new Set),[E,$]=(0,i.useState)(""),[I,L]=(0,i.useState)(!1),[U,R]=(0,i.useState)(null),[q,z]=(0,i.useState)(!1),[H,K]=(0,i.useState)({name:"",slug:"",icon:"",description:"",parent_id:"",order:"0",is_active:!0});(0,i.useEffect)(()=>{"authenticated"===y?V():"unauthenticated"===y&&C(!1)},[y]),(0,i.useEffect)(()=>{f&&N&&Z()},[f,N]);let V=async()=>{F(!0);try{let e=await fetch("/api/admin/auth"),a=await e.json();C(a.isAdmin)}catch(e){C(!1)}finally{F(!1)}},Z=async()=>{O(!0);try{let e=await fetch("/api/admin/service-categories");if(e.ok){let a=await e.json();P(a)}}catch(e){console.error("Error loading data:",e),A("Ошибка загрузки данных")}finally{O(!1)}},J=(0,i.useMemo)(()=>{let e=(a,i=0)=>{let t=[];for(let s of a)t.push({...s,level:i}),s.children&&s.children.length>0&&t.push(...e(s.children,i+1));return t};return e(_)},[_]),X=async()=>{z(!0);try{let e=U?`/api/admin/service-categories/${U.id}`:"/api/admin/service-categories",a=U?"PUT":"POST",i=await fetch(e,{method:a,headers:{"Content-Type":"application/json"},body:JSON.stringify({...H,parent_id:H.parent_id?parseInt(H.parent_id):null,order:parseInt(H.order)})});if(i.ok)await Z(),Q(),k(U?"Категория обновлена":"Категория создана");else{let e=await i.json();A(e.error||"Ошибка сохранения")}}catch(e){A("Ошибка сохранения")}finally{z(!1)}},G=async(e,a)=>{if(await T.confirm({title:"Удаление категории",message:`Вы уверены, что хотите удалить категорию "${a}"? Это также удалит все вложенные подкатегории. Это действие нельзя отменить.`,confirmText:"Удалить",cancelText:"Отмена",variant:"danger"}))try{let a=await fetch(`/api/admin/service-categories/${e}`,{method:"DELETE"});if(a.ok)await Z(),k("Категория удалена");else{let e=await a.json();A(e.error||"Ошибка удаления")}}catch(e){A("Ошибка удаления")}},Q=()=>{K({name:"",slug:"",icon:"",description:"",parent_id:"",order:"0",is_active:!0}),R(null),L(!1)},W=()=>{Q(),L(!0)},Y=(e,i=0)=>{let t=e.icon?j.iconMap[e.icon]:null,s=e.children&&e.children.length>0,n=B.has(e.id);return(0,a.jsxs)("div",{className:"mb-2 relative",style:{marginLeft:`${24*i}px`},children:[(0,a.jsxs)(o.ItemCard,{children:[s&&(0,a.jsx)("button",{onClick:()=>{var a;let i;return a=e.id,void((i=new Set(B)).has(a)?i.delete(a):i.add(a),D(i))},className:"absolute left-2 top-1/2 -translate-y-1/2 p-1 hover:bg-gray-100 rounded transition-colors",children:n?(0,a.jsx)(r.ChevronDown,{className:"w-4 h-4 text-gray-600"}):(0,a.jsx)(l.ChevronRight,{className:"w-4 h-4 text-gray-600"})}),(0,a.jsxs)("div",{className:s?"ml-8":"ml-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[t&&(0,a.jsx)("div",{className:"w-10 h-10 bg-[#18A36C]/10 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,a.jsx)(t,{className:"w-5 h-5 text-[#18A36C]"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-800",children:e.name}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["/",e.slug]})]})]}),e.description&&(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-wrap mb-3",children:[(0,a.jsxs)(o.Badge,{variant:"secondary",children:["Порядок: ",e.order]}),(0,a.jsx)(o.Badge,{variant:e.is_active?"success":"danger",children:e.is_active?"Активна":"Неактивна"}),s&&(0,a.jsxs)(o.Badge,{variant:"primary",children:["Подкатегорий: ",e.children.length]})]}),(0,a.jsx)("div",{className:"flex items-center justify-end pt-3 border-t border-gray-100",children:(0,a.jsx)(o.CardActions,{onEdit:()=>{R(e),K({name:e.name,slug:e.slug,icon:e.icon||"",description:e.description||"",parent_id:e.parent_id?.toString()||"",order:e.order.toString(),is_active:e.is_active}),L(!0)},onDelete:()=>G(e.id,e.name)})})]})]}),s&&n&&(0,a.jsx)("div",{className:"mt-2",children:e.children.map(e=>Y(e,i+1))})]},e.id)};return"loading"===y||null===N||b||S?(0,a.jsx)(x.AdminAccessSkeleton,{}):"unauthenticated"===y||!1===N?(0,a.jsx)(c.default,{}):f?(0,a.jsxs)("div",{className:"flex min-h-screen bg-gray-50",children:[(0,a.jsx)(d.AdminMenu,{}),(0,a.jsx)("div",{className:"flex-1 p-4 lg:p-8 overflow-auto",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsx)(o.AdminSection,{title:"Категории услуг",icon:s,count:J.length,loading:M,onAdd:W,addButtonText:"Добавить категорию",searchValue:E,onSearchChange:$,children:0===_.length?(0,a.jsx)(o.EmptyState,{icon:s,title:"Категории не найдены",description:"Добавьте первую категорию услуг",actionText:"Добавить категорию",onAction:W}):(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsx)(n.AnimatePresence,{children:_.map(e=>Y(e))})})}),(0,a.jsx)(o.FormModal,{isOpen:I,onClose:Q,title:U?"Редактирование категории":"Новая категория",onSubmit:X,loading:q,disabled:!H.name||!H.slug,children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)(o.FormField,{label:"Название",required:!0,children:(0,a.jsx)(o.FormInput,{type:"text",value:H.name,onChange:e=>{let a=e.target.value;K({...H,name:a,slug:U?H.slug:a.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")})},placeholder:"Детская стоматология"})}),(0,a.jsx)(o.FormField,{label:"Slug (URL)",required:!0,children:(0,a.jsx)(o.FormInput,{type:"text",value:H.slug,onChange:e=>K({...H,slug:e.target.value}),placeholder:"detskaya-stomatologiya"})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)(o.FormField,{label:"Иконка",children:[(0,a.jsxs)(o.FormSelect,{value:H.icon,onChange:e=>K({...H,icon:e.target.value}),children:[(0,a.jsx)("option",{value:"",children:"Без иконки"}),v.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}),H.icon&&j.iconMap[H.icon]&&(0,a.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-[#18A36C]/10 rounded flex items-center justify-center",children:(e=j.iconMap[H.icon],(0,a.jsx)(e,{className:"w-4 h-4 text-[#18A36C]"}))}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"Предпросмотр"})]})]}),(0,a.jsx)(o.FormField,{label:"Родительская категория",children:(0,a.jsxs)(o.FormSelect,{value:H.parent_id,onChange:e=>K({...H,parent_id:e.target.value}),children:[(0,a.jsx)("option",{value:"",children:"Корневая категория"}),J.filter(e=>!U||e.id!==U.id).map(e=>(0,a.jsxs)("option",{value:e.id,children:["—".repeat(e.level)," ",e.name]},e.id))]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)(o.FormField,{label:"Порядок сортировки",children:(0,a.jsx)(o.FormInput,{type:"number",value:H.order,onChange:e=>K({...H,order:e.target.value}),placeholder:"0"})}),(0,a.jsx)(o.FormField,{label:"Статус",children:(0,a.jsxs)(o.FormSelect,{value:H.is_active?"true":"false",onChange:e=>K({...H,is_active:"true"===e.target.value}),children:[(0,a.jsx)("option",{value:"true",children:"Активна"}),(0,a.jsx)("option",{value:"false",children:"Неактивна"})]})})]}),(0,a.jsx)(o.FormField,{label:"Описание",children:(0,a.jsx)(o.FormTextarea,{value:H.description,onChange:e=>K({...H,description:e.target.value}),rows:3,placeholder:"Краткое описание категории..."})})]})}),(0,a.jsx)(p.ConfirmDialog,{isOpen:T.isOpen,onClose:T.handleCancel,onConfirm:T.handleConfirm,title:T.options.title,message:T.options.message,confirmText:T.options.confirmText,cancelText:T.options.cancelText,variant:T.options.variant,loading:T.loading})]})})]}):(0,a.jsx)(h.AdminAuthForm,{onSuccess:()=>{w()}})}e.s(["default",()=>y],7475)}]);