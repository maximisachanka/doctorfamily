{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Study/commercial-projects/smartmedical/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\n  });\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\n\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEF,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 71, "column": 0}, "map": {"version":3,"sources":["file:///C:/Study/commercial-projects/smartmedical/src/app/api/specialists/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { prisma } from '@/lib/prisma';\n\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const categoryId = searchParams.get('categoryId');\n    const serviceCategorySlug = searchParams.get('serviceCategorySlug');\n\n    let specialists;\n\n    if (serviceCategorySlug) {\n      console.log('Filtering by service category slug:', serviceCategorySlug);\n\n      // Новый способ - фильтрация по категории услуг\n      // Сначала находим категорию услуг и все её подкатегории\n      // @ts-ignore\n      const serviceCategory = await prisma.serviceCategory.findUnique({\n        where: { slug: serviceCategorySlug },\n        include: {\n          children: {\n            include: {\n              children: true, // До 3 уровней вложенности\n            },\n          },\n        },\n      });\n\n      if (!serviceCategory) {\n        console.log('Service category not found:', serviceCategorySlug);\n        return NextResponse.json([]);\n      }\n\n      console.log('Found service category:', serviceCategory.name, 'ID:', serviceCategory.id);\n\n      // Собираем все ID категорий (текущая + все подкатегории)\n      const categoryIds = [serviceCategory.id];\n\n      // Добавляем ID подкатегорий первого уровня\n      if (serviceCategory.children) {\n        for (const child of serviceCategory.children) {\n          categoryIds.push(child.id);\n          // Добавляем ID подкатегорий второго уровня\n          if (child.children) {\n            for (const grandchild of child.children) {\n              categoryIds.push(grandchild.id);\n            }\n          }\n        }\n      }\n\n      console.log('Searching specialists with category IDs:', categoryIds);\n\n      // Находим специалистов, у которых:\n      // 1. service_category_id совпадает с категорией\n      // 2. ИЛИ есть услуги в этих категориях\n      specialists = await prisma.specialist.findMany({\n        where: {\n          OR: [\n            {\n              service_category_id: {\n                in: categoryIds,\n              },\n            },\n            {\n              services: {\n                some: {\n                  service: {\n                    service_category_id: {\n                      in: categoryIds,\n                    },\n                  },\n                },\n              },\n            },\n          ],\n        },\n        include: {\n          category: true,\n          serviceCategory: true,\n        },\n        orderBy: {\n          name: 'asc',\n        },\n      });\n\n      console.log('Found specialists:', specialists.length, specialists.map(s => ({ name: s.name, service_category_id: s.service_category_id })));\n    } else if (categoryId) {\n      // Старый способ - фильтрация по старой таблице категорий\n      specialists = await prisma.specialist.findMany({\n        where: {\n          category_id: parseInt(categoryId),\n        },\n        include: {\n          category: true,\n          serviceCategory: true,\n        },\n        orderBy: {\n          name: 'asc',\n        },\n      });\n    } else {\n      // Без фильтрации - все специалисты\n      specialists = await prisma.specialist.findMany({\n        include: {\n          category: true,\n          serviceCategory: true,\n        },\n        orderBy: {\n          name: 'asc',\n        },\n      });\n    }\n\n    return NextResponse.json(specialists);\n  } catch (error) {\n    console.error('Error fetching specialists:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch specialists' },\n      { status: 500 }\n    );\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,aAAa,aAAa,GAAG,CAAC;QACpC,MAAM,sBAAsB,aAAa,GAAG,CAAC;QAE7C,IAAI;QAEJ,IAAI,qBAAqB;YACvB,QAAQ,GAAG,CAAC,uCAAuC;YAEnD,+CAA+C;YAC/C,wDAAwD;YACxD,aAAa;YACb,MAAM,kBAAkB,MAAM,gIAAM,CAAC,eAAe,CAAC,UAAU,CAAC;gBAC9D,OAAO;oBAAE,MAAM;gBAAoB;gBACnC,SAAS;oBACP,UAAU;wBACR,SAAS;4BACP,UAAU;wBACZ;oBACF;gBACF;YACF;YAEA,IAAI,CAAC,iBAAiB;gBACpB,QAAQ,GAAG,CAAC,+BAA+B;gBAC3C,OAAO,gJAAY,CAAC,IAAI,CAAC,EAAE;YAC7B;YAEA,QAAQ,GAAG,CAAC,2BAA2B,gBAAgB,IAAI,EAAE,OAAO,gBAAgB,EAAE;YAEtF,yDAAyD;YACzD,MAAM,cAAc;gBAAC,gBAAgB,EAAE;aAAC;YAExC,2CAA2C;YAC3C,IAAI,gBAAgB,QAAQ,EAAE;gBAC5B,KAAK,MAAM,SAAS,gBAAgB,QAAQ,CAAE;oBAC5C,YAAY,IAAI,CAAC,MAAM,EAAE;oBACzB,2CAA2C;oBAC3C,IAAI,MAAM,QAAQ,EAAE;wBAClB,KAAK,MAAM,cAAc,MAAM,QAAQ,CAAE;4BACvC,YAAY,IAAI,CAAC,WAAW,EAAE;wBAChC;oBACF;gBACF;YACF;YAEA,QAAQ,GAAG,CAAC,4CAA4C;YAExD,mCAAmC;YACnC,gDAAgD;YAChD,uCAAuC;YACvC,cAAc,MAAM,gIAAM,CAAC,UAAU,CAAC,QAAQ,CAAC;gBAC7C,OAAO;oBACL,IAAI;wBACF;4BACE,qBAAqB;gCACnB,IAAI;4BACN;wBACF;wBACA;4BACE,UAAU;gCACR,MAAM;oCACJ,SAAS;wCACP,qBAAqB;4CACnB,IAAI;wCACN;oCACF;gCACF;4BACF;wBACF;qBACD;gBACH;gBACA,SAAS;oBACP,UAAU;oBACV,iBAAiB;gBACnB;gBACA,SAAS;oBACP,MAAM;gBACR;YACF;YAEA,QAAQ,GAAG,CAAC,sBAAsB,YAAY,MAAM,EAAE,YAAY,GAAG,CAAC,CAAA,IAAK,CAAC;oBAAE,MAAM,EAAE,IAAI;oBAAE,qBAAqB,EAAE,mBAAmB;gBAAC,CAAC;QAC1I,OAAO,IAAI,YAAY;YACrB,yDAAyD;YACzD,cAAc,MAAM,gIAAM,CAAC,UAAU,CAAC,QAAQ,CAAC;gBAC7C,OAAO;oBACL,aAAa,SAAS;gBACxB;gBACA,SAAS;oBACP,UAAU;oBACV,iBAAiB;gBACnB;gBACA,SAAS;oBACP,MAAM;gBACR;YACF;QACF,OAAO;YACL,mCAAmC;YACnC,cAAc,MAAM,gIAAM,CAAC,UAAU,CAAC,QAAQ,CAAC;gBAC7C,SAAS;oBACP,UAAU;oBACV,iBAAiB;gBACnB;gBACA,SAAS;oBACP,MAAM;gBACR;YACF;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA8B,GACvC;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}