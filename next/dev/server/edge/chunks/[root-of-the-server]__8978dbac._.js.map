{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport type { NextRequest } from \"next/server\";\r\nimport { getToken } from \"next-auth/jwt\";\r\nimport { hasAdminAccess } from \"@/utils/auth\";\r\n\r\nexport async function middleware(request: NextRequest) {\r\n  const { pathname } = request.nextUrl;\r\n\r\n  // Защищаем роуты /admin (кроме /admin - страницы входа с паролем)\r\n  if (pathname.startsWith(\"/admin\")) {\r\n    // Разрешаем доступ к основной странице /admin для ввода пароля\r\n    if (pathname === \"/admin\") {\r\n      // Проверяем, есть ли у пользователя право видеть страницу входа\r\n      const token = await getToken({\r\n        req: request,\r\n        secret: process.env.NEXTAUTH_SECRET,\r\n      });\r\n\r\n      // Если пользователь не авторизован или не имеет нужной роли - редирект на главную\r\n      if (!token || !token.role || !ADMIN_ROLES.includes(token.role)) {\r\n        const url = request.nextUrl.clone();\r\n        url.pathname = \"/\";\r\n        return NextResponse.redirect(url);\r\n      }\r\n\r\n      // Если роль подходит - разрешаем доступ к странице входа\r\n      return NextResponse.next();\r\n    }\r\n\r\n    // Для всех остальных админ-роутов проверяем сессию\r\n    const token = await getToken({\r\n      req: request,\r\n      secret: process.env.NEXTAUTH_SECRET,\r\n    });\r\n\r\n    // Проверяем роль пользователя\r\n    if (!token || !token.role || !ADMIN_ROLES.includes(token.role)) {\r\n      // Перенаправляем на главную страницу, если нет доступа\r\n      const url = request.nextUrl.clone();\r\n      url.pathname = \"/\";\r\n      return NextResponse.redirect(url);\r\n    }\r\n  }\r\n\r\n  return NextResponse.next();\r\n}\r\n\r\n// Настройка matcher для применения middleware только к нужным путям\r\nexport const config = {\r\n  matcher: [\r\n    // Применяем middleware к роутам админ-панели\r\n    \"/admin/:path*\",\r\n  ],\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;;;AAGO,eAAe,WAAW,OAAoB;IACnD,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,kEAAkE;IAClE,IAAI,SAAS,UAAU,CAAC,WAAW;QACjC,+DAA+D;QAC/D,IAAI,aAAa,UAAU;YACzB,gEAAgE;YAChE,MAAM,QAAQ,MAAM,IAAA,gKAAQ,EAAC;gBAC3B,KAAK;gBACL,QAAQ,QAAQ,GAAG,CAAC,eAAe;YACrC;YAEA,kFAAkF;YAClF,IAAI,CAAC,SAAS,CAAC,MAAM,IAAI,IAAI,CAAC,YAAY,QAAQ,CAAC,MAAM,IAAI,GAAG;gBAC9D,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;gBACjC,IAAI,QAAQ,GAAG;gBACf,OAAO,gMAAY,CAAC,QAAQ,CAAC;YAC/B;YAEA,yDAAyD;YACzD,OAAO,gMAAY,CAAC,IAAI;QAC1B;QAEA,mDAAmD;QACnD,MAAM,QAAQ,MAAM,IAAA,gKAAQ,EAAC;YAC3B,KAAK;YACL,QAAQ,QAAQ,GAAG,CAAC,eAAe;QACrC;QAEA,8BAA8B;QAC9B,IAAI,CAAC,SAAS,CAAC,MAAM,IAAI,IAAI,CAAC,YAAY,QAAQ,CAAC,MAAM,IAAI,GAAG;YAC9D,uDAAuD;YACvD,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;YACjC,IAAI,QAAQ,GAAG;YACf,OAAO,gMAAY,CAAC,QAAQ,CAAC;QAC/B;IACF;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAGO,MAAM,SAAS;IACpB,SAAS;QACP,6CAA6C;QAC7C;KACD;AACH"}}]
}