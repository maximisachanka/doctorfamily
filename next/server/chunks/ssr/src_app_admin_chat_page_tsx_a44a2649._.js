module.exports=[96518,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(75003),e=a.i(50944),f=a.i(96215),g=a.i(50751),h=a.i(41710),i=a.i(46842),j=a.i(20610),k=a.i(45222),l=a.i(56468);let m=(0,a.i(70106).default)("user-x",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);var n=a.i(96221),o=a.i(210),p=a.i(31371),q=a.i(9526),r=a.i(46271),s=a.i(62036),t=a.i(33508),u=a.i(92759),v=a.i(82434),w=a.i(81560),x=a.i(25170);function y({chatId:a,onClose:d}){let[e,f]=(0,c.useState)(null),[g,k]=(0,c.useState)(!0),[o,y]=(0,c.useState)(""),[z,A]=(0,c.useState)(!1),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(!1),[H,I]=(0,c.useState)(!1),J=(0,c.useRef)(null),K=(0,x.useAlert)(),L=(0,c.useCallback)(async()=>{try{let b=await fetch(`/api/operator-chat/${a}`);if(b.ok){let a=await b.json();f(a.chat)}else K.error("Не удалось загрузить чат","Ошибка")}catch(a){K.error("Ошибка при загрузке чата","Ошибка")}finally{k(!1)}},[a,K]);(0,c.useEffect)(()=>{L()},[L]),(0,c.useEffect)(()=>{e&&J.current?.scrollIntoView({behavior:"smooth"})},[e?.messages]);let M=async()=>{try{(await fetch(`/api/operator-chat/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"take"})})).ok?(K.success("Вы взяли чат","Успех"),L()):K.error("Не удалось взять чат","Ошибка")}catch(a){K.error("Ошибка при взятии чата","Ошибка")}},N=async()=>{try{(await fetch(`/api/operator-chat/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"CLOSED"})})).ok?(K.success("Чат закрыт","Успех"),d()):K.error("Не удалось закрыть чат","Ошибка")}catch(a){K.error("Ошибка при закрытии чата","Ошибка")}},O=async()=>{if(!e||D)return;let b=e.patient.is_messages_blocked?"unblock":"block";E(!0);try{let c=await fetch(`/api/operator-chat/${a}/block`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:b})}),e=await c.json();c.ok?(K.success("block"===b?"Пользователь заблокирован и все его чаты удалены":"Пользователь разблокирован","Успех"),"block"===b?d():(await L(),C(!1))):K.error(e.error||"Не удалось "+("block"===b?"заблокировать":"разблокировать")+" пользователя","Ошибка")}catch(a){K.error("Ошибка при блокировке/разблокировке","Ошибка")}finally{E(!1)}},P=async()=>{if(e&&!H){I(!0);try{let b=await fetch(`/api/operator-chat/${a}`,{method:"DELETE"}),c=await b.json();b.ok?(K.success("Чат удален","Успех"),d()):K.error(c.error||"Не удалось удалить чат","Ошибка")}catch(a){K.error("Ошибка при удалении чата","Ошибка")}finally{I(!1)}}},Q=async()=>{if(o.trim()&&!z){A(!0);try{let b=await fetch(`/api/operator-chat/${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:o.trim()})});if(b.ok)y(""),L();else{let a=await b.json();K.error(a.error||"Не удалось отправить сообщение","Ошибка")}}catch(a){K.error("Ошибка при отправке сообщения","Ошибка")}finally{A(!1)}}};return(0,b.jsx)(s.AnimatePresence,{children:(0,b.jsxs)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[(0,b.jsx)(r.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:d,className:"absolute inset-0 bg-black/50 backdrop-blur-sm"}),(0,b.jsx)(r.motion.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative z-10 w-full max-w-3xl bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[80vh]",children:g?(0,b.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,b.jsx)(n.Loader2,{className:"w-8 h-8 text-[#18A36C] animate-spin"})}):e?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"bg-white border-b border-gray-200 p-4 sm:p-6 flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 sm:gap-4 min-w-0",children:[e.patient.avatar_url?(0,b.jsx)("img",{src:e.patient.avatar_url,alt:e.patient.name,className:"w-12 h-12 sm:w-14 sm:h-14 rounded-full object-cover border-2 border-gray-200 flex-shrink-0"}):(0,b.jsx)("div",{className:"w-12 h-12 sm:w-14 sm:h-14 bg-gradient-to-br from-[#18A36C] to-[#15905f] rounded-full flex items-center justify-center shadow-md flex-shrink-0",children:(0,b.jsx)(i.User,{className:"w-6 h-6 sm:w-7 sm:h-7 text-white"})}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("h2",{className:"text-lg sm:text-xl font-bold text-gray-900 truncate",children:e.patient.name}),(0,b.jsx)("p",{className:"text-gray-600 text-xs sm:text-sm truncate",children:e.patient.email}),(0,b.jsxs)("div",{className:"mt-1.5 flex items-center gap-2 flex-wrap",children:[(a=>{switch(a){case"WAITING":return(0,b.jsx)(p.Badge,{variant:"outline",className:"border-amber-400 text-amber-700 bg-amber-50",children:"Ожидает"});case"ACTIVE":return(0,b.jsx)(p.Badge,{variant:"default",className:"bg-[#18A36C] text-white border-transparent shadow-sm",children:"Активный"});case"CLOSED":return(0,b.jsx)(p.Badge,{variant:"secondary",className:"bg-gray-200 text-gray-700",children:"Закрыт"});default:return null}})(e.status),e.patient.is_messages_blocked&&(0,b.jsxs)(p.Badge,{variant:"secondary",className:"bg-gray-700 text-white text-xs",children:[(0,b.jsx)(l.Ban,{className:"w-3 h-3 mr-1"}),"Заблокирован"]})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:["CLOSED"!==e.status&&(0,b.jsxs)(b.Fragment,{children:["WAITING"===e.status&&(0,b.jsx)(q.Button,{onClick:M,className:"bg-[#18A36C] text-white hover:bg-[#15905f] shadow-sm cursor-pointer",children:"Взять чат"}),"ACTIVE"===e.status&&(0,b.jsx)(q.Button,{onClick:N,variant:"outline",className:"text-gray-700 border-gray-300 cursor-pointer",children:"Закрыть чат"})]}),(0,b.jsx)("button",{onClick:()=>{G(!0)},title:"Удалить чат",className:"w-10 h-10 rounded-lg flex items-center justify-center transition-all bg-red-50 text-red-600 hover:bg-red-100 cursor-pointer",children:(0,b.jsx)(w.Trash2,{className:"w-5 h-5"})}),(0,b.jsx)("button",{onClick:()=>{e&&C(!0)},title:e.patient.is_messages_blocked?"Разблокировать":"Заблокировать",className:`w-10 h-10 rounded-lg flex items-center justify-center transition-all cursor-pointer ${e.patient.is_messages_blocked?"bg-[#18A36C]/10 text-[#18A36C] hover:bg-[#18A36C]/20":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:e.patient.is_messages_blocked?(0,b.jsx)(m,{className:"w-5 h-5"}):(0,b.jsx)(l.Ban,{className:"w-5 h-5"})}),(0,b.jsx)("button",{onClick:d,className:"w-10 h-10 rounded-lg bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600 transition-colors cursor-pointer",children:(0,b.jsx)(t.X,{className:"w-5 h-5"})})]})]}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-4 bg-gradient-to-b from-gray-50 to-white",children:[e.messages.map(a=>(0,b.jsxs)(r.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex gap-3 ${"operator"===a.sender_type?"flex-row-reverse":""}`,children:[a.sender.avatar_url?(0,b.jsx)("img",{src:a.sender.avatar_url,alt:a.sender.name,className:"w-10 h-10 rounded-full object-cover flex-shrink-0 shadow-sm"}):(0,b.jsx)("div",{className:`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 shadow-sm ${"operator"===a.sender_type?"bg-gradient-to-br from-[#18A36C] to-[#15905f]":"bg-gradient-to-br from-gray-400 to-gray-500"}`,children:"operator"===a.sender_type?(0,b.jsx)(v.Bot,{className:"w-5 h-5 text-white"}):(0,b.jsx)(i.User,{className:"w-5 h-5 text-white"})}),(0,b.jsxs)("div",{className:`max-w-[70%] ${"operator"===a.sender_type?"items-end":"items-start"} flex flex-col`,children:[(0,b.jsx)("div",{className:`rounded-2xl p-4 shadow-sm ${"operator"===a.sender_type?"bg-gradient-to-br from-[#18A36C] to-[#15905f] text-white":"bg-white text-gray-800 border border-gray-200"}`,children:(0,b.jsx)("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:a.content})}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-1.5 px-2",children:[(0,b.jsx)(h.Clock,{className:"w-3 h-3 text-gray-400"}),(0,b.jsx)("span",{className:"text-xs text-gray-500",children:new Date(a.created_at).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}),"operator"===a.sender_type&&a.is_read&&(0,b.jsx)(j.CheckCheck,{className:"w-4 h-4 text-[#18A36C]"})]})]})]},a.id)),(0,b.jsx)("div",{ref:J})]}),"CLOSED"!==e.status&&(0,b.jsx)("div",{className:"p-4 bg-white border-t border-gray-200",children:(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("input",{type:"text",value:o,onChange:a=>y(a.target.value),onKeyPress:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),Q())},placeholder:"Напишите сообщение...",disabled:z,className:"flex-1 px-4 py-3 bg-gray-50 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-[#18A36C] focus:border-transparent transition-all disabled:opacity-50"}),(0,b.jsx)("button",{onClick:Q,disabled:z||!o.trim(),className:"w-12 h-12 bg-gradient-to-br from-[#18A36C] to-[#15905f] rounded-xl flex items-center justify-center text-white hover:shadow-md hover:scale-105 transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 cursor-pointer",children:z?(0,b.jsx)(n.Loader2,{className:"w-5 h-5 animate-spin"}):(0,b.jsx)(u.Send,{className:"w-5 h-5"})})]})})]}):(0,b.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,b.jsx)("p",{className:"text-gray-600",children:"Чат не найден"})})}),B&&e&&(0,b.jsx)(r.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-20 flex items-center justify-center bg-black/40 backdrop-blur-sm",onClick:()=>C(!1),children:(0,b.jsxs)(r.motion.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},onClick:a=>a.stopPropagation(),className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden",children:[(0,b.jsx)("div",{className:`p-6 ${(e.patient.is_messages_blocked,"bg-gradient-to-r from-[#18A36C] to-[#15905f]")}`,children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center",children:e.patient.is_messages_blocked?(0,b.jsx)(m,{className:"w-6 h-6 text-white"}):(0,b.jsx)(l.Ban,{className:"w-6 h-6 text-white"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-bold text-white",children:e.patient.is_messages_blocked?"Разблокировать пользователя?":"Заблокировать пользователя?"}),(0,b.jsx)("p",{className:"text-sm text-white/80",children:e.patient.name})]})]})}),(0,b.jsx)("div",{className:"p-6",children:(0,b.jsx)("p",{className:"text-gray-700 leading-relaxed",children:e.patient.is_messages_blocked?"Пользователь сможет снова создавать новые чаты и отправлять сообщения.":"Пользователь не сможет создавать новые чаты и отправлять сообщения. Все его чаты будут удалены."})}),(0,b.jsxs)("div",{className:"px-6 pb-6 flex gap-3 justify-end",children:[(0,b.jsx)(q.Button,{variant:"outline",onClick:()=>C(!1),disabled:D,className:"border-gray-300 text-gray-700 hover:bg-gray-50 cursor-pointer",children:"Отмена"}),(0,b.jsxs)(q.Button,{onClick:O,disabled:D,className:e.patient.is_messages_blocked?"bg-[#18A36C] hover:bg-[#15905f] text-white shadow-md flex items-center gap-2 cursor-pointer":"bg-gray-700 hover:bg-gray-800 text-white shadow-md flex items-center gap-2 cursor-pointer",children:[D&&(0,b.jsx)(n.Loader2,{className:"w-4 h-4 animate-spin"}),e.patient.is_messages_blocked?"Разблокировать":"Заблокировать"]})]})]})}),F&&e&&(0,b.jsx)(r.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-20 flex items-center justify-center bg-black/40 backdrop-blur-sm",onClick:()=>G(!1),children:(0,b.jsxs)(r.motion.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},onClick:a=>a.stopPropagation(),className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden",children:[(0,b.jsx)("div",{className:"p-6 bg-gradient-to-r from-red-500 to-red-600",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center",children:(0,b.jsx)(w.Trash2,{className:"w-6 h-6 text-white"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-bold text-white",children:"Удалить чат?"}),(0,b.jsx)("p",{className:"text-sm text-white/80",children:e.patient.name})]})]})}),(0,b.jsx)("div",{className:"p-6",children:(0,b.jsx)("p",{className:"text-gray-700 leading-relaxed",children:"Все сообщения в этом чате будут удалены безвозвратно. Это действие нельзя отменить."})}),(0,b.jsxs)("div",{className:"px-6 pb-6 flex gap-3 justify-end",children:[(0,b.jsx)(q.Button,{variant:"outline",onClick:()=>G(!1),disabled:H,className:"border-gray-300 text-gray-700 hover:bg-gray-50 cursor-pointer",children:"Отмена"}),(0,b.jsxs)(q.Button,{onClick:P,disabled:H,className:"bg-red-500 hover:bg-red-600 text-white shadow-md flex items-center gap-2 cursor-pointer",children:[H&&(0,b.jsx)(n.Loader2,{className:"w-4 h-4 animate-spin"}),"Удалить"]})]})]})})]})})}var z=a.i(67974),A=a.i(48701);function B(){let{data:a,status:r}=(0,d.useSession)(),s=(0,e.useRouter)(),t=(0,x.useAlert)(),[u,v]=(0,c.useState)(null),[w,B]=(0,c.useState)(!0),[C,D]=(0,c.useState)([]),[E,F]=(0,c.useState)([]),[G,H]=(0,c.useState)(!0),[I,J]=(0,c.useState)(null),[K,L]=(0,c.useState)("ALL"),[M,N]=(0,c.useState)(null),{currentPage:O,setPage:P,paginateData:Q}=(0,A.useUrlPagination)(9),R=(0,c.useCallback)(async()=>{B(!0);try{let a=await fetch("/api/admin/auth"),b=await a.json();v(b.isAdmin||!1)}catch(a){v(!1)}finally{B(!1)}},[]);(0,c.useEffect)(()=>{"authenticated"===r?R():"unauthenticated"===r&&(B(!1),v(!1))},[r,R]);let S=(0,c.useCallback)(async()=>{try{H(!0);let a=await fetch("/api/operator-chat");if(a.ok){let b=await a.json();D(b.chats||[])}else t.error("Не удалось загрузить чаты","Ошибка")}catch(a){t.error("Ошибка при загрузке чатов","Ошибка")}finally{H(!1)}},[t]),T=(0,c.useCallback)(async()=>{try{let a=await fetch("/api/admin/blocked-users");if(a.ok){let b=await a.json();F(b.users||[])}else t.error("Не удалось загрузить заблокированных пользователей","Ошибка")}catch(a){t.error("Ошибка при загрузке заблокированных пользователей","Ошибка")}},[t]),U=async a=>{N(a);try{let b=await fetch("/api/admin/blocked-users",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:a})});if(b.ok)t.success("Пользователь разблокирован","Успех"),T();else{let a=await b.json();t.error(a.error||"Не удалось разблокировать пользователя","Ошибка")}}catch(a){t.error("Ошибка при разблокировке пользователя","Ошибка")}finally{N(null)}};if((0,c.useEffect)(()=>{u&&(S(),T())},[u,S,T]),(0,c.useEffect)(()=>{"unauthenticated"===r&&s.push("/account?section=login")},[r,s]),(0,c.useEffect)(()=>{P(1)},[K]),"loading"===r||null===u||w)return(0,b.jsx)(f.AdminAccessSkeleton,{});if(!u)return s.push("/"),(0,b.jsx)(f.AdminAccessSkeleton,{});let V="ALL"===K?C:C.filter(a=>a.status===K),W=C.filter(a=>"WAITING"===a.status).length,X=C.filter(a=>"ACTIVE"===a.status).length,Y=E.length,Z=Math.ceil(V.length/9),$=V.slice((O-1)*9,9*O),_=Math.ceil(E.length/9),aa=E.slice((O-1)*9,9*O);return(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,b.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-6 lg:py-8",children:[(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-[#18A36C] to-[#15905f] rounded-xl flex items-center justify-center shadow-md",children:(0,b.jsx)(g.MessagesSquare,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"Чат с пациентами"}),(0,b.jsx)("p",{className:"text-xs sm:text-sm text-gray-600",children:"Управление обращениями"})]})]}),(0,b.jsxs)(q.Button,{variant:"outline",onClick:()=>s.push("/admin"),className:"flex items-center gap-2 hover:bg-gray-50 self-start sm:self-auto cursor-pointer",children:[(0,b.jsx)(o.ArrowLeft,{className:"w-4 h-4"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Назад в админ-панель"}),(0,b.jsx)("span",{className:"sm:hidden",children:"Назад"})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,b.jsxs)(q.Button,{variant:"ALL"===K?"default":"outline",onClick:()=>L("ALL"),className:"ALL"===K?"bg-[#18A36C] hover:bg-[#15905f] shadow-sm text-white cursor-pointer":"hover:bg-gray-50 cursor-pointer",children:["Все (",C.length,")"]}),(0,b.jsxs)(q.Button,{variant:"WAITING"===K?"default":"outline",onClick:()=>L("WAITING"),className:"WAITING"===K?"bg-[#18A36C] hover:bg-[#15905f] shadow-sm text-white cursor-pointer":"hover:bg-gray-50 cursor-pointer",children:["Ожидают (",W,")"]}),(0,b.jsxs)(q.Button,{variant:"ACTIVE"===K?"default":"outline",onClick:()=>L("ACTIVE"),className:"ACTIVE"===K?"bg-[#18A36C] hover:bg-[#15905f] shadow-sm text-white cursor-pointer":"hover:bg-gray-50 cursor-pointer",children:["Активные (",X,")"]}),(0,b.jsx)(q.Button,{variant:"CLOSED"===K?"default":"outline",onClick:()=>L("CLOSED"),className:"CLOSED"===K?"bg-[#18A36C] hover:bg-[#15905f] shadow-sm text-white cursor-pointer":"hover:bg-gray-50 cursor-pointer",children:"Закрытые"}),(0,b.jsxs)(q.Button,{variant:"BLOCKED"===K?"default":"outline",onClick:()=>L("BLOCKED"),className:"BLOCKED"===K?"bg-red-500 hover:bg-red-600 shadow-sm text-white cursor-pointer":"hover:bg-gray-50 text-red-600 border-red-300 cursor-pointer",children:["Заблокированные (",Y,")"]})]})]}),G?(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(a=>(0,b.jsxs)("div",{className:"bg-white rounded-lg p-6 border border-gray-200 animate-pulse",children:[(0,b.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-4"}),(0,b.jsx)("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]},a))}):"BLOCKED"===K?0===E.length?(0,b.jsxs)("div",{className:"bg-white rounded-lg p-12 text-center border border-gray-200",children:[(0,b.jsx)(k.MessageCircle,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Нет заблокированных пользователей"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Заблокированные пользователи появятся здесь"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:aa.map(a=>(0,b.jsxs)("div",{className:"bg-white rounded-xl p-5 border-2 border-red-300 bg-red-50/20 shadow-sm",children:[(0,b.jsx)("div",{className:"flex items-start justify-between mb-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[a.avatar_url?(0,b.jsx)("img",{src:a.avatar_url,alt:a.name,className:"w-12 h-12 rounded-full object-cover shadow-sm"}):(0,b.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-gray-400 to-gray-500 rounded-full flex items-center justify-center shadow-sm",children:(0,b.jsx)(i.User,{className:"w-6 h-6 text-white"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:a.name}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:a.email})]})]})}),(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsxs)(p.Badge,{variant:"secondary",className:"bg-red-100 text-red-700 border-red-300 mb-2",children:[(0,b.jsx)(l.Ban,{className:"w-3 h-3 mr-1"}),"Заблокирован"]}),a.phone&&(0,b.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:a.phone})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1.5 text-xs text-gray-500",children:[(0,b.jsx)(h.Clock,{className:"w-3.5 h-3.5"}),(0,b.jsx)("span",{children:new Date(a.registration_date).toLocaleDateString("ru-RU")})]}),(0,b.jsxs)(q.Button,{onClick:()=>U(a.id),disabled:M===a.id,className:"bg-[#18A36C] hover:bg-[#15905f] text-white text-xs px-3 py-1.5 flex items-center gap-1.5 cursor-pointer",children:[M===a.id?(0,b.jsx)(n.Loader2,{className:"w-3.5 h-3.5 animate-spin"}):(0,b.jsx)(m,{className:"w-3.5 h-3.5"}),"Разблокировать"]})]})]},a.id))}),_>1&&(0,b.jsx)(z.Pagination,{currentPage:O,totalPages:_,onPageChange:P,className:"mt-6"})]}):0===V.length?(0,b.jsxs)("div",{className:"bg-white rounded-lg p-12 text-center border border-gray-200",children:[(0,b.jsx)(k.MessageCircle,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,b.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:["ALL"===K&&"Нет чатов","WAITING"===K&&"Нет ожидающих чатов","ACTIVE"===K&&"Нет активных чатов","CLOSED"===K&&"Нет закрытых чатов"]}),(0,b.jsxs)("p",{className:"text-gray-600",children:["WAITING"===K&&"Когда пациенты напишут, их чаты появятся здесь","ACTIVE"===K&&"Нет активных чатов в данный момент","CLOSED"===K&&"Нет закрытых чатов","ALL"===K&&"Чаты появятся когда пациенты начнут писать"]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:$.map(a=>(0,b.jsxs)("div",{className:`bg-white rounded-xl p-5 border-2 transition-all cursor-pointer ${a.has_unread_operator?"border-[#18A36C] bg-[#18A36C]/5 shadow-sm hover:shadow-md":"border-gray-200 hover:border-[#18A36C]/50 hover:shadow-md"}`,onClick:()=>J(a.id),children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[a.patient.avatar_url?(0,b.jsx)("img",{src:a.patient.avatar_url,alt:a.patient.name,className:"w-12 h-12 rounded-full object-cover shadow-sm"}):(0,b.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-[#18A36C] to-[#15905f] rounded-full flex items-center justify-center shadow-sm",children:(0,b.jsx)(i.User,{className:"w-6 h-6 text-white"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:a.patient.name}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:a.patient.email})]})]}),a.has_unread_operator&&(0,b.jsx)("div",{className:"w-2.5 h-2.5 bg-red-500 rounded-full animate-pulse"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-3 flex-wrap",children:[(a=>{switch(a){case"WAITING":return(0,b.jsx)(p.Badge,{variant:"outline",className:"border-amber-400 text-amber-700 bg-amber-50",children:"Ожидает"});case"ACTIVE":return(0,b.jsx)(p.Badge,{variant:"default",className:"bg-[#18A36C] text-white border-transparent shadow-sm",children:"Активный"});case"CLOSED":return(0,b.jsx)(p.Badge,{variant:"secondary",className:"bg-gray-200 text-gray-700",children:"Закрыт"});default:return null}})(a.status),a.operator&&(0,b.jsxs)("span",{className:"text-xs text-gray-500",children:["Оператор: ",a.operator.name]})]}),a.messages.length>0&&(0,b.jsx)("div",{className:"mb-3",children:(0,b.jsx)("p",{className:"text-sm text-gray-700 line-clamp-2",children:a.messages[0].content})}),(0,b.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 pt-3 border-t border-gray-100",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsx)(h.Clock,{className:"w-3.5 h-3.5"}),(0,b.jsx)("span",{children:a.last_message_at?(a=>{let b=new Date,c=new Date(a),d=Math.floor((b.getTime()-c.getTime())/6e4);if(d<1)return"только что";if(d<60)return`${d} мин назад`;let e=Math.floor(d/60);if(e<24)return`${e} ч назад`;let f=Math.floor(e/24);return`${f} д назад`})(a.last_message_at):"Нет сообщений"})]}),a.has_unread_operator?(0,b.jsx)("span",{className:"text-[#18A36C] font-semibold",children:"Новое"}):(0,b.jsx)(j.CheckCheck,{className:"w-4 h-4 text-gray-400"})]})]},a.id))}),Z>1&&(0,b.jsx)(z.Pagination,{currentPage:O,totalPages:Z,onPageChange:P,className:"mt-6"})]})]}),I&&(0,b.jsx)(y,{chatId:I,onClose:()=>{J(null),S(),T()}})]})}a.s(["default",()=>B,"dynamic",0,"force-dynamic"],96518)}];

//# sourceMappingURL=src_app_admin_chat_page_tsx_a44a2649._.js.map